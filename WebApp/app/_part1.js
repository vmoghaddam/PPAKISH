"use strict";app.controller("flightDelaysController",["$scope","$location","$routeParams","$rootScope","flightService","weatherService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d,s){e.prms=i.prms;var c=[{text:"By Code",id:"code"},{text:"By Source Airport",id:"source"},{text:"By Register",id:"register"},{text:"By Route",id:"route"},{text:"Details",id:"details"}];e.tabs=c,e.$watch("selectedTabIndex",function(e){$(".tabc").hide();var t=c[e].id;$("#"+t).fadeIn()}),e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex"}},e.selectedTabIndex=0,e.boardSummary={arrived:"-",flights:"-",flightTime:"-",flightTimeStr:"-",fixTime:"-",blockTime:"-",blockTimeStr:"-",cancled:"-",delayRatio:"-",delay:"-",delayStr:"-",pax:"-",seat:"-",paxLoad:"-"};(new Date).getTimezoneOffset();e.dsUrl=null,e.formatMinutes=function(e){return pad(Math.floor(e/60)).toString()+":"+pad(e%60).toString()},e.bind=function(){var t=e.dt_to?e.dt_to:new Date(2200,4,19,0,0,0),i=e.dt_from?e.dt_from:new Date(1900,4,19,0,0,0);e.boardSummary={arrived:"-",flights:"-",flightTime:"-",flightTimeStr:"-",fixTime:"-",blockTime:"-",blockTimeStr:"-",cancled:"-",delayRatio:"-",delay:"-",delayStr:"-",pax:"-",seat:"-",paxLoad:"-"},e.loadingVisible=!0,a.getSummary(Config.CustomerId,i,t).then(function(n){e.loadingVisible=!1,e.boardSummary.arrived=n.arrived,e.boardSummary.flights=n.flights,e.boardSummary.flightTime=n.flightTime,e.boardSummary.flightTimeStr=e.formatMinutes(n.flightTime),e.boardSummary.fixTime=n.fixTime,e.boardSummary.blockTime=n.blockTime,e.boardSummary.blockTimeStr=e.formatMinutes(n.blockTime),e.boardSummary.cancled=n.cancled,e.boardSummary.delayRatio=n.delayRatio,e.boardSummary.delay=n.delay,e.boardSummary.delayStr=e.formatMinutes(n.delay),e.boardSummary.pax=n.pax,e.boardSummary.seat=n.seat,e.boardSummary.paxLoad=n.paxLoad,a.getDelaysTotalByCode(Config.CustomerId,i,t).then(function(n){e.loadingVisible=!1,$.each(n,function(e,t){var i=t.TotalDelay;t.TotalDelay2=pad(Math.floor(i/60)).toString()+":"+pad(i%60).toString()}),e.dg_ds=n,a.getDelaysTotalBySource(Config.CustomerId,i,t).then(function(n){$.each(n,function(e,t){var i=t.TotalDelay;t.TotalDelay2=pad(Math.floor(i/60)).toString()+":"+pad(i%60).toString()}),e.dg_src_ds=n,e.grp_src=Enumerable.From(n).GroupBy("$.FromAirportIATA",null,function(e,t){return{FromAirportIATA:e,TotalDelay:t.Sum("$.TotalDelay"),Items:t.OrderBy("$.TotalDelay").ToArray()}}).ToArray(),a.getDelaysTotalByRegister(Config.CustomerId,i,t).then(function(n){e.grp_reg=Enumerable.From(n).GroupBy("$.Register",null,function(e,t){return{Register:e,TotalDelay:t.Sum("$.TotalDelay"),Items:t.OrderBy("$.TotalDelay").ToArray()}}).ToArray(),$.each(n,function(e,t){var i=t.TotalDelay;t.TotalDelay2=pad(Math.floor(i/60)).toString()+":"+pad(i%60).toString()}),e.dg_reg_ds=n,a.getDelaysTotalByRoute(Config.CustomerId,i,t).then(function(t){e.grp_route=Enumerable.From(t).GroupBy("$.Route",null,function(e,t){return{Route:e,TotalDelay:t.Sum("$.TotalDelay"),Items:t.OrderBy("$.TotalDelay").ToArray()}}).ToArray(),$.each(t,function(e,t){var i=t.TotalDelay;t.TotalDelay2=pad(Math.floor(i/60)).toString()+":"+pad(i%60).toString()}),e.dg_route_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.btn_search={text:"Search",type:"success",icon:"search",width:120,validationGroup:"crewreportsearch",bindingOptions:{},onClick:function(t){e.dg_ds=null,e.bind()}},e.selected_employee_id=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dt_from=(new Date).addDays(-30),e.dt_to=new Date,e.date_from={type:"date",placeholder:"From",width:"100%",bindingOptions:{value:"dt_from"}},e.date_to={type:"date",placeholder:"To",width:"100%",bindingOptions:{value:"dt_to"}},e.scroll_height=$(window).height()-245,e.scroll_main={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.filters=[],e.dg_columns=[{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60,fixed:!1,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60,fixed:!1,fixedPosition:"left"},{dataField:"DelayRemark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"Flights",caption:"Legs",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"TotalDelay2",caption:"Delay",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!1,fixedPosition:"right"}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={wordWrapEnabled:!0,headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-275,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},summary:{totalItems:[{name:"DelayTotal",showInColumn:"TotalDelay2",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"DelayTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.TotalDelay,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_ds"}},e.pie_code={type:"doughnut",palette:"bright",size:{height:$(window).height()-265},bindingOptions:{dataSource:"dg_ds"},margin:{top:20},legend:{orientation:"horizontal",itemTextPosition:"right",horizontalAlignment:"center",verticalAlignment:"bottom",columnCount:10},export:{enabled:!1},series:[{argumentField:"Title",valueField:"TotalDelay",label:{visible:!0,font:{size:12},connector:{visible:!0,width:.5},position:"outside",customizeText:function(e){return e.argumentText+" ("+e.percentText+")"}}}]},e.pie_src={type:"doughnut",palette:"ocean",size:{height:$(window).height()-400},bindingOptions:{dataSource:"grp_src"},margin:{top:20},legend:{orientation:"horizontal",itemTextPosition:"right",horizontalAlignment:"center",verticalAlignment:"bottom",columnCount:10},export:{enabled:!1},series:[{argumentField:"FromAirportIATA",valueField:"TotalDelay",label:{visible:!0,font:{size:12},connector:{visible:!0,width:.5},position:"outside",customizeText:function(e){return e.argumentText+" ("+e.percentText+")"}}}],onPointClick:function(t){var i=t.target;e.grp_src_items=i.data.Items}},e.bar_src={palette:"ocean",legend:{visible:!1},size:{height:200},bindingOptions:{dataSource:"grp_src_items"},series:{barWidth:30,argumentField:"Code",valueField:"TotalDelay",type:"bar"}},e.pie_reg={type:"doughnut",palette:"vintage",size:{height:$(window).height()-400},bindingOptions:{dataSource:"grp_reg"},margin:{top:20},legend:{orientation:"horizontal",itemTextPosition:"right",horizontalAlignment:"center",verticalAlignment:"bottom",columnCount:10},export:{enabled:!1},series:[{argumentField:"Register",valueField:"TotalDelay",label:{visible:!0,font:{size:12},connector:{visible:!0,width:.5},position:"outside",customizeText:function(e){return e.argumentText+" ("+e.percentText+")"}}}],onPointClick:function(t){var i=t.target;e.grp_reg_items=i.data.Items}},e.bar_reg={palette:"vintage",legend:{visible:!1},size:{height:200},bindingOptions:{dataSource:"grp_reg_items"},series:{barWidth:30,argumentField:"Code",valueField:"TotalDelay",type:"bar"}},e.pie_route={type:"doughnut",palette:"violet",size:{height:$(window).height()-400},bindingOptions:{dataSource:"grp_route"},margin:{top:20},legend:{orientation:"horizontal",itemTextPosition:"right",horizontalAlignment:"center",verticalAlignment:"bottom",columnCount:10},export:{enabled:!1},series:[{argumentField:"Route",valueField:"TotalDelay",label:{visible:!0,font:{size:12},connector:{visible:!0,width:.5},position:"outside",customizeText:function(e){return e.argumentText+" ("+e.percentText+")"}}}],onPointClick:function(t){var i=t.target;e.grp_route_items=i.data.Items}},e.bar_route={palette:"violet",legend:{visible:!1},size:{height:200},bindingOptions:{dataSource:"grp_route_items"},series:{barWidth:30,argumentField:"Code",valueField:"TotalDelay",type:"bar"}},e.dg_src_columns=[{dataField:"FromAirportIATA",caption:"Airport",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!1,fixedPosition:"left"},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60,fixed:!1,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60,fixed:!1,fixedPosition:"left"},{dataField:"DelayRemark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"Flights",caption:"Legs",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"TotalDelay2",caption:"Delay",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!1,fixedPosition:"right"}],e.dg_src_selected=null,e.dg_src_instance=null,e.dg_src_ds=null,e.grp_src=null,e.dg_src={wordWrapEnabled:!0,headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-175,columns:e.dg_src_columns,onContentReady:function(t){e.dg_src_instance||(e.dg_src_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_src_selected=i||null},summary:{totalItems:[{name:"DelayTotal",showInColumn:"TotalDelay2",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"DelayTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.TotalDelay,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_src_ds"}},e.dg_reg_columns=[{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!1,fixedPosition:"left"},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60,fixed:!1,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60,fixed:!1,fixedPosition:"left"},{dataField:"DelayRemark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"Flights",caption:"Legs",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"TotalDelay2",caption:"Delay",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!1,fixedPosition:"right"}],e.dg_reg_selected=null,e.dg_reg_instance=null,e.dg_reg_ds=null,e.dg_reg={wordWrapEnabled:!0,headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-175,columns:e.dg_reg_columns,onContentReady:function(t){e.dg_reg_instance||(e.dg_reg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_reg_selected=i||null},summary:{totalItems:[{name:"DelayTotal",showInColumn:"TotalDelay2",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"DelayTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.TotalDelay,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_reg_ds"}},e.dg_route_columns=[{dataField:"Route",caption:"Route",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:110,fixed:!1,fixedPosition:"left"},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60,fixed:!1,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60,fixed:!1,fixedPosition:"left"},{dataField:"DelayRemark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"Flights",caption:"Legs",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"TotalDelay2",caption:"Delay",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!1,fixedPosition:"right"}],e.dg_route_selected=null,e.dg_route_instance=null,e.dg_route_ds=null,e.dg_route={wordWrapEnabled:!0,headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-175,columns:e.dg_route_columns,onContentReady:function(t){e.dg_route_instance||(e.dg_route_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_route_selected=i||null},summary:{totalItems:[{name:"DelayTotal",showInColumn:"TotalDelay2",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"DelayTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.TotalDelay,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_route_ds"}},e.dg_flight_columns=[{dataField:"Date",caption:"Date",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:150,format:"yyyy-MMM-dd"},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!1,fixedPosition:"left"},{dataField:"Position",caption:"Position",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{caption:"Airports",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80}]},{caption:"Departure",columns:[{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Arrival",columns:[{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Times",fixed:!0,fixedPosition:"right",columns:[{dataField:"FlightTime2",caption:"Flight Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"BlockTime",caption:"Block Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"Duty2",caption:"Duty",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100}]}],e.dg_flight_selected=null,e.dg_flight_instance=null,e.dg_flight_ds=null,e.dg_flight={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-235,columns:e.dg_flight_columns,onContentReady:function(t){e.dg_flight_instance||(e.dg_flight_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_flight_selected=i||null},summary:{totalItems:[{name:"FlightTimeTotal",showInColumn:"FlightTime2",displayFormat:"{0}",summaryType:"custom"},{name:"BlockTimeTotal",showInColumn:"BlockTime",displayFormat:"{0}",summaryType:"custom"},{name:"DutyTotal",showInColumn:"Duty",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"FlightTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.FlightH+e.value.FlightM,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"BlockTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.ActualFlightHOffBlock+e.value.ActualFlightMOffBlock,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"DutyTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.Duty,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_flight_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind1=function(){var t=moment(e.dt_from).format("YYYY-MM-DDTHH:mm:ss");console.log(e.dt_from);var i="odata/crew/report/main?date="+t;e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+i,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}}}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},r.isAuthorized()?(n.page_title="> Delays",$(".flightdelays").fadeIn()):r.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onPersonSaved",function(t,i){e.doRefresh=!0}),e.$on("onPersonHide",function(t,i){e.bind()}),n.$broadcast("PersonLoaded",null)}]),app.controller("flightPlanListController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.filterVisible=!1,e.plan={},e.IsDetailsVisible=!1,e.IsTabDisabled=!1,e.tabs=[{text:"Calendar",id:"calendar"},{text:"Legs",id:"legs"},{text:"Information",id:"information"},{text:"Registers",id:"registers"}],e.$watch("selectedTabIndex",function(t){try{e.selectedTab=e.tabs[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_reg_instance.repaint()}catch(e){}}),e.selectedTabIndex=0,e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex",disabled:"IsTabDisabled"}},e.minDate=new Date,e.maxDate=new Date,e.scheduleCurrentDate=null,e.data=[],e.scheduler_instance=null,e.schedulerOptions={onContentReady:function(t){e.scheduler_instance||(e.scheduler_instance=t.component)},views:["month"],currentView:"month",startDayHour:0,endDayHour:24,showCurrentTimeIndicator:!1,height:function(){return window.innerHeight-180},appointmentTemplate:function(e){return $("<div style='text-align:center; height:30px;color:green;background:white;margin-top:-5px'><i style='font-size:24px' class='icon ion-md-checkmark'></i></div>")},editing:{allowAdding:!1,allowUpdating:!1,allowDeleting:!0,allowResizing:!1,allowDragging:!1},onAppointmentClick:function(e){e.cancel=!0},onAppointmentDblClick:function(e){e.cancel=!0},onCellClick:function(e){e.cancel=!0},bindingOptions:{dataSource:"data",min:"plan.DateFrom",max:"plan.DateTo",currentDate:"scheduleCurrentDate"}},e.scroll_height=200,e.scroll_calendar={scrollByContent:!0,scrollByThumb:!0,height:function(){return window.innerHeight-180}},e.scroll_info={scrollByContent:!0,scrollByThumb:!0,height:function(){return window.innerHeight-180}},e.tempData=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.btn_view={text:"View",type:"default",icon:"info",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.loadingVisible=!0,a.getFlightPlanView(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,e.tempData=t,e.popup_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.btn_edit={text:"Make Editable",type:"default",icon:"info",width:200,onClick:function(t){return e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?e.dg_selected.IsApproved50?(e.loadingVisible=!0,void a.makePlanEditable(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,e.$broadcast("getFilterQuery",null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):void General.ShowNotify("The selected plan is not approved","error"):void General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.IsApproveDisabled=!0,e.btn_approve={text:"Approve",type:"default",icon:"check",width:150,bindingOptions:{disabled:"IsApproveDisabled"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_SimpleConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.approvePlanRegisters(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.IsApproveDisabled=!0,e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.addCustom=function(t,i,n,a){if(n&&0!=n.length&&a&&0!=a.length)for(;t<=i;){var o=!1,l=!1;o=!n||0==n.length||-1!=n.indexOf(t.getMonth()),l=!a||0==a.length||-1!=a.indexOf(t.getDay()),o&&l&&e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(1)}},e.addDaily=function(t,i,n){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(n)},e.addMonthly=function(t,i){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(30)},e.fillSchedule=function(){if(e.data=[],e.plan.Interval&&e.plan.DateFrom&&e.plan.DateTo){var t=new Date(e.plan.DateFrom);t=new Date(t.setHours(0,0,0,0));var i=new Date(e.plan.DateTo);switch(i=new Date(i.setHours(23,59,59,999)),e.plan.Interval){case 1:e.addDaily(t,i,1);break;case 2:e.addDaily(t,i,7);break;case 3:e.addDaily(t,i,10);break;case 4:e.addDaily(t,i,14);break;case 5:e.addDaily(t,i,15);break;case 100:e.addCustom(t,i,e.plan.Months,e.plan.Days)}}e.scheduler_instance.repaint()},e.date_from={type:"date",readOnly:!0,width:"100%",bindingOptions:{value:"plan.DateFrom"}},e.date_to={type:"date",readOnly:!0,width:"100%",bindingOptions:{value:"plan.DateTo"}},e.text_interval={readOnly:!0,width:"100%",bindingOptions:{value:"plan.IntervalType"}},e.text_month={readOnly:!0,width:"100%",bindingOptions:{value:"plan.MonthsStr"}},e.text_day={readOnly:!0,width:"100%",bindingOptions:{value:"plan.DaysStr"}},e.text_type={readOnly:!0,width:"100%",bindingOptions:{value:"plan.Types"}},e.dg_height_full=100,e.scroll_height_full=400,e.fillPlan=function(t){e.plan=t,e.plan.Interval=Number(e.plan.Interval),e.scheduleCurrentDate=new Date(e.plan.DateFrom),e.fillSchedule()},e.dg_selected=null,e.dg_columns=[{dataField:"",caption:"Applied",width:85,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){(t.data.IsApproved50||1==t.data.IsApproved50)&&$("<div>").append("<i style='font-size:22px;color:#4CAF50!important' class='icon ion-md-checkmark-circle'></i>").appendTo(e)},fixed:!0,fixedPosition:"left",alignment:"center"},{dataField:"Id",caption:"No",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",fixed:!0,fixedPosition:"left"},{dataField:"BaseIATA",caption:"Base",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"Types",caption:"Types",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:120},{dataField:"DateFrom",caption:"From",allowResizing:!0,dataType:"date",allowEditing:!1,width:130,alignment:"center",sortIndex:1,sortOrder:"asc",fixed:!1,fixedPosition:"right"},{dataField:"DateTo",caption:"To",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!1,fixedPosition:"right"},{dataField:"IntervalType",caption:"Interval",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:120}],e.dg_height=100,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];if(i)if(e.dg_selected=i,e.dg_selected.summary)e.dg_reg_ds=e.dg_selected.summary.AssignedRegisters,e.fillPlan(e.dg_selected.summary);else{e.selectedTabIndex=0,e.IsTabDisabled=!0,e.loadingVisible=!0;var n=-1*(new Date).getTimezoneOffset(),o={Id:e.dg_selected.Id,Offset:n};a.getPlanItemsById(o).then(function(t){e.dg_leg_ds=t,a.getFlightPlanSummary(e.dg_selected.Id,n).then(function(t){e.loadingVisible=!1,e.IsDetailsVisible=!0,e.dg_selected.summary=t;var i=setInterval(function(){e.fillPlan(e.dg_selected.summary),e.IsTabDisabled=!1,clearInterval(i)},200);e.dg_reg_ds=e.dg_selected.summary.AssignedRegisters,console.log(e.dg_reg_ds)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else e.dg_selected=null,e.IsDetailsVisible=!1,e.dg_reg_ds=null,e.dg_leg_ds=null},height:"100%",bindingOptions:{dataSource:"dg_ds"}},e.dg_reg_columns=[{dataField:"DateFromTo",caption:"Date",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,groupIndex:0,width:200},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,groupIndex:1,width:200},{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Dep.",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:120,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arr.",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:120,format:"HH:mm"}],e.dg_reg_selected=null,e.dg_reg_instance=null,e.dg_reg_ds=null,e.dg_reg_height=null,e.dg_reg={grouping:{autoExpandAll:!0,allowCollapsing:!0},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_reg_columns,onContentReady:function(t){e.dg_reg_instance||(e.dg_reg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_reg_selected=i||null},height:function(){return window.innerHeight-175},bindingOptions:{dataSource:"dg_reg_ds"}},e.dg_leg_columns=[{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300}],e.dg_leg_selected=null,e.dg_leg_instance=null,e.dg_leg_ds=null,e.dg_leg_height=null,e.dg_leg={grouping:{autoExpandAll:!0,allowCollapsing:!0},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_leg_columns,onContentReady:function(t){e.dg_leg_instance||(e.dg_leg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_leg_selected=i||null},height:function(){return window.innerHeight-175},bindingOptions:{dataSource:"dg_leg_ds"}},e.bind=function(){var t="odata/flightplans/approved/customer/"+Config.CustomerId+"/"+-1;!e.dg_ds&&e.doRefresh&&(e.dg_ds={
store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Id",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},l.isAuthorized()?(n.page_title="> Flight Plans",$(".flightplanlist").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("flightPlanRegsiterController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.filterVisible=!1,e.minDate=new Date,e.maxDate=new Date,e.itemCaption="Plan Name",e.IsDetailsVisible=!0,e.IsRegistersVisible=!1,e.doSetRegisters=!1,e.EditVisible=!1,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".filter").show())}},e.getOverlap=function(t,i,n){return Enumerable.From(e.registers).Where(function(e){return e.RegisterId==t&&(new Date(i)>=new Date(e.DateFrom)&&new Date(i)<=new Date(e.DateTo)||new Date(n)>=new Date(e.DateFrom)&&new Date(n)<=new Date(e.DateTo))}).ToArray().length>0},e.createRanges=function(t){var i=datediff(new Date(e.plan.DateFrom),new Date(e.plan.DateTo)),n=Enumerable.From(e.registers).Where("$.PlannedRegisterId=="+t).OrderBy(function(e){return new Date(e.DateFrom)}).ToArray(),a=Enumerable.From(e.registers).Where("$.PlannedRegisterId=="+t).OrderByDescending(function(e){return new Date(e.DateFrom)}).FirstOrDefault(),o=a?datediff(new Date(a.DateTo),new Date(e.plan.DateTo)):i,l=[],r=[],d=(Enumerable.From(n).GroupBy("{ Register: $.Register }",null,function(e,t){var i=(e.Register,[]);t.ForEach(function(e){i.push(e)}),r.push(i)},"$.Register").ToArray(),[]);if($.each(r,function(e,t){var i={DateFrom:t[0].DateFrom,DateTo:t[t.length-1].DateTo,Register:t[0].Register};d.push(i)}),$.each(d,function(e,t){var i=datediff(new Date(t.DateFrom),new Date(t.DateTo)),n=i;0==n&&(n=1),l.push({ratio:n,text:t.Register,bgColor:Colors.getColor(e%Colors.Palette.length)})}),o>0&&l.push({ratio:o,text:"",bgColor:"white"}),console.log(l),$("#date_range").length>0&&($("#date_range").dxBox("dispose"),$("#date_range").remove()),l.length>0){var s='<div   id="date_range" >';$.each(l,function(e,t){s+='<div class="rect" style="background:'+t.bgColor+'" data-options="dxItem: {ratio: '+t.ratio+'}">'+t.text+"</div>"}),s+="</div>",$("#range_container").html(s),$("#date_range").dxBox({direction:"row",width:"100%",height:30})}},e.btn_add={text:"",type:"default",icon:"plus",width:40,validationGroup:"fpregisteradd",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i=General.getDayFirstHour(e.entity.DateFrom);if(General.getDayLastHour(e.entity.DateTo)<i)return void General.ShowNotify(Config.Text_InvalidDates,"error");e.entity.PlannedRegisterId=e.plan.VirtualRegisterId;var n=e.duplicateEntity(e.entity);if(n.DateFrom=new Date(e.entity.DateFrom).ToUTC(),n.DateTo=new Date(e.entity.DateTo).ToUTC(),n.Register=e.selectedMsn.Register,n.PlannedREgister="-",n.Id=-1*(e.registers.length+1),e.getOverlap(n.RegisterId,n.DateFrom,n.DateTo))return void General.ShowNotify("Overlap","error");e.loadingVisible=!0,a.checkOverlap(e.plan.Id,e.plan.VirtualRegisterId,n.RegisterId,new Date(n.DateFrom).toUTCDateTimeDigits(),new Date(n.DateTo).toUTCDateTimeDigits()).then(function(t){if(e.loadingVisible=!1,!t)return void General.ShowNotify("Overlap","error");e.registers.push(n),e.setRegisterDs(e.plan.VirtualRegisterId,e.plan.VirtualTypeId),e.createRanges(e.plan.VirtualRegisterId),e.fillSchedule(),e.clearEntity();var i=new Date(n.DateTo).addDays(1);i>e.maxDate||(e.entity.DateFrom=i)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.btn_approve={text:"Approve",type:"default",icon:"ion ion-md-lock",width:150,bindingOptions:{disabled:"IsApproved"},onClick:function(t){General.Confirm(Config.Text_SimpleConfirm,function(t){if(t){var i={Id:e.plan.Id};e.loadingVisible=!0,a.approvePlanRegisters(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.IsApproved=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.IsDeleteDisabled=!0,e.deleted=[],e.btn_delete={text:"",type:"danger",icon:"clear",width:40,bindingOptions:{disabled:"IsDeleteDisabled"},onClick:function(t){e.dg_reg_selected.Id;e.dg_reg_selected.Id>0&&e.deleted.push(e.dg_reg_selected.Id),e.entity.DateFrom=new Date(e.dg_reg_selected.DateFrom);var i=e.dg_reg_instance.getRowIndexByKey(e.dg_reg_selected);e.dg_reg_instance.deleteRow(i)}},e.boxOptions1={direction:"row",width:"100%",height:50},e.getGantt=function(){return $("#resourceGanttpr").data("ejGantt")},e.registers=null,e.ganttData=null,e.resourceGroups=[],e.resources=[],e.dataSource=[],e.btn_search={text:"Search",type:"success",icon:"search",width:"100%",bindingOptions:{},onClick:function(t){e.loadingVisible=!0,a.getFlightPlanGantt(e.planId).then(function(t){e.loadingVisible=!1,e.ganttData=t,e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource(t.flights),Flight.activeDatasource=e.dataSource,console.log(e.ganttData),console.log(e.resourceGroups),console.log(e.dataSource),e.createGantt()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.btn_register={text:"Set/View Registers",type:"default",icon:"ion ion-md-airplane",width:220,onClick:function(t){e.popup_registers_visible=!0}},e.entity={DateFrom:null,DateTo:null,RegisterId:null,PlannedRegisterId:null,FlightPlanId:e.planId},e.clearEntity=function(){e.entity.DateFrom=null,e.entity.DateTo=null,e.entity.RegisterId=null,e.entity.PlannedRegisterId=null,e.entity.FlightPlanId=e.planId},e.duplicateEntity=function(){var t={};return t.DateFrom=e.entity.DateFrom,t.DateTo=e.entity.DateTo,t.RegisterId=e.entity.RegisterId,t.PlannedRegisterId=e.entity.PlannedRegisterId,t.FlightPlanId=e.entity.FlightPlanId,t},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.date_from={type:"date",width:"100%",readOnly:!0,onValueChanged:function(t){e.fillSchedule()},bindingOptions:{value:"plan.DateFrom"}},e.date_to={type:"date",width:"100%",readOnly:!0,onValueChanged:function(t){e.fillSchedule()},bindingOptions:{value:"plan.DateTo"}},e.date_from_entity={type:"date",width:"100%",readOnly:!0,bindingOptions:{value:"entity.DateFrom",max:"maxDate",min:"minDate"}},e.date_to_entity={type:"date",width:"100%",bindingOptions:{value:"entity.DateTo",max:"maxDate",min:"minDate"}},e.isCustomVisible=!1,e.intervalTypes=[{Id:1,Title:"Daily"},{Id:2,Title:"Weekly"},{Id:3,Title:"Every 10 days"},{Id:4,Title:"Every 14 days"},{Id:5,Title:"Every 15 days"},{Id:100,Title:"Custom"},{Id:101,Title:"Once"}],e.sb_interval={readOnly:!0,showClearButton:!0,width:"100%",searchEnabled:!1,displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(e){},bindingOptions:{value:"plan.Interval",dataSource:"intervalTypes"}},e.tag_months_instance=null,e.tag_months={readOnly:!0,dataSource:General.MonthDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_months_instance||(e.tag_months_instance=t.component)},bindingOptions:{value:"plan.Months"}},e.tag_days_instance=null,e.tag_days={readOnly:!0,dataSource:General.WeekDayDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_days_instance||(e.tag_days_instance=t.component)},bindingOptions:{value:"plan.Days"}},e.scheduleCurrentDate=null,e.data=[],e.scheduler_instance=null,e.schedulerOptions={onContentReady:function(t){e.scheduler_instance||(e.scheduler_instance=t.component)},views:["month"],currentView:"month",startDayHour:0,endDayHour:24,showCurrentTimeIndicator:!1,height:430,appointmentTemplate:function(t){var i=new Date(t.startDate).ToUTC(),n=!1;return $.each(e.registers,function(e,t){console.log("dates"),console.log(i),console.log(new Date(t.DateFrom).ToUTC()),console.log(new Date(t.DateTo).ToUTC()),i>=new Date(t.DateFrom).ToUTC()&&i<=new Date(t.DateTo).ToUTC()&&(n=!0)}),n?$("<div style='text-align:center; height:30px;color:green;background:white;margin-top:-5px'><i style='font-size:24px' class='icon ion-md-airplane'></i></div>"):$("<div style='text-align:center; height:30px;color:red;background:white;margin-top:-5px'><i style='font-size:24px' class='icon ion-md-help-circle'></i></div>")},editing:{allowAdding:!1,allowUpdating:!1,allowDeleting:!0,allowResizing:!1,allowDragging:!1},onAppointmentClick:function(e){e.cancel=!0},onAppointmentDblClick:function(e){e.cancel=!0},onCellClick:function(e){e.cancel=!0},bindingOptions:{dataSource:"data",min:"plan.DateFrom",max:"plan.DateTo",currentDate:"scheduleCurrentDate"}},e.addCustom=function(t,i,n,a){if(n&&0!=n.length&&a&&0!=a.length)for(;t<=i;){var o=!1,l=!1;o=!n||0==n.length||-1!=n.indexOf(t.getMonth()),l=!a||0==a.length||-1!=a.indexOf(t.getDay()),o&&l&&e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(1)}},e.addDaily=function(t,i,n){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(n)},e.addMonthly=function(t,i){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(30)},e.fillSchedule=function(){if(e.data=[],e.plan.Interval&&e.plan.DateFrom&&e.plan.DateTo){var t=new Date(e.plan.DateFrom);t=new Date(t.setHours(0,0,0,0));var i=new Date(e.plan.DateTo);switch(i=new Date(i.setHours(23,59,59,999)),e.plan.Interval){case 1:e.addDaily(t,i,1);break;case 2:e.addDaily(t,i,7);break;case 3:e.addDaily(t,i,10);break;case 4:e.addDaily(t,i,14);break;case 5:e.addDaily(t,i,15);break;case 100:e.addCustom(t,i,e.plan.Months,e.plan.Days);break;case 101:e.addDaily(t,i,1)}}},e.IsApproved=!1,e.popup_registers_visible=!1,e.popup_registers_title="Set Registers",e.popup_registers={width:1e3,height:620,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",bindingOptions:{disabled:"IsApproved"},onClick:function(t){var i=Enumerable.From(e.registers).Where("$.Id<0").ToArray(),o={};o.PlanId=e.plan.Id,o.Items=i,o.Deleted=e.deleted,console.log(o),e.loadingVisible=!0,a.savePlanRegisters(o).then(function(t){$.each(t,function(t,i){Enumerable.From(e.registers).Where("$.Id=="+i.OldId).FirstOrDefault().Id=i.NewId}),General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.popup_registers_visible=!1,e.bindGantt(),n.$broadcast("onRegisterAssigned",null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.dg_res_instance.deselectAll(),e.IsRegistersVisible=!1,e.dg_res_ds=e.resources},onHiding:function(){e.deleted=[],e.popup_registers_visible=!1},bindingOptions:{visible:"popup_registers_visible",title:"popup_registers_title"}},e.popup_registers.toolbarItems[1].options.onClick=function(t){e.popup_registers_visible=!1},e.dg_res_selected=null,e.dg_res_columns=[{dataField:"group",caption:"Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,groupIndex:0},{dataField:"resourceName",caption:"Virtual Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_res_height=500,e.dg_res_instance=null,e.dg_res_ds=null,e.dg_res={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_res_columns,onContentReady:function(t){e.dg_res_instance||(e.dg_res_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_res_selected=i,e.IsRegistersVisible=!0,e.setRegisterDs(i.resourceId,i.groupId)):(e.dg_res_selected=null,e.setRegisterDs(null,null),e.IsRegistersVisible=!1)},bindingOptions:{dataSource:"dg_res_ds",height:"dg_res_height"}},e.dg_reg_selected=null,e.dg_reg_columns=[{caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i=Colors.getColor(t.rowIndex%Colors.Palette.length);$("<div>").append("<i style='font-size:22px;color:"+i+"' class='icon ion-ios-airplane'></i>").appendTo(e)}},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"DateFrom",caption:"From",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200,sortIndex:0,sortOrder:"asc"},{dataField:"DateTo",caption:"To",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200}],e.dg_reg_height=$(window).height()-387,e.dg_reg_instance=null,e.dg_reg_ds=[],e.dg_reg={searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_reg_columns,onContentReady:function(t){e.dg_reg_instance||(e.dg_reg_instance=t.component)},onRowRemoved:function(t){if(t.data){var i=t.data.PlannedRegisterId;e.createRanges(i);var n=t.data.Id;e.registers=Enumerable.From(e.registers).Where("$.Id!="+n).ToArray(),e.fillSchedule(),e.IsDeleteDisabled=!0}},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_reg_selected=i,e.IsDeleteDisabled=e.dg_reg_instance.getRowIndexByKey(i)!=e.dg_reg_instance.totalCount()-1):e.dg_reg_selected=null},bindingOptions:{dataSource:"dg_reg_ds",height:"dg_reg_height"}},e.ds_msn=[],e.ds_msn=[],e.msn_readOnly=!0,e.unknown_readOnly=!1,e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(e){e.selectedItem},bindingOptions:{value:"entity.RegisterId",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.dg_reg_filter=null,e.setRegisterDs=function(t,i){if(t){e.dg_reg_ds=Enumerable.From(e.registers).Where("$.PlannedRegisterId=="+t).ToArray(),e.dg_reg_filter=t,e.dg_reg_instance.repaint();var n=Enumerable.From(e.registers).Where("$.PlannedRegisterId=="+t).OrderByDescending(function(e){return new Date(e.DateFrom)}).FirstOrDefault();if(n)var a=new Date(n.DateTo).addDays(1);else var a=e.plan.DateFrom;e.clearEntity(),e.entity.DateFrom=new Date(a),e.createRanges(t),e.loadingVisible=!0,o.getAvailableMSNsByType(Config.CustomerId,i).then(function(t){e.loadingVisible=!1,e.ds_msn=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else e.dg_reg_filter=null,e.dg_reg_ds=null},Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.scroll=0,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},l.isAuthorized()?(n.page_title="> Flights",$(".flightplanregister").fadeIn(400,function(){})):l.redirectToLogin(),e.selectedFlights=[],e.addSelectedFlight=function(t){Enumerable.From(e.selectedFlights).Where("$.taskId=="+t.taskId).FirstOrDefault()?e.selectedFlights=Enumerable.From(e.selectedFlights).Where("$.taskId!="+t.taskId).ToArray():e.selectedFlights.push(t)},e.selectedResource=null,e.setSelectedResource=function(t){var i=t.index;e.selectedResource&&e.setSelectedResource.index==i?(e.selectedResource=null,$("#resourceGanttpr").data("ejGantt").clearSelection(i),alert("x")):e.selectedResource={index:t.index,item:t.item}},e.ganttCreated=!1,e.Day0="01/31/2019",e.Day1=new Date("02/01/2019"),e.Day2=new Date("02/02/2019 23:59:00.000"),e.Day0="05/06/2019",e.Day1="05/07/2019",e.Day2="05/07/2019 23:59:00.000";var s=function(t,i){if("groupTask"==i.eResourceTaskType)return"<div style='padding-left:5px;font-weight:bold'>"+i.eResourceName+"</div>";var n=Enumerable.From(e.resources).Where("$.resourceId=="+t).FirstOrDefault();return n?"<div style='padding-left:10px'>"+n.resourceName+"</div><div style='padding-left:15px;font-size:12px'>"+n.registers+"</div>":t},c={registerTemplate:s};$.views.helpers(c),e.createGantt=function(){var t=$("#resourceGanttpr").data("ejGantt");t&&t.destroy();var i=$(window).height()-110;i+="px",i="170px",$("#resourceGanttpr").ejGantt({selectionMode:ej.Gantt.SelectionMode.Cell,selectionType:ej.Gantt.SelectionType.MultipleTask,taskbarClick:function(t){e.addSelectedFlight(t.data.item),$("#resourceGanttpr").data("ejGantt").clearSelection()},dataSource:e.dataSource,allowColumnResize:!0,isResponsive:!0,taskIdMapping:"taskId",taskNameMapping:"taskName",fromLocationMapping:"from",startDateMapping:"startDate",endDateMapping:"endDate",progressMapping:"progress",durationMapping:"duration",groupNameMapping:"Title",groupIdMapping:"groupId",groupCollection:e.resourceGroups,resources:e.resources,resourceIdMapping:"resourceId",resourceNameMapping:"resourceName",resourceInfoMapping:"resourceId",notesMapping:"notes",rightTaskLabelMapping:"taskName",baselineStartDateMapping:"BaselineStartDate",baselineEndDateMapping:"BaselineEndDate",highlightWeekEnds:!0,includeWeekend:!1,rowHeight:50,taskbarHeight:35,scheduleStartDate:e.Day1,scheduleEndDate:e.Day2,predecessorMapping:"predecessor",allowGanttChartEditing:!1,allowDragAndDrop:!0,editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,editMode:"normal"},splitterSettings:{position:240},toolbarSettings:{showToolbar:!1,toolbarItems:[ej.Gantt.ToolbarItems.Add,ej.Gantt.ToolbarItems.Delete,ej.Gantt.ToolbarItems.Update,ej.Gantt.ToolbarItems.Cancel,ej.Gantt.ToolbarItems.ExpandAll,ej.Gantt.ToolbarItems.CollapseAll,ej.Gantt.ToolbarItems.NextTimeSpan,ej.Gantt.ToolbarItems.PrevTimeSpan]},enableContextMenu:!1,load:function(){e.ganttCreated=!0,this.getColumns()[0].width=180,this.getColumns()[0].visible=!1;var t={field:"resourceId",mappingName:"resourceId",allowEditing:!1,headerText:"Registers",isTemplateColumn:!0,width:180,templateID:"columnTemplateRegister"};this.getColumns().unshift(t),this.getColumns().unshift({field:"assigned",mappingName:"assigned",allowEditing:!1,headerText:"",isTemplateColumn:!0,width:60,templateID:"columnTemplate"})},create:function(t){$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(e.scroll)},cellSelecting:function(e){e&&"resourceTask"!=e.data.eResourceTaskType&&(e.cancel=!0)},cellSelected:function(t){$(".e-gantt-taskbarSelection").removeClass("e-gantt-taskbarSelection"),console.log(t.data),e.setSelectedResource(t.data)},actionBegin:function(e){e.requestType&&"beginedit"==e.requestType&&(e.cancel=!0)},actionComplete:function(e){},workingTimeScale:"TimeScale24Hours",durationUnit:ej.Gantt.DurationUnit.Hour,scheduleHeaderSettings:{scheduleHeaderType:ej.Gantt.ScheduleHeaderType.Hour,dayHeaderFormat:"DAY dd",minutesPerInterval:ej.Gantt.minutesPerInterval.ThirtyMinutes,timescaleUnitSize:"200%"},taskbarTemplate:"#taskbarTemplate",leftTaskLabelTemplate:"#leftlableTemplate",viewType:ej.Gantt.ViewType.ResourceView,sizeSettings:{height:i},groupSettings:{},showStackedHeader:!1,taskSchedulingMode:ej.Gantt.TaskSchedulingMode.Manual,enableTaskbarTooltip:!1})},e.setResourceGroup=function(){$.each(e.resources,function(t,i){var n=Enumerable.From(e.resourceGroups).Where("$.groupId=="+i.groupId).FirstOrDefault();i.group=n.Title})},e.bindGantt=function(){var t=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0,a.getFlightPlanGantt(e.planId,t).then(function(t){e.loadingVisible=!1,e.ganttData=t,e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.setResourceGroup(),e.registers=t.registers,console.log(e.registers),e.dataSource=Flight.proccessDataSource(t.flights),Flight.activeDatasource=e.dataSource;var i;!function(){i=setTimeout(function(){clearTimeout(i),e.createGantt()},500)}(),e.setRegisterDs(e.plan.VirtualRegisterId,e.plan.VirtualTypeId),e.fillSchedule()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.bind=function(){e.loadingVisible=!0,a.getFlightPlan(e.planId).then(function(t){e.loadingVisible=!1,e.plan=t,e.plan.Title2=e.plan.BaseIATA+" ("+e.plan.BaseName+")",e.EditVisible=1!=e.plan.IsApproved70,e.IsApproved=1==e.plan.IsApproved100,e.minDate=General.getDayFirstHour(new Date(e.plan.DateFrom)),e.maxDate=General.getDayLastHour(new Date(e.plan.DateTo)),e.plan.Interval=Number(e.plan.Interval),e.isCustomVisible=100==e.plan.Interval,e.scheduleCurrentDate=new Date(e.plan.DateFrom),e.bindGantt()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.scroll_1_height=300,e.scroll_1={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_1_height"}},e.IsEditView=!0,e.pop_width=900,e.pop_height=600,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!0,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",bindingOptions:{disabled:"IsApproved"},onClick:function(t){var i=Enumerable.From(e.registers).Where("$.Id<0").ToArray(),o={};o.PlanId=e.plan.Id,o.Items=i,o.Deleted=e.deleted,console.log(o),e.loadingVisible=!0,a.savePlanRegisters(o).then(function(t){$.each(t,function(t,i){Enumerable.From(e.registers).Where("$.Id=="+i.OldId).FirstOrDefault().Id=i.NewId}),General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.popup_registers_visible=!1,e.bindGantt(),n.$broadcast("onRegisterAssigned",null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_add_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.scroll_1_height=$(window).height()-145,e.bind(e.planId),e.dg_reg_instance.repaint()},onHiding:function(){var t=$("#resourceGanttpr").data("ejGantt");t&&t.destroy(),e.clearEntity(),e.popup_add_visible=!1,n.$broadcast("onFlightRegistersHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title","toolbarItems[0].visible":"IsEditView"}},e.tempData=null,e.planId=null,e.plan=null,e.$on("InitFlightPlanRegister",function(t,i){e.planId=i.Id,e.plan={},e.plan.Title="DFSDFSDF",e.popup_add_title="Registers",e.popup_add_visible=!0})}]),app.controller("documentAddController",["$scope","$location","libraryService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.IsExposedDisabled=!0,e._IsEditable=e.IsEditable||e.IsEditableDoc,e.entity={Id:-1,Title:null,ISBN:null,DateRelease:null,PublisherId:null,ISSNPrint:null,ISSNElectronic:null,DOI:null,Pages:null,CategoryId:93,ImageUrl:null,Abstract:null,DateCreate:null,DatePublished:null,CustomerId:Config.CustomerId,IsExposed:!1,BookKeywords:[],BookAuthors:[],BookRelatedAircraftTypes:[],BookRelatedGroups:[],BookRelatedStudyFields:[],BookRelatedEmployees:[],BookFiles:[],DateDeadline:null,Duration:null,LanguageId:null,ExternalUrl:null,NumberOfLessens:null,TypeId:86,JournalId:null,Conference:null,ConferenceLocationId:null,DateConference:null,Sender:null,No:null,PublishedIn:null,INSPECAccessionNumber:null,Edition:null,DateEffective:null,DeadLine:null,DateValidUntil:null},e.clearEntity=function(){e.entity.Id=-1,e.entity.Title=null,e.entity.ISBN=null,e.entity.DateRelease=null,e.entity.DatePublished=null,e.entity.PublisherId=null,e.entity.ISSNPrint=null,e.entity.ISSNElectronic=null,e.entity.DOI=null,e.entity.Pages=null,e.entity.CategoryId=93,e.entity.ImageUrl=null,e.entity.Abstract=null,e.entity.DateCreate=null,e.entity.IsExposed=!1,e.entity.BookKeywords=[],e.entity.BookAuthors=[],e.entity.BookRelatedAircraftTypes=[],e.entity.BookRelatedGroups=[],e.entity.BookRelatedStudyFields=[],e.entity.BookRelatedEmployees=[],e.entity.BookFiles=[],e.uploaderValueDocument=[],e.uploadedFileDocument=null,e.uploader_document_instance.reset(),e.entity.CustomerId=Config.CustomerId,e.img_url="content/images/image.png",e.entity.DateDeadline=null,e.entity.Duration=null,e.entity.LanguageId=null,e.entity.ExternalUrl=null,e.entity.NumberOfLessens=null,e.entity.TypeId=86,e.entity.JournalId=null,e.entity.Conference=null,e.entity.ConferenceLocationId=null,e.entity.DateConference=null,e.entity.Sender=null,e.entity.No=null,e.entity.PublishedIn=null,e.entity.INSPECAccessionNumber=null,e.entity.Edition=null,e.entity.DateEffective=null,e.DeadLine=null,e.DateValidUntil=null},e.bind=function(t){e.entity.Id=t.Id,e.entity.Title=t.Title,e.entity.ISBN=t.ISBN,e.entity.DateRelease=t.DateRelease,e.entity.PublisherId=t.PublisherId,e.entity.ISSNPrint=t.ISSNPrint,e.entity.ISSNElectronic=t.ISSNElectronic,e.entity.DOI=t.DOI,e.entity.Pages=t.Pages,e.entity.CategoryId=t.CategoryId,e.entity.CustomerId=t.CustomerId,e.entity.Abstract=t.Abstract,e.entity.DateCreate=t.DateCreate,e.entity.DatePublished=t.DatePublished,e.entity.ImageUrl=t.ImageUrl,e.entity.BookKeywords=t.BookKeywords,e.entity.BookAuthors=t.BookAuthors,e.entity.BookRelatedAircraftTypes=t.BookRelatedAircraftTypes,e.entity.BookRelatedGroups=t.BookRelatedGroups,e.entity.BookRelatedStudyFields=t.BookRelatedStudyFields,e.entity.BookRelatedEmployees=t.BookRelatedEmployees,e.entity.BookFiles=t.BookFiles,e.entity.IsExposed=t.IsExposed,e.IsExposedDisabled=0==t.IsExposed,t.ImageUrl?e.img_url=o.clientsFilesUrl+t.ImageUrl:e.img_url="content/images/image.png",e.entity.DateDeadline=t.DateDeadline,e.entity.Duration=t.Duration,e.entity.LanguageId=t.LanguageId,e.entity.ExternalUrl=t.ExternalUrl,e.entity.NumberOfLessens=t.NumberOfLessens,e.entity.TypeId=t.TypeId,e.entity.JournalId=t.JournalId,e.entity.Conference=t.Conference,e.entity.ConferenceLocationId=t.ConferenceLocationId,e.entity.DateConference=t.DateConference,e.entity.Sender=t.Sender,e.entity.No=t.No,e.entity.PublishedIn=t.PublishedIn,e.entity.INSPECAccessionNumber=t.INSPECAccessionNumber,e.entity.Edition=t.Edition,e.entity.DateEffective=t.DateEffective,e.entity.DeadLine=t.DeadLine,e.entity.DateValidUntil=t.DateValidUntil};var l=[{text:"Main",id:"main",visible_btn:!1},{text:"Files",id:"files",visible_btn:!1,visible:!0},{text:"Aircraft Types",id:"actypes",visible_btn:!0,visible:!0},{text:"Groups",id:"groups",visible_btn:!1,visible_btn2:!0,visible:!0},{text:"Educations",id:"educations",visible_btn:!1,visible:!0},{text:"Employees",id:"employees",visible_btn:!1,visible:!0}];e.btn_visible_aircrafttype=!1,e.btn_visible_coursetype=!1,e.btn_visible_education=!1,e.btn_visible_course=!1,e.btn_visible_group=!1,e.btn_visible_employee=!1,e.btn_visible_file=!1,e.tabs=l,e.selectedTabIndex=0,e.$watch("selectedTabIndex",function(t){try{e.selectedTab=l[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_aircrafttype_instance.repaint(),e.dg_education_instance.repaint(),e.dg_group_instance.repaint(),e.dg_employee_instance.repaint();var i=setInterval(function(){$("#dg_education").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_aircrafttype").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_file").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_group").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_employee").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),clearInterval(i)},10);e.btn_visible_aircrafttype=2==t,e.btn_visible_file=1==t,e.btn_visible_education=4==t,e.btn_visible_group=3==t,e.btn_visible_employee=5==t}catch(e){console.log(e)}}),e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.txt_Title={hoverStateEnabled:!1,bindingOptions:{value:"entity.Title"}},e.txt_Remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.Remark"}},e.txt_Sender={hoverStateEnabled:!1,bindingOptions:{value:"entity.Sender"}},e.txt_DateEffective={hoverStateEnabled:!1,bindingOptions:{value:"entity.DateEffective"}},e.txt_Edition={hoverStateEnabled:!1,bindingOptions:{value:"entity.Edition"}},e.txt_Remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.Remark"}},e.sb_Category={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(94),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.CategoryId"}},e.date_DatePublication={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateRelease"}},e.date_DateValidUntil={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateValidUntil"}},e.date_DeadLine={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DeadLine"}},e.txt_Abstract={hoverStateEnabled:!1,height:150,bindingOptions:{value:"entity.Abstract"}},e.txt_No={hoverStateEnabled:!1,bindingOptions:{value:"entity.No"}},e.txt_Remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.PublishedIn"}},e.chb_Exposed={text:"Exposed",bindingOptions:{value:"entity.IsExposed",disabled:"IsExposedDisabled"}},e.scroll_height=200,e.dg_height=200,e.dg_height2=200,e.scroll_main={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.pop_width=900,e.pop_height=500,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"aircrafttypeadd",bindingOptions:{visible:"btn_visible_aircrafttype"},onClick:function(e){o.$broadcast("InitAircraftSelect",null)}}},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"aircrafttypeadd",bindingOptions:{visible:"btn_visible_aircrafttype"},onClick:function(t){var i=o.getSelectedRow(e.dg_aircrafttype_instance);if(!i)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.BookRelatedAircraftTypes=Enumerable.From(e.entity.BookRelatedAircraftTypes).Where("$.Id!="+i.Id).ToArray()}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"groupadd",bindingOptions:{visible:"btn_visible_group"},onClick:function(e){o.$broadcast("InitJobGroupSelect",null)}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"groupadd",bindingOptions:{visible:"btn_visible_group"},onClick:function(t){var i=o.getSelectedRow(e.dg_group_instance);if(!i)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.BookRelatedGroups=Enumerable.From(e.entity.BookRelatedGroups).Where("$.Id!="+i.Id).ToArray()}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"educationadd",onClick:function(e){o.$broadcast("InitStudyFieldSelect",null)}},toolbar:"bottom",
bindingOptions:{visible:"btn_visible_education",disabled:"IsMainDisabled"}},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"educationadd",bindingOptions:{visible:"btn_visible_education"},onClick:function(t){var i=o.getSelectedRow(e.dg_education_instance);if(!i)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.BookRelatedStudyFields=Enumerable.From(e.entity.BookRelatedStudyFields).Where("$.Id!="+i.Id).ToArray()}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"employeeadd",bindingOptions:{visible:"btn_visible_employee"},onClick:function(e){o.$broadcast("InitEmployeeSelect",null)}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"employeeadd",bindingOptions:{visible:"btn_visible_employee"},onClick:function(t){var i=o.getSelectedRow(e.dg_employee_instance);if(!i)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.BookRelatedEmployees=Enumerable.From(e.entity.BookRelatedEmployees).Where("$.Id!="+i.Id).ToArray()}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Save",icon:"check",validationGroup:"documentadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();e.pop_height=600,i.width<=600&&(e.pop_width=i.width,e.pop_height=i.height),e.dg_height=e.pop_height-133,e.dg_height2=e.dg_height-73,e.scroll_height=e.pop_height-140},onShown:function(t){e.loadingVisible=!0,i.getKeywords().then(function(t){e.keywords=t.slice(),null!=e.tempData?i.getBook(e.tempData.Id).then(function(t){e.loadingVisible=!1,e.bind(t)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}):e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,o.$broadcast("onLibraryHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title","toolbarItems[0].visible":"btn_visible_aircrafttype","toolbarItems[1].visible":"btn_visible_aircrafttype","toolbarItems[2].visible":"btn_visible_group","toolbarItems[3].visible":"btn_visible_group","toolbarItems[4].visible":"btn_visible_education","toolbarItems[5].visible":"btn_visible_education","toolbarItems[6].visible":"btn_visible_employee","toolbarItems[7].visible":"btn_visible_employee","toolbarItems[8].visible":"_IsEditable"}},e.popup_add.toolbarItems[9].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[8].options.onClick=function(t){return t.validationGroup.validate().isValid?83!=e.entity.TypeId||e.entity.PublisherId?84!=e.entity.TypeId||e.entity.JournalId?(e.isNew&&(e.entity.Id=-1),e.entity.DateRelease=new Date(e.entity.DateRelease).ToUTC(),e.loadingVisible=!0,void i.save(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onLibrarySaved",t),e.loadingVisible=!1,e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):void General.ShowNotify('Please select "Journal / Conference".',"error"):void General.ShowNotify('Please select "Publisher".',"error"):void General.ShowNotify(Config.Text_FillRequired,"error")},e.uploaderValueDocument=[],e.uploadedFileDocument=null,e.uploader_document_instance=null,e.uploader_document={multiple:!1,labelText:"",uploadMethod:"POST",uploadMode:"instantly",uploadUrl:o.fileHandlerUrl+"?t=clientfiles",onValueChanged:function(e){},onUploaded:function(t){var i=-1*(e.entity.BookFiles.length+1),n={Id:i,Title:t.request.responseText,FileUrl:t.request.responseText,Remark:"",DocumentId:-1,BookId:e.entity.Id};n.SysUrl=e.uploaderValueDocument[0].name,n.FileType=e.uploaderValueDocument[0].type,e.entity.BookFiles.push(n),console.log(e.uploaderValueDocument)},onContentReady:function(t){e.uploader_document_instance||(e.uploader_document_instance=t.component)},bindingOptions:{value:"uploaderValueDocument"}},e.dg_aircrafttype_columns=[{dataField:"Type",caption:"Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200,sortIndex:0,sortOrder:"asc"},{dataField:"Manufacturer",caption:"Manufacturer",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_aircrafttype_selected=null,e.dg_aircrafttype_instance=null,e.dg_aircrafttype={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_aircrafttype_columns,onContentReady:function(t){e.dg_aircrafttype_instance||(e.dg_aircrafttype_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_aircrafttype_selected=i||null},bindingOptions:{dataSource:"entity.BookRelatedAircraftTypes",height:"dg_height"}},e.dg_group_columns=[{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FullCode",caption:"Code",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,encodeHtml:!1,width:200,sortIndex:0,sortOrder:"asc"}],e.dg_group_selected=null,e.dg_group_instance=null,e.dg_group={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_group_columns,onContentReady:function(t){e.dg_group_instance||(e.dg_group_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_group_selected=i||null},bindingOptions:{dataSource:"entity.BookRelatedGroups",height:"dg_height"}},e.dg_education_columns=[{dataField:"Title",caption:"Field",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,sortIndex:0,sortOrder:"asc"},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300}],e.dg_education_selected=null,e.dg_education_instance=null,e.dg_education={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_education_columns,onContentReady:function(t){e.dg_education_instance||(e.dg_education_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_education_selected=i||null},bindingOptions:{dataSource:"entity.BookRelatedStudyFields",height:"dg_height"}},e.dg_employee_columns=[{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,sortIndex:0,sortOrder:"asc",width:250},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Location",caption:"Department",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"CaoCardNumber",caption:"CAO No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"NDTNumber",caption:"NDT No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"DateJoinCompany",caption:"Join Company",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130}],e.dg_employee_selected=null,e.dg_employee_instance=null,e.dg_employee={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_employee_columns,onContentReady:function(t){e.dg_employee_instance||(e.dg_employee_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_employee_selected=i||null},bindingOptions:{dataSource:"entity.BookRelatedEmployees",height:"dg_height"}},e.dg_file_columns=[{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!0},{dataField:"SysUrl",caption:"File",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"FileType",caption:"File Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150}],e.dg_file_selected=null,e.dg_file_instance=null,e.dg_file={editing:{allowUpdating:!0,allowDeleting:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_file_columns,onContentReady:function(t){e.dg_file_instance||(e.dg_file_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_file_selected=i||null},bindingOptions:{dataSource:"entity.BookFiles",height:"dg_height2"}},e.tempData=null,e.$on("InitAddDocument",function(t,i){e.tempData=null,i.Id?(e.popup_add_title="Edit",e.tempData=i,e.isNew=!1):(e.isNew=!0,e.popup_add_title="New"),e.popup_add_visible=!0}),e.$on("onAircraftSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.BookRelatedAircraftTypes).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.BookRelatedAircraftTypes.push(i)}),e.dg_aircrafttype_instance.refresh())}),e.$on("onJobGroupSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.BookRelatedGroups).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.BookRelatedGroups.push(i)}),e.dg_group_instance.refresh())}),e.$on("onStudyFieldSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.BookRelatedStudyFields).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.BookRelatedStudyFields.push(i)}),e.dg_education_instance.refresh())}),e.$on("onEmployeeSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.BookRelatedEmployees).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.BookRelatedEmployees.push(i)}),e.dg_employee_instance.refresh())})}]),app.controller("coursetypeSelectController",["$scope","$location","authService","$routeParams","$rootScope",function(e,t,i,n,a){e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_columns=[{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"multiple"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData;e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.dg_height=100,e.pop_width=700,e.pop_height=500,e.popup_add_visible=!1,e.popup_add_title="Course Types",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Ok",icon:"check",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=a.getWindowSize();i.width<=700&&(e.pop_width=i.width,e.pop_height=i.height),e.dg_height=e.pop_height-100},onShown:function(t){e.bind()},onHiding:function(){e.popup_add_visible=!1},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){if(!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");a.$broadcast("onCourseTypeSelectHide",e.dg_selected),e.popup_add_visible=!1},e.bind=function(){e.dg_ds?e.dg_instance.clearSelection():e.dg_ds={store:{type:"odata",url:a.serviceUrl+"odata/courses/types",key:"Id",version:4}}},e.$on("InitCourseTypeSelect",function(t,i){e.popup_add_visible=!0})}]),app.controller("flightPlansMaintenanceController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.typeId=60,e.typeId=50,e.filterVisible=!1,e.tempData=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.btn_register={text:"Registers",type:"default",icon:"airplane",width:150,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");n.$broadcast("InitFlightPlanRegister",{Id:e.dg_selected.Id})}},e.IsApproveDisabled=!0,e.btn_approve={text:"Approve Assigned Regsiters",type:"default",icon:"check",width:300,bindingOptions:{disabled:"IsApproveDisabled"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_SimpleConfirm,function(t){t&&(e.loadingVisible=!0,a.approvePlan70(e.dg_selected.Id).then(function(t){e.IsApproveDisabled=!0,e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))})}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_height_full=100,e.scroll_height_full=400,e.dg_selected=null,e.dg_columns=[{dataField:"",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.data.IsApproved70&&0!=t.data.IsApproved70?$("<div>").append("<i style='font-size:22px;color:#8bc34a!important' class='icon ion-md-checkmark-circle'></i>").appendTo(e):$("<div>").append("<i style='font-size:22px;color:#ff5722!important' class='icon ion-md-help-circle '></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"",caption:"Assigned Registers",width:200,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="<div style='width:100%; text-align:center;position:absolute;top:0;left:0;line-height:30px;z-index:100'>"+t.data.RegisterAssignProgress+"%</div><div style='width:"+(t.data.RegisterAssignProgress+.5)+"%; position:absolute;top:-1px;left:0;height:30px;background:lightgreen'></div>";$("<div style='position:relative;width:100%;border:1px solid lightgreen;height:30px'>").append(i).appendTo(e)},fixed:!0,fixedPosition:"left",alignment:"center"},{dataField:"BaseIATA",caption:"Base",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:150},{dataField:"BaseName",caption:"Base Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"Types",caption:"Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:200},{dataField:"IntervalType",caption:"Interval",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:150},{dataField:"TotalFlights",caption:"Flights",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"DateFrom",caption:"From",allowResizing:!0,dataType:"date",allowEditing:!1,width:200,alignment:"center",fixed:!0,fixedPosition:"right"},{dataField:"DateTo",caption:"To",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200,fixed:!0,fixedPosition:"right"}],e.dg_height=$(window).height()-135,e.dg_instance=null,e.dg_ds=null,e.dg={masterDetail:{enabled:!0,template:"detail"},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onRowExpanding:function(e){},onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,e.IsApproveDisabled=1==i.IsApproved70||100!=i.RegisterAssignProgress):(e.dg_selected=null,e.IsApproveDisabled=!0,e.IsApproveDisabled=!0)},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.dg_detail_ds=null,e.getDetailGridSettings=function(e){var t=-1*(new Date).getTimezoneOffset();return{scrolling:{mode:"infinite"},paging:{pageSize:100},dataSource:{store:{type:"odata",url:n.serviceUrl+"odata/flightplanitems/plan/"+e+"/"+t+"/",key:"Id",version:4,onLoaded:function(e){}},sort:[{getter:"DateFrom",desc:!0},"BaseIATA","STD"]},columnAutoWidth:!0,showBorders:!0,columns:[{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:400}]}},e.bind=function(){var t="odata/flightplans/approved/customer/"+Config.CustomerId+"/"+e.typeId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Id",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.getFlightsGantt=function(){e.loadingVisible=!0,a.getFlightsGantt(Config.CustomerId).then(function(t){e.loadingVisible=!1,e.flightData=t,$.each(e.flightData.flights,function(e,t){t.startDate=new Date(t.startDate)})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},l.isAuthorized()?(n.page_title="> Flight Plans",$(".flightplansmaintenance").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){console.log(i),e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onRegisterAssigned",function(t,i){e.doRefresh=!0}),e.$on("onFlightRegistersHide",function(t,i){e.bind()}),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("courseAddController",["$scope","$location","courseService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.entity={Id:null,CourseTypeId:null,DateStart:null,DateStartP:null,DateEnd:null,DateEndP:null,Instructor:null,Location:null,Department:null,OrganizationId:null,Duration:null,DurationUnitId:null,StatusId:null,Remark:null,Capacity:null,Tuition:null,CurrencyId:null,DateDeadlineRegistration:null,DateDeadlineRegistrationP:null,TrainingDirector:null,Title:null,AircraftTypeId:null,AircraftModelId:null,CaoTypeId:null,Recurrent:null,Interval:null,CalanderTypeId:null,IsInside:null,Quarantine:null,DateStartPractical:null,DateEndPractical:null,DateStartPracticalP:null,DateEndPracticalP:null,DurationPractical:null,DurationPracticalUnitId:null,IsGeneral:null,CustomerId:null,No:null,IsNotificationEnabled:null,CourseRelatedAircraftTypes:[],CourseRelatedCourseTypes:[],CourseRelatedStudyFields:[],CourseRelatedEmployees:[],CourseRelatedCourses:[],CourseRelatedGroups:[],CourseCatRates:[],CourseAircraftTypes:[]},e.clearEntity=function(){e.entity.Id=null,e.entity.CourseTypeId=null,e.entity.DateStart=null,e.entity.DateStartP=null,e.entity.DateEnd=null,e.entity.DateEndP=null,e.entity.Instructor=null,e.entity.Location=null,e.entity.Department=null,e.entity.OrganizationId=null,e.entity.Duration=null,e.entity.DurationUnitId=null,e.entity.StatusId=null,e.entity.Remark=null,e.entity.Capacity=null,e.entity.Tuition=null,e.entity.CurrencyId=null,e.entity.DateDeadlineRegistration=null,e.entity.DateDeadlineRegistrationP=null,e.entity.TrainingDirector=null,e.entity.Title=null,e.entity.AircraftTypeId=null,e.entity.AircraftModelId=null,e.entity.CaoTypeId=null,e.entity.Recurrent=null,e.entity.Interval=null,e.entity.CalanderTypeId=null,e.entity.IsInside=null,e.entity.Quarantine=null,e.entity.DateStartPractical=null,e.entity.DateEndPractical=null,e.entity.DateStartPracticalP=null,e.entity.DateEndPracticalP=null,e.entity.DurationPractical=null,e.entity.DurationPracticalUnitId=null,e.entity.IsGeneral=null,e.entity.CustomerId=null,e.entity.No=null,e.entity.IsNotificationEnabled=null,e.entity.CourseRelatedAircraftTypes=[],e.entity.CourseRelatedCourseTypes=[],e.entity.CourseRelatedStudyFields=[],e.entity.CourseRelatedEmployees=[],e.entity.CourseRelatedCourses=[],e.entity.CourseRelatedGroups=[],e.entity.CourseCatRates=[],e.entity.CourseAircraftTypes=[]},e.bind=function(t){e.entity.Id=t.Id,e.entity.CourseTypeId=t.CourseTypeId,e.entity.DateStart=t.DateStart,e.entity.DateStartP=t.DateStartP,e.entity.DateEnd=t.DateEnd,e.entity.DateEndP=t.DateEndP,e.entity.Instructor=t.Instructor,e.entity.Location=t.Location,e.entity.Department=t.Department,e.entity.OrganizationId=t.OrganizationId,e.entity.Duration=t.Duration,e.entity.DurationUnitId=t.DurationUnitId,e.entity.StatusId=t.StatusId,e.entity.Remark=t.Remark,e.entity.Capacity=t.Capacity,e.entity.Tuition=t.Tuition,e.entity.CurrencyId=t.CurrencyId,e.entity.DateDeadlineRegistration=t.DateDeadlineRegistration,e.entity.DateDeadlineRegistrationP=t.DateDeadlineRegistrationP,e.entity.TrainingDirector=t.TrainingDirector,e.entity.Title=t.Title,e.entity.AircraftTypeId=t.AircraftTypeId,e.entity.AircraftModelId=t.AircraftModelId,e.entity.CaoTypeId=t.CaoTypeId,e.entity.Recurrent=t.Recurrent,e.entity.Interval=t.Interval,e.entity.CalanderTypeId=t.CalanderTypeId,e.entity.IsInside=t.IsInside,e.entity.Quarantine=t.Quarantine,e.entity.DateStartPractical=t.DateStartPractical,e.entity.DateEndPractical=t.DateEndPractical,e.entity.DateStartPracticalP=t.DateStartPracticalP,e.entity.DateEndPracticalP=t.DateEndPracticalP,e.entity.DurationPractical=t.DurationPractical,e.entity.DurationPracticalUnitId=t.DurationPracticalUnitId,e.entity.IsGeneral=t.IsGeneral,e.entity.CustomerId=t.CustomerId,e.entity.No=t.No,e.entity.IsNotificationEnabled=t.IsNotificationEnabled,e.entity.CourseRelatedAircraftTypes=t.CourseRelatedAircraftTypes,e.entity.CourseRelatedCourseTypes=t.CourseRelatedCourseTypes,e.entity.CourseRelatedStudyFields=t.CourseRelatedStudyFields,e.entity.CourseRelatedEmployees=t.CourseRelatedEmployees,e.entity.CourseRelatedCourses=t.CourseRelatedCourses,e.entity.CourseRelatedGroups=t.CourseRelatedGroups,e.entity.CourseCatRates=t.CourseCatRates,e.entity.CourseAircraftTypes=t.CourseAircraftTypes},e.entityEmployee={},e.entityGroup={},e.entityCourse={},e.entityCourseType={},e.entityAircrafttype={},e.entityEducation={},e.clearEntityEmployee=function(){},e.clearEntityGroup=function(){},e.clearEntityCourse=function(){},e.clearEntityCourseType=function(){},e.clearEntityAircrafttype=function(){},e.clearEntityEducation=function(){};var l=[{text:"Main",id:"main",visible_btn:!1},{text:"Aircraft Type",id:"aircrafttype",visible_btn:!1,visible:"active"==e.type},{text:"Course Type",id:"coursetype",visible_btn:!0,visible:"active"==e.type},{text:"Education",id:"education",visible_btn:!1,visible_btn2:!0,visible:"active"==e.type},{text:"Course",id:"course",visible_btn:!1,visible:"active"==e.type},{text:"Group",id:"group",visible_btn:!1,visible:"active"==e.type},{text:"Employee",id:"employee",visible_btn:!1,visible:"active"==e.type}];e.btn_visible_aircrafttype=!1,e.btn_visible_coursetype=!1,e.btn_visible_education=!1,e.btn_visible_course=!1,e.btn_visible_group=!1,e.btn_visible_employee=!1,e.tabs=l,e.selectedTabIndex=0,e.$watch("selectedTabIndex",function(t){try{e.selectedTab=l[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_aircrafttype_instance.repaint(),e.dg_coursetype_instance.repaint(),e.dg_education_instance.repaint(),e.dg_course_instance.repaint(),e.dg_group_instance.repaint(),e.dg_employee_instance.repaint();var i=setInterval(function(){$("#dg_education").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_aircrafttype").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_coursetype").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_course").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_group").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_employee").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),clearInterval(i)},10);e.btn_visible_aircrafttype=1==t,e.btn_visible_coursetype=2==t,e.btn_visible_education=3==t,e.btn_visible_course=4==t,e.btn_visible_group=5==t,e.btn_visible_employee=6==t}catch(e){}}),e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.scroll_height=200,e.scroll_main={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.pop_width=600,e.pop_height=350,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"educationadd",onClick:function(e){o.$broadcast("InitStudyFieldSelect",null)}},toolbar:"bottom",bindingOptions:{visible:"btn_visible_education",disabled:"IsMainDisabled"}},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"educationadd",bindingOptions:{visible:"btn_visible_education"},onClick:function(t){var i=o.getSelectedRow(e.dg_education_instance);if(!i)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.CourseRelatedStudyFields=Enumerable.From(e.entity.CourseRelatedStudyFields).Where("$.Id!="+i.Id).ToArray()}},toolbar:"bottom"},{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"aircrafttypeadd",bindingOptions:{visible:"btn_visible_aircrafttype"},onClick:function(e){o.$broadcast("InitAircraftSelect",null)}}},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"aircrafttypeadd",bindingOptions:{visible:"btn_visible_aircrafttype"},onClick:function(t){var i=o.getSelectedRow(e.dg_aircrafttype_instance);if(!i)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.CourseRelatedAircraftTypes=Enumerable.From(e.entity.CourseRelatedAircraftTypes).Where("$.Id!="+i.Id).ToArray()}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"coursetypeadd",bindingOptions:{visible:"btn_visible_coursetype"},onClick:function(e){o.$broadcast("InitCourseTypeSelect",null)}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"coursetypeadd",bindingOptions:{visible:"btn_visible_coursetype"},onClick:function(t){var i=o.getSelectedRow(e.dg_coursetype_instance);if(!i)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.CourseRelatedCourseTypes=Enumerable.From(e.entity.CourseRelatedCourseTypes).Where("$.Id!="+i.Id).ToArray()}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"courseadd",bindingOptions:{visible:"btn_visible_course"},onClick:function(e){o.$broadcast("InitCourseSelect",null)}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"courseadd",bindingOptions:{visible:"btn_visible_course"},onClick:function(t){var i=o.getSelectedRow(e.dg_course_instance);if(!i)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.CourseRelatedCourses=Enumerable.From(e.entity.CourseRelatedCourses).Where("$.Id!="+i.Id).ToArray()}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"groupadd",bindingOptions:{visible:"btn_visible_group"},onClick:function(e){o.$broadcast("InitJobGroupSelect",null)}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"groupadd",bindingOptions:{visible:"btn_visible_group"},onClick:function(t){var i=o.getSelectedRow(e.dg_group_instance);if(!i)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.CourseRelatedGroups=Enumerable.From(e.entity.CourseRelatedGroups).Where("$.Id!="+i.Id).ToArray()}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"employeeadd",bindingOptions:{visible:"btn_visible_employee"},onClick:function(e){o.$broadcast("InitEmployeeSelect",null)}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"employeeadd",bindingOptions:{visible:"btn_visible_employee"},
onClick:function(t){var i=o.getSelectedRow(e.dg_employee_instance);if(!i)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.CourseRelatedEmployees=Enumerable.From(e.entity.CourseRelatedEmployees).Where("$.Id!="+i.Id).ToArray()}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"courseadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();e.pop_width=i.width,e.pop_width>1e3&&(e.pop_width=1e3),e.pop_height=$(window).height()-30,e.dg_height=e.pop_height-133,e.scroll_height=e.pop_height-140},onShown:function(t){e.isNew,null!=e.tempData&&(e.loadingVisible=!0,i.getCourse(e.tempData.Id).then(function(t){e.loadingVisible=!1,e.bind(t)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1},onHidden:function(){e.selectedTabIndex=0,o.$broadcast("onCourseHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title","toolbarItems[0].visible":"btn_visible_education","toolbarItems[1].visible":"btn_visible_education","toolbarItems[2].visible":"btn_visible_aircrafttype","toolbarItems[3].visible":"btn_visible_aircrafttype","toolbarItems[4].visible":"btn_visible_coursetype","toolbarItems[5].visible":"btn_visible_coursetype","toolbarItems[6].visible":"btn_visible_course","toolbarItems[7].visible":"btn_visible_course","toolbarItems[8].visible":"btn_visible_group","toolbarItems[9].visible":"btn_visible_group","toolbarItems[10].visible":"btn_visible_employee","toolbarItems[11].visible":"btn_visible_employee"}},e.popup_add.toolbarItems[13].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[12].options.onClick=function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.isNew&&(e.entity.Id=-1,e.entity.CustomerId=Config.CustomerId,e.entity.IsGeneral=1),e.entity.IsNotificationEnabled=0,"active"==e.type&&(e.entity.IsNotificationEnabled=1),e.loadingVisible=!0,i.save(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onCourseSaved",t),e.loadingVisible=!1,e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.pop_width_education=800,e.pop_height_education=600,e.popup_education_visible=!1,e.popup_education_title="Education",e.popup_education={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"educationadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_education_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_education>e.pop_width&&(e.pop_width_education=e.pop_width),e.pop_height_education>e.pop_height&&(e.pop_height_education=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityEducation(),e.popup_education_visible=!1},bindingOptions:{visible:"popup_education_visible",width:"pop_width_education",height:"pop_height_education",title:"popup_education_title"}},e.pop_width_aircrafttype=800,e.pop_height_aircrafttype=600,e.popup_aircrafttype_visible=!1,e.popup_aircrafttype_title="Aircraft Type",e.popup_aircrafttype={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"aircrafttypeadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_aircrafttype_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_aircrafttype>e.pop_width&&(e.pop_width_aircrafttype=e.pop_width),e.pop_height_aircrafttype>e.pop_height&&(e.pop_height_aircrafttype=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityAircrafttype(),e.popup_aircrafttype_visible=!1},bindingOptions:{visible:"popup_aircrafttype_visible",width:"pop_width_aircrafttype",height:"pop_height_aircrafttype",title:"popup_aircrafttype_title"}},e.pop_width_coursetype=800,e.pop_height_coursetype=600,e.popup_coursetype_visible=!1,e.popup_coursetype_title="Course Type",e.popup_coursetype={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"coursetypeadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_coursetype_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_coursetype>e.pop_width&&(e.pop_width_coursetype=e.pop_width),e.pop_height_coursetype>e.pop_height&&(e.pop_height_coursetype=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityCourseType(),e.popup_coursetype_visible=!1},bindingOptions:{visible:"popup_coursetype_visible",width:"pop_width_coursetype",height:"pop_height_coursetype",title:"popup_coursetype_title"}},e.pop_width_course=800,e.pop_height_course=600,e.popup_course_visible=!1,e.popup_course_title="Course",e.popup_course={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"courseadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_course_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_course>e.pop_width&&(e.pop_width_course=e.pop_width),e.pop_height_course>e.pop_height&&(e.pop_height_course=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityCourse(),e.popup_course_visible=!1},bindingOptions:{visible:"popup_course_visible",width:"pop_width_course",height:"pop_height_course",title:"popup_course_title"}},e.pop_width_group=800,e.pop_height_group=600,e.popup_group_visible=!1,e.popup_group_title="Group",e.popup_group={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"groupadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_group_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_group>e.pop_width&&(e.pop_width_group=e.pop_width),e.pop_height_group>e.pop_height&&(e.pop_height_group=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityGroup(),e.popup_group_visible=!1},bindingOptions:{visible:"popup_group_visible",width:"pop_width_group",height:"pop_height_group",title:"popup_group_title"}},e.pop_width_employee=800,e.pop_height_employee=600,e.popup_employee_visible=!1,e.popup_employee_title="Employee",e.popup_employee={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"employeeadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_employee_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_employee>e.pop_width&&(e.pop_width_employee=e.pop_width),e.pop_height_employee>e.pop_height&&(e.pop_height_employee=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityEmployee(),e.popup_employee_visible=!1},bindingOptions:{visible:"popup_employee_visible",width:"pop_width_employee",height:"pop_height_employee",title:"popup_employee_title"}},e.dg_education_columns=[{dataField:"Title",caption:"Field",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,sortIndex:0,sortOrder:"asc"},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300}],e.dg_education_selected=null,e.dg_education_instance=null,e.dg_education={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_education_columns,onContentReady:function(t){e.dg_education_instance||(e.dg_education_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_education_selected=i||null},bindingOptions:{dataSource:"entity.CourseRelatedStudyFields",height:"dg_height"}},e.dg_aircrafttype_columns=[{dataField:"Type",caption:"Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200,sortIndex:0,sortOrder:"asc"},{dataField:"Manufacturer",caption:"Manufacturer",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_aircrafttype_selected=null,e.dg_aircrafttype_instance=null,e.dg_aircrafttype={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_aircrafttype_columns,onContentReady:function(t){e.dg_aircrafttype_instance||(e.dg_aircrafttype_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_aircrafttype_selected=i||null},bindingOptions:{dataSource:"entity.CourseRelatedAircraftTypes",height:"dg_height"}},e.dg_coursetype_columns=[{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,sortIndex:0,sortOrder:"asc"},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300}],e.dg_coursetype_selected=null,e.dg_coursetype_instance=null,e.dg_coursetype={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_coursetype_columns,onContentReady:function(t){e.dg_coursetype_instance||(e.dg_coursetype_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_coursetype_selected=i||null},bindingOptions:{dataSource:"entity.CourseRelatedCourseTypes",height:"dg_height"}},e.dg_course_columns=[{dataField:"No",caption:"No",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:100},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"DateStart",caption:"DateStart",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"DateEnd",caption:"DateEnd",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"Organization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Instructor",caption:"Instructor",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150}],e.dg_course_selected=null,e.dg_course_instance=null,e.dg_course={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_course_columns,onContentReady:function(t){e.dg_course_instance||(e.dg_course_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_course_selected=i||null},bindingOptions:{dataSource:"entity.CourseRelatedCourses",height:"dg_height"}},e.dg_group_columns=[{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FullCode",caption:"Code",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,encodeHtml:!1,width:200,sortIndex:0,sortOrder:"asc"}],e.dg_group_selected=null,e.dg_group_instance=null,e.dg_group={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_group_columns,onContentReady:function(t){e.dg_group_instance||(e.dg_group_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_group_selected=i||null},bindingOptions:{dataSource:"entity.CourseRelatedGroups",height:"dg_height"}},e.dg_employee_columns=[{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,sortIndex:0,sortOrder:"asc"},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Location",caption:"Department",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"DateJoinCompany",caption:"Join Company",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130}],e.dg_employee_selected=null,e.dg_employee_instance=null,e.dg_employee={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_employee_columns,onContentReady:function(t){e.dg_employee_instance||(e.dg_employee_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_employee_selected=i||null},bindingOptions:{dataSource:"entity.CourseRelatedEmployees",height:"dg_height"}},e.category=null,e.txt_category={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"category"}},e.txt_No={hoverStateEnabled:!1,bindingOptions:{value:"entity.No"}},e.txt_Title={hoverStateEnabled:!1,bindingOptions:{value:"entity.Title"}},e.txt_Duration={min:1,bindingOptions:{value:"entity.Duration"}},e.txt_Interval={min:1,bindingOptions:{value:"entity.Interval"}},e.txt_Tuition={min:1,bindingOptions:{value:"entity.Tuition"}},e.txt_Instructor={hoverStateEnabled:!1,bindingOptions:{value:"entity.Instructor"}},e.txt_TrainingDirector={hoverStateEnabled:!1,bindingOptions:{value:"entity.TrainingDirector"}},e.txt_Location={hoverStateEnabled:!1,bindingOptions:{value:"entity.Location"}},e.txt_Remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.Remark"}},e.chb_Recurrent={text:"Recurrent",bindingOptions:{value:"entity.Recurrent"}},e.chb_IsNotificationEnabled={text:"Push Notifications",bindingOptions:{value:"entity.IsNotificationEnabled"}},e.chb_IsInside={text:"Initial",bindingOptions:{value:"entity.IsInside"}},e.date_DateStart={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateStart"}},e.date_DateEnd={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateEnd"}},e.date_DateStartPractical={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateStartPractical"}},e.date_DateEndPractical={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateEndPractical"}},e.date_DateDeadlineRegistration={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateDeadlineRegistration"}},e.sb_DurationUnitId={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(26),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.DurationUnitId"}},e.sb_CalanderTypeId={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(11),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.CalanderTypeId"}},e.sb_CurrencyId={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceCurrencies(),displayExpr:"Code",valueExpr:"Id",searchExpr:["Title","Code"],bindingOptions:{value:"entity.CurrencyId"}},e.sb_CourseTypeId={dataSource:o.getDatasourceCourseType(),showClearButton:!0,searchEnabled:!0,searchExpr:["Title"],valueExpr:"Id",displayExpr:"Title",onSelectionChanged:function(t){e.isNew&&(e.entity.Title=t.selectedItem?t.selectedItem.Title:null),t.selectedItem&&t.selectedItem.Interval&&(e.entity.Interval=t.selectedItem.Interval),t.selectedItem&&t.selectedItem.CalenderTypeId&&(e.entity.CalanderTypeId=t.selectedItem.CalenderTypeId)},bindingOptions:{value:"entity.CourseTypeId"}},e.sb_CaoTypeId={dataSource:o.getDatasourceCaoType(),showClearButton:!0,searchEnabled:!0,searchExpr:["Title"],valueExpr:"Id",displayExpr:"Title",bindingOptions:{value:"entity.CaoTypeId"}},e.sb_OrganizationId={dataSource:o.getDatasourceAirline(),showClearButton:!0,searchEnabled:!0,searchExpr:["Title"],valueExpr:"Id",displayExpr:"Title",bindingOptions:{value:"entity.OrganizationId"}},e.tag_CourseCatRate={showClearButton:!0,width:"100%",searchEnabled:!0,dataSource:o.getDatasourceOption(51),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.CourseCatRates"}},e.tag_CourseAircraftType={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(e){return o.getSbTemplateAircraft(e)},searchExpr:["Type","Manufacturer"],dataSource:o.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",bindingOptions:{value:"entity.CourseAircraftTypes"}},e.tempData=null,e.$on("InitAddCourse",function(t,i){e.tempData=null,i.Id?(e.popup_add_title="Edit",e.tempData=i,e.isNew=!1):(e.isNew=!0,e.popup_add_title="New"),e.popup_add_visible=!0}),e.$on("onAircraftSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.CourseRelatedAircraftTypes).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.CourseRelatedAircraftTypes.push(i)}),e.dg_aircrafttype_instance.refresh())}),e.$on("onCourseTypeSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.CourseRelatedCourseTypes).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.CourseRelatedCourseTypes.push(i)}),e.dg_coursetype_instance.refresh())}),e.$on("onStudyFieldSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.CourseRelatedStudyFields).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.CourseRelatedStudyFields.push(i)}),e.dg_education_instance.refresh())}),e.$on("onEmployeeSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.CourseRelatedEmployees).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.CourseRelatedEmployees.push(i)}),e.dg_employee_instance.refresh())}),e.$on("onCourseSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.CourseRelatedCourses).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.CourseRelatedCourses.push(i)}),e.dg_coursetype_instance.refresh())}),e.$on("onJobGroupSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.CourseRelatedGroups).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.CourseRelatedGroups.push(i)}),e.dg_group_instance.refresh())})}]),app.controller("courseController",["$scope","$location","$routeParams","$rootScope","courseService","authService",function(e,t,i,n,a,o){e.prms=i.prms,e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(e){var t={Id:null};n.$broadcast("InitAddCourse",t)}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitAddCourse",i)}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitAddCourse",i)}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_columns=[{dataField:"No",caption:"No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"CT_Title",caption:"Course Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"CaoTypeTitle",caption:"Cao Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Duration2",caption:"Duration",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"DateStart",caption:"DateStart",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,sortIndex:0,sortOrder:"desc"},{dataField:"DateEnd",caption:"DateEnd",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"Recurrent",caption:"Recurrent",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100},{dataField:"AircraftType",caption:"Aircraft Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:120},{dataField:"Organization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Instructor",caption:"Instructor",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"TrainingDirector",caption:"Training Director",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds"}},e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+"odata/courses/archived/"+Config.CustomerId,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}}}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},o.isAuthorized()?(n.page_title="> Archived Courses",$(".course").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onCourseSaved",function(t,i){e.doRefresh=!0}),e.$on("onCourseHide",function(t,i){e.bind()}),n.$broadcast("PersonLoaded",null)}]),app.controller("flightListController",["$scope","$location","$routeParams","$rootScope","flightService","weatherService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d,s){e.prms=i.prms,e.typeId=s.current.type,e.airport=i.airport,e.airportEntity=null,e.filterVisible=!1,e.plan={},e.IsDetailsVisible=!1,e.IsTabDisabled=!1,e.scroll_height=200,e.scroll_info={scrollByContent:!0,scrollByThumb:!0,height:function(){return window.innerHeight-180}},e.tempData=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.IsApproveDisabled=!0,e.btn_approve={text:"Approve",type:"default",icon:"check",width:150,bindingOptions:{disabled:"IsApproveDisabled"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_SimpleConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.approvePlanRegisters(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.IsApproveDisabled=!0,e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_view={text:"View",type:"default",icon:"info",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.popup_flight_visible=!0}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.date_from={type:"date",readOnly:!0,width:"100%",bindingOptions:{value:"plan.DateFrom"}},e.date_to={type:"date",readOnly:!0,width:"100%",bindingOptions:{value:"plan.DateTo"}},e.text_interval={readOnly:!0,width:"100%",bindingOptions:{value:"plan.IntervalType"}},e.text_month={readOnly:!0,width:"100%",bindingOptions:{value:"plan.MonthsStr"}},e.text_day={readOnly:!0,width:"100%",bindingOptions:{value:"plan.DaysStr"}},e.text_type={readOnly:!0,width:"100%",bindingOptions:{value:"plan.Types"}},e.dg_height_full=100,e.scroll_height_full=400,e.dg_selected=null,e.dg_columns=[{dataField:"delay1",caption:"",width:50,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="lightgray";t.data.FlightStatusID>1&&(i=t.data.DelayOffBlock>0||t.data.DelayOnBlock>0?"#e51400":"#60a917"),$("<div>").append('<i class="fas fa-clock" style="color:'+i+';font-size:16px"></i>').appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"FlightStatusID",caption:"",width:150,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i=Flight.getStatus(t.value),n=i.bgcolor,a=t.data.FlightStatus;switch(t.value){case 1:$("<div>").append('<i class="fas fa-calendar-day" style="color:lightgray;font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 14:$("<div>").append('<i class="far fa-square" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 2:$("<div>").append('<i class="fas fa-plane-departure" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 3:$("<div>").append('<i class="fas fa-plane-arrival" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 15:$("<div>").append('<i class="fas fa-square" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 7:$("<div>").append('<i class="fas fa-level-down-alt" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 17:$("<div>").append('<i class="fas fa-random" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 4:$("<div>").append('<i class="fas fa-ban" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e)}},fixed:!0,fixedPosition:"left"},{caption:"Aircraft",columns:[{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"AircraftType",caption:"Type",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90}]},{dataField:"FlightTypeAbr",caption:"",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70,fixed:!0,fixedPosition:"left"},{dataField:"ID",caption:"ID",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left"},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:110,fixed:!0,fixedPosition:"left"},{caption:"Airports",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90}]},{caption:"Duration",columns:[{dataField:"ActualFlightHOffBlock",caption:"Hour(s)",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"ActualFlightMOffBlock",caption:"Minute(s)",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90}]},{caption:"Departure",columns:[{dataField:"STD",caption:"Scheduled Dep.",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:170,alignment:"center",format:"yyyy-MMM-dd, HH:mm",sortIndex:0,sortOrder:"desc"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Arrival",columns:[{dataField:"STA",caption:"Scheduled Arr.",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,
format:"yyyy-MMM-dd, HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Pax",columns:[{dataField:"PaxAdult",caption:"Adult",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxChild",caption:"Child",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxInfant",caption:"Infant",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"TotalPax",caption:"Total",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center",name:"totalpax"},{dataField:"TotalSeat",caption:"Seats",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxOver",caption:"Over",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Cargo",columns:[{dataField:"CargoUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"CargoWeight",caption:"Weight",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"cargoweight"},{dataField:"CargoCount",caption:"Count",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Baggage",columns:[{dataField:"CargoUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"BaggageWeight",caption:"Weight",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"baggageweight"},{dataField:"BaggageCount",caption:"Count",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Fuel",columns:[{dataField:"FuelUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"FuelDeparture",caption:"Dep.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FuelArrival",caption:"Arr.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"}]},{caption:"Delays",fixed:!0,fixedPosition:"right",columns:[{dataField:"DelayOffBlock",caption:"Dep.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"delay"},{dataField:"DelayOnBlock",caption:"Arr.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"delayLanding"}]}],e.dg_height=100,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:50},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,e.flight=i):(e.dg_selected=null,e.IsDetailsVisible=!1,e.flight={},e.dg_delay_ds=null)},height:$(window).height()-135,bindingOptions:{dataSource:"dg_ds"}},e.getStatusClass=function(e){return"col-lg-3 col-md-3 col-sm-3 col-xs-3 font-inherit "+Enumerable.From(Flight.statusDataSource).Where("$.id=="+e.status).FirstOrDefault().class},e.scroll_1={scrollByContent:!0,scrollByThumb:!0,height:534},e.scroll_dep={scrollByContent:!0,scrollByThumb:!0,height:497},e.scroll_weather={scrollByContent:!0,scrollByThumb:!0,height:497},e.scroll_arr={scrollByContent:!0,scrollByThumb:!0,height:497};var c=[{text:"Main",id:"departure",visible:!0},{text:"Delays",id:"delays",visible:!0},{text:"Weather",id:"weather",visible:!0}];e.tabs=c,e.selectedTabIndex=-1,e.$watch("selectedTabIndex",function(t){try{e.selectedTab=c[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_delay_instance.repaint()}catch(e){}}),e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex"}},e.dg_delay_selected=null,e.dg_delay_columns=[{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,groupIndex:0},{dataField:"Selected",caption:"",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!0,width:90,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!0,fixedPosition:"left"},{dataField:"MM",caption:"Minute(s)",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!0,width:90},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_delay_height=100,e.dg_delay_instance=null,e.dg_delay_ds=null,e.dg_delay={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},onEditingStart:function(e){"MM"!=e.column.dataField||e.key.Selected||(e.cancel=!0)},onRowUpdating:function(e){e.newData.hasOwnProperty("Selected")&&(e.newData.Selected||(e.newData.HH=null,e.newData.MM=null))},onRowUpdated:function(e){},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_delay_columns,onContentReady:function(t){e.dg_delay_instance||(e.dg_delay_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_delay_selected=i||null},height:497,summary:{totalItems:[{column:"MM",summaryType:"sum"}]},bindingOptions:{dataSource:"dg_delay_ds"}},e.flight={},e.time_std={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.STD"}},e.time_sta={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.STA"}},e.time_offblock={type:"datetime",width:"100%",interval:5,readOnly:!0,bindingOptions:{value:"flight.ChocksOut"}},e.time_takeoff2={type:"datetime",width:"100%",interval:5,readOnly:!0,bindingOptions:{value:"flight.Takeoff"}},e.time_landing={type:"datetime",readOnly:!0,width:"100%",interval:5,bindingOptions:{value:"flight.Landing"}},e.time_onblock={type:"datetime",readOnly:!0,width:"100%",interval:5,bindingOptions:{value:"flight.ChocksIn"}},e.total_seats={readOnly:!0,bindingOptions:{value:"flight.TotalSeat"}},e.total_pax={readOnly:!0,bindingOptions:{value:"flight.TotalPax"}},e.pax_adult={readOnly:!0,min:0,bindingOptions:{value:"flight.PaxAdult"}},e.pax_child={readOnly:!0,min:0,bindingOptions:{value:"flight.PaxChild"}},e.pax_infant={readOnly:!0,min:0,bindingOptions:{value:"flight.PaxInfant"}},e.pax_over={readOnly:!0,min:0,bindingOptions:{value:"flight.PaxOver"}},e.cargo_piece={readOnly:!0,min:0,bindingOptions:{value:"flight.CargoCount"}},e.cargo_weight={readOnly:!0,min:0,bindingOptions:{value:"flight.CargoWeight"}},e.cargo_excess={readOnly:!0,min:0,bindingOptions:{}},e.bag_piece={readOnly:!0,min:0,bindingOptions:{value:"flight.BaggageCount"}},e.bag_weight={readOnly:!0,min:0,bindingOptions:{value:"flight.BaggageWeight"}},e.bag_excess={readOnly:!0,min:0,bindingOptions:{}},e.txt_massunit={readOnly:!0,bindingOptions:{value:"flight.CargoUnit"}},e.txt_fuelunit={readOnly:!0,bindingOptions:{value:"flight.FuelUnit"}},e.remark_dep={readOnly:!0,bindingOptions:{value:"flight.DepartureRemark"}},e.remark_arr={readOnly:!0,bindingOptions:{value:"flight.ArrivalRemark"}},e.fuel_dep={readOnly:!0,min:0,bindingOptions:{value:"flight.FuelDeparture"}},e.fuel_arr={readOnly:!0,min:0,bindingOptions:{value:"flight.FuelArrival"}},e.fuel_actual={readOnly:!0,min:0,bindingOptions:{value:"flight.FuelActual"}},e.fuel_planned={readOnly:!0,min:0,bindingOptions:{value:"flight.FuelPlanned"}},e.fuel_variance={readOnly:!0,min:0,bindingOptions:{value:"flight.FuelVariance"}},e.txt_delay={readOnly:!0,min:0,bindingOptions:{value:"flight.DelayOffBlock"}},e.txt_delayLanding={readOnly:!0,min:0,bindingOptions:{value:"flight.DelayOnBlock"}},e.popup_flight_visible=!1,e.popup_flight_title="Departure",e.popup_flight={elementAttr:{class:"popup_flight"},shading:!0,width:1200,height:647,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.selectedTabIndex=0},onShown:function(t){e.flight.delays?e.dg_delay_ds=e.flight.delays:(e.loadingVisible=!0,a.getFlightDelayCodes(e.flight.ID).then(function(t){e.loadingVisible=!1,e.flight.delays=t,e.dg_delay_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})),1!=e.flight.IsWeather&&(e.loadingVisible=!0,o.getFlightAll(e.flight.ID).then(function(t){e.loadingVisible=!1,e.flight.IsWeather=1,$.each(t,function(t,i){2==i.StatusId&&(e.flight.WTakeoff=JSON.parse(i.Details),Weather.prepareWeather(e.flight.WTakeoff),e.flight.WTakeoffVisible=!0),3==i.StatusId&&(e.flight.WLanding=JSON.parse(i.Details),Weather.prepareWeather(e.flight.WLanding),e.flight.WLandingVisible=!0),14==i.StatusId&&(e.flight.WOffBlock=JSON.parse(i.Details),Weather.prepareWeather(e.flight.WOffBlock),e.flight.WOffBlockVisible=!0),15==i.StatusId&&(e.flight.WOnBlock=JSON.parse(i.Details),Weather.prepareWeather(e.flight.WOnBlock),e.flight.WOnBlockVisible=!0)})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},onHiding:function(){e.selectedTabIndex=-1,e.popup_flight_visible=!1},bindingOptions:{visible:"popup_flight_visible",title:"popup_flight_title"}},e.popup_flight.toolbarItems[0].options.onClick=function(t){e.popup_flight_visible=!1},e.bind=function(){var t="odata/flights/"+Config.CustomerId+"/"+(e.airport?e.airportEntity.Id:"-1");!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"ID",version:4,onLoading:function(e){},onLoaded:function(e){$.each(e,function(e,t){t.STD=new Date(t.STD+".000Z"),t.STA=new Date(t.STA+".000Z"),t.ChocksOut&&(t.ChocksOut=new Date(t.ChocksOut+".000Z")),t.ChocksIn&&(t.ChocksIn=new Date(t.ChocksIn+".000Z")),t.Takeoff&&(t.Takeoff=new Date(t.Takeoff+".000Z")),t.Landing&&(t.Landing=new Date(t.Landing+".000Z"))}),n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"ID",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},r.isAuthorized()?(n.page_title="> Flights Archive",$(".flightlist").fadeIn(400,function(){})):r.redirectToLogin(),e.$on("getFilterResponse",function(t,i){console.log(i),e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("$viewContentLoaded",function(){e.airport&&(e.loadingVisible=!0,a.getAirportByIATA(e.airport).then(function(t){e.airportEntity=t,e.airportEntity.Latitude2=Number(e.airportEntity.Latitude).toFixed(3),e.airportEntity.Longitude2=Number(e.airportEntity.Longitude).toFixed(3),e.airportEntity.LtLg="("+e.airportEntity.Latitude2+", "+e.airportEntity.Longitude2+")",e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))}),n.$broadcast("FlightLoaded",null)}]),app.controller("certificateAddController",["$scope","$location","courseService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.entity={Id:null,DateIssue:null,No:null,DateExpire:null,PersonId:null,CourseId:null,CourseTypeId:null,CourseTitle:null},e.employee={Name:null,PID:null,NID:null,Mobile:null},e.course={Title:null,Type:null,Organization:null,CalanderTypeId:null,Interval:null},e.clearEntity=function(t){t&&(e.employee.Name=null,e.employee.PID=null,e.employee.NID=null,e.employee.Mobile=null,e.entity.PersonId=null),e.course.Title=null,e.course.Type=null,e.course.Organization=null,e.course.CalanderTypeId=null,e.course.Interval=null,e.entity.DateIssue=null,e.entity.No=null,e.entity.DateExpire=null,e.entity.CourseId=null,e.entity.CourseTypeId=null,e.entity.CourseTitle=null,e.dg_instance&&e.dg_instance.clearSelection()},e.bindEmployee=function(t){e.employee.Name=t.Name,e.employee.PID=t.PID,e.employee.NID=t.NID,e.employee.Mobile=t.Mobile},e.bindCourse=function(t){e.course.Title=t.Title,e.course.Type=t.Type,e.course.Organization=t.Organization,e.course.CalanderTypeId=t.CalanderTypeId,e.course.Interval=t.Interval},e.bindEntity=function(t){e.entity.DateIssue=t.DateIssue,e.entity.No=t.No,e.entity.CourseId=t.CourseId,e.entity.PersonId=t.PersonId,e.entity.CourseTypeId=t.CourseTypeId,e.entity.CourseTitle=t.Title},e.bindCourses=function(){if(e.dg_ds){if(!e.dg_instance)return;var t=[["Id",">",0],"and"];e.courseTypeId&&(t.push(["CourseTypeId","=",e.courseTypeId]),t.push("and")),e.organizationId&&(t.push(["OrganizationId","=",e.organizationId]),t.push("and")),e.courseTitle&&(t.push(["Title","contains",e.courseTitle]),t.push("and")),t=t.slice(0,-1),console.log(t),e.dg_ds.filter=t,e.dg_instance.refresh()}else e.dg_ds={store:{type:"odata",url:o.serviceUrl+"odata/courses/archived/"+Config.CustomerId,key:"Id",version:4}}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.scroll_height=200,e.scroll_main={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.pop_width=600,e.pop_height=350,e.dg_height=100,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",text:"Add Course",width:150,icon:"plus",onClick:function(e){var t={Id:null};o.$broadcast("InitAddCourse",t)}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"certificateadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();e.pop_width=i.width,e.pop_width>1200&&(e.pop_width=1200),e.pop_height=$(window).height()-30,e.dg_height=e.pop_height-200-100,e.scroll_height=e.pop_height-90,$("._course").height(e.pop_height-115-100)},onShown:function(t){e.dg_instance.clearSelection(),e.bindCourses(),e.tempData},onHiding:function(){e.clearEntity(!0),e.popup_add_visible=!1},onHidden:function(){o.$broadcast("onCertificateHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[2].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[1].options.onClick=function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.entity.DateIssue=new Date(e.entity.DateIssue).ToUTC(),e.isNew&&(e.entity.Id=-1),e.entity.DateExpire=null,e.loadingVisible=!0,i.saveCertificate(e.entity).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onCertificateSaved",t),e.loadingVisible=!1,e.clearEntity(!1),e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.dg_columns=[{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"CT_Title",caption:"Course Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"CaoTypeTitle",caption:"Cao Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Duration2",caption:"Duration",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"DateStart",caption:"DateStart",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,sortIndex:0,sortOrder:"desc"},{dataField:"DateEnd",caption:"DateEnd",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"Recurrent",caption:"Recurrent",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100},{dataField:"AircraftType",caption:"Aircraft Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:120},{dataField:"Organization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Instructor",caption:"Instructor",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"TrainingDirector",caption:"Training Director",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:"100%",columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,e.course.Title=e.dg_selected.Title,e.course.Type=e.dg_selected.CT_Title,e.course.Organization=e.dg_selected.Organization,e.course.Interval=e.dg_selected.Interval,e.course.CalanderTypeId=e.dg_selected.CalanderTypeId,e.entity.DateExpire=o.getNextDate(e.dg_selected.Interval,e.dg_selected.CalanderTypeId,e.entity.DateIssue),e.entity.CourseId=e.dg_selected.Id,e.entity.CourseTypeId=e.dg_selected.CourseTypeId,e.entity.CourseTitle=e.dg_selected.Title):(e.dg_selected=null,e.course.Title=null,e.course.Type=null,e.course.Organization=null,e.course.Interval=null,e.course.CalanderTypeId=null,e.entity.DateExpire=null,e.entity.CourseId=null,e.entity.CourseTypeId=null,e.entity.CourseTitle=null)},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.txt_Name={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"employee.Name"}},e.txt_PID={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"employee.PID"}},e.txt_NID={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"employee.NID"}},e.txt_Mobile={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"employee.Mobile"}},e.courseTypeId=null,e.$watch("courseTypeId",function(e){}),e.sb_CourseTypeId={dataSource:o.getDatasourceCourseType(),showClearButton:!0,searchEnabled:!0,searchExpr:["Title"],valueExpr:"Id",displayExpr:"Title",onSelectionChanged:function(t){e.bindCourses()},bindingOptions:{value:"courseTypeId"}},e.organizationId=null,e.$watch("organizationId",function(e){}),e.sb_OrganizationId={dataSource:o.getDatasourceAirline(),showClearButton:!0,searchEnabled:!0,searchExpr:["Title"],valueExpr:"Id",displayExpr:"Title",onSelectionChanged:function(t){e.bindCourses()},bindingOptions:{value:"organizationId"}},e.courseTitle=null,e.$watch("courseTitle",function(e){}),e.txt_courseTitle={hoverStateEnabled:!1,onValueChanged:function(t){e.bindCourses()},bindingOptions:{value:"courseTitle"}},e.txt_selectedCourseTitle={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"course.Title"}},e.txt_selectedCourseType={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"course.Type"}},e.txt_selectedCourseOrganization={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"course.Organization"}},e.txt_selectedInterval={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"course.Interval"}},e.sb_selectedCalType={readOnly:!0,showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(11),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"course.CalanderTypeId"}},e.date_DateIssue={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){e.entity.DateExpire=o.getNextDate(e.course.Interval,e.course.CalanderTypeId,t.value)},bindingOptions:{value:"entity.DateIssue"}},e.txt_CerNumber={hoverStateEnabled:!1,bindingOptions:{value:"entity.No"}},e.date_DateExpire={width:"100%",type:"date",readOnly:!0,displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateExpire"}},e.tempData=null,e.$on("InitAddCertificate",function(t,i){e.tempData=null,i.Id?(e.popup_add_title="Edit",e.tempData=i,e.isNew=!1,e.bindEmployee(i),e.bindCourse(i),e.bindEntity(i)):(e.isNew=!0,e.popup_add_title="New",e.bindEmployee(i),e.bindCourse(i),e.bindEntity(i)),e.popup_add_visible=!0}),e.$on("onCourseHide",function(t,i){e.bindCourses()})}]),app.controller("aircraftTypeController",["$scope","$location","$routeParams","$rootScope","airportService","authService",function(e,t,i,n,a,o){e.prms=i.prms,e.dsUrl=null,e.btn_delete={text:"",type:"danger",icon:"clear",width:40,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_new={text:"",type:"default",icon:"plus",width:40,onClick:function(e){var t={Id:null};n.$broadcast("InitAddAircraftType",t)}},e.btn_edit={text:"",type:"default",icon:"edit",width:40,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitAddAircraftType",i)}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;e.InitAddAirport(i)}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_delete_man={text:"",type:"danger",icon:"clear",width:40,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_new_man={text:"",type:"default",icon:"plus",width:40,onClick:function(e){var t={Id:null};n.$broadcast("InitAddAircraftType",t)}},e.btn_edit_man={text:"",type:"default",icon:"edit",width:40,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitAddAircraftType",i)}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.filters=[],e.dg_columns=[{dataField:"Type",caption:"Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_columns_man=[{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Country",caption:"Country",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:100},{dataField:"Website",caption:"Website",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Email",caption:"Email",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-175,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds"}},e.dg_selected_man=null,e.dg_instance_man=null,e.dg_ds_man=null,e.dg_man={filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-175,columns:e.dg_columns_man,onContentReady:function(t){e.dg_instance_man||(e.dg_instance_man=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected_man=i,e.dg_ds=null,e.typeFilters=[],e.typeFilters.push("ManufacturerId"),e.typeFilters.push("="),e.typeFilters.push(Number(i.Id)),e.bind()):e.dg_selected_man=null},bindingOptions:{dataSource:"dg_ds_man"}},e.doRefresh=!1,e.doRefresh_man=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.typeFilters=[],e.bind=function(){e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+"odata/aircrafttypes/all",key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},filter:e.typeFilters}),e.doRefresh&&(e.dg_ds.filter=e.typeFilters,e.dg_instance.refresh(),e.doRefresh=!1)},e.bind_man=function(){e.dg_ds_man||(e.dg_ds_man={store:{type:"odata",url:n.serviceUrl+"odata/manufactureres/all",key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}}}),e.doRefresh_man&&(e.dg_instance_man.refresh(),e.doRefresh_man=!1)},o.isAuthorized()?(n.page_title="> Aircraft Types",$(".aircraftType").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onAircraftTypeSaved",function(t,i){e.doRefresh=!0}),e.$on("onAircraftTypeHide",function(t,i){e.bind()}),e.bind_man(),n.$broadcast("AircraftTypeLoaded",null)}]),app.controller("employeeSelectController",["$scope","$location","authService","$routeParams","$rootScope",function(e,t,i,n,a){e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_columns=[{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:250},{dataField:"Location",caption:"Department",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"multiple"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData;e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.dg_height=100,e.pop_width=800,e.pop_height=500,e.popup_add_visible=!1,e.popup_add_title="Employees",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Ok",icon:"check",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=a.getWindowSize();i.width<=800&&(e.pop_width=i.width,e.pop_height=i.height),e.dg_height=e.pop_height-100},onShown:function(t){e.bind()},onHiding:function(){e.popup_add_visible=!1,a.$broadcast("onEmployeeSelectHide",e.dg_selected)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){if(!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.popup_add_visible=!1},e.bind=function(){e.dg_ds?e.dg_instance.clearSelection():e.dg_ds={store:{type:"odata",url:a.serviceUrl+"odata/employees/"+Config.CustomerId,key:"Id",version:4}}},e.$on("InitEmployeeSelect",function(t,i){e.popup_add_visible=!0})}]),app.controller("aircraftSelectController",["$scope","$location","aircraftService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_columns=[{dataField:"Type",caption:"Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Manufacturer",caption:"Manufacturer",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"multiple"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData;e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.dg_height=100,e.pop_width=700,e.pop_height=500,e.popup_add_visible=!1,e.popup_add_title="Aircraft Types",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Ok",icon:"check",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();i.width<=700&&(e.pop_width=i.width,e.pop_height=i.height),e.dg_height=e.pop_height-100},onShown:function(t){e.bind()},onHiding:function(){e.popup_add_visible=!1},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){if(!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error")
;o.$broadcast("onAircraftSelectHide",e.dg_selected),e.popup_add_visible=!1},e.bind=function(){e.dg_ds?e.dg_instance.clearSelection():e.dg_ds={store:{type:"odata",url:o.serviceUrl+"odata/aircrafttypes/all",key:"Id",version:4}}},e.$on("InitAircraftSelect",function(t,i){e.popup_add_visible=!0})}]),app.controller("crewtestController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.Day0="05/06/2019",e.Day1="05/08/2019",e.Day2="05/08/2019 23:59:00.000",e.CurrentDate=new Date,e.ToDate=(new Date).addDays(0),Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.flight=null,e.getGantt=function(){return $("#resourceGanttba").data("ejGantt")},e.ganttData=null,e.resourceGroups=[],e.resources=[],e.dataSource=[],e.scrollGantt=function(t){var i=new Date(t.STD),n=new Date(e.datefrom),a=Flight.subtractDatesHours(i,n)*$(".e-schedule-day-headercell").width()-50;$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(a)},e.scrollGanttNow=function(){var t=new Date(Date.now()),i=new Date(t),n=new Date(e.datefrom),a=Flight.subtractDatesHours(i,n)*$(".e-schedule-day-headercell").width()-50;$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(a)},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.popup_search_visible=!0}},e.btn_box={text:"Group",type:"default",width:150,onClick:function(t){if(!(e.selectedIds.length<1)){if(e.selectedIds.length>10)return void General.ShowNotify("Invalid sector counts","error");var i=(Enumerable.From(e.selectedItems).Select("$.CalendarId").Distinct().ToArray(),{ids:e.selectedIds,cid:e.selectedItems[0].CalendarId});e.loadingVisible=!0,a.boxItems(i).then(function(t){e.loadingVisible=!1,e.rebind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}},e.btn_unbox={text:"UnGroup",type:"default",width:150,onClick:function(t){if(e.selectedBox){var i={id:e.selectedBox.BoxId};e.loadingVisible=!0,a.unboxItems(i).then(function(t){e.loadingVisible=!1,e.rebind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}},e.IsCrewDisabled=!1,e.btn_crew_add={text:"",type:"default",icon:"plus",width:40,onClick:function(t){return e.selectedBox?1==e.selectedBox.WOCLError?void General.ShowNotify("WOCL Error","error"):1==e.selectedBox.IsDutyOver?void General.ShowNotify("Over Duty Error","error"):void(e.popup_crew2_visible=!0):void General.ShowNotify(Config.Text_NoRowSelected,"error")},bindingOptions:{disabled:"IsCrewDisabled"}},e.btn_crew_delete={text:"",type:"danger",icon:"remove",width:40,onClick:function(t){if(e.dg_crew_selected=n.getSelectedRow(e.dg_crew_instance),!e.dg_crew_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_crew_selected.Id};e.loadingVisible=!0,a.deleteBoxCrew(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.getCrew(e.selectedBox.BoxId)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})},bindingOptions:{disabled:"IsCrewDisabled"}},e.group_id=null,e.sb_group={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceGroups(),itemTemplate:function(e){return n.getSbTemplateGroup(e)},displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"group_id"}},e.dg_person_columns=[{dataField:"Position",caption:"Position",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:140,fixed:!0,fixedPosition:"left"},{dataField:"ScheduleName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:180,fixed:!1,fixedPosition:"left"},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left"},{dataField:"AvStatus",caption:"Status",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"",caption:"MEDICAL",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsMedicalExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"LPR",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsLPRExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsLPRExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"SKILL",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsProficiencyExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsProficiencyExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"CMC",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsCMCExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"CCRM",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsCCRMExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"AVSEC",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsAvSecExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"SEPT",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsSEPTExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"SEPTP",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsSEPTPExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"DG",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsDGExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"SMS",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsSMSExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"FIRSTAID",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsFirstAidExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsFirstAidExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"COLD W.",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsColdWeatherExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsColdWeatherExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"HOT W.",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsHotWeatherExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsHotWeatherExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"UPSET",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsUpsetRecoveryTrainingExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsUpsetRecoveryTrainingExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"CurrentLocationAirporIATA",caption:"Location",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90}],e.dg_person_selected=null,e.dg_person_instance=null,e.dg_person_ds=null,e.dg_person={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-310,columns:e.dg_person_columns,onContentReady:function(t){e.dg_person_instance||(e.dg_person_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_person_selected=i,e.group_id=i.GroupId):e.dg_person_selected=null},onCellPrepared:function(e){"data"==e.rowType&&"CurrentLocationAirporIATA"===e.column.dataField&&(e.data.IsLocation?e.cellElement.css("color","green"):e.cellElement.css("color","red").css("font-weight","bold")),"data"==e.rowType&&"AvStatus"===e.column.dataField&&(e.data.AvStatusId>1?e.cellElement.css("background","#ffdddd"):e.cellElement.css("background","#ddffdd"))},bindingOptions:{dataSource:"dg_person_ds"}},e.dg_crew_columns=[{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250,fixed:!0,fixedPosition:"left"},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130,fixed:!0,fixedPosition:"left"},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"left"},{dataField:"Location",caption:"Department",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"",caption:"Passport",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";t.data.IsPassportExpired?(i="red",n="ion-md-alert"):t.data.IsPassportExpiring&&(i="orange",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"PassportNumber",caption:"Passport No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"DatePassportExpire",caption:"Passport Expire",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"CaoCardNumber",caption:"CAO No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"DateCaoCardExpire",caption:"CAO Expire",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Mobile",caption:"Mobile",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Types",caption:"Types",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200,fixed:!1,fixedPosition:"left"}],e.dg_crew_selected=null,e.dg_crew_instance=null,e.dg_crew_ds=null,e.dg_crew={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:270,columns:e.dg_person_columns,onContentReady:function(t){e.dg_crew_instance||(e.dg_crew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew_selected=i||null},onRowPrepared:function(e){e.data&&1!=e.data.AvailabilityId&&e.rowElement.css("background","#ffcccc")},bindingOptions:{dataSource:"dg_crew_ds"}},e.dg_crew2_columns=[],e.selectedCell=null,e.dg_crew2_selected=null,e.dg_crew2_instance=null,e.dg_crew2_ds=null,e.dg_crew2={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-115,columns:e.dg_crew2_columns,onContentReady:function(t){e.dg_crew2_instance||(e.dg_crew2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew2_selected=i||null},onRowPrepared:function(e){},onCellPrepared:function(t){var i=moment(e.selectedBox.Date).format("YYYYMMDD");if(t.data&&"Name"==t.column.dataField&&t.cellElement.css({background:"#f1f1f1",padding:"5px"}),console.log("green "+t.column.dataField+"   "+i),t.data&&t.column.dataField==i&&t.cellElement.addClass("grid-cell-day"),t.data&&t.value.CalendarStatusId){var n="white";switch(t.value.CalendarStatusId){case 1169:n="#ffccff";break;case 1166:case 1165:n="#e6ccff";break;case 1167:case 1168:case 1170:n="#ffff99"}t.cellElement.css({background:n})}if(t.data&&"Name"!=t.column.dataField){Enumerable.From(t.value.Times).Where("$.DutyViolated || $.FlightViolated").FirstOrDefault()&&t.cellElement.css({background:"#ff8566"})}},onCellClick:function(t){if(t.data){console.log(t.data),$("td").removeClass("grid-cell-selected"),t.cellElement.addClass("grid-cell-selected"),e.selectedCell=t.value,e.selected_date=t.value.DateStr,e.selected_crew=t.data.Name+" ("+t.data.PID+")",e.sb_position_instance&&("P1"==t.data.JobGroup&&e.sb_position_instance.option("value",1160),"P2"==t.data.JobGroup&&e.sb_position_instance.option("value",1161),"TRI"==t.data.JobGroup&&e.sb_position_instance.option("value",1205),"TRE"==t.data.JobGroup&&e.sb_position_instance.option("value",1206),"CCM"==t.data.JobGroup&&e.sb_position_instance.option("value",1158),"SCCM"==t.data.JobGroup&&e.sb_position_instance.option("value",1157),"SCCM(i)"==t.data.JobGroup&&e.sb_position_instance.option("value",1157)),e.dg_fdp_ds=t.value.Times,e.BoxTimeStr="Flight: "+GetTimeStr(e.selectedBox.Flight)+" (h)       Duty: "+GetTimeStr(e.selectedBox.Duty)+" (h)   Max:"+GetTimeStr(e.selectedBox.MaxFDPExtended-t.value.FDPReduction)+"(h)";var i=t.value,n=!0,a=moment(e.selectedBox.Date).format("YYYYMMDD");t.column.dataField!=a&&(n=!1),t.value.CalendarStatusId&&1167!=t.value.CalendarStatusId&&1168!=t.value.CalendarStatusId&&(n=!1),n&&i.Boxes&&(n=null==Enumerable.From(i.Boxes).Where("$.BoxId=="+e.selectedBox.BoxId).FirstOrDefault()),1==t.data.RestIssue&&(n=!1),1==t.data.OverDuty&&(n=!1),e.selected_date2=t.column.dataField,e.IsAssignDisable=!n}},bindingOptions:{dataSource:"dg_crew2_ds"}},e.selected_crew="Crew",e.selected_date="Date",e.selected_date2="",e.dg_fdp_columns=[{dataField:"Title",caption:"FDP",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Flight",caption:"Flight",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:75},{dataField:"Duty",caption:"Duty",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:75},{caption:"After Assigning",columns:[{dataField:"NewFlight",caption:"Flight",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:75},{dataField:"NewDuty",caption:"Duty",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:75}]}],e.dg_fdp_selected=null,e.dg_fdp_instance=null,e.dg_fdp_ds=null,e.dg_fdp={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite",showScrollbar:"never"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:320,columns:e.dg_fdp_columns,onContentReady:function(t){e.dg_fdp_instance||(e.dg_fdp_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_fdp_selected=i||null},onRowPrepared:function(e){},onCellPrepared:function(e){e.data&&"Title"==e.column.dataField&&e.cellElement.css({background:"#f1f1f1"}),e.data&&"Duty"==e.column.dataField&&e.data.DutyViolated&&e.cellElement.css({background:"#ff8566"}),e.data&&"Flight"==e.column.dataField&&e.data.FlightViolated&&e.cellElement.css({background:"#ff8566"}),e.data&&"NewDuty"==e.column.dataField&&e.data.NewDutyViolated&&e.cellElement.css({background:"#ff8566"}),e.data&&"NewFlight"==e.column.dataField&&e.data.NewFlightViolated&&e.cellElement.css({background:"#ff8566"})},bindingOptions:{dataSource:"dg_fdp_ds"}},e.dg_items_columns=[{dataField:"FlightNumber",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"Route",caption:"Route",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"Duration",caption:"Duration",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"STS",caption:"",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1}],e.dg_items_selected=null,e.dg_items_instance=null,e.dg_items_ds=null,e.dg_items={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-500,columns:e.dg_items_columns,onContentReady:function(t){e.dg_items_instance||(e.dg_items_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_items_selected=i||null},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_items_ds"}},e.dg_sum_columns=[{dataField:"Title",caption:"Summary",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Value",caption:"Count",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:60}],e.dg_sum_selected=null,e.dg_sum_instance=null,e.dg_sum_ds=null,e.dg_sum={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:270,columns:e.dg_sum_columns,onContentReady:function(t){e.dg_sum_instance||(e.dg_sum_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_sum_selected=i||null},bindingOptions:{dataSource:"dg_sum_ds"}},e.date_from={type:"date",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"CurrentDate"}},e.date_to={type:"date",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"ToDate"}},e.FromDateEvent=null,e.ToDateEvent=null,e.date_from_event={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"FromDateEvent"}},e.date_to_event={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"ToDateEvent"}},e.event_status=null,e.popup_event_visible=!1,e.popup_event_title="",e.popup_event={width:300,height:260,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Ok",icon:"check",validationGroup:"eventadd",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={EmployeeId:e.dg_crew2_selected.Id,Date:e.selected_date2,Status:e.event_status,DateStart:e.FromDateEvent,DateEnd:e.ToDateEvent};e.loadingVisible=!0,a.saveCrewCalendar(i).then(function(t){e.loadingVisible=!1,e.bindCrew()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){},bindingOptions:{visible:"popup_event_visible",title:"popup_event_title"}},e.popup_event.toolbarItems[1].options.onClick=function(t){e.popup_event_visible=!1},e.popup_search_visible=!1,e.popup_search_title="",e.popup_search={width:500,height:300,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Ok",icon:"check",validationGroup:"crewsearch",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.bindtest()}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){},bindingOptions:{visible:"popup_search_visible",title:"popup_search_title"}},e.popup_search.toolbarItems[1].options.onClick=function(t){e.popup_search_visible=!1},e.popup_crew_visible=!1,e.popup_crew_title="Crew",e.popup_crew={width:1300,height:650,fullScreen:!0,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Add",icon:"check",validationGroup:"crewadd",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(e.dg_person_selected=n.getSelectedRow(e.dg_person_instance),!e.dg_person_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i={Id:-1,EmployeeId:e.dg_person_selected.Id,FlightPlanId:e.selectedBox.FlightPlanId,CalanderId:e.selectedBox.CalendarId,GroupId:e.group_id,BoxId:e.selectedBox.BoxId,AvailabilityId:e.dg_person_selected.AvStatusId};e.loadingVisible=!0,a.saveFlightPlanCrew(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.group_id=null,e.getCrew(e.selectedBox.BoxId)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Calendar"},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Flights"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.dg_person_instance.repaint(),e.bindPeople()},onHiding:function(){e.popup_crew_visible=!1},bindingOptions:{visible:"popup_crew_visible",title:"FlightsTitle"}},e.popup_crew.toolbarItems[1].options.onClick=function(t){e.popup_crew_visible=!1},e.crew_position_ds=[],e.$watch("IsCockpit",function(t,i,n){t?a.getCockpitPositions().then(function(t){e.crew_position_ds=t,e.bindCrew()},function(e){General.ShowNotify(e.message,"error")}):a.getCabinPositions().then(function(t){e.crew_position_ds=t,e.bindCrew()},function(e){General.ShowNotify(e.message,"error")})}),e.IsCockpit=!0,e.sb_cabin={showClearButton:!1,searchEnabled:!1,height:35,width:150,value:"Cockpit",dataSource:["Cockpit","Cabin"],onValueChanged:function(t){e.IsCockpit="Cockpit"==t.value}},e.filter_name=null,e.txt_name_filter={hoverStateEnabled:!1,readOnly:!1,placeholder:"Name, PID",width:"100%",onFocusOut:function(t){e.dg_crew2_ds=e.getFilteredCrew(),e.dg_crew2_instance.refresh()},bindingOptions:{value:"filter_name"}},e.popup_crew2_visible=!1,e.popup_crew2_title="Crew",e.IsAssignDisable=!0,e.sb_position_instance=null,e.buildAlertBox=function(e,t,i,n){if(n){if("cabin"==n&&e.JobGroupCode.startsWith("00101"))return"";if("cockpit"==n&&e.JobGroupCode.startsWith("00102"))return""}return 0==e[t]?"":"<div class='grid-cell-certificate' style='background:#cc0000'>"+i+"</div>"},e.popup_crew2={width:1300,height:650,fullScreen:!0,showTitle:!1,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",text:"Profile",icon:"card",onClick:function(t){if(e.dg_crew2_selected){e.dg_crew2_selected.Id;n.$broadcast("InitViewPerson",e.dg_crew2_selected)}}},toolbar:"bottom"},{widget:"dxSelectBox",location:"after",options:{showClearButton:!0,searchEnabled:!0,onInitialized:function(t){e.sb_position_instance||(e.sb_position_instance=t.component)},displayExpr:"Title",valueExpr:"Id",height:35,width:200,onValueChanged:function(t){e.group_id=t.value},bindingOptions:{dataSource:"crew_position_ds"}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{bindingOptions:{disabled:"IsAssignDisable"},type:"success",text:"Assign",icon:"check",onClick:function(t){return e.dg_crew2_selected=n.getSelectedRow(e.dg_crew2_instance),e.dg_crew2_selected?e.group_id?(console.log(e.selectedBox),void a.getRestValidation(e.selectedBox.BoxId,e.dg_crew2_selected.Id).then(function(t){if(t.nextRest&&t.nextRest.length>0)return void General.ShowNotify("Rest Requirement Error(Next FDP)","error");if(!t.dayoff)return void General.ShowNotify("Rest Requirement Error(Day Off)","error");var i=new Date(e.selectedBox.Date),n=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate();a.getOverDuty(n,e.dg_crew2_selected.Id,e.selectedBox.Duty+(e.selectedCell&&e.selectedCell.ECDuty?e.selectedCell.ECDuty:0),e.selectedBox.Flight).then(function(t){if(!t.status){var i="Over Duty/Flight error found. First occurrence: "+moment(new Date(t.first.CDate)).format("YYYY-MM-DD")+". Errors: "+t.remark.join(",");return void General.ShowNotify(i,"error")}var n={Id:-1,EmployeeId:e.dg_crew2_selected.Id,FlightPlanId:e.selectedBox.FlightPlanId,CalanderId:e.selectedBox.CalendarId,GroupId:e.group_id,BoxId:e.selectedBox.BoxId,AvailabilityId:e.dg_crew2_selected.Issues.length>0?-1:1,ECId:e.selectedCell.ECId?e.selectedCell.ECId:-1,ECSplitedId:e.selectedCell.ECSplitedId?e.selectedCell.ECSplitedId:-1},o="Are you sure?";e.dg_crew2_selected.Issues.length>0&&(o="Errors: "+e.dg_crew2_selected.Issues.join(", ")+". Are you sure?"),General.Confirm(o,function(t){t&&(e.loadingVisible=!0,a.saveFlightPlanCrew(n).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.bindCrew()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):void General.ShowNotify("Please select Position","error"):void General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Day Off",onClick:function(t){e.selectedCell&&e.selectedCell.Boxes&&e.selectedCell.Boxes.length>0||a.getRestDayOffCheck(e.selected_date2,e.dg_crew2_selected.Id).then(function(t){if(t&&-1==t)return void General.ShowNotify("Rest Requirement Error","error");var i={EmployeeId:e.dg_crew2_selected.Id,Date:e.selected_date2,Status:1166};e.loadingVisible=!0,a.saveCrewCalendar(i).then(function(t){e.loadingVisible=!1,e.bindCrew()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Rest",onClick:function(t){if(!(e.selectedCell&&e.selectedCell.Boxes&&e.selectedCell.Boxes.length>0)){var i={EmployeeId:e.dg_crew2_selected.Id,Date:e.selected_date2,Status:1165};e.loadingVisible=!0,a.saveCrewCalendar(i).then(function(t){e.loadingVisible=!1,e.bindCrew()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"STBY-A",onClick:function(t){e.selectedCell&&e.selectedCell.Boxes&&e.selectedCell.Boxes.length>0||a.getRestDayOffCheck(e.selected_date2,e.dg_crew2_selected.Id).then(function(t){if(t&&-1==t)return void General.ShowNotify("Rest Requirement Error","error");var i={EmployeeId:e.dg_crew2_selected.Id,Date:e.selected_date2,Status:1168};e.loadingVisible=!0,a.saveCrewCalendar(i).then(function(t){e.loadingVisible=!1,e.bindCrew()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"STBY-P",onClick:function(t){e.selectedCell&&e.selectedCell.Boxes&&e.selectedCell.Boxes.length>0||a.getRestDayOffCheck(e.selected_date2,e.dg_crew2_selected.Id).then(function(t){alert("x");var i={EmployeeId:e.dg_crew2_selected.Id,Date:e.selected_date2,Status:1167};e.loadingVisible=!0,a.saveCrewCalendar(i).then(function(t){e.loadingVisible=!1,e.bindCrew()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Reserve",onClick:function(t){e.selectedCell&&e.selectedCell.Boxes&&e.selectedCell.Boxes.length>0||a.getRestDayOffCheck(e.selected_date2,e.dg_crew2_selected.Id).then(function(t){if(t&&-1==t)return void General.ShowNotify("Rest Requirement Error","error");var i={EmployeeId:e.dg_crew2_selected.Id,Date:e.selected_date2,Status:1170};e.loadingVisible=!0,a.saveCrewCalendar(i).then(function(t){e.loadingVisible=!1,e.bindCrew()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Training",onClick:function(t){e.selectedCell&&e.selectedCell.Boxes&&e.selectedCell.Boxes.length>0||a.getRestDayOffCheck(e.selected_date2,e.dg_crew2_selected.Id).then(function(t){if(t&&-1==t)return void General.ShowNotify("Rest Requirement Error","error");var i=new Date(moment(e.selected_date2,"YYYYMMDD"));e.FromDateEvent=new Date(General.getDayFirstHour(i)).addHours(8),e.ToDateEvent=new Date(General.getDayFirstHour(i)).addHours(16),e.event_status=5e3,e.popup_event_visible=!0})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Office",onClick:function(t){e.selectedCell&&e.selectedCell.Boxes&&e.selectedCell.Boxes.length>0||a.getRestDayOffCheck(e.selected_date2,e.dg_crew2_selected.Id).then(function(t){if(t&&-1==t)return void General.ShowNotify("Rest Requirement Error","error");var i=new Date(moment(e.selected_date2,"YYYYMMDD"));e.FromDateEvent=new Date(General.getDayFirstHour(i)).addHours(8),e.ToDateEvent=new Date(General.getDayFirstHour(i)).addHours(16),e.event_status=5001,e.popup_event_visible=!0})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Clear",onClick:function(t){var i={EmployeeId:e.dg_crew2_selected.Id,Date:e.selected_date2,Status:-1};e.loadingVisible=!0,a.saveCrewCalendar(i).then(function(t){e.loadingVisible=!1,e.bindCrew()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){
e.popup_crew2_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=e.dg_crew2_instance.option("columns");i=[{dataField:"Name",caption:"",width:210,allowFiltering:!1,allowSorting:!1,alignment:"center",fixed:!0,fixedPosition:"left",cellTemplate:function(t,i){var n="#00cc99",a="#cc0000";i.data.ImageUrl||(i.data.ImageUrl="imguser.png");var o="<div style='text-align:left;width:100%;display:inline-block'><div  ><span style='display:inline-block;font-weight:bold;margin-right:5px;font-size:13px;'>("+i.data.JobGroup+")</span><span style='display:inline-block;font-weight:bold;font-size:13px'>"+i.data.ScheduleName+"</span><span style='display:inline-block;font-weight:normal;margin-left:5px;font-size:13px'>("+i.data.Code+")</span></div>";i.data.CurrentLocationAirporIATA!=e.selectedBox.FromAirportIATA&&(o+="<div  class='grid-cell-certificate' style='position:relative; white-space:normal;text-align:center;background:white;color:"+(i.data.CurrentLocationAirporIATA==e.selectedBox.FromAirportIATA?n:a)+";border:1px solid "+(i.data.CurrentLocationAirporIATA==e.selectedBox.FromAirportIATA?n:a)+"'>"+i.data.CurrentLocationAirporIATA+"</div>"),o+=e.buildAlertBox(i.data,"IsMedicalExpired","MEDICAL",null),o+=e.buildAlertBox(i.data,"IsCMCExpired","CMC",null),o+=e.buildAlertBox(i.data,"IsSEPTExpired","SEPT",null),o+=e.buildAlertBox(i.data,"IsSEPTPExpired","SEPTP",null),o+=e.buildAlertBox(i.data,"IsDGExpired","DG",null),o+=e.buildAlertBox(i.data,"IsCCRMExpired","CCRM",null),o+=e.buildAlertBox(i.data,"IsSMSExpired","SMS",null),o+=e.buildAlertBox(i.data,"IsAvSecExpired","AVSEC",null),o+=e.buildAlertBox(i.data,"IsProficiencyExpired","SKILL","cockpit"),o+=e.buildAlertBox(i.data,"IsLPRExpired","LPR","cockpit"),o+=e.buildAlertBox(i.data,"IsFirstAidExpired","FIRST AID","cabin"),o+="<div style='clear:both'></div></div>",$("<div style='white-space:normal'>").append(o).appendTo(t)}}];for(var n=moment(e.selectedBox.Date).format("YYYYMMDD"),a=new Date(e.CurrentDate).setHours(0,0,0,0),o=new Date(e.ToDate).setHours(0,0,0,0);a<=o;){var l=moment(a).format("YYYYMMDD"),r={dataField:l,caption:moment(a).format("MMM Do YYYY"),allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:172};r.cellTemplate=function(e,t){n==t.column.dataField&&t.data.Id;var i="";n!=t.column.dataField||!t.data.RestRemark||t.value.CalendarStatusId&&1167!=t.value.CalendarStatusId&&1168!=t.value.CalendarStatusId||(i="<div style='font-weight:bold;color:red;font-size:12px'>"+t.data.RestRemark+"</div>");n==t.column.dataField&&t.data.OverDuty;var a="";t.value.CalendarStatusId&&(a="<div style='font-weight:normal;color:black;font-size:12px'>"+t.value.CalendarStatus+"</div>");var o="",l=t.value;l.Boxes&&$.each(l.Boxes,function(e,t){var i="";$.each(t.Items,function(e,t){i+="<div class='cell-flight' style='height:initial;width:29px;padding:0 3px 0 3px;margin-right:3px;'><div class='route'>"+t.FlightNumber+"</div></div>"}),o+="<div style='margin-bottom:5px;width:100%;text-align:left'>"+i+"</div>"});var r="<div>"+i+a+o+"</div>";$("<div>").append(r).appendTo(e)},i.push(r),a=new Date(a).addDays(1).setHours(0,0,0,0)}e.dg_crew2_instance.option("columns",i),e.dg_crew2_instance.repaint()},onShown:function(t){$(".dx-toolbar-items-container").addClass("dx-border");var i=[];$.each(e.selectedBox.BoxItems,function(e,t){var n=JSON.parse(JSON.stringify(t));n.Duration=pad(t.FlightH)+":"+pad(t.FlightM),n.Route=n.FromAirportIATA+"-"+n.ToAirportIATA;var a=new Date(n.STD),o=new Date(n.STA);n.STS=pad(a.getHours())+":"+pad(a.getMinutes())+" - "+pad(o.getHours())+":"+pad(o.getMinutes()),i.push(n)}),e.dg_items_ds=i,e.BoxTimeStr="Flight: "+GetTimeStr(e.selectedBox.Flight)+" (h)       Duty: "+GetTimeStr(e.selectedBox.Duty)+" (h)   Max:"+GetTimeStr(e.selectedBox.MaxFDPExtended)+"(h)",e.bindCrew()},onHiding:function(){e.getCrew(e.selectedBox.BoxId),e.popup_crew2_visible=!1},bindingOptions:{visible:"popup_crew2_visible",title:"FlightsTitle"}},Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.scroll=0,e.crewDataSource=[],e.getFilteredCrew=function(){var t=Enumerable.From(e.crewDataSource).ToArray();if(e.filter_name){var i=e.filter_name.toLowerCase();t=Enumerable.From(t).Where('$.Name.toLowerCase().includes("'+i+'") || $.PID=="'+e.filter_name+'"').ToArray()}return t=Enumerable.From(t).OrderBy("$.AvStatus2").ThenBy("$.JobGroupCode").ThenBy("$._F1").ThenBy("$._F7").ThenBy("$._F14").ThenBy("$._F28").ThenBy("$._FY").ToArray()},e.setAvStatus=function(t){t.Issues=[],t.CurrentLocationAirporIATA!=e.selectedBox.FromAirportIATA&&t.Issues.push("Location"),1==t.IsSEPTExpired&&t.Issues.push("SEPT"),1==t.IsSEPTPExpired&&t.Issues.push("SEPTP"),1==t.IsCCRMExpired&&t.Issues.push("CCRM"),1==t.IsDGExpired&&t.Issues.push("DG"),1==t.IsAvSecExpired&&t.Issues.push("AVSEC"),1==t.IsSMSExpired&&t.Issues.push("SMS"),1==t.IsCMCExpired&&t.Issues.push("CMC"),1==t.IsMedicalExpired&&t.Issues.push("MEDICAL"),t.JobGroupCode.startsWith("00101")&&(1==t.IsProficiencyExpired&&t.Issues.push("SKILL"),1==t.IsLPRExpired&&t.Issues.push("LPR")),t.JobGroupCode.startsWith("00102")&&1==t.IsFirstAidExpired&&t.Issues.push("FIRSTAID");var i=t.CurrentLocationAirporIATA==e.selectedBox.FromAirportIATA&&0==t.IsSEPTExpired&&0==t.IsSEPTPExpired&&0==t.IsCCRMExpired&&0==t.IsCRMExpired&&0==t.IsDGExpired&&0==t.IsAvSecExpired&&0==t.IsSMSExpired&&0==t.IsCMCExpired&&0==t.IsMedicalExpired;t.JobGroupCode.startsWith("00101")&&(i=i&&0==t.IsProficiencyExpired&&0==t.IsLPRExpired),t.JobGroupCode.startsWith("00102")&&(i=i&&0==t.IsFirstAidExpired),t.AvStatus2=i?0:1},e.bindCrew=function(){var t={cid:Config.CustomerId,type:e.selectedBox.TypeId,boxid:e.selectedBox.BoxId,DateFrom:new Date(e.CurrentDate).toUTCString(),DateTo:new Date(e.ToDate).toUTCString(),cockpit:e.IsCockpit};e.loadingVisible=!0,a.getCrew(t).then(function(t){e.loadingVisible=!1;var i=-1*(new Date).getTimezoneOffset();$.each(t.reqrests,function(e,t){t.RestFrom=new Date(t.RestFrom).addMinutes(i),t.RestUntil=new Date(t.RestUntil).addMinutes(i)});moment(e.selectedBox.Date).format("YYYYMMDD");$.each(t.crew,function(i,n){e.setAvStatus(n);var a=Enumerable.From(t.reqrests).Where("$.EmployeeId=="+n.Id).FirstOrDefault();a?(n.RestFrom=a.RestFrom,n.RestUntil=a.RestUntil,n.RestRemark="Rest Until "+moment(new Date(a.RestUntil)).format("MMM-DD h:mm a"),n.RestIssue=1,console.log(n.RestRemark)):(n.RestFrom=null,n.RestUntil=null,n.RestRemark=null,n.RestIssue=0);var o=moment(e.selectedBox.Date).format("YYYYMMDD"),l=new Date(e.CurrentDate).setHours(0,0,0,0),r=new Date(e.ToDate).setHours(0,0,0,0);for(n.OverDuty=0;l<=r;){var d=moment(l).format("YYYYMMDD");n[d]={DateStr:moment(l).format("MMM Do YYYY")};var s=Enumerable.From(t.calendar).Where('$.DateStr=="'+d+'" && $.EmployeeId=='+n.Id).FirstOrDefault();s&&(n[d].Boxes=s.Boxed);var c=Enumerable.From(t.times).Where("$.Id=="+n.Id+' && $.DateStr=="'+d+'"').FirstOrDefault(),g=[];g.push({Id:1,Title:"Day",DM:c.Day1_Duty,FM:c.Day1_Flight,Duty:GetTimeStr(c.Day1_Duty),Flight:GetTimeStr(c.Day1_Flight),DutyViolated:Flight.IsDutyViolated(1,c.Day1_Duty,e.selectedBox.MaxFDPExtended),FlightViolated:Flight.IsFlightViolated(1,c.Day1_Flight)}),g.push({Id:7,Title:"7D",DM:c.Day7_Duty,FM:c.Day7_Flight,Duty:GetTimeStr(c.Day7_Duty),Flight:GetTimeStr(c.Day7_Flight),DutyViolated:Flight.IsDutyViolated(7,c.Day7_Duty),FlightViolated:Flight.IsFlightViolated(7,c.Day7_Flight)}),g.push({Id:14,Title:"14D",DM:c.Day14_Duty,FM:c.Day14_Flight,Duty:GetTimeStr(c.Day14_Duty),Flight:GetTimeStr(c.Day14_Flight),DutyViolated:Flight.IsDutyViolated(14,c.Day14_Duty),FlightViolated:Flight.IsFlightViolated(14,c.Day14_Flight)}),g.push({Id:28,Title:"28D",DM:c.Day28_Duty,FM:c.Day28_Flight,Duty:GetTimeStr(c.Day28_Duty),Flight:GetTimeStr(c.Day28_Flight),DutyViolated:Flight.IsDutyViolated(28,c.Day28_Duty),FlightViolated:Flight.IsFlightViolated(28,c.Day28_Flight)}),g.push({Id:12,Title:"Year",DM:c.Year_Duty,FM:c.Year_Flight,Duty:GetTimeStr(c.Year_Duty),Flight:GetTimeStr(c.Year_Flight),DutyViolated:Flight.IsDutyViolated(12,c.Year_Duty),FlightViolated:Flight.IsFlightViolated(12,c.Year_Flight)}),$.each(g,function(t,i){if(d==o){Enumerable.From(n[d].Boxes).Where("$.BoxId=="+e.selectedBox.BoxId).FirstOrDefault()||(i.NFM=i.FM+e.selectedBox.Flight,i.NDM=i.DM+e.selectedBox.Duty+(c.CalendarStatusId?c.ECDuty:0),i.NewFlight=GetTimeStr(i.NFM),i.NewDuty=GetTimeStr(i.NDM),i.NewDutyViolated=Flight.IsDutyViolated(i.Id,i.NDM,e.selectedBox.MaxFDPExtended,c.FDPReduction),i.NewFlightViolated=Flight.IsFlightViolated(i.Id,i.NFM),(i.NewFlightViolated||i.NewDutyViolated||i.FlightViolated||i.DutyViolated)&&(n.OverDuty=1))}}),n[d].Times=g,n[d].ECDuty=c.CalendarStatusId?c.ECDuty:0,n[d].FDPReduction=c.FDPReduction,n[d].CalendarStatus=c.CalendarStatus,n[d].CalendarStatusId=c.CalendarStatusId,n[d].ECSplitedId=c.ECSplitedId,n[d].ECId=c.ECId,d==o&&(n._F1=c.Day1_Flight,n._F7=c.Day7_Flight,n._F14=c.Day14_Flight,n._F28=c.Day28_Flight,n._FY=c.Year_Flight),l=new Date(l).addDays(1).setHours(0,0,0,0)}}),e.crewDataSource=t.crew,e.dg_crew2_ds=e.getFilteredCrew()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.doRefreshPeople=!0,e.bindPeople=function(){var t=((new Date).toDateTimeDigits(),"odata/crew/available/"+Config.CustomerId+"/"+e.selectedBox.TypeId+"/"+e.selectedBox.BoxId);e.dg_person_ds={store:{type:"odata",url:n.serviceUrl+t,version:4,onLoaded:function(t){$.each(t,function(t,i){i.IsLocation=i.CurrentLocationAirporIATA==e.SourceLocation})},beforeSend:function(e){n.$broadcast("OnDataLoading",null)}},sort:[{getter:"JobGroup",desc:!1},{getter:"Name",desc:!1}]},e.dg_person_instance.refresh(),e.doRefreshPeople=!1},e.bind=function(){var t="odata/flightplans/customer/"+Config.CustomerId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Id",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.selectedFlights=[],e.clearSelectedFlights=function(){e.selectedFlights=[],e.hideButtons()},e.doGridSelectedChanged=!0,e.addSelectedFlight=function(t){e.removeUpdatedFlights(t),e.hideButtons(),Enumerable.From(e.selectedFlights).Where("$.taskId=="+t.taskId).FirstOrDefault()?(e.selectedFlights=[],e.$apply(function(){e.popup_inf_visible=!1})):(e.selectedFlights=[],e.selectedFlights.push(t),e.flight=t,e.showButtons(t),e.popup_inf_visible&&e.setWeather(),e.doGridSelectedChanged=!1,e.dg_flights_instance.selectRows([t],!1))},e.addSelectedFlight2=function(t){e.removeUpdatedFlights(t),e.hideButtons2(),Enumerable.From(e.selectedFlights).Where("$.taskId=="+t.taskId).FirstOrDefault()?(e.selectedFlights=[],e.popup_inf_visible=!1):(e.selectedFlights=[],e.selectedFlights.push(t),e.flight=t,e.showButtons2(t),e.popup_inf_visible&&e.setWeather())},e.selectedResource=null,e.setSelectedResource=function(t){var i=t.index;e.selectedResource&&e.setSelectedResource.index==i?(e.selectedResource=null,$("#resourceGanttba").data("ejGantt").clearSelection(i),alert("x")):e.selectedResource={index:t.index,item:t.item}},e.ganttCreated=!1,e.createGantt=function(){var t=.24*$(window).width(),i=$("#resourceGanttba").data("ejGantt");i&&i.destroy();var n=$(window).height()-139-255-50;n+="px",$("#resourceGanttba").ejGantt({selectionMode:ej.Gantt.SelectionMode.Cell,selectionType:ej.Gantt.SelectionType.Multiple,taskbarClick:function(e){},dataSource:e.dataSource,allowColumnResize:!0,isResponsive:!0,taskIdMapping:"taskId",taskNameMapping:"taskName",fromLocationMapping:"from",startDateMapping:"startDate",endDateMapping:"endDate",progressMapping:"progress",durationMapping:"duration",groupNameMapping:"Title",groupIdMapping:"groupId",groupCollection:e.resourceGroups,resources:e.resources,resourceIdMapping:"resourceId",resourceNameMapping:"resourceName",resourceInfoMapping:"resourceId",notesMapping:"notes",rightTaskLabelMapping:"taskName",baselineStartDateMapping:"BaselineStartDate",baselineEndDateMapping:"BaselineEndDate",highlightWeekEnds:!0,includeWeekend:!1,rowHeight:60,taskbarHeight:40,scheduleStartDate:e.datefrom,scheduleEndDate:e.dateto,predecessorMapping:"predecessor",allowGanttChartEditing:!1,allowDragAndDrop:!0,editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,editMode:"normal"},splitterSettings:{position:110},toolbarSettings:{showToolbar:!1,toolbarItems:[ej.Gantt.ToolbarItems.Add,ej.Gantt.ToolbarItems.Delete,ej.Gantt.ToolbarItems.Update,ej.Gantt.ToolbarItems.Cancel,ej.Gantt.ToolbarItems.ExpandAll,ej.Gantt.ToolbarItems.CollapseAll,ej.Gantt.ToolbarItems.NextTimeSpan,ej.Gantt.ToolbarItems.PrevTimeSpan]},enableContextMenu:!1,load:function(){console.log("load"),e.ganttCreated=!0,this.getColumns()[0].width=110},create:function(t){$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(e.scroll)},cellSelecting:function(e){e&&"resourceTask"!=e.data.eResourceTaskType&&(e.cancel=!0)},cellSelected:function(t){$(".e-gantt-taskbarSelection").removeClass("e-gantt-taskbarSelection"),e.setSelectedResource(t.data)},actionBegin:function(e){e.requestType&&"beginedit"==e.requestType&&(e.cancel=!0)},actionComplete:function(t){"save"==t.requestType&&(e.doActionCompleteSave?setTimeout(function(){$("#resourceGanttba").data("ejGantt")._$ganttchartHelper.ejGanttChart("selectTaskbar",t.modifiedRecord)},100):e.doActionCompleteSave=!0)},workingTimeScale:"TimeScale24Hours",durationUnit:ej.Gantt.DurationUnit.Hour,scheduleHeaderSettings:{scheduleHeaderType:ej.Gantt.ScheduleHeaderType.Day,dayHeaderFormat:"MMM MM ddd dd , yyyy",minutesPerInterval:ej.Gantt.minutesPerInterval.ThirtyMinutes,timescaleUnitSize:t+"%"},taskbarTemplate:"#taskbarTemplateBox",leftTaskLabelTemplate:"#leftlableTemplate",viewType:ej.Gantt.ViewType.ResourceView,sizeSettings:{height:n},groupSettings:{},showStackedHeader:!1,taskSchedulingMode:ej.Gantt.TaskSchedulingMode.Manual,enableTaskbarTooltip:!1})},e.flight_click=function(e){alert(e)},e.bindFlights=function(t){var i={Status:e.filterStatus,Types:e.filterType,Registers:e.filterAircraft,From:e.filterFrom,To:e.filterTo};e.hideButtons2(),e.selectedFlights=[],e.dg_flights_instance.deselectAll();var n=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0,a.getFlightsGantt(Config.CustomerId,new Date(e.datefrom).toUTCDateTimeDigits(),new Date(e.dateto).toUTCDateTimeDigits(),n,e.IsAdmin?null:e.airportEntity.Id,i).then(function(t){e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource2(t.flights),Flight.activeDatasource=e.dataSource,e.dg_flights_ds=e.dataSource,console.log(Flight.activeDatasource),e.calculateSummary(),e.createGantt(),e.scrollGanttNow(),e.footerfilter=!0,e.searched=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.rebind=function(){var t=-1*(new Date).getTimezoneOffset();e.plansDto={CustomerId:1,Date:e.CurrentDate.ToUTC(),DateTo:e.ToDate.ToUTC(),Offset:t,Design:!1,PlanId:-1},e.loadingVisible=!0,a.getPlanItemsGanttCrewTest(e.plansDto).then(function(t){e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource2(t.flights),Flight.activeDatasource=e.dataSource,$("#resourceGanttba").data("ejGantt")._refreshDataSource(e.dataSource),e.selectedBox=null,e.selectedBoxId=null,e.selectedIds=[],e.selectedItems=[]},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.CalanderId=-1,e.bindtest=function(){var t=-1*(new Date).getTimezoneOffset();e.plansDto={CustomerId:1,Date:e.CurrentDate.ToUTC(),DateTo:e.ToDate.ToUTC(),Offset:t,Design:!1,PlanId:-1},e.loadingVisible=!0,a.getPlanItemsGanttCrewTest(e.plansDto).then(function(t){e.loadingVisible=!1,e.popup_search_visible=!1,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,t.flights.length>0&&(e.CalanderId=t.flights[0].CalendarId),e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource2(t.flights),Flight.activeDatasource=e.dataSource,console.log(Flight.activeDatasource),e.createGantt(),e.selectedBox=null,e.selectedBoxId=null,e.selectedIds=[],e.selectedItems=[],e.dg_crew_ds=null,e.dg_sum_ds=null},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrew=function(t){e.loadingVisible=!0,a.getBoxCrew(t).then(function(t){if(e.loadingVisible=!1,e.dg_crew_ds=t.Crew,e.dg_sum_ds=t.Summary,t.Crew.length>0&&e.selectedBox){e.selectedBox.HasCrew=!0,e.selectedBox.HasCrewProblem=t.HasCrewProblem,e.selectedBox.AllCrewAssigned=t.AllCrewAssigned;$("#resourceGanttba").data("ejGantt").updateRecordByTaskId(e.selectedBox)}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.AssignedCrew="Assigned Crew",e.FlightsTitle="",e.SourceLocation="",e.selectedIds=[],e.selectedItems=[],e.selectedBox=null,e.selectedBoxId=null,e.selectedBoxChanged=function(){if(e.selectedBox){var t=[];$.each(e.selectedBox.BoxItems,function(i,n){0==i&&(e.SourceLocation=n.FromAirportIATA),t.push(n.FlightNumber+" ("+n.FromAirportIATA+"-"+n.ToAirportIATA+")")}),e.AssignedCrew="Assigned crew for flights: "+t.join(", "),e.FlightsTitle="Flights: "+t.join(", "),e.getCrew(e.selectedBox.BoxId)}},e.selectedIdsChanged=function(){e.$apply(function(){e.selectedBox=null,e.selectedBoxId=null,e.AssignedCrew="Assigned Crew",e.dg_crew_ds=[],e.dg_sum_ds=[]})},e.$watch("selectedBox",function(){e.selectedBoxChanged()}),e.$on("$viewContentLoaded",function(){$("#resourceGanttba").height($(window).height()-139-255-50),$(document).on("click",".assigncrew",function(){var e=$(this).data("eid");alert(e)}),$(document).on("click","._xati",function(){var t=$(this).data("id"),i=$("#task-"+t).parent(),n=Enumerable.From(e.dataSource).Where("$.Id=="+t).FirstOrDefault(),a=n.IsBox;n.BoxId;a?e.$apply(function(){e.selectedBox=n,e.selectedBoxId=n.BoxId}):(i.hasClass("flight-item-selected")?(e.selectedIds=Enumerable.From(e.selectedIds).Where("$!="+t).ToArray(),e.selectedItems=Enumerable.From(e.selectedItems).Where("$.Id!="+t).ToArray()):(e.selectedIds.push(t),e.selectedItems.push(n)),$("#task-"+t).parent().toggleClass("nobox").toggleClass("flight-item-selected"),e.selectedIdsChanged())})}),n.$broadcast("FlightLoaded",null)}]),app.controller("flightPlanViewController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.typeId=d.current.type,e.filterVisible=!1,e.entity={Id:null,Title:null,DateFrom:null,DateTo:null,iDateFrom:new Date,iDateTo:new Date,CustomerId:Config.CustomerId,IsActive:!1,DateActive:null,Interval:null,Months:[],Days:[]},e.clearEntity=function(){e.entity.Id=null,e.entity.Title=null,e.entity.DateFrom=null,e.entity.DateTo=null,e.entity.iDateFrom=new Date,e.entity.iDateTo=new Date,e.entity.CustomerId=Config.CustomerId,e.entity.IsActive=!1,e.entity.DateActive=null,e.entity.Interval=null,e.entity.Months=[],e.entity.Days=[],e.data=[]},e.bindEntity=function(t){var i=t.Month,n=t.Days;t=t.plan,e.entity=t,e.entity.iDateFrom=new Date(t.DateFrom),e.entity.iDateTo=new Date(t.DateTo),e.entity.Months=i,e.entity.Days=n},e.tempData=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.btn_view={text:"View",type:"default",icon:"info",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.loadingVisible=!0,a.getFlightPlanView(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,e.tempData=t,e.popup_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.IsApproveDisabled=!0,e.btn_approve={text:"Approve",type:"default",icon:"check",width:150,bindingOptions:{disabled:"IsApproveDisabled"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_SimpleConfirm,function(t){t&&(e.loadingVisible=!0,a.approvePlan60(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))})}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}};new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("03/18/2017"),new Date("03/22/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017");e.pop_width_employees=600,e.pop_height_employees=450,e.dg_height_full=100,e.scroll_height_full=400,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={width:1e3,height:620,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Flights (Gantt)",icon:"rowfield",width:200,onClick:function(t){n.$broadcast("InitFlightDesignView",e.entity)}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Flights (Grid)",icon:"menu",width:200,onClick:function(t){n.$broadcast("InitFlightDesignGridView",e.entity)}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_add_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.tempData&&e.bindEntity(e.tempData)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1},bindingOptions:{visible:"popup_add_visible",title:"popup_add_title"}},e.isDouble=0;e.monthArray=[],e.dayArray=[],e.addCustom=function(t,i,n,a){if(n&&0!=n.length&&a&&0!=a.length)for(;t<=i;){var o=!1,l=!1;o=!n||0==n.length||-1!=n.indexOf(t.getMonth()),l=!a||0==a.length||-1!=a.indexOf(t.getDay()),o&&l&&e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(1)}},e.addDaily=function(t,i,n){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(n)},e.addMonthly=function(t,i){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(30)},e.fillSchedule=function(){if(e.data=[],e.entity.Interval&&e.entity.iDateFrom&&e.entity.iDateTo){var t=new Date(e.entity.iDateFrom);t=new Date(t.setHours(0,0,0,0));var i=new Date(e.entity.iDateTo);switch(i=new Date(i.setHours(23,59,59,999)),console.log(t),console.log(i),e.entity.Interval){case 1:e.addDaily(t,i,1);break;case 2:e.addDaily(t,i,7);break;case 3:e.addDaily(t,i,10);break;case 4:e.addDaily(t,i,14);break;case 5:e.addDaily(t,i,15);break;case 100:e.addCustom(t,i,e.entity.Months,e.entity.Days)}}},e.data=[],e.scheduler_instance=null,e.schedulerOptions={onContentReady:function(t){e.scheduler_instance||(e.scheduler_instance=t.component)},views:["month"],currentView:"month",startDayHour:0,endDayHour:24,showCurrentTimeIndicator:!1,height:492,appointmentTemplate:function(e){return $("<div style='text-align:center; height:38px;color:green;background:white;margin-top:-5px'><i style='font-size:32px' class='icon ion-md-checkmark'></i></div>")},editing:{allowAdding:!1,allowUpdating:!1,allowDeleting:!0,allowResizing:!1,allowDragging:!1},onAppointmentClick:function(e){e.cancel=!0},onAppointmentDblClick:function(e){e.cancel=!0},onCellClick:function(e){e.cancel=!0},bindingOptions:{dataSource:"data",min:"entity.iDateFrom",max:"entity.iDateTo"}},e.date_from={type:"date",width:"100%",readOnly:!0,onValueChanged:function(t){e.fillSchedule()},bindingOptions:{value:"entity.iDateFrom"}},e.date_to={type:"date",width:"100%",readOnly:!0,onValueChanged:function(t){e.fillSchedule()},bindingOptions:{value:"entity.iDateTo"}},e.intervalTypes=[{Id:1,Title:"Daily"},{Id:2,Title:"Weekly"},{Id:3,Title:"Every 10 days"},{Id:4,Title:"Every 14 days"},{Id:5,Title:"Every 15 days"},{Id:100,Title:"Custom"}],e.sb_interval={readOnly:!0,showClearButton:!0,width:"100%",searchEnabled:!1,displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){e.customDisabled=t.selectedItem&&100!=t.selectedItem.Id,e.fillSchedule()},bindingOptions:{value:"entity.Interval",dataSource:"intervalTypes"}},e.customDisabled=!0,e.tag_months_instance=null,e.tag_months={readOnly:!0,dataSource:General.MonthDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_months_instance||(e.tag_months_instance=t.component)},onSelectionChanged:function(t){e.fillSchedule()},bindingOptions:{disabled:"customDisabled",value:"entity.Months"}},e.tag_days_instance=null,e.tag_days={readOnly:!0,dataSource:General.WeekDayDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_days_instance||(e.tag_days_instance=t.component)},onSelectionChanged:function(t){e.fillSchedule()},bindingOptions:{disabled:"customDisabled",value:"entity.Days"}},e.text_title={readOnly:!0,bindingOptions:{value:"entity.Title"}},e.text_types={readOnly:!0,bindingOptions:{value:"entity.Types"}},e.text_no={readOnly:!0,bindingOptions:{value:"entity.Id"}},e.text_flights={readOnly:!0,bindingOptions:{value:"entity.TotalFlights"}},e.dg_selected1=null,e.dg_columns1=[{dataField:"",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.data.IsApproved60&&0!=t.data.IsApproved60?$("<div>").append("<i style='font-size:22px;color:#8bc34a!important' class='icon ion-md-checkmark-circle'></i>").appendTo(e):$("<div>").append("<i style='font-size:22px;color:#ff5722!important' class='icon ion-md-help-circle '></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"Id",caption:"No",allowResizing:!0,dataType:"number",allowEditing:!1,width:120,alignment:"center",sortIndex:1,sortOrder:"asc",fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:200},{dataField:"Types",caption:"Types",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:200},{dataField:"IntervalType",caption:"Interval",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:150},{dataField:"TotalFlights",caption:"Flights",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"DateFrom",caption:"From",allowResizing:!0,dataType:"date",allowEditing:!1,width:200,alignment:"center",fixed:!0,fixedPosition:"right"},{dataField:"DateTo",caption:"To",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200,fixed:!0,fixedPosition:"right"}],e.dg_height1=100,e.dg_instance1=null,e.dg_ds1=null,e.dg1={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,e.IsApproveDisabled=1==i.IsApproved60):(e.dg_selected=null,e.IsApproveDisabled=!0)},height:"100%",bindingOptions:{dataSource:"dg_ds"}},e.dg_selected=null,e.dg_columns=[{dataField:"status",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){12==t.value&&$("<div>").append("<i style='font-size:22px;color:#2196F3' class='icon ion-md-add-circle'></i>").appendTo(e),13==t.value&&$("<div>").append("<i style='font-size:22px;color:#4CAF50' class='icon ion-md-create'></i>").appendTo(e),10==t.value&&$("<div>").append("<i style='font-size:22px;color:#f44336' class='icon ion-md-shuffle'></i>").appendTo(e),11==t.value&&$("<div>").append("<i style='font-size:22px;color:#ff5722' class='icon ion-md-code-working'></i>").appendTo(e),16==t.value&&$("<div>").append("<i style='font-size:22px;color:#f44336' class='icon ion-md-shuffle'></i><i style='font-size:22px;color:#ff5722' class='icon ion-md-code-working'></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"DateFrom",caption:"Date",allowResizing:!0,dataType:"date",allowEditing:!1,width:200,alignment:"center",groupIndex:0},{dataField:"BaseIATA",caption:"Base",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"AircraftType",caption:"AC Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"FlightStatus",caption:"Status",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"right"}],e.dg_height=$(window).height()-135,e.dg_instance=null,e.dg_ds=null,e.dg={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,e.IsPermitDisabled=1==i.IsApproved60,i.permits?e.dg_permits_ds=i.permits:(e.loadingVisible=!0,a.getFlightPlanItemPermits(i.Id).then(function(t){e.loadingVisible=!1,i.permits=t||[],e.dg_permits_ds=i.permits},function(t){e.loadingVisible=!1,
General.ShowNotify(t.message,"error")}))):(e.dg_selected=null,e.IsPermitDisabled=!0)},onCellPrepared:function(e){if("data"==e.rowType&&"BaseIATA"===e.column.dataField){var t=Flight.getBaseMetaData(e.data.BaseIATA);t&&e.cellElement.css("background",t.bgcolor)}},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.IsPermitDisabled=!0,e.btn_permit_add={text:"",type:"default",icon:"plus",width:40,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.popup_permit_add_visible=!0},bindingOptions:{disabled:"IsPermitDisabled"}},e.btn_permit_delete={text:"",type:"danger",icon:"remove",width:40,onClick:function(e){},bindingOptions:{disabled:"IsPermitDisabled"}},e.sb_permit={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceFlightPermits(),onSelectionChanged:function(t){t.selectedItem?e.permitEntity.Title=t.selectedItem.Title:e.permitEntity.Title=null},searchExpr:["Title"],displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"permitEntity.PermitId"}},e.date_permit={type:"date",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"permitEntity.Date"}},e.dg_permits_selected=null,e.dg_permits_columns=[{dataField:"Date",caption:"Date",allowResizing:!0,dataType:"date",allowEditing:!1,width:150,alignment:"center"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1}],e.dg_permits_height=$(window).height()-220,e.dg_permits_instance=null,e.dg_permits_ds=null,e.dg_permits={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_permits_columns,onContentReady:function(t){e.dg_permits_instance||(e.dg_permits_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_permits_selected=i||null},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_permits_ds",height:"dg_permits_height"}},e.permitEntity={},e.clearPermitEntity=function(){e.permitEntity.Title=null,e.permitEntity.Date=null,e.permitEntity.Remark="",e.permitEntity.PermitId=null},e.popup_permit_add_visible=!1,e.popup_permit_add_title="New",e.popup_permit_add={width:600,height:270,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"permitadd",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.permitEntity.Id=-1,e.permitEntity.Remark="",e.permitEntity.FlightPlanId=e.dg_selected.Id,e.loadingVisible=!0,a.saveFlightPlanItemPermit(e.permitEntity).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1;var i=JSON.parse(JSON.stringify(e.permitEntity));e.dg_permits_ds.push(i),e.clearPermitEntity()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_permit_add_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.clearPermitEntity(),e.popup_permit_add_visible=!1},bindingOptions:{visible:"popup_permit_add_visible",title:"popup_permit_add_title"}};var s=-1*(new Date).getTimezoneOffset();e.bind=function(){var t="odata/plan/items/approved/"+Config.CustomerId+"/"+e.typeId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){$.each(e,function(e,t){t.STD=new Date(t.STD).addMinutes(s),t.STA=new Date(t.STA).addMinutes(s)}),n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Id",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.getFlightsGantt=function(){e.loadingVisible=!0,a.getFlightsGantt(Config.CustomerId).then(function(t){e.loadingVisible=!1,e.flightData=t,$.each(e.flightData.flights,function(e,t){t.startDate=new Date(t.startDate)})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},l.isAuthorized()?(n.page_title="> Flight Plans Permits",$(".flightplanview").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("irregularFlightController",["$scope","$location","$routeParams","$rootScope","flightService","weatherService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d,s){e.prms=i.prms,e.typeId=s.current.type,e.IsEditVisible=1==e.typeId,e.IsRegisterVisible=2==e.typeId,e.IsReadOnly=2==e.typeId,e.entity={ID:null,FlightTypeID:null,FlightStatusID:null,FlightNumber:null,FromAirportId:null,ToAirportId:null,STD:null,STA:null,FlightH:null,FlightM:null,CustomerId:Config.CustomerId,DateCreate:null,RouteId:null,FromAirportIATA:null,FromAirportName:null,ToAirportName:null,ToAirportIATA:null,FromAirportCity:null,ToAirportCity:null,FromAirportCityId:null,ToAirportCityId:null,LinkedFlight:null,LinkedReason:null,LinkedRemark:null},e.clearEntity=function(){e.entity.ID=-1,e.entity.FlightTypeID=null,e.entity.FlightStatusID=null,e.entity.FlightNumber=null,e.entity.FromAirportId=null,e.entity.ToAirportId=null,e.entity.STD=null,e.entity.STA=null,e.entity.CustomerId=Config.CustomerId,e.entity.DateCreate=null,e.entity.RouteId=null,e.start=null,e.entity.FromAirportName=null,e.entity.FromAirportIATA=null,e.entity.ToAirportName=null,e.entity.ToAirportIATA=null,e.entity.FromAirportCity=null,e.entity.ToAirportCity=null,e.entity.FromAirportCityId=null,e.entity.ToAirportCityId=null,e.entity.LinkedFlight=null,e.entity.LinkedReason=null,e.entity.LinkedRemark=null,e.link=null,e.linkEntity={}},e.bindEntity=function(t,i){e.entity.ID=t.ID,e.entity.FlightTypeID=t.FlightTypeID,e.entity.FlightStatusID=t.FlightStatusID,e.entity.FlightNumber=t.FlightNumber,e.entity.FromAirportId=t.FromAirport,e.entity.ToAirportId=t.ToAirport,e.entity.STD=t.STD,e.entity.STA=t.STA,e.entity.CustomerId=t.CustomerId,e.entity.DateCreate=t.DateCreate,e.entity.RouteId=t.RouteId,e.start=t.start,e.entity.FromAirportName=t.FromAirportName,e.entity.FromAirportIATA=t.FromAirportIATA,e.entity.ToAirportName=t.ToAirportName,e.entity.ToAirportIATA=t.ToAirportIATA,e.entity.FromAirportCity=t.FromAirportCity,e.entity.ToAirportCity=t.ToAirportCity,e.entity.FromAirportCityId=t.FromAirportCityId,e.entity.ToAirportCityId=t.ToAirportCityId,e.entity.LinkedFlight=t.LinkedFlight,e.entity.LinkedReason=t.LinkedReason,e.entity.LinkedRemark=t.LinkedRemark,e.entity.LinkedFlight&&(e.link=t.LinkedFlight,e.linkEntity=i,e.link=i.FlightNumber+" ("+i.ID+"), "+i.FlightStatus)},e.IsDisabled=!1,e.setArrival=function(){if(null!=e.entity.STD&&null!=e.entity.FlightH&&null!=e.entity.FlightM){var t=new Date(e.entity.STD);e.entity.STA=new Date(t.addHours(e.entity.FlightH).addMinutes(e.entity.FlightM))}else e.entity.STA=null},e.tempToAirport=null,e.selectedFromAirport=null,e.selectedToAirport=null,e.sb_FromAirport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){if(e.entity.ToAirport=null,!t.selectedItem)return e.ds_toairport=[],void(e.entity.FromAirportIATA=null);e.entity.FromAirportIATA=t.selectedItem.IATA,e.loadingVisible=!0,a.getRouteDestination(Config.AirlineId,t.selectedItem.Id).then(function(t){e.loadingVisible=!1,e.ds_toairport=t,e.tempToAirport&&(e.entity.ToAirport=e.tempToAirport,e.tempToAirport=null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.FromAirportId",selectedItem:"selectedFromAirport",readOnly:"IsReadOnly"}},e.ds_toairport=[],e.sb_ToAirport={showClearButton:!0,searchEnabled:!0,itemTemplate:function(e){return n.getSbTemplateRouteTo(e)},onSelectionChanged:function(t){t.selectedItem?(e.entity.RouteId=t.selectedItem.Id,e.entity.FlightH=t.selectedItem.FlightH,e.entity.FlightM=t.selectedItem.FlightM,e.entity.ToAirportIATA=t.selectedItem.ToAirportIATA):(e.entity.RouteId=null,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.ToAirportIATA=null),e.setArrival()},searchExpr:["ToAirportIATA","ToCity"],displayExpr:"ToAirportIATA",valueExpr:"ToAirportId",bindingOptions:{value:"entity.ToAirportId",selectedItem:"selectedRoute",dataSource:"ds_toairport",readOnly:"IsReadOnly"}},e.selectedRoute=null,e.sb_route={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceRoutes(Config.AirlineId),itemTemplate:function(e){return n.getSbTemplateRoute(e)},onSelectionChanged:function(t){t.selectedItem?(e.entity.FromAirport=t.selectedItem.FromAirportId,e.entity.ToAirport=t.selectedItem.ToAirportId,e.entity.FlightH=t.selectedItem.FlightH,e.entity.FlightM=t.selectedItem.FlightM):(e.entity.FromAirport=null,e.entity.ToAirport=null,e.entity.FlightH=null,e.entity.FlightM=null),e.setArrival()},searchExpr:["FromAirportIATA","FromCity"],displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.RouteId",selectedItem:"selectedRoute"}},e.start=null,e.time_start={type:"datetime",width:"100%",interval:15,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.STD",disabled:"IsDisabled",readOnly:"IsReadOnly"}},e.time_end={readOnly:!0,type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entity.STA",disabled:"IsDisabled",readOnly:"IsReadOnly"}},e.text_flighth={min:0,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.FlightH",disabled:"IsDisabled",readOnly:"IsReadOnly"}},e.text_flightm={min:0,max:59,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.FlightM",disabled:"IsDisabled",readOnly:"IsReadOnly"}},e.text_flightnumber={bindingOptions:{value:"entity.FlightNumber",disabled:"IsDisabled",readOnly:"IsReadOnly"}},e.sb_flighttype={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.FlightTypeID",disabled:"IsDisabled",readOnly:"IsReadOnly"}},e.link=null,e.linkEntity={},e.txt_link={readOnly:!0,bindingOptions:{value:"link"}},e.txt_LinkedRemark={bindingOptions:{value:"entity.LinkedRemark",disabled:"link==null"}},e.sb_LinkedReason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1132),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.LinkedReason",disabled:"link==null"}},e.date_std=null,e.date_std_select={type:"date",width:"100%",bindingOptions:{value:"date_std"}},e.filterVisible=!1,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.IsApproveDisabled=!1,e.btn_approve={text:"Approve",type:"default",icon:"check",width:150,bindingOptions:{disabled:"IsApproveDisabled"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_SimpleConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.approvePlanRegisters(i).then(function(t){e.IsApproveDisabled=!1,e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.IsApproveDisabled=!0,e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_view={text:"View",type:"default",icon:"info",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.popup_item_visible=!0}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,bindingOptions:{visible:"IsEditVisible"},onClick:function(t){e.entity.ID=-1,e.popup_item_visible=!0}},e.btn_link={text:"Link",type:"default",icon:"fas fa-link",width:120,bindingOptions:{visible:"IsEditVisible"},onClick:function(t){e.entity.ID=-1,e.IsDisabled=!0,e.popup_link_visible=!0}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,bindingOptions:{visible:"IsEditVisible"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.dg_selected.LinkedFlight?(e.loadingVisible=!0,a.getFlight(e.dg_selected.LinkedFlight).then(function(t){e.loadingVisible=!1,e.bindEntity(e.dg_selected,t),e.popup_link_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):(e.bindEntity(e.dg_selected,null),e.popup_item_visible=!0)}},e.btn_register={text:"Register",type:"default",icon:"fas fa-plane",width:150,bindingOptions:{visible:"IsRegisterVisible"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity_register.FlightId=e.dg_selected.ID,e.bind_entity_register(e.dg_selected),e.dg_selected.LinkedFlight?(e.loadingVisible=!0,a.getFlight(e.dg_selected.LinkedFlight).then(function(t){e.loadingVisible=!1,e.bindEntity(e.dg_selected,t),e.popup_register_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):(e.bindEntity(e.dg_selected,null),e.popup_register_visible=!0)}},e.IsApproveVisible=!1,e.btn_approve={text:"Approve",type:"default",icon:"check",width:150,bindingOptions:{visible:"IsApproveVisible"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_SimpleConfirm,function(t){t&&(e.loadingVisible=!0,a.saveFlightAppy(e.dg_selected.ID).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))})}},e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,bindingOptions:{visible:"IsEditVisible"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.moment=function(e){return e?moment(e).format("MM-DD-YYYY HH:mm"):""},e.btn_select={text:"",type:"default",icon:"airplane",width:50,onClick:function(t){e.popup_select_visible=!0}},e.btn_select_remove={text:"",type:"danger",icon:"close",width:50,onClick:function(t){e.entity.LinkedFlight=null,e.entity.LinkedReason=null,e.entity.LinkedRemark=null,e.link=null,e.linkEntity={},e.IsDisabled=!1}},e.btn_select_search={text:"",type:"default",icon:"search",validationGroup:"irrflightselect",width:40,onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.dg_flight_ds=null;var i=new Date(e.date_std).toDateTimeDigits();e.loadingVisible=!0,a.getFlightsAbnormal(Config.CustomerId,-1,i).then(function(t){e.loadingVisible=!1,$.each(t,function(e,t){t.STD=new Date(t.STD+".000Z"),t.STA=new Date(t.STA+".000Z"),t.ChocksOut&&(t.ChocksOut=new Date(t.ChocksOut+".000Z")),t.ChocksIn&&(t.ChocksIn=new Date(t.ChocksIn+".000Z")),t.Takeoff&&(t.Takeoff=new Date(t.Takeoff+".000Z")),t.Landing&&(t.Landing=new Date(t.Landing+".000Z"))}),e.dg_flight_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.popup_item_visible=!1,e.popup_item_title="Add",e.popup_item={fullScreen:!1,showTitle:!0,height:380,width:600,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"irrflight",onClick:function(t){return t.validationGroup.validate().isValid?0==e.entity.FlightH&&0==e.entity.FlightM?void General.ShowNotify(Config.Text_FillRequired,"error"):(-1==e.entity.ID&&(e.entity.FlightStatusID=1),e.entity.STD=new Date(e.entity.STD).toUTCString(),e.entity.STA=new Date(e.entity.STA).toUTCString(),console.log(e.entity.FlightStatusID),e.entity.FlightStatus=Flight.getStatus(e.entity.FlightStatusID).title,e.loadingVisible=!0,void a.saveFlight(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,n.$broadcast("onFlightSaved",null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):void General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_item_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!0,closeOnOutsideClick:!1,onShowing:function(t){e.IsDisabled=!1},onShown:function(e){},onHiding:function(){e.clearEntity(),e.popup_item_visible=!1,n.$broadcast("onFlightHide",null)},bindingOptions:{visible:"popup_item_visible",title:"popup_item_title"}},e.popup_link_visible=!1,e.popup_link_title="Link",e.popup_link={fullScreen:!1,showTitle:!0,height:630,width:700,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"irrlink",onClick:function(t){return t.validationGroup.validate().isValid?0==e.entity.FlightH&&0==e.entity.FlightM?void General.ShowNotify(Config.Text_FillRequired,"error"):(-1==e.entity.ID&&(e.entity.FlightStatusID=1),e.entity.STD=new Date(e.entity.STD).toUTCString(),e.entity.STA=new Date(e.entity.STA).toUTCString(),console.log(e.entity.FlightStatusID),e.entity.FlightStatus=Flight.getStatus(e.entity.FlightStatusID).title,console.log(e.entity),e.loadingVisible=!0,void a.saveFlight(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,n.$broadcast("onFlightSaved",null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):void General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_link_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!0,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.clearEntity(),e.popup_link_visible=!1,n.$broadcast("onFlightHide",null)},bindingOptions:{visible:"popup_link_visible",title:"popup_link_title"}},e.popup_register_visible=!1,e.popup_register_title="Set Register",e.popup_register={fullScreen:!1,showTitle:!0,height:630,width:700,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"irrregister",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.loadingVisible=!0,a.saveFlightRegister(e.entity_register).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.clear_entity_register(),n.$broadcast("onFlightSaved",null),e.popup_register_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_register_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!0,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.clearEntity(),e.popup_register_visible=!1,n.$broadcast("onFlightHide",null)},bindingOptions:{visible:"popup_register_visible",title:"popup_register_title"}},e.getRoute=function(){e.entity.FromAirportId&&e.entity.ToAirportId&&(e.loadingVisible=!0,a.getRoute(e.entity.FromAirportId,e.entity.ToAirportId).then(function(t){t&&(e.entity.FlightH=t.FlightH,e.entity.FlightM=t.FlightM),e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},e.sb_link_fromairport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceAirport(),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){e.getRoute()},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.FromAirportId",disabled:"IsDisabled",readOnly:"IsReadOnly"}},e.sb_link_toairport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceAirport(),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){e.getRoute()},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.ToAirportId",disabled:"IsDisabled",readOnly:"IsReadOnly"}},e.entity_register={FlightId:null,TypeId:null,RegisterId:null},e.clear_entity_register=function(){e.entity_register.FlightId=null,e.entity_register.TypeId=null,e.entity_register.RegisterId=null},e.bind_entity_register=function(t){e.entity_register.FlightId=t.ID,e.entity_register.TypeId=t.TypeId,e.entity_register.RegisterId=t.RegisterID},e.selectedType=null,e.sb_type={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(e){return n.getSbTemplateAircraft(e)},searchExpr:["Type","Manufacturer"],dataSource:n.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",onSelectionChanged:function(t){e.ds_msn=[],e.msn_readOnly=!0,t&&t.selectedItem?l.getAvailableMSNsByType(Config.CustomerId,t.selectedItem.Id).then(function(t){e.msn_readOnly=!1,e.ds_msn=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}):(e.msn_readOnly=!0,e.ds_msn=[])},bindingOptions:{value:"entity_register.TypeId",selectedItem:"selectedType"}},e.ds_msn=[],e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(t){if(t.selectedItem&&1==e.IsNew){var i=Flight.getLastFlight(vmins.datasource(),t.selectedItem.ID);i&&(e.entity.FromAirport=i.ToAirport,e.entity.ToAirport=null,e.entity.STD=new Date(i.STA),e.start=new Date(e.entity.STD))}},bindingOptions:{value:"entity_register.RegisterId",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.popup_select_visible=!1,e.popup_select_title="Select Flight",e.popup_select={fullScreen:!0,showTitle:!0,height:480,width:600,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Select",icon:"check",onClick:function(t){if(e.dg_flight_selected=n.getSelectedRow(e.dg_flight_instance),!e.dg_flight_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.LinkedFlight=e.dg_flight_selected.ID,e.linkEntity=e.dg_flight_selected,e.link=e.dg_flight_selected.FlightNumber+" ("+e.dg_flight_selected.ID+"), "+e.dg_flight_selected.FlightStatus,e.IsDisabled=!1,e.popup_select_visible=!1}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_select_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!0,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_select_visible=!1},bindingOptions:{visible:"popup_select_visible",title:"popup_select_title"}},e.dg_height_full=100,e.scroll_height_full=400,e.dg_selected=null,e.dg_columns=[{dataField:"IsActive",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.value?$("<div>").append("<i style='font-size:22px;color:#2196F3' class='icon ion-md-checkmark-circle'></i>").appendTo(e):$("<div>").append("<i style='font-size:22px;color:#eee' class='icon ion-md-checkmark-circle'></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"Register",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.value?$("<div>").append("<i style='font-size:22px;color:green' class='fas fa-plane'></i>").appendTo(e):$("<div>").append("<i style='font-size:22px;color:#eee' class='fas fa-plane'></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"LinkedFlight",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.value?$("<div>").append("<i style='font-size:22px;color:#2196F3' class='fas fa-link'></i>").appendTo(e):$("<div>").append("<i style='font-size:22px;color:#eee' class='fas fa-link'></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"FlightStatusID",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i=Flight.getStatus(t.value),n=i.bgcolor;switch(t.value){case 1:$("<div>").append('<i class="fas fa-calendar-day" style="color:lightgray;font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px"></span>').appendTo(e);break;case 14:$("<div>").append('<i class="far fa-square" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px"></span>').appendTo(e);break;case 2:$("<div>").append('<i class="fas fa-plane-departure" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px"></span>').appendTo(e);break;case 3:$("<div>").append('<i class="fas fa-plane-arrival" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px"></span>').appendTo(e);break;case 15:$("<div>").append('<i class="fas fa-square" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px"></span>').appendTo(e);break;case 7:$("<div>").append('<i class="fas fa-level-down-alt" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px"></span>').appendTo(e);break;case 17:$("<div>").append('<i class="fas fa-random" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px"></span>').appendTo(e)}},fixed:!0,fixedPosition:"left"},{dataField:"ID",caption:"ID",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left"},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:180},{dataField:"AircraftType",caption:"AC Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:170,alignment:"center",format:"yyyy-MM-dd HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MM-dd HH:mm"},{dataField:"FlightH",caption:"Hour(s)",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightM",caption:"Minute(s)",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"LinkedFlight",caption:"Linked To",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:150,fixed:!0,fixedPosition:"right"},{dataField:"LinkedReasonTitle",caption:"Reason",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200,fixed:!0,fixedPosition:"right"}],e.dg_height=100,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:50},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,e.flight=i,e.IsApproveVisible=1==e.typeId&&!i.IsActive&&i.RegisterID):(e.IsApproveVisible=!1,e.dg_selected=null,e.IsDetailsVisible=!1,e.flight={},e.dg_delay_ds=null)},height:"100%",bindingOptions:{dataSource:"dg_ds"}},e.dg_flight_selected=null,e.dg_flight_columns=[{dataField:"delay1",caption:"",width:50,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="lightgray";t.data.FlightStatusID>1&&(i=t.data.DelayOffBlock>0||t.data.DelayOnBlock>0?"#e51400":"#60a917"),$("<div>").append('<i class="fas fa-clock" style="color:'+i+';font-size:16px"></i>').appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"FlightStatusID",caption:"",width:150,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i=Flight.getStatus(t.value),n=i.bgcolor,a=t.data.FlightStatus;switch(t.value){case 1:$("<div>").append('<i class="fas fa-calendar-day" style="color:lightgray;font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 14:$("<div>").append('<i class="far fa-square" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 2:$("<div>").append('<i class="fas fa-plane-departure" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 3:$("<div>").append('<i class="fas fa-plane-arrival" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 15:$("<div>").append('<i class="fas fa-square" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 7:$("<div>").append('<i class="fas fa-level-down-alt" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 17:$("<div>").append('<i class="fas fa-random" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e);break;case 4:$("<div>").append('<i class="fas fa-ban" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:12px">'+a+"</span>").appendTo(e)}},fixed:!0,fixedPosition:"left"},{caption:"Aircraft",columns:[{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"AircraftType",caption:"Type",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90}]},{dataField:"ID",caption:"ID",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left"},{dataField:"FlightTypeAbr",caption:"",
allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70,fixed:!0,fixedPosition:"left"},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:110,fixed:!0,fixedPosition:"left"},{caption:"Airports",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90}]},{caption:"Duration",columns:[{dataField:"ActualFlightHOffBlock",caption:"Hour(s)",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"ActualFlightMOffBlock",caption:"Minute(s)",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90}]},{caption:"Departure",columns:[{dataField:"STD",caption:"Scheduled Dep.",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:170,alignment:"center",format:"yyyy-MMM-dd, HH:mm",sortIndex:0,sortOrder:"desc"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Arrival",columns:[{dataField:"STA",caption:"Scheduled Arr.",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Delays",fixed:!0,fixedPosition:"right",columns:[{dataField:"DelayOffBlock",caption:"Dep.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"delay"},{dataField:"DelayOnBlock",caption:"Arr.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"delayLanding"}]}],e.dg_flight_height=100,e.dg_flight_instance=null,e.dg_flight_ds=null,e.dg_flight={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:50},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_flight_columns,onContentReady:function(t){e.dg_flight_instance||(e.dg_flight_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_flight_selected=i||null},height:function(){return window.innerHeight-190},bindingOptions:{dataSource:"dg_flight_ds"}},e.bind=function(){var t="odata/flights/irregular/"+Config.CustomerId+"/"+(e.airport?e.airportEntity.Id:"-1");!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"ID",version:4,onLoading:function(e){},onLoaded:function(e){$.each(e,function(e,t){t.STD=new Date(t.STD+".000Z"),t.STA=new Date(t.STA+".000Z"),t.ChocksOut&&(t.ChocksOut=new Date(t.ChocksOut+".000Z")),t.ChocksIn&&(t.ChocksIn=new Date(t.ChocksIn+".000Z")),t.Takeoff&&(t.Takeoff=new Date(t.Takeoff+".000Z")),t.Landing&&(t.Landing=new Date(t.Landing+".000Z"))}),n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"ID",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},r.isAuthorized()?(n.page_title="> Irregular Flights",$(".irrflights").fadeIn(400,function(){})):r.redirectToLogin(),e.$on("getFilterResponse",function(t,i){console.log(i),e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onFlightSaved",function(t,i){e.doRefresh=!0}),e.$on("onFlightHide",function(t,i){e.bind()}),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("flightPlanningController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.filterVisible=!1,e.IsNew=!0,e.entity={Id:null,Title:null,DateFrom:null,DateTo:null,DateFirst:null,DateLast:null,BaseId:null,iDateFrom:new Date,iDateTo:new Date,CustomerId:Config.CustomerId,IsActive:!1,DateActive:null,Interval:101,TypeId:null,RegisterID:null,FlightTypeID:null,FromAirport:null,ToAirport:null,STA:null,STD:null,FlightH:null,FlightM:null,FlightNumber:null,RouteId:null,FlightPlanId:-1,Months:[],Days:[]},e.refreshEntity=function(){e.entity.Id=-1,e.entity.DateFirst=null,e.entity.DateLast=null,e.entity.CustomerId=Config.CustomerId,e.entity.IsActive=!1,e.entity.DateActive=null,e.entity.Interval=101,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.FlightNumber=null,e.entity.RouteId=null},e.clearEntity=function(){e.entity.Id=null,e.entity.BaseId=null,e.entity.Title=null,e.entity.DateFrom=null,e.entity.DateTo=null,e.entity.DateFirst=null,e.entity.DateLast=null,e.entity.iDateFrom=new Date,e.entity.iDateTo=new Date,e.entity.CustomerId=Config.CustomerId,e.entity.IsActive=!1,e.entity.DateActive=null,e.entity.Interval=101,e.entity.TypeId=null,e.entity.RegisterID=null,e.entity.FlightTypeID=null,e.entity.FromAirport=null,e.entity.ToAirport=null,e.entity.STA=null,e.entity.STD=null,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.FlightNumber=null,e.entity.RouteId=null,e.entity.Months=[],e.entity.Days=[],e.data=[]},e.DotBlockToBlock=!0,e.bindEntity=function(t){e.DotBlockToBlock=!1,e.entity.Id=t.Id,e.entity.BaseId=t.BaseId,e.entity.Title=t.Title,e.entity.DateFrom=t.DateFrom,e.entity.DateTo=t.DateTo,e.entity.DateFirst=t.DateFirst,e.entity.DateLast=t.DateLast,e.entity.iDateFrom=t.DateFrom,e.entity.iDateTo=t.DateTo,e.entity.CustomerId=t.CustomerId,e.entity.IsActive=t.IsActive,e.entity.DateActive=t.DateActive,e.entity.Interval=t.Interval,e.entity.Months=t.Months,e.entity.Days=t.Days,e.entity.FlightPlanId=t.FlightPlanId,e.entity.TypeId=t.TypeId,e.entity.RegisterID=t.RegisterID,e.entity.FlightTypeID=t.FlightTypeID,e.entity.AirlineOperatorsID=t.AirlineOperatorsID,e.entity.FlightNumber=t.FlightNumber,e.entity.FromAirport=t.FromAirport,e.entity.ToAirport=t.ToAirport,e.entity.STA=t.STA,e.entity.STD=t.STD,e.entity.FlightH=t.FlightH,e.entity.FlightM=t.FlightM,e.entity.FlightStatus=t.FlightStatus,e.start=new Date(e.entity.STD),e.tempToAirport=e.entity.ToAirport},e.tempData=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.deletePlanItem(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.addMode=!1,e.appendMode=!1,e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(t){e.doRefresh=!1,e.entity.Id=-1,e.tempData=null,e.IsNew=!0,e.addMode=!0,e.popup_add_visible=!0}};var s=-1*(new Date).getTimezoneOffset();e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.loadingVisible=!0,a.getFlightPlanItem(e.dg_selected.Id,s).then(function(t){e.loadingVisible=!1,e.IsNew=!1,e.tempData=t,e.doRefresh=!1,e.popup_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.btn_append={text:"Append",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.loadingVisible=!0,a.getFlightPlanItem(e.dg_selected.Id,s).then(function(t){e.loadingVisible=!1,e.IsNew=!0,e.tempData=t,e.doRefresh=!1,e.popup_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.btn_approve={text:"Approve",type:"default",icon:"check",width:150,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.loadingVisible=!0,a.checkPlanErrors(e.dg_selected.FlightPlanId).then(function(t){if(e.loadingVisible=!1,t>0)return void General.ShowNotify("The plan has error(s).","error")},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}),General.Confirm(Config.Text_SimpleConfirm,function(t){t&&(e.loadingVisible=!0,a.closePlan(e.dg_selected.FlightPlanId).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))})}},e.btn_gantt_base={text:"Gantt View (Base)",type:"default",icon:"rowfield",width:210,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.dg_selected;n.$broadcast("InitFlightPlanningGanttViewBase",e.dg_selected)}},e.btn_gantt={text:"Gantt View (All)",type:"default",icon:"rowfield",width:200,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.dg_selected;n.$broadcast("InitFlightPlanningGanttView",e.dg_selected)}},e.btn_grid={text:"Grid View",type:"default",icon:"menu",width:140,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.dg_selected;n.$broadcast("InitFlightDesignGrid",e.dg_selected)}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.entityInterval={FlightPlanId:null,DateFrom:null,DateTo:null,Interval:null,BaseIATA:null,Register:null,Months:[],Days:[]},e.clearEntityInterval=function(){e.entityInterval.FlightPlanId=null,e.entityInterval.DateFrom=null,e.entityInterval.DateTo=null,e.entityInterval.Interval=null,e.entityInterval.BaseIATA=null,e.entityInterval.Register=null,e.entityInterval.Months=[],e.entityInterval.Days=[]},e.btn_interval={text:"Interval",type:"default",icon:"event",width:150,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entityInterval.FlightPlanId=e.dg_selected.FlightPlanId,e.entityInterval.DateFrom=e.dg_selected.DateFrom,e.entityInterval.DateTo=e.dg_selected.DateTo,e.entityInterval.Interval=e.dg_selected.Interval,e.entityInterval.BaseIATA=e.dg_selected.BaseIATA,e.entityInterval.Register=e.dg_selected.Register,e.entityInterval.Months=[],e.entityInterval.Days=[],console.log(e.entityInterval),100==e.entityInterval.Interval||(e.popup_interval_visible=!0)}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}};new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("03/18/2017"),new Date("03/22/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017");e.Day0="05/06/2019",e.Day1="05/07/2019",e.Day2="05/07/2019 23:59:00.000",e.setArrival=function(){if(null!=e.entity.STD&&null!=e.entity.FlightH&&null!=e.entity.FlightM){var t=new Date(e.entity.STD);console.log(e.entity.STD),console.log(e.entity.FlightH),console.log(e.entity.FlightM),e.entity.STA=new Date(t.addHours(e.entity.FlightH).addMinutes(e.entity.FlightM))}else e.entity.STA=null},e.isBaseDisabled=!0,e.sb_Base={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){e.isBaseDisabled||(e.entity.FromAirport=t.selectedItem.Id)},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.BaseId",disabled:"isBaseDisabled"}},e.tempToAirport=null,e.selectedFromAirport=null,e.selectedToAirport=null,e.sb_FromAirport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){if(e.entity.ToAirport=null,!t.selectedItem)return e.ds_toairport=[],void(e.entity.FromAirportIATA=null);e.entity.FromAirportIATA=t.selectedItem.IATA,e.loadingVisible=!0,a.getRouteDestination(Config.AirlineId,t.selectedItem.Id).then(function(t){e.loadingVisible=!1,e.ds_toairport=t,e.tempToAirport&&(e.entity.ToAirport=e.tempToAirport,e.tempToAirport=null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.FromAirport",selectedItem:"selectedFromAirport"}},e.ds_toairport=[],e.sb_ToAirport={showClearButton:!0,searchEnabled:!0,itemTemplate:function(e){return n.getSbTemplateRouteTo(e)},onSelectionChanged:function(t){t.selectedItem?(e.entity.RouteId=t.selectedItem.Id,e.DotBlockToBlock?(e.entity.FlightH=t.selectedItem.FlightH,e.entity.FlightM=t.selectedItem.FlightM):e.DotBlockToBlock=!0,e.entity.ToAirportIATA=t.selectedItem.ToAirportIATA):(e.entity.RouteId=null,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.ToAirportIATA=null),e.setArrival()},searchExpr:["ToAirportIATA","ToCity"],displayExpr:"ToAirportIATA",valueExpr:"ToAirportId",bindingOptions:{value:"entity.ToAirport",selectedItem:"selectedRoute",dataSource:"ds_toairport"}},e.selectedRoute=null,e.start=null,e.time_start={type:"time",width:"100%",interval:15,onValueChanged:function(t){if(t.value){var i=new Date(t.value),n=i.getHours(),a=i.getMinutes(),o=n+":"+a+":00",l=new Date(e.entity.iDateFrom).getDatePartSlash()+" "+o,r=new Date(l);e.entity.STD=r}else e.entity.STD=null;e.setArrival()},bindingOptions:{value:"start"}},e.time_end={readOnly:!0,type:"time",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entity.STA"}},e.text_flighth={min:0,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.FlightH"}},e.text_flightm={min:0,max:59,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.FlightM"}},e.text_flightnumber={bindingOptions:{value:"entity.FlightNumber"}},e.sb_flighttype={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.FlightTypeID"}},e.selectedType=null,e.sb_type={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(e){return n.getSbTemplateAircraft(e)},searchExpr:["Type","Manufacturer"],dataSource:n.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",onSelectionChanged:function(t){e.ds_msn=[],e.msn_readOnly=!0,t&&t.selectedItem?(e.entity.AircraftType=t.selectedItem.Type,o.getVirtualMSNsByType(Config.CustomerId,t.selectedItem.Id).then(function(t){e.msn_readOnly=!1,e.ds_msn=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):(e.msn_readOnly=!0,e.ds_msn=[],e.entity.AircraftType=null)},bindingOptions:{value:"entity.TypeId",selectedItem:"selectedType"}},e.ds_msn=[],e.msn_readOnly=!0,e.unknown_readOnly=!1,e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(t){if(t.selectedItem){e.entity.Register=t.selectedItem.Register;var i=-1*(new Date).getTimezoneOffset(),n={CustomerId:Config.CustomerId,Date:new Date(e.entity.iDateFrom).ToUTC(),RegisterId:t.selectedItem.ID,Offset:i};e.loadingVisible=!0,a.getPlanLastItem(n).then(function(t){e.loadingVisible=!1,t&&-1!=t.Id?(e.isBaseDisabled=!0,e.entity.BaseId=t.BaseId,e.IsNew&&(e.entity.FromAirport=t.ToAirport,e.entity.ToAirport=null,e.entity.STD=new Date(t.STA),e.start=new Date(e.entity.STD)),a.getPlanItems(n).then(function(t){e.dg2_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):e.isBaseDisabled=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else e.entity.Register=null,e.entity.BaseId=null,e.isBaseDisabled=!0},bindingOptions:{value:"entity.RegisterID",disabled:"msn_readOnly",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.pop_width_employees=600,e.pop_height_employees=450,e.dg_height_full=100,e.scroll_height_full=501,e.scroll_add={bindingOptions:{height:"scroll_height_full"}},e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={width:1200,height:530,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplan",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.entity.DateFrom=new Date(e.entity.iDateFrom).ToUTC(),e.entity.DateTo=new Date(e.entity.iDateTo).ToUTC(),e.entity.STD=new Date(e.entity.STD).toUTCString(),e.entity.STA=new Date(e.entity.STA).toUTCString(),100!=e.entity.Interval&&(e.entity.Months=[],e.entity.Days=[]),e.loadingVisible=!0,a.savePlanItem(e.entity).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.refreshEntity(),e.IsNew?(e.isBaseDisabled=!0,e.entity.STD=new Date(e.entity.STA).addMinutes(60),e.start=e.entity.STD,e.entity.STA=null,e.entity.FromAirport=e.entity.ToAirport,e.entity.ToAirport=null,t.STD=new Date(t.STD).addMinutes(s),t.STA=new Date(t.STA).addMinutes(s),e.dg2_ds.push(t),e.dg2_instance.refresh()):e.popup_add_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.tempData&&e.bindEntity(e.tempData)},onHiding:function(){e.clearEntity(),e.dg2_ds=[],e.dg2_instance.refresh(),e.popup_add_visible=!1,e.doRefresh&&e.bind()},bindingOptions:{visible:"popup_add_visible",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_interval_visible=!1,e.popup_interval_title="Interval",e.popup_interval={width:1100,height:620,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplaninterval",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={Id:e.entityInterval.FlightPlanId,DateFrom:new Date(e.entityInterval.DateFrom).ToUTC(),DateTo:new Date(e.entityInterval.DateTo).ToUTC(),Interval:e.entityInterval.Interval,Months:e.entityInterval.Months,Days:e.entityInterval.Days,DateFirst:new Date(e.data[0].startDate).ToUTC()};e.loadingVisible=!0,a.savePlanInterval(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.clearEntityInterval(),e.popup_interval_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_interval_visible=!1,e.doRefresh&&e.bind()},bindingOptions:{visible:"popup_interval_visible",title:"popup_interval_title"}},e.popup_interval.toolbarItems[1].options.onClick=function(t){e.popup_interval_visible=!1},e.isDouble=0;e.monthArray=[],e.dayArray=[],e.addCustom=function(t,i,n,a){if(n&&0!=n.length&&a&&0!=a.length)for(;t<=i;){var o=!1,l=!1;o=!n||0==n.length||-1!=n.indexOf(t.getMonth()),l=!a||0==a.length||-1!=a.indexOf(t.getDay()),o&&l&&e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(1)}},e.addDaily=function(t,i,n){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(n)},e.addMonthly=function(t,i){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(30)},e.fillSchedule=function(){if(e.data=[],e.entity.Interval&&e.entity.iDateFrom&&e.entity.iDateTo){var t=new Date(e.entity.iDateFrom);t=new Date(t.setHours(0,0,0,0));var i=new Date(e.entity.iDateTo);switch(i=new Date(i.setHours(23,59,59,999)),console.log(t),console.log(i),e.entity.Interval){case 1:e.addDaily(t,i,1);break;case 2:e.addDaily(t,i,7);break;case 3:e.addDaily(t,i,10);break;case 4:e.addDaily(t,i,14);break;case 5:e.addDaily(t,i,15);break;case 100:e.addCustom(t,i,e.entity.Months,e.entity.Days)}}},e.fillSchedule2=function(){if(e.data=[],e.entityInterval.Interval&&e.entityInterval.DateFrom&&e.entityInterval.DateTo){var t=new Date(e.entityInterval.DateFrom);t=new Date(t.setHours(0,0,0,0));var i=new Date(e.entityInterval.DateTo);switch(i=new Date(i.setHours(23,59,59,999)),e.entityInterval.Interval){case 1:e.addDaily(t,i,1);break;case 2:e.addDaily(t,i,7);break;case 3:e.addDaily(t,i,10);break;case 4:e.addDaily(t,i,14);break;case 5:e.addDaily(t,i,15);break;case 100:e.addCustom(t,i,e.entityInterval.Months,e.entityInterval.Days);break;case 101:e.addDaily(t,i,1)}}},e.data=[],e.scheduler_instance=null,e.schedulerOptions={onContentReady:function(t){e.scheduler_instance||(e.scheduler_instance=t.component)},views:["month"],currentView:"month",startDayHour:0,endDayHour:24,showCurrentTimeIndicator:!1,height:492,appointmentTemplate:function(e){return $("<div style='text-align:center; height:38px;color:green;background:white;margin-top:-5px'><i style='font-size:32px' class='icon ion-md-checkmark'></i></div>")},editing:{allowAdding:!1,allowUpdating:!1,allowDeleting:!0,allowResizing:!1,allowDragging:!1},onAppointmentClick:function(e){e.cancel=!0},onAppointmentDblClick:function(e){e.cancel=!0},onCellClick:function(e){e.cancel=!0},bindingOptions:{dataSource:"data",min:"entityInterval.DateFrom",max:"entityInterval.DateTo",currentDate:"entityInterval.DateFrom"}},e.date_from={type:"date",width:"100%",onValueChanged:function(t){e.entity.iDateTo=t.value},bindingOptions:{value:"entity.iDateFrom"}},e.date_to={type:"date",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entity.iDateTo"}},e.date_from2={type:"date",width:"100%",onValueChanged:function(t){e.fillSchedule2()},bindingOptions:{value:"entityInterval.DateFrom"}},e.date_to2={type:"date",width:"100%",onValueChanged:function(t){e.fillSchedule2()},bindingOptions:{value:"entityInterval.DateTo"}},e.intervalTypes=[{Id:1,Title:"Daily"},{Id:2,Title:"Weekly"},{Id:3,Title:"Every 10 days"},{Id:4,Title:"Every 14 days"},{Id:5,Title:"Every 15 days"},{Id:100,Title:"Custom"},{Id:101,Title:"Once"}],e.sb_interval={showClearButton:!0,width:"100%",searchEnabled:!1,displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){e.customDisabled=t.selectedItem&&100!=t.selectedItem.Id,e.fillSchedule()},bindingOptions:{value:"entity.Interval",dataSource:"intervalTypes"}},e.sb_interval2={showClearButton:!0,width:"100%",searchEnabled:!1,displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){e.customDisabled=t.selectedItem&&100!=t.selectedItem.Id,e.fillSchedule2()},bindingOptions:{value:"entityInterval.Interval",dataSource:"intervalTypes"}},e.customDisabled=!0,e.tag_months_instance=null,e.tag_months={dataSource:General.MonthDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_months_instance||(e.tag_months_instance=t.component)},onSelectionChanged:function(t){e.fillSchedule2()},bindingOptions:{disabled:"customDisabled",value:"entityInterval.Months"}},e.tag_days_instance=null,e.tag_days={dataSource:General.WeekDayDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_days_instance||(e.tag_days_instance=t.component)},onSelectionChanged:function(t){e.fillSchedule2()},bindingOptions:{disabled:"customDisabled",value:"entityInterval.Days"}},e.text_title={bindingOptions:{value:"entity.Title"}},e.text_base={readOnly:!0,bindingOptions:{value:"entityInterval.BaseIATA"}},e.text_type={readOnly:!0,bindingOptions:{value:"dg_selected.AircraftType"}},e.text_msn={readOnly:!0,bindingOptions:{value:"entityInterval.Register"}},e.dg_selected=null,e.dg_columns=[{dataField:"status",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){12==t.value&&$("<div>").append("<i style='font-size:22px;color:#2196F3' class='icon ion-md-add-circle'></i>").appendTo(e),13==t.value&&$("<div>").append("<i style='font-size:22px;color:#4CAF50' class='icon ion-md-create'></i>").appendTo(e),10==t.value&&$("<div>").append("<i style='font-size:22px;color:#f44336' class='icon ion-md-shuffle'></i>").appendTo(e),11==t.value&&$("<div>").append("<i style='font-size:22px;color:#ff5722' class='icon ion-md-code-working'></i>").appendTo(e),16==t.value&&$("<div>").append("<i style='font-size:22px;color:#f44336' class='icon ion-md-shuffle'></i><i style='font-size:22px;color:#ff5722' class='icon ion-md-code-working'></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"DateFrom",caption:"Date",allowResizing:!0,dataType:"date",allowEditing:!1,width:200,alignment:"center",groupIndex:0},{dataField:"BaseIATA",caption:"Base",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"AircraftType",caption:"AC Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200,groupIndex:1},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"FlightPlanId",caption:"Plan Id",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"right"}],e.dg_height=$(window).height()-135,e.dg_instance=null,e.dg_ds=null,e.dg={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},onCellPrepared:function(e){if("data"==e.rowType&&"BaseIATA"===e.column.dataField){var t=Flight.getBaseMetaData(e.data.BaseIATA);t&&e.cellElement.css("background",t.bgcolor)}},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.dg2_selected=null,e.dg2_columns=[{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300}],e.dg2_height=400,e.dg2_instance=null,e.dg2_ds=[],e.dg2={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg2_columns,onContentReady:function(t){e.dg2_instance||(e.dg2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg2_selected=i||null},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg2_ds",height:"dg2_height"}},e.bind=function(){var t="odata/flightplans/items/opened/"+Config.CustomerId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){$.each(e,function(e,t){t.STD=new Date(t.STD).addMinutes(s),t.STA=new Date(t.STA).addMinutes(s)}),n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"DateFrom",desc:!0},"BaseIATA","Register","STD"]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.getFlightsGantt=function(){e.loadingVisible=!0,a.getFlightsGantt(Config.CustomerId).then(function(t){e.loadingVisible=!1,e.flightData=t,$.each(e.flightData.flights,function(e,t){t.startDate=new Date(t.startDate)})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},l.isAuthorized()?(n.page_title="> Flights Planning 2",
$(".flight").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onFlightPlanItemsSaved",function(t,i){e.doRefresh=!0}),e.$on("onFlightDesignHide",function(t,i){e.bind()}),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("flightDesignController",["$scope","$location","flightService","aircraftService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o,l){e.Day0="01/31/2019",e.Day1="02/01/2019",e.Day2="02/02/2019 23:59:00.000",Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.scroll=0,e.addSelectedFlight=function(t){e.selectedFlight?e.selectedFlight=null:e.selectedFlight=t,console.log(e.selectedFlight)};var r,d=function(){var t=this;t.flightData=ko.observable(),t.details="vahid",t.startDate=ko.observable(new Date(e.Day1)),t.endDate=ko.observable(new Date(e.Day2)),t.flights=ko.observable([]),t.resourceGroups=ko.observable([]),t.resources=ko.observableArray([]),t.viewType=ko.observable(ej.Gantt.ViewType.ResourceView),t.height=ko.observable("300px"),t.datasource=ko.observableArray([]),t.selectedTask=ko.observable(),t.selectedTaskData=ko.observable(),t.gantt_option={selectionMode:ej.Gantt.SelectionMode.Cell,selectionType:ej.Gantt.SelectionType.Single,taskbarClick:function(t){console.log("taskbarClick"),e.addSelectedFlight(t.data.item)},dataSource:[],allowColumnResize:!0,isResponsive:!0,taskIdMapping:"taskId",taskNameMapping:"taskName",fromLocationMapping:"from",startDateMapping:"startDate",endDateMapping:"endDate",progressMapping:"progress",durationMapping:"duration",groupNameMapping:"Title",groupIdMapping:"groupId",groupCollection:t.resourceGroups,resources:t.resources,resourceIdMapping:"resourceId",resourceNameMapping:"resourceName",resourceInfoMapping:"resourceId",notesMapping:"notes",rightTaskLabelMapping:"taskName",baselineStartDateMapping:"BaselineStartDate",baselineEndDateMapping:"BaselineEndDate",highlightWeekEnds:!0,includeWeekend:!1,rowHeight:"material"==window.theme?48:"office-365"==window.theme?36:40,taskbarHeight:35,scheduleStartDate:t.startDate,scheduleEndDate:t.endDate,predecessorMapping:"predecessor",allowGanttChartEditing:!1,allowDragAndDrop:!0,editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,editMode:"normal"},splitterSettings:{position:180},toolbarSettings:{showToolbar:!1,toolbarItems:[ej.Gantt.ToolbarItems.Add,ej.Gantt.ToolbarItems.Delete,ej.Gantt.ToolbarItems.Update,ej.Gantt.ToolbarItems.Cancel,ej.Gantt.ToolbarItems.ExpandAll,ej.Gantt.ToolbarItems.CollapseAll,ej.Gantt.ToolbarItems.NextTimeSpan,ej.Gantt.ToolbarItems.PrevTimeSpan]},enableContextMenu:!1,load:function(){this.getColumns()[0].width=180},create:function(t){e.tempFlight&&e.addFlight(e.tempFlight),$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(e.scroll)},rowSelected:function(e){},actionBegin:function(e){e.requestType&&"beginedit"==e.requestType&&(e.cancel=!0)},actionComplete:function(e){},rowDataBound:function(e){e.data.eResourceTaskType},beginEdit:function(e){},workingTimeScale:"TimeScale24Hours",durationUnit:ej.Gantt.DurationUnit.Hour,scheduleHeaderSettings:{scheduleHeaderType:ej.Gantt.ScheduleHeaderType.Hour,dayHeaderFormat:"DAY dd",minutesPerInterval:ej.Gantt.minutesPerInterval.ThirtyMinutes,timescaleUnitSize:"255%"},taskbarTemplate:"#taskbarTemplate",leftTaskLabelTemplate:"#leftlableTemplate",viewType:t.viewType,sizeSettings:{height:t.height},groupSettings:{},showStackedHeader:!1,taskSchedulingMode:ej.Gantt.TaskSchedulingMode.Manual,enableTaskbarTooltip:!1},t.test=ko.observable("vahid"),t.date_takeoff=ko.observable(),t.date_takeoff_options=ko.observable({type:"datetime",value:t.date_takeoff})};e.entity={Id:-1,FlightPlanId:null,TypeId:null,RegisterID:null,FlightTypeID:null,AirlineOperatorsID:null,FlightNumber:null,FromAirport:null,ToAirport:null,STD:null,STA:null,FlightH:null,FlightM:null,Unknown:null,RouteId:null},e.clearEntity=function(){e.entity.Id=null,e.entity.TypeId=null,e.entity.RegisterID=null,e.entity.FlightTypeID=null,e.entity.FlightNumber=null,e.entity.FromAirport=null,e.entity.ToAirport=null,e.entity.STD=null,e.entity.STA=null,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.Unknown=null,e.start=null,e.entity.RouteId=null},e.refreshEntity=function(){e.entity.Id=null,e.entity.FlightTypeID=null,e.entity.AirlineOperatorsID=null,e.entity.FlightNumber=null,e.entity.FromAirport=e.entity.ToAirport,e.entity.ToAirport=null,e.entity.STD=e.entity.STA,e.start=e.entity.STD,e.entity.STA=null,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.Unknown=null,e.entity.RouteId=null},e.selectedFlight=null,e.tempToAirport=null,e.InitUpdate=function(){var t=Enumerable.From(r.datasource()).Where("$.taskId=="+e.selectedFlight.taskId).FirstOrDefault();t&&(e.entity.Id=t.Id,e.entity.FlightNumber=t.FlightNumber,e.entity.FlightTypeID=t.FlightTypeID,e.entity.FromAirport=t.FromAirport,e.entity.ToAirport=t.ToAirport,e.tempToAirport=t.ToAirport,e.entity.TypeId=t.TypeId,e.entity.RegisterID=t.RegisterID,e.start=new Date(t.STD),e.entity.FlightH=t.FlightH,e.entity.FlightM=t.FlightM,e.entity.STA=new Date(t.STA),e.entity.STD=new Date(t.STD),e.IsNew=!1,e.popup_item_title="Update",e.popup_item_visible=!0,e.entity.status=t.status,e.entity.initStatus=t.initStatus,e.entity.isnew=!1)},e.setArrival=function(){if(null!=e.entity.STD&&null!=e.entity.FlightH&&null!=e.entity.FlightM){var t=new Date(e.entity.STD);e.entity.STA=new Date(t.addHours(e.entity.FlightH).addMinutes(e.entity.FlightM))}else e.entity.STA=null},e.selectedType=null,e.sb_type={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(e){return l.getSbTemplateAircraft(e)},searchExpr:["Type","Manufacturer"],dataSource:l.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",onSelectionChanged:function(t){e.ds_msn=[],e.msn_readOnly=!0,t&&t.selectedItem?n.getVirtualMSNsByType(Config.CustomerId,t.selectedItem.Id).then(function(t){e.msn_readOnly=!1,e.ds_msn=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}):(e.msn_readOnly=!0,e.ds_msn=[])},bindingOptions:{value:"entity.TypeId",selectedItem:"selectedType"}},e.ds_msn=[],e.msn_readOnly=!0,e.unknown_readOnly=!1,e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(t){if(t.selectedItem&&1==e.IsNew){var i=Flight.getLastFlight(r.datasource(),t.selectedItem.ID);i&&(e.entity.FromAirport=i.ToAirport,e.entity.ToAirport=null,e.entity.STD=new Date(i.STA),e.start=new Date(e.entity.STD))}},bindingOptions:{value:"entity.RegisterID",disabled:"msn_readOnly",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.getAverageRouteTime=function(){1==e.IsNew&&e.entity.FromAirport&&e.entity.ToAirport&&(e.loadingVisible=!0,i.getAverageRouteTime(e.entity.FromAirport,e.entity.ToAirport).then(function(t){e.loadingVisible=!1,e.entity.FlightH=t.FlightH,e.entity.FlightM=t.FlightM,e.setArrival()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},e.sb_flighttype={showClearButton:!0,searchEnabled:!0,dataSource:l.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.FlightTypeID"}},e.selectedFromAirport=null,e.selectedToAirport=null,e.sb_FromAirport={showClearButton:!0,searchEnabled:!0,dataSource:l.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return l.getSbTemplateAirport(e)},onSelectionChanged:function(t){if(e.entity.ToAirport=null,!t.selectedItem)return void(e.ds_toairport=[]);e.loadingVisible=!0,i.getRouteDestination(Config.AirlineId,t.selectedItem.Id).then(function(t){e.loadingVisible=!1,e.ds_toairport=t,e.tempToAirport&&(e.entity.ToAirport=e.tempToAirport,e.tempToAirport=null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.FromAirport",selectedItem:"selectedFromAirport"}},e.ds_toairport=[],e.sb_ToAirport={showClearButton:!0,searchEnabled:!0,itemTemplate:function(e){return l.getSbTemplateRouteTo(e)},onSelectionChanged:function(t){t.selectedItem?(e.entity.RouteId=t.selectedItem.Id,e.entity.FlightH=t.selectedItem.FlightH,e.entity.FlightM=t.selectedItem.FlightM):(e.entity.RouteId=null,e.entity.FlightH=null,e.entity.FlightM=null),e.setArrival()},searchExpr:["ToAirportIATA","ToCity"],displayExpr:"ToAirportIATA",valueExpr:"ToAirportId",bindingOptions:{value:"entity.ToAirport",selectedItem:"selectedRoute",dataSource:"ds_toairport"}},e.selectedRoute=null,e.sb_route={showClearButton:!0,searchEnabled:!0,dataSource:l.getDatasourceRoutes(Config.AirlineId),itemTemplate:function(e){return l.getSbTemplateRoute(e)},onSelectionChanged:function(t){t.selectedItem?(e.entity.FromAirport=t.selectedItem.FromAirportId,e.entity.ToAirport=t.selectedItem.ToAirportId,e.entity.FlightH=t.selectedItem.FlightH,e.entity.FlightM=t.selectedItem.FlightM):(e.entity.FromAirport=null,e.entity.ToAirport=null,e.entity.FlightH=null,e.entity.FlightM=null),e.setArrival()},searchExpr:["FromAirportIATA","FromCity"],displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.RouteId",selectedItem:"selectedRoute"}},e.start=null,e.time_start={type:"time",width:"100%",interval:15,onValueChanged:function(t){if(t.value){var i=new Date(t.value),n=i.getHours(),a=i.getMinutes(),o=n+":"+a+":00",l=e.Day1+" "+o,r=new Date(l);e.entity.STD=r}else e.entity.STD=null;e.setArrival()},bindingOptions:{value:"start"}},e.time_end={readOnly:!0,type:"time",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entity.STA"}},e.text_flighth={min:0,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.FlightH"}},e.text_flightm={min:0,max:59,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.FlightM"}},e.text_unknown={bindingOptions:{value:"entity.Unknown",disabled:"unknown_readOnly"}},e.text_flightnumber={bindingOptions:{value:"entity.FlightNumber"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.scroll_height=200,e.dg_height=200,e.dg_height2=200,e.scroll_main={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.deleted=[],e.pop_width=900,e.pop_height=600,e.popup_add_visible=!1,e.popup_add_title="New",e.apply=!1,e.gaps="Gaps: 0",e.overlaps="Overlaps: 0",e.gapoverlaps="Gap & Overlaps: 0",e.gapsn=0,e.overlapsn=0,e.gapoverlapsn=e.popup_add={fullScreen:!0,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"default",text:"",width:40,icon:"plus",onClick:function(t){e.IsNew=!0,e.popup_item_visible=!0,e.popup_item_title="Add"}}},{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"default",text:"",width:40,icon:"edit",onClick:function(t){if(!e.selectedFlight)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.InitUpdate()}}},{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"danger",text:"",width:40,icon:"remove",onClick:function(t){if(!e.selectedFlight)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.deleted.push(e.selectedFlight.taskId);var i=e.selectedFlight.RegisterID,n=Enumerable.From(r.datasource()).Where("$.taskId!="+e.selectedFlight.taskId).ToArray(),a=$("#resourceGantt").data("ejGantt");Flight.findGaps(n,r.resources()),Flight.findOverlaps(n,i),a._refreshDataSource(n),e.selectedFlight=null,r.datasource(n),Flight.activeDatasource=n,e.getErrors()}}},{widget:"dxTextBox",location:"after",options:{width:70,readOnly:!0,bindingOptions:{value:"gaps"}},toolbar:"bottom"},{widget:"dxTextBox",location:"after",options:{width:100,readOnly:!0,bindingOptions:{value:"overlaps"}},toolbar:"bottom"},{widget:"dxTextBox",location:"after",options:{width:130,readOnly:!0,bindingOptions:{value:"gapoverlaps"}},toolbar:"bottom"},{widget:"dxCheckBox",location:"after",options:{visible:!1,width:100,text:"Apply",onValueChanged:function(t){e.apply=t.value}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",onClick:function(t){if(1==e.apply&&(e.gapsn>0||e.overlapsn>0))return void General.ShowNotify(Config.Text_GanttErrors,"error");var n=Enumerable.From(r.datasource()).ToArray(),a=[];$.each(n,function(t,i){a.push({Id:i.Id,FlightPlanId:e.planId,TypeId:i.TypeId,RegisterID:i.RegisterID,FlightTypeID:i.FlightTypeID,AirlineOperatorsID:i.AirlineOperatorsID,FlightNumber:i.FlightNumber,FromAirport:i.FromAirport,ToAirport:i.ToAirport,STD:new Date(i.startDate).toUTCString(),STA:new Date(i.endDate).toUTCString(),FlightH:i.FlightH,FlightM:i.FlightM,StatusId:i.status})});var o={};o.Plan=e.plan,o.Items=a,o.Deleted=e.deleted,o.Apply=e.apply,e.loadingVisible=!0,i.savePlanItems(o).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success");var i=Enumerable.From(r.datasource()).ToArray();$.each(i,function(e,i){if(i.Id>=1e6){var n=Enumerable.From(t).Where("$.InitId=="+i.Id).FirstOrDefault();i.Id=n.Id}});var n=$("#resourceGantt").data("ejGantt");n._refreshDataSource(i),r.datasource(i),n.reRenderChart(),e.selectedFlight=null,e.loadingVisible=!1,l.$broadcast("onFlightPlanItemsSaved",null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_add_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){$("#gantt_container").append('<div id="resourceGantt" style="height:450px;width:100%;" data-bind="ejGantt: gantt_option" />')},onShown:function(t){e.bind(e.planId)},onHiding:function(){var t=$("#resourceGantt")[0];ko.cleanNode(t),$("#resourceGantt").remove(),e.clearEntity(),e.popup_add_visible=!1,l.$broadcast("onFlightDesignHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title","toolbarItems[0].visible":"IsEditView","toolbarItems[1].visible":"IsEditView","toolbarItems[2].visible":"IsEditView","toolbarItems[3].visible":"IsEditView","toolbarItems[4].visible":"IsEditView","toolbarItems[5].visible":"IsEditView","toolbarItems[6].visible":"IsEditView","toolbarItems[7].visible":"IsEditView"}},e.detailType="gantt",e.copy=function(e,t){t.Id=e.Id,t.taskId=e.taskId,t.FlightPlanId=e.FlightPlanId,t.TypeId=e.TypeId,t.RegisterID=e.RegisterID,t.FlightTypeID=e.FlightTypeID,t.AirlineOperatorsID=e.AirlineOperatorsID,t.FlightNumber=e.FlightNumber,t.FromAirport=e.FromAirport,t.ToAirport=e.ToAirport,t.STA=new Date(e.STA),t.STD=new Date(e.STD),t.FlightH=e.FlightH,t.FlightM=e.FlightM,t.Unknown=e.Unknown,t.FlightPlan=e.FlightPlan,t.CustomerId=e.CustomerId,t.IsActive=e.IsActive,t.DateActive=e.DateActive,t.DateFrom=e.DateFrom,t.DateTo=e.DateTo,t.Customer=e.Customer,t.FromAirportName=e.FromAirportName,t.FromAirportIATA=e.FromAirportIATA,t.from=e.from,t.FromAirportCityId=e.FromAirportCityId,t.ToAirportName=e.ToAirportName,t.ToAirportIATA=e.ToAirportIATA,t.to=e.to,t.ToAirportCityId=e.ToAirportCityId,t.notes=e.notes,t.status=e.status,t.progress=e.progress,t.duration=e.duration,t.startDate=new Date(e.startDate),t.taskName=e.taskName,t.FromAirportCity=e.FromAirportCity,t.ToAirportCity=e.ToAirportCity,t.MSN=e.MSN,t.Register=e.Register,t.AircraftType=e.AircraftType,t.resourceId=e.resourceId,t.initStatus=e.initStatus,t.delay=e.delay,t.delayLanding=e.delayLanding,t.baseDuration=e.baseDuration,t.baseEndDate=new Date(e.baseEndDate),t.baseStartDate=new Date(e.baseStartDate),t.endDate=new Date(e.endDate),t.BaselineStartDate=e.BaselineStartDate,t.BaselineEndDate=e.BaselineEndDate,t.serialNumber=e.serialNumber,t.isnew=e.isnew},e.IsNew=!0,e.tempFlight=null,e.addFlight=function(t){1==e.IsNew?(t.taskId=e.taskIndex,t.Id=t.taskId,e.taskIndex=e.taskIndex+1):t.taskId=t.Id,e.IsNew?(t.isnew=!0,t.status=1,t.initStatus=[1]):t.isnew;var i=$("#resourceGantt").data("ejGantt");e.tempFlight=null;var n=JSON.parse(JSON.stringify(t));if(n.startDate=new Date(t.startDate),n.endDate=new Date(t.endDate),Flight.processData(n),e.IsNew)i.addRecord(n,0),r.datasource().push(n),e.refreshEntity();else{var a=Enumerable.From(r.datasource()).Where("$.taskId=="+t.taskId).FirstOrDefault();e.copy(n,a),i.updateRecordByTaskId(n),e.popup_item_visible=!1}Flight.findGaps(r.datasource(),r.resources(),function(){Flight.findOverlaps(r.datasource(),t.RegisterID,function(){Flight.activeDatasource=r.datasource()})}),e.getErrors(),i.reRenderChart()},e.popup_item_visible=!1,e.popup_item_title="Add",e.popup_item={fullScreen:!1,showTitle:!0,height:480,width:600,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplanitem",onClick:function(t){if(e.scroll=$(".e-ganttviewerbodyContianer").data("ejScroller").scrollLeft(),!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(!e.entity.RegisterID&&!e.entity.Unknown)return void General.ShowNotify(Config.Text_FillRequired,"error");if(0==e.entity.FlightH&&0==e.entity.FlightM)return void General.ShowNotify(Config.Text_FillRequired,"error");e.entity.from=e.selectedFromAirport.IATA,e.entity.to=e.selectedRoute.ToAirportIATA,e.entity.taskName=e.selectedFromAirport.IATA+(e.entity.FlightNumber?" -"+e.entity.FlightNumber+"- ":" -?- ")+e.selectedRoute.ToAirportIATA,e.entity.startDate=new Date(e.entity.STD),e.entity.endDate=new Date(e.entity.STA),e.entity.notes="green",e.entity.progress=0,e.entity.delay=0,e.entity.delayLanding=0,e.entity.duration=Flight.calculateDuration(e.entity.FlightH,e.entity.FlightM),e.entity.baseDuration=e.entity.duration,e.entity.resourceId=[],e.entity.resourceId.push(e.entity.RegisterID);var i=$("#resourceGantt").data("ejGantt");if(!Enumerable.From(r.resourceGroups()).Where("$.groupId=="+e.entity.TypeId).FirstOrDefault()){var n=r.resourceGroups();n.push({groupId:e.entity.TypeId,Title:e.selectedType.Type}),r.resourceGroups(n)}if(!Enumerable.From(r.resources()).Where("$.resourceId=="+e.entity.RegisterID).FirstOrDefault()){var a=r.resources();a.push({resourceName:e.selectedMsn.Register,groupId:e.selectedMsn.AircraftTypeId,resourceId:e.entity.RegisterID}),r.resources(a)}e.tempFlight={},e.copy(e.entity,e.tempFlight),i.reRenderChart()}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_item_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!0,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.clearEntity(),e.popup_expose_visible=!1},bindingOptions:{visible:"popup_item_visible",title:"popup_item_title"}},e.applied=!1,e.aircraftTypes=null,e.msns=null,e.buildResources=function(){var t=[];$.each(e.aircraftTypes,function(e,i){t.push({groupId:Number(i.Id),Title:i.Type})});var i=[];i.push({resourceName:"Vahid",groupId:6,resourceId:1}),r.resourceGroups(t),r.resources(i)},e.getErrors=function(){e.gapsn=Enumerable.From(r.datasource()).Where("$.status==11").ToArray().length,e.gaps="Gaps: "+e.gapsn,e.overlapsn=Enumerable.From(r.datasource()).Where("$.status==10").ToArray().length,e.overlaps="Overlaps: "+e.overlapsn,e.gapoverlapsn=Enumerable.From(r.datasource()).Where("$.status==16").ToArray().length,e.gapoverlaps="Gap & Overlaps: "+e.gapoverlapsn},e.bind=function(t){var a=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0,n.getAircraftTypes(Config.CustomerId).then(function(o){e.aircraftTypes=o,n.getMSNs(Config.CustomerId).then(function(n){e.msns=n,i.getFlightPlanGantt(t,a).then(function(t){e.loadingVisible=!1,$.each(t.flights,function(e,t){t.startDate=new Date(t.startDate),t.initStatus=[1],1!=t.status&&t.initStatus.push(t.status)}),r.flightData(t),r.resourceGroups(t.resourceGroups),r.resources(t.resources),e.applied=!0,ko.applyBindings(r,document.getElementById("resourceGantt"));var i=$(window).height()-100;r.height(i+"px");var n=Flight.proccessDataSource(t.flights);Flight.activeDatasource=n,r.datasource(n),e.getErrors(),$("#resourceGantt").data("ejGantt")._refreshDataSource(r.datasource())},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.tempData=null,e.plan=null,e.planId=null,e.$on("InitFlightDesign",function(t,i){e.plan=i,e.planId=i.Id,e.entity.FlightPlanId=e.planId,e.taskIndex=1e6,r=new d,e.tempData=null,e.popup_add_title="Plan Items",e.popup_add_visible=!0}),e.IsReadonly=!1,e.IsEditView=!0,e.$on("InitFlightDesignView",function(t,i){e.plan=i,e.IsReadonly=!0,e.IsEditView=!1,e.planId=i.Id,e.entity.FlightPlanId=e.planId,e.taskIndex=1e6,r=new d,e.tempData=null,e.popup_add_title="Plan Items",e.popup_add_visible=!0})}]),app.controller("crewTimeReportController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.btn_search={text:"Search",type:"success",icon:"search",width:120,validationGroup:"ctrsearch",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.dg_flight_total_ds=null,e.dg_flight_ds=null;var i="From "+moment(e.dt_from).format("YYYY-MM-DD")+" to "+moment(e.dt_to).format("YYYY-MM-DD");e.dg_flight_total_instance.columnOption("date","caption",i),e.getCrewFlightsTotal(e.dt_from,e.dt_to)}},e.dt_to=(new Date).addDays(0),e.dt_from=(new Date).addDays(-30);var s=new Date(2019,10,30);s>e.dt_from&&(e.dt_from=s),e.date_from={type:"date",placeholder:"From",width:"100%",bindingOptions:{value:"dt_from"}},e.date_to={type:"date",placeholder:"To",width:"100%",bindingOptions:{value:"dt_to"}},e.formatMinutes=function(e){return pad(Math.floor(e/60)).toString()+":"+pad(e%60).toString()},e.getCrewFlightsTotal=function(t,i){e.loadingVisible=!0,a.getCrewFlightsTotal(t,i).then(function(t){e.loadingVisible=!1,$.each(t,function(t,i){i.FlightTime2=e.formatMinutes(i.FlightTime),i.FixTime2=e.formatMinutes(i.FixTime),i.BlockTime2=e.formatMinutes(i.BlockTime),i.SITATime2=e.formatMinutes(i.SITATime)}),e.dg_flight_total_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrewFlights=function(t,i,n){e.dg_flight_ds=null;var o=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0,a.getCrewFlights(t,i,n).then(function(t){console.log(t),e.loadingVisible=!1,$.each(t,function(t,i){i.Route=i.FromAirportIATA+"-"+i.ToAirportIATA,i.STA=new Date(i.STA).addMinutes(o),i.STD=new Date(i.STD).addMinutes(o),i.ChocksIn&&(i.ChocksIn=new Date(i.ChocksIn).addMinutes(o)),i.ChocksOut&&(i.ChocksOut=new Date(i.ChocksOut).addMinutes(o)),i.Takeoff&&(i.Takeoff=new Date(i.Takeoff).addMinutes(o)),i.Landing&&(i.Landing=new Date(i.Landing).addMinutes(o)),i.DurationH=Math.floor(i.FlightTime/60),i.DurationM=i.FlightTime%60;var n=60*i.FlightH+i.FlightM;i.FlightTime2=pad(Math.floor(n/60)).toString()+":"+pad(n%60).toString(),i.ScheduledFlightTime2=e.formatMinutes(i.ScheduledFlightTime);i.ActualFlightHOffBlock,i.ActualFlightMOffBlock;i.BlockTime2=e.formatMinutes(i.BlockTime),i.SITATime2=e.formatMinutes(i.SITATime),i.FixTime2=e.formatMinutes(i.FixTime),i.Duty2=pad(Math.floor(i.Duty/60)).toString()+":"+pad(i.Duty%60).toString(),i.FlightTimeActual2=e.formatMinutes(i.FlightTimeActual)}),e.dg_flight_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_flight_total_columns=[{name:"date",caption:"Date",columns:[{cellTemplate:function(e,t){$("<div style='text-align:center'/>").html(t.rowIndex+1).appendTo(e)},name:"row",caption:"#",width:50,fixed:!0,fixedPosition:"left",allowResizing:!1,cssClass:"rowHeader"},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",width:90,allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"Legs",caption:"Legs",allowResizing:!0,dataType:"number",allowEditing:!1,width:90,alignment:"center"},{dataField:"DH",caption:"DH",allowResizing:!0,dataType:"number",allowEditing:!1,width:90,alignment:"center"},{dataField:"LayOver",caption:"LO",allowResizing:!0,dataType:"number",allowEditing:!1,width:90,alignment:"center"},{dataField:"FlightTime2",caption:"Sch. FLT Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120,fixed:!0,fixedPosition:"right"},{dataField:"BlockTime2",caption:"Block Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"right"},{dataField:"SITATime2",caption:"SITA FLT Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120,fixed:!0,fixedPosition:"right"},{dataField:"FixTime2",caption:"Fix Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"right"}]}],e.dg_flight_total_selected=null,e.dg_flight_total_instance=null,e.dg_flight_total_ds=null,e.dg_flight_total={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-140,columns:e.dg_flight_total_columns,onContentReady:function(t){e.dg_flight_total_instance||(e.dg_flight_total_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];if(i){e.dg_flight_total_selected=i;var n=i.Name+" (From "+moment(e.dt_from).format("YYYY-MM-DD")+" to "+moment(e.dt_to).format("YYYY-MM-DD")+" )";e.dg_flight_instance.columnOption("crew","caption",n),e.getCrewFlights(e.dg_flight_total_selected.CrewId,e.dt_from,e.dt_to)}else e.dg_flight_ds=null,e.dg_flight_total_selected=null,e.dg_flight_instance.columnOption("crew","caption","Crew")},summary:{totalItems:[{name:"FlightTimeTotal",showInColumn:"FlightTime2",displayFormat:"{0}",summaryType:"custom"},{name:"SITATimeTotal",showInColumn:"SITATime2",displayFormat:"{0}",summaryType:"custom"},{name:"FixTimeTotal",showInColumn:"FixTime2",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"FlightTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.FlightTime,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"SITATimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.SITATime,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"FixTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.FixTime,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},export:{enabled:!0,fileName:"CREW_TOTAL_TIMES",allowExportSelectedData:!1},onToolbarPreparing:function(e){e.toolbarOptions.items.unshift({location:"before",template:function(){return $("<div/>").append("<span style='color:white;'>Total</span>")}})},onExporting:function(e){e.component.beginUpdate(),e.component.columnOption("row","visible",!1)},onExported:function(e){e.component.columnOption("row","visible",!0),e.component.endUpdate()},bindingOptions:{dataSource:"dg_flight_total_ds"}},e.dg_flight_columns=[{caption:"Crew",name:"crew",columns:[{cellTemplate:function(e,t){$("<div style='text-align:center'/>").html(t.rowIndex+1).appendTo(e)},name:"row",caption:"#",width:50,fixed:!0,fixedPosition:"left",allowResizing:!1,cssClass:"rowHeader"},{dataField:"IsPositioning",caption:"DH",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:60},{dataField:"Date",caption:"Date",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:120,format:"yy-MMM-dd"},{dataField:"FlightNumber",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!1,fixedPosition:"left"},{dataField:"Route",caption:"Route",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"STD",caption:"Dep.",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"STA",caption:"Arr.",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"ScheduledFlightTime2",caption:"Sch. FLT Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120,fixed:!0,fixedPosition:"right"},{dataField:"FlightTimeActual2",caption:"FLT Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"right"},{dataField:"BlockTime2",caption:"Block Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"right"},{dataField:"SITATime2",caption:"SITA FLT Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120,fixed:!0,fixedPosition:"right"},{dataField:"FixTime2",caption:"Fix Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90,fixed:!0,fixedPosition:"right"}]}],e.dg_flight_selected=null,e.dg_flight_instance=null,e.dg_flight_ds=null,e.dg_flight={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-140,columns:e.dg_flight_columns,onContentReady:function(t){e.dg_flight_instance||(e.dg_flight_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_flight_selected=i||null},summary:{totalItems:[{name:"BlockTimeTotal",showInColumn:"BlockTime2",displayFormat:"{0}",summaryType:"custom"},{name:"FlightTimeTotal",showInColumn:"ScheduledFlightTime2",displayFormat:"{0}",summaryType:"custom"},{name:"FlightTimeActualTotal",showInColumn:"FlightTimeActual2",displayFormat:"{0}",summaryType:"custom"},{name:"SITATimeTotal",showInColumn:"SITATime2",displayFormat:"{0}",summaryType:"custom"},{name:"FixTimeTotal",showInColumn:"FixTime2",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"FlightTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.ScheduledFlightTime,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"FlightTimeActualTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.FlightTimeActual,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"SITATimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.SITATime,
e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"FixTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.FixTime,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"BlockTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.BlockTime,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},export:{enabled:!0,fileName:"CREW_TIMES",allowExportSelectedData:!1},onToolbarPreparing:function(e){e.toolbarOptions.items.unshift({location:"before",template:function(){return $("<div/>").append("<span style='color:white;'>Legs</span>")}})},onExporting:function(e){e.component.beginUpdate(),e.component.columnOption("row","visible",!1)},onExported:function(e){e.component.columnOption("row","visible",!0),e.component.endUpdate()},onRowPrepared:function(e){e.data&&e.data.IsPositioning&&e.rowElement.css("background","#ffccff")},bindingOptions:{dataSource:"dg_flight_ds"}},l.isAuthorized()?(n.page_title="> Crew Times Report",$(".crewtimereport").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("$viewContentLoaded",function(){}),n.$broadcast("CrewTimeReportLoaded",null)}]),app.controller("airportAddController",["$scope","$location","airportService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.entity={Id:null,Name:null,IATA:null,ICAO:null,CityId:null},e.clearEntity=function(){e.entity.Id=null,e.entity.Name=null,e.entity.IATA=null,e.entity.ICAO=null,e.entity.CityId=null},e.bind=function(t){e.entity.Id=t.Id,e.entity.Name=t.Name,e.entity.IATA=t.IATA,e.entity.ICAO=t.ICAO,e.entity.CityId=t.CityId},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.sb_CityId={showClearButton:!0,width:"100%",searchEnabled:!0,dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.ODataStore({url:o.serviceUrl+"odata/cities/all",version:4}),sort:["City"]}),searchExpr:["City","Country"],valueExpr:"Id",searchMode:"startsWith",displayExpr:"FullName",bindingOptions:{value:"entity.CityId"}},e.txt_Name={hoverStateEnabled:!1,bindingOptions:{value:"entity.Name"}},e.txt_IATA={hoverStateEnabled:!1,bindingOptions:{value:"entity.IATA"}},e.txt_ICAO={hoverStateEnabled:!1,bindingOptions:{value:"entity.ICAO"}},e.sb_from={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceAirport(),onSelectionChanged:function(e){},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.SourceAirportId"}},e.sb_to={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceAirport(),onSelectionChanged:function(e){},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.DestinationAirportId"}},e.pop_width=600,e.pop_height=350,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Save",icon:"check",validationGroup:"airportadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();i.width<=600&&(e.pop_width=i.width,e.pop_height=i.height)},onShown:function(t){e.isNew,null!=e.tempData&&e.bind(e.tempData)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,o.$broadcast("onAirportHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.isNew&&(e.entity.Id=-1),e.loadingVisible=!0,i.save(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onAirportSaved",t),e.loadingVisible=!1,e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.tempData=null,e.$on("InitAddAirport",function(t,i){e.tempData=null,i.Id?(e.popup_add_title="Edit",e.tempData=i,e.isNew=!1):(e.isNew=!0,e.popup_add_title="New"),e.popup_add_visible=!0})}]),app.controller("crewassignregController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){try{l.isAuthorized()?n.page_title="> Crew":l.redirectToLogin(),e.prms=i.prms,e.IsCockpit=d.current.isCockpit?1:0,e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.selectedTabDateIndex=-1,e.tabsdatefirst=!0,e.$watch("selectedTabDateIndex",function(t){try{if(-1==e.selectedTabDateIndex)return;e.selectedTab=e.tabs_date[t],e.selectedDate=new Date(e.selectedTab.date),e.createGantt()}catch(e){alert("e1"),alert(e)}}),e.tabs_date=[],e.tabsdatevisible=!1,e.tabs_date_options={scrollByContent:!0,showNavButtons:!0,elementAttr:{class:"tabsdate"},onItemClick:function(e){},onItemRendered:function(t){e.selectedTabDateIndex=-1,e.selectedTabDateIndex=0},bindingOptions:{visible:"tabsdatevisible",dataSource:{dataPath:"tabs_date",deep:!0},selectedIndex:"selectedTabDateIndex"}},e.btn_search={type:"success",icon:"search",width:40,validationGroup:"assigncrewdate",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.fdpCrews=[],e.dg_calcrew_ds=null,e.dg_box_ds=null,e.assignedCrewDs=null,e.dg_calfdp_ds=null,e.cal_crew_ds=null,e.BeginSearch()}},e._datefrom=new Date,e.date_from={type:"date",placeholder:"From",width:"100%",displayFormat:"yyyy-MM-dd",bindingOptions:{value:"_datefrom"}},e.days_count=14,e.num_days={min:1,showSpinButtons:!1,bindingOptions:{value:"days_count"}},e.datefrom=null,e.dateEnd=null,e.dateto=null,e.BeginSearch=function(){e.cal_crew_current=General.getDayFirstHour(new Date(e._datefrom)),e.datefrom=General.getDayFirstHour(new Date(e._datefrom)),e.dateEnd=General.getDayLastHour(new Date(new Date(e._datefrom).addDays(e.days_count-1))),e.dateto=General.getDayLastHour(new Date(e._datefrom)),e.search()},e.search=function(){e.bindFlights(!1)},Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.baseDate=null,e.ganttData=null,e.resourceGroups=[],e.resources=[],e.dataSource=[],e.bindFlights=function(t){e.selectedTabDateIndex=-1;var i=-1*(new Date).getTimezoneOffset(),n=new Date(e._datefrom),o=new Date(n.addDays(e.days_count-1));e.plansDto={CustomerId:1,Date:n.ToUTC(),DateTo:o.ToUTC(),Offset:i,Design:!1,PlanId:-1},e.loadingVisible=!0,a.getPlanItemsGanttCrewAssignReg(e.plansDto).then(function(t){e.loadingVisible=!1,e.btn_crew_disabled=!1,e.tabsdatefirst=!0,e.tabs_date=[];var i;for(i=1;i<=e.days_count;i++){var a=moment(n).format("DD-MMM-YYYY");e.tabs_date.push({text:a,id:i,date:moment(n).format("YYYY/MM/DD")}),n=n.addDays(1)}e.tabsdatevisible=!0,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource2(t.flights),Flight.activeDatasource=e.dataSource,e.selectedTabDateIndex=0})},e.rebind=function(){var t=-1*(new Date).getTimezoneOffset(),i=new Date(e._datefrom),n=new Date(i.addDays(e.days_count-1));e.plansDto={CustomerId:1,Date:i.ToUTC(),DateTo:n.ToUTC(),Offset:t,Design:!1,PlanId:-1},e.loadingVisible=!0,a.getPlanItemsGanttCrewTest(e.plansDto).then(function(t){e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource2(t.flights),Flight.activeDatasource=e.dataSource,e.createGantt(),e.selectedBox=null,e.selectedBoxId=null,e.selectedIds=[],e.selectedItems=[]})},e.bindPosFlights=function(t){var i=new Date(General.getDayFirstHour(new Date(e.selectedDate))),n=new Date(General.getDayLastHour(new Date(e.selectedDate))),o=-1*(new Date).getTimezoneOffset(),l=new Date(e._datefrom);new Date(l.addDays(e.days_count-1));e.plansDto={CustomerId:1,Date:new Date(i.ToUTC()),DateTo:new Date(n.ToUTC()),Offset:o},e.loadingVisible=!0,a.getFlights(e.plansDto).then(function(i){e.loadingVisible=!1,t(i)})},e.bindFlightCrews=function(t,i){e.loadingVisible=!0,a.getFlightCrews(t).then(function(t){e.loadingVisible=!1,i(t)})},e.bindFlightFDPs=function(e,t){a.getFlightFDPs(e).then(function(e){t(e)})},e.addSelectedFlight=function(e){},e.timeCellWidth=0,e.selectedDate=null,e.createGantt=function(t){new Date(e.datefrom).yyyymmddtimenow(!1);t||(t=.24*$(window).width());var i=$("#resourceGanttba").data("ejGantt");i&&i.destroy(),e.StartNowLineTimerFirst=!0;var n=$(window).height()-139-50+50-38;n+="px";var a=General.getDayFirstHour(new Date(e.selectedDate)),o=General.getDayLastHour(new Date(e.selectedDate)),l=Enumerable.From(e.resources).Where(function(e){var t=new Date(e.DutyStartLocal),i=new Date(e.DutyEndLocal);return t>=a&&t<=o||i>=a&&i<=o}).ToArray();console.log("groups"),console.log(e.resourceGroups),console.log(l);var r=Enumerable.From(e.dataSource).Where(function(e){var t=new Date(e.DutyStartLocal),i=new Date(e.DutyEndLocal);return t>=a&&t<=o||i>=a&&i<=o}).ToArray();console.log("_data"),console.log(r),$("#resourceGanttba").ejGantt({scheduleStartDate:a,scheduleEndDate:o,taskbarBackground:"red",selectionMode:ej.Gantt.SelectionMode.Cell,selectionType:ej.Gantt.SelectionType.Single,taskbarClick:function(t){e.addSelectedFlight(t.data.item),$("#resourceGanttba").data("ejGantt").clearSelection()},dataSource:r,allowColumnResize:!0,isResponsive:!0,taskIdMapping:"taskId",taskNameMapping:"taskName",fromLocationMapping:"from",startDateMapping:"startDate",endDateMapping:"endDate",progressMapping:"progress",durationMapping:"duration",groupNameMapping:"Title",groupIdMapping:"groupId",groupCollection:e.resourceGroups,resources:l,resourceIdMapping:"resourceId",resourceNameMapping:"resourceName",resourceInfoMapping:"resourceId",notesMapping:"notes",rightTaskLabelMapping:"taskName",baselineStartDateMapping:"BaselineStartDate",baselineEndDateMapping:"BaselineEndDate",highlightWeekEnds:!0,includeWeekend:!1,rowHeight:50,taskbarHeight:30,predecessorMapping:"predecessor",allowGanttChartEditing:!1,allowDragAndDrop:!0,editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,editMode:"normal"},splitterSettings:{position:140},toolbarSettings:{showToolbar:!1,toolbarItems:[ej.Gantt.ToolbarItems.Add,ej.Gantt.ToolbarItems.Delete,ej.Gantt.ToolbarItems.Update,ej.Gantt.ToolbarItems.Cancel,ej.Gantt.ToolbarItems.ExpandAll,ej.Gantt.ToolbarItems.CollapseAll,ej.Gantt.ToolbarItems.NextTimeSpan,ej.Gantt.ToolbarItems.PrevTimeSpan]},load:function(){e.ganttCreated=!0,this.getColumns()[0].width=140},create:function(t){try{$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(1e6),$(".e-scrollbar.e-js.e-widget.e-hscrollbar").remove(),e.renderTopTimeHeader(),e.renderTimeHeader(),$(".e-ganttviewerbodyContianer-stripLines").css("z-index",0),e.timeCellWidth=$(".e-schedule-day-headercell-content").width();var i=new Date,n=new Date(a),l=new Date(o);i.getTime()>=n.getTime()&&(i.getTime(),l.getTime())}catch(e){alert(e)}},cellSelecting:function(e){e&&"resourceTask"!=e.data.eResourceTaskType&&(e.cancel=!0)},cellSelected:function(t){$(".e-gantt-taskbarSelection").removeClass("e-gantt-taskbarSelection"),e.setSelectedResource(t.data)},actionBegin:function(e){e.requestType&&"beginedit"==e.requestType&&(e.cancel=!0)},actionComplete:function(t){"save"==t.requestType&&(e.doActionCompleteSave?setTimeout(function(){$("#resourceGanttba").data("ejGantt")._$ganttchartHelper.ejGanttChart("selectTaskbar",t.modifiedRecord)},100):e.doActionCompleteSave=!0)},workingTimeScale:"TimeScale24Hours",durationUnit:ej.Gantt.DurationUnit.Hour,scheduleHeaderSettings:{scheduleHeaderType:ej.Gantt.ScheduleHeaderType.Day,dayHeaderFormat:"dd-MM-yyyy",minutesPerInterval:ej.Gantt.minutesPerInterval.Auto,timescaleStartDateMode:ej.Gantt.TimescaleRoundMode.Auto,timescaleUnitSize:t+"%"},taskbarTemplate:"#taskbarTemplateBoxNew",leftTaskLabelTemplate:"#leftlableTemplate",viewType:ej.Gantt.ViewType.ResourceView,sizeSettings:{height:n},groupSettings:{},showStackedHeader:!1,taskSchedulingMode:ej.Gantt.TaskSchedulingMode.Manual,enableTaskbarTooltip:!1,enableContextMenu:!0,contextMenuItems:[],contextMenuClick:function(e){},contextMenuOpen:function(t){if("resourceChildTask"!=t.item.eResourceTaskType)return void(t.cancel=!0);var i=-1,n=$(t.targetElement.target);if(n.hasClass("div-flight"))i=n.data("flightid");else{i=n.closest(".div-flight").data("flightid")}if(!t.item.item.IsBox)return void(t.cancel=!0);t.contextMenuItems=i?[{headerText:"Flight Crews",menuId:"flightcrews",eventHandler:function(t){e.$apply(function(){e.popup_fc_visible=!0})}}]:[{headerText:"Information",menuId:"information",eventHandler:function(e){}}]}})},e.ganttCreated=!1,e.renderTopTimeHeader=function(){var e=$(".e-schedule-week-headercell-content");$.each(e,function(e,t){var i=$(t),n=i.html().split("(")[0],a=Number(n.split("-")[2]),o=n.split("-"),l=o[1],r=o[0],d=new Date(a+"/"+l+"/"+r),s=n+" ("+new persianDate(d).format("DD/MM/YYYY")+")";i.html(s)})},e.renderTimeHeader=function(){var t=$(".e-schedule-day-headercell-content");$.each(t,function(t,i){var n=$(i),a=n.html(),o=Number(n.html());n.find("span").length>0&&(a=$(n.find("span")[1]).html(),o=Number(a));var l=0;e.IsUTC,l=getUTCHour(o);var r="<span style='font-size:10px;display:block;color:gray;text-align:left;padding-left:2px'>"+l+"</span><span style='font-size:13px;display:block;position:relative;top:-5px'>"+a+"</span>";n.html(r)})},e.selectedIds=[],e.selectedItems=[],e.selectedBox=null,e.selectedBoxId=null,e.selectedBoxChanged=function(){if(e.selectedBox){var t=[];$.each(e.selectedBox.BoxItems,function(i,n){0==i&&(e.SourceLocation=n.FromAirportIATA),t.push(n.FlightNumber+" ("+n.FromAirportIATA+"-"+n.ToAirportIATA+")")})}},e.selectedIdsChanged=function(){e.$apply(function(){e.selectedBox=null,e.selectedBoxId=null,e.AssignedCrew="Assigned Crew",e.dg_crew_ds=[],e.dg_sum_ds=[]})},e.$watch("selectedBox",function(){try{e.selectedBoxChanged()}catch(e){alert("e2"),alert(e)}}),e.btn_box={type:"default",icon:"plus",width:40,onClick:function(t){if(!(e.selectedIds.length<1)){if(e.selectedIds.length>10)return void General.ShowNotify("Invalid sector counts","error");var i=(Enumerable.From(e.selectedItems).Select("$.CalendarId").Distinct().ToArray(),{ids:e.selectedIds,cid:e.selectedItems[0].CalendarId});e.loadingVisible=!0,a.boxItems(i).then(function(t){e.loadingVisible=!1,e.rebind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}},e.btn_unbox={type:"danger",icon:"close",width:40,onClick:function(t){if(e.selectedBox){var i={id:e.selectedBox.BoxId};e.loadingVisible=!0,a.unboxItems(i).then(function(t){e.loadingVisible=!1,e.rebind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}},e.btn_crew_disabled=!0,e.btn_crew={text:"Assign Crew",type:"default",icon:"group",width:160,bindingOptions:{disabled:"btn_crew_disabled"},onClick:function(t){e.popup_crew_visible=!0}},e.btn_cal={text:"Calendar",type:"default",icon:"event",width:140,onClick:function(t){e.popup_cal_visible=!0}},e.btn_details={text:"Details",type:"default",icon:"event",width:120,onClick:function(t){if(!e.selectedBox)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.popup_fdp_details_visible=!0}},e.btn_pos={text:"Positioning",type:"default",icon:"map",width:160,onClick:function(t){e.popup_pos_visible=!0}},e.btn_fc={text:"Flight Crews",type:"default",icon:"airplane",width:170,onClick:function(t){e.popup_fc_visible=!0}},e.crewGroup=e.IsCockpit?"Cockpit":"Cabin",e.sb_cabin={showClearButton:!1,searchEnabled:!1,height:35,disabled:!0,dataSource:["Cockpit","Cabin"],onValueChanged:function(t){if(!t.value)return void(e.dg_crew_ds=null);e.dg_box_keys&&e.dg_box_keys.length>0&&e.bindValidCrew(e.dg_box_selected.BoxId,1,"Cockpit"==t.value?1:0)},bindingOptions:{value:"crewGroup"}},e.dg_crew_columns=[{dataField:"ScheduleName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120},{dataField:"Id",caption:"",width:70,allowFiltering:!1,allowSorting:!1,cellTemplate:"addCrewTemplate"}],e.dg_crew_selected=null,e.dg_crew_instance=null,e.dg_crew_ds=null,e.dg_crew={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-200-160},columns:e.dg_crew_columns,onContentReady:function(t){e.dg_crew_instance||(e.dg_crew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew_selected=i||null},onRowPrepared:function(e){e.data&&-1!=e.data.StandById&&e.rowElement.css("background","#ffff80")},bindingOptions:{dataSource:"dg_crew_ds"}},e.dg_fcrew_columns=[{caption:"Crew",columns:[{dataField:"IsPositioning",caption:"DH",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:60},{dataField:"Position",caption:"Position",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FDPTitle",caption:"FDP",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:250},{dataField:"Sex",caption:"Gender",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120}]}],e.dg_fcrew_selected=null,e.dg_fcrew_instance=null,e.dg_fcrew_ds=null,e.dg_fcrew={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-370},columns:e.dg_fcrew_columns,onContentReady:function(t){e.dg_fcrew_instance||(e.dg_fcrew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_fcrew_selected=i||null},onRowPrepared:function(e){e.data&&e.data.IsPositioning&&e.rowElement.css("background","#ffccff")},bindingOptions:{dataSource:"dg_fcrew_ds"}},e.dg_ffdp_columns=[{caption:"FDPs",columns:[{dataField:"FDPTitle",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"DutyStartLocal",caption:"Start",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170},{dataField:"DutyEndLocal",caption:"End",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170}]}],e.dg_ffdp_selected=null,e.dg_ffdp_instance=null,e.dg_ffdp_ds=null,e.dg_ffdp={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return 250},columns:e.dg_ffdp_columns,onContentReady:function(t){e.dg_ffdp_instance||(e.dg_ffdp_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_ffdp_selected=i||null},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_ffdp_ds"}},e.dg_box_columns=[{dataField:"Flights",caption:"Flights",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_box_selected=null,e.dg_box_instance=null,e.dg_box_ds=null,e.dg_box_keys=null,e.dg_box={keyExpr:"BoxId",wordWrapEnabled:!0,headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-115},columns:e.dg_box_columns,onContentReady:function(t){e.dg_box_instance||(e.dg_box_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_box_selected=i,e.bindAssignedCrew(i),e.dg_crew_ds=null,e.bindValidCrew(i.BoxId,1,e.IsCockpit?1:0)):(e.dg_box_selected=null,e.assignedCrewDs=null)},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_box_ds",selectedRowKeys:"dg_box_keys"}},e.dg_calcrew_columns=[{dataField:"ScheduleName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120},{dataField:"GroupOrder",caption:"O",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120,visible:!1}],e.dg_calcrew_selected=null,e.dg_calcrew_instance=null,e.dg_calcrew_ds=null,e.dg_calcrew={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-114},columns:e.dg_calcrew_columns,onContentReady:function(t){e.dg_calcrew_instance||(e.dg_calcrew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_calcrew_selected=i,e.cal_change()):e.dg_calcrew_selected=null},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_calcrew_ds"}},e.dg_calfdp_columns=[{dataField:"DutyStart",caption:"Date",allowResizing:!0,alignment:"left",dataType:"date",allowEditing:!1,width:110},{dataField:"FDPTitle",caption:"Duty",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FDPRemark",caption:"Duration",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:110},{dataField:"Id",caption:"",width:65,allowFiltering:!1,allowSorting:!1,cellTemplate:"addFDPTemplate"}],e.dg_calfdp_selected=null,e.dg_calfdp_instance=null,e.dg_calfdp_ds=null,e.dg_calfdp={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-114},columns:e.dg_calfdp_columns,onContentReady:function(t){e.dg_calfdp_instance||(e.dg_calfdp_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_calfdp_selected=i,e.cal_change()):e.dg_calfdp_selected=null},onRowPrepared:function(e){e.data&&-1!=e.data.StandById&&e.rowElement.css("background","#ffff80")},bindingOptions:{dataSource:"dg_calfdp_ds"}},e.cal_crew_current=new Date,e.$watch("cal_crew_current",function(t,i,n){try{e.cal_change()}catch(e){alert("e3"),alert(e)}}),e.assign1168=function(t){e.event_status=1168,e.FromDateEvent=new Date(e.contextMenuCellData.startDate).setHours(0,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addMinutes(720),e.popup_event_title="StandBy AM",e.popup_event_visible=!0},e.assign1167=function(t){e.event_status=1167,e.FromDateEvent=new Date(e.contextMenuCellData.startDate).setHours(12,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addMinutes(720),e.popup_event_title="StandBy PM",e.popup_event_visible=!0},e.assign5000=function(t){e.event_status=5e3,e.FromDateEvent=new Date(e.contextMenuCellData.startDate).setHours(8,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addMinutes(240),e.popup_event_title="Training",e.popup_event_visible=!0},e.assign5001=function(t){e.event_status=5001,e.FromDateEvent=new Date(e.contextMenuCellData.startDate).setHours(8,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addMinutes(540),e.popup_event_title="Office",e.popup_event_visible=!0},e.assign10000=function(t){e.event_status=1e4,e.FromDateEvent=new Date(e.contextMenuCellData.startDate).setHours(20,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addHours(36),e.popup_event_title="Day Off",e.popup_event_visible=!0},e.cellContextMenuItems=[{text:"Assign Day Off",onItemClick:e.assign10000,template:"<table><tr><td style='vertical-align:middle;'><div class='duty-10000' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Day Off</td></tr></table>"},{text:"Assign Stan By AM",onItemClick:e.assign1168,template:"<table><tr><td style='vertical-align:middle;'><div class='duty-1168' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Stand By AM</td></tr></table>"},{text:"Assign Stan By PM",onItemClick:e.assign1167,template:"<table><tr><td style='vertical-align:middle;'><div class='duty-1167' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Stand By PM</td></tr></table>"},{text:"Assign Office",onItemClick:e.assign5001,template:"<table><tr><td style='vertical-align:middle;'><div class='duty-5001' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Office</td></tr></table>"},{text:"Assign Training",onItemClick:e.assign5000,template:"<table><tr><td style='vertical-align:middle;'><div class='duty-5000' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Training</td></tr></table>"}],e.cellContextMenuOptions={target:".dx-scheduler-date-table-cell",dataSource:e.cellContextMenuItems,width:200,onShowing:function(t){e.dg_calcrew_selected||(t.cancel=!0);var i=new Date(e.contextMenuCellData.startDate),n=new Date(e.dg_calcrew_selected.DateInactiveBegin),a=new Date(e.dg_calcrew_selected.DateInactiveEnd);i>=n&&i<=a&&(t.cancel=!0)},onItemClick:function(t){e.dg_calcrew_selected&&t.itemData.onItemClick(t.itemData)}},e.cal_crew_ds=null,e.cal_crew_instance=null,e.cal_crew={editing:{allowAdding:!1,allowDeleting:!1,allowDragging:!1,allowResizing:!1,allowUpdating:!1},textExpr:"Flights",startDateExpr:"DutyStartLocal",endDateExpr:"DutyEndLocal",views:["month","day"],currentView:"month",startDayHour:0,appointmentTemplate:"appointmentTemplate",appointmentTooltipTemplate:"tooltip-template",dataCellTemplate:"dataCellTemplate",height:function(){return $(window).height()-115-31},onContentReady:function(t){e.cal_crew_instance||(e.cal_crew_instance=t.component)},optionChanged:function(e){},onAppointmentClick:function(e){if($(e.event.target).hasClass("cellposition"))return void(e.cancel=!0)},onAppointmentDblClick:function(e){e.cancel=!0},onCellContextMenu:function(t){e.contextMenuCellData=t.cellData},bindingOptions:{currentDate:"cal_crew_current",dataSource:"cal_crew_ds"}},e.getDutyClass=function(e){switch(e.DutyType){case 1165:return"duty-1165";default:return"duty-"+e.DutyType}},e.getCaption=function(e){switch(e.DutyType){case 5e3:return"TRN";case 5001:return"OFC";case 1167:return"PM";case 1168:return"AM";case 1e4:return"OFF";default:return"DTY"}},e.getDataCellTemplateClass=function(t){if(!e.dg_calcrew_selected)return"";var i=new Date(t.startDate),n=new Date(e.dg_calcrew_selected.DateInactiveBegin),a=new Date(e.dg_calcrew_selected.DateInactiveEnd);return i>=n&&i<=a?"inactive-cell":""},e.getPosition=function(e){switch(e){case"Captain":return"CPT";case"Purser":return"PU";case"SCCM(i)":case"ISCCM":return"SCI";default:return e}},e.cellPositionClicked=function(e){},e.bindValidCrew=function(t,i,n){e.loadingVisible=!0,a.getValidCrew(t,i,n).then(function(t){e.loadingVisible=!1,e.dg_crew_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.bindValidPosCrew=function(t,i,n){e.loadingVisible=!0,a.getValidCrew(t,i,n).then(function(t){e.loadingVisible=!1,e.dg_pos_crew_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.bindValidFDP=function(t,i,n){e.loadingVisible=!0,a.getValidFDP(t,i,n).then(function(t){e.loadingVisible=!1,e.dg_calfdp_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.popup_crew_visible=!1,e.popup_crew={width:function(){return 850},height:function(){return $(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",text:"Profile",icon:"card",onClick:function(e){}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_crew_visible=!1}},toolbar:"bottom"}],position:"right",visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.crewGroup=e.IsCockpit?"Cockpit":"Cabin";var i=Enumerable.From(e.dataSource).Where("$.IsBox").OrderBy("$.STD").ToArray();e.dg_box_ds=i,e.dg_box_keys=[],e.dg_box_keys.push(e.selectedBox.BoxId)},onHiding:function(){e.crewGroup=null,e.assignedCrewDs=null,e.dg_crew_ds=null,e.dg_box_instance.clearSelection(),e.createGantt(),e.popup_crew_visible=!1},bindingOptions:{visible:"popup_crew_visible"}},e.dg_details_columns=[{dataField:"ScheduleName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Id",caption:"Flights",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,cellTemplate:"detailTemplate"}],e.dg_details_selected=null,e.dg_details_instance=null,e.dg_details_ds=null,e.dg_details={onCellClick:function(e){},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"none"},height:"480",columns:e.dg_details_columns,onContentReady:function(t){e.dg_details_instance||(e.dg_details_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_details_selected=i||null},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_details_ds"}},e.dg_pos_crew_columns=[{dataField:"ScheduleName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120},{dataField:"Id",caption:"",width:70,allowFiltering:!1,allowSorting:!1,cellTemplate:"addPosCrewTemplate"}],e.dg_pos_crew_selected=null,e.dg_pos_crew_instance=null,e.dg_pos_crew_ds=null,e.dg_pos_crew={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-330},columns:e.dg_pos_crew_columns,onContentReady:function(t){e.dg_pos_crew_instance||(e.dg_pos_crew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_pos_crew_selected=i||null},onRowPrepared:function(e){
e.data&&-1!=e.data.StandById&&e.rowElement.css("background","#ffff80")},bindingOptions:{dataSource:"dg_pos_crew_ds"}},e.dg_pos_flights_columns=[{caption:"Positioning Flights",columns:[{dataField:"taskName",caption:"Flight",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Register",caption:"Reg.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"DepartureLocal",caption:"Departure",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170},{dataField:"ArrivalLocal",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170}]}],e.dg_pos_flights_selected=null,e.dg_pos_flights_instance=null,e.dg_pos_flights_ds=null,e.dg_pos_flights={onCellClick:function(e){},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"multiple"},height:function(){return $(window).height()-400},columns:e.dg_pos_flights_columns,onContentReady:function(t){e.dg_pos_flights_instance||(e.dg_pos_flights_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData;e.dg_pos_flights_selected=i;var n=Enumerable.From(i).Select("$.ID").ToArray();e.dg_main_flights_ds=Enumerable.From(e.posFlights).Where(function(e){var t=e.ID;return-1==n.indexOf(t)}).ToArray()},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_pos_flights_ds"}},e.dg_main_flights_columns=[{caption:"Main Flights",columns:[{dataField:"taskName",caption:"Flight",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Register",caption:"Reg.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"DepartureLocal",caption:"Departure",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170},{dataField:"ArrivalLocal",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170}]}],e.dg_main_flights_selected=null,e.dg_main_flights_instance=null,e.dg_main_flights_ds=null,e.dg_main_flights={onCellClick:function(e){},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"multiple"},height:function(){return 270},columns:e.dg_main_flights_columns,onContentReady:function(t){e.dg_main_flights_instance||(e.dg_main_flights_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData;e.dg_main_flights_selected=i;var n=Enumerable.From(i).Select("$.ID").ToArray();e.dg_pos_flights_ds=Enumerable.From(e.posFlights).Where(function(e){var t=e.ID;return-1==n.indexOf(t)}).ToArray()},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_main_flights_ds"}},e.dg_fc_columns=[{caption:"Flights",columns:[{dataField:"MatchingListErrors",caption:"ML",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:35,cellTemplate:function(e,t){t.value>0&&$("<div>").append('<i class="fas fa-puzzle-piece" style="font-size:13px;position: relative;left:0px;top:-1px;color:red"></i>').appendTo(e)}},{dataField:"MaleFemalError",caption:"MF",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:37,cellTemplate:function(e,t){t.value>0&&$("<div>").append('<i class="fas fa-restroom" style="font-size:13px;position: relative;left:-2px;top:-1px;color:red"></i>').appendTo(e)}},{dataField:"taskName",caption:"Flight",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Register",caption:"Reg.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"DepartureLocal",caption:"Departure",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170},{dataField:"ArrivalLocal",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170}]}],e.dg_fc_selected=null,e.dg_fc_instance=null,e.dg_fc_ds=null,e.dg_fc={onCellClick:function(e){},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},height:function(){return $(window).height()-115},columns:e.dg_fc_columns,onContentReady:function(t){e.dg_fc_instance||(e.dg_fc_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_fc_selected=i,e.bindFlightCrews(i.ID,function(t){e.dg_fcrew_ds=t,e.bindFlightFDPs(i.ID,function(t){e.dg_ffdp_ds=t})})):(e.dg_fc_selected=null,e.dg_fcrew_ds=null,e.dg_ffdp_ds=null)},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_fc_ds"}},e.on_visible=!1,e.off_visible=!1,e.getTileFlightClass=function(e){var t="tile-flight off";return e.IsOff||(t="tile-flight on"),1==e.selected&&(t+=" selected"),t},e.selectedTileFlight=null,e.tileFlightClicked=function(t){var i=e.dg_details_ds;$.each(i,function(e,i){$.each(i.Items,function(e,i){i.Id!=t.Id&&(i.selected=!1)})}),t.selected=!t.selected,e.on_visible=!1,e.off_visible=!1,t.selected&&!t.IsCanceled&&(e.on_visible=t.IsOff,e.off_visible=!t.IsOff,e.selectedTileFlight=t)},e.popup_fdp_details_visible=!1,e.popup_fdp_details={width:function(){return 1100},height:function(){return 600},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",text:"Notify",onClick:function(t){e.loadingVisible=!0,a.notifyFDPCrew(e.selectedBoxId).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success")},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"On",icon:"airplane",onClick:function(t){e.selectedTileFlight.IsOff=null,e.on_visible=e.selectedTileFlight.IsOff,e.off_visible=!e.selectedTileFlight.IsOff}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Off",icon:"airplane",onClick:function(t){e.selectedTileFlight.IsOff=!0,e.on_visible=e.selectedTileFlight.IsOff,e.off_visible=!e.selectedTileFlight.IsOff}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"save",onClick:function(t){var i=[];$.each(e.dg_details_ds,function(e,t){var n=Enumerable.From(t.Items).Where("$.IsOff!=$._IsOff").ToArray();if(n.length>0){var a={};a.FDPId=t.Id;var o=[];$.each(n,function(e,t){var i=!!t.IsOff,n={FDPItem:t.Id,Off:i};o.push(n)}),a.Items=o,i.push(a)}}),i.length>0&&(e.loadingVisible=!0,a.offFlights(i,function(){e.loadingVisible=!1,e.popup_fdp_details_visible=!1}))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_fdp_details_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.loadingVisible=!0,a.getFDPChildren(e.selectedBoxId).then(function(t){e.loadingVisible=!1,$.each(t.children,function(e,t){$.each(t.Items,function(e,t){t.selected=!1,t._IsOff=t.IsOff})}),e.dg_details_ds=t.children},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},onHiding:function(){e.popup_fdp_details_visible=!1},bindingOptions:{visible:"popup_fdp_details_visible","toolbarItems[1].visible":"on_visible","toolbarItems[2].visible":"off_visible"}},e.popup_pos_visible=!1,e.posFDP=null,e.posFDPSaved=!1,e.popup_pos={width:function(){return $(window).width()},height:function(){return $(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",text:"Create FDP",icon:"airplane",onClick:function(t){var i=[],n=[];$.each(e.dg_pos_flights_selected,function(e,t){i.push(t.ID),n.push(t.ID)}),$.each(e.dg_main_flights_selected,function(e,t){i.push(t.ID)});var o={ids:i,cid:-1,posIds:n};e.loadingVisible=!0,a.createFDP(o).then(function(t){e.loadingVisible=!1,e.posFDP=t,e.posFDPSaved=!1,e.dg_pos_crew_ds=null,e.bindValidPosCrew(e.posFDP.Id,1,e.IsCockpit?1:0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"save",onClick:function(t){if(e.assignedPosCrewDs&&e.assignedPosCrewDs.length>0){var i=[];$.each(e.assignedPosCrewDs,function(e,t){var n={fdp:t.fdpId,crew:t.CrewId,position:t.PositionId,stby:t.StandById};i.push(n)}),e.loadingVisible=!0,a.saveAssignFDPToCrews(i).then(function(t){e.loadingVisible=!1,e.crewFDPs=[],e.posFDPSaved=!0,e.popup_pos_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_pos_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.bindPosFlights(function(t){e.posFlights=t;var i=Enumerable.From(t).ToArray(),n=Enumerable.From(t).ToArray();e.dg_pos_flights_ds=i,e.dg_main_flights_ds=n})},onHiding:function(){if(!e.posFDPSaved&&e.posFDP){var t={id:e.posFDP.Id};a.unboxItems(t).then(function(t){e.posFDP=null,e.posFDPSaved=!1,e.dg_pos_flights_ds=null,e.dg_main_flights_ds=null,e.dg_main_flights_selected=null,e.dg_pos_flights_selected=null,e.popup_pos_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else e.posFDP=null,e.posFDPSaved=!1,e.dg_pos_flights_ds=null,e.dg_main_flights_ds=null,e.dg_main_flights_selected=null,e.dg_pos_flights_selected=null,e.rebind(),e.popup_pos_visible=!1},bindingOptions:{visible:"popup_pos_visible"}},e.popup_fc_visible=!1,e.popup_fc={width:function(){return $(window).width()},height:function(){return $(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_fc_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.bindPosFlights(function(t){e.dg_fc_ds=t})},onHiding:function(){e.dg_fc_ds=[],e.popup_fc_visible=!1},bindingOptions:{visible:"popup_fc_visible"}},e.popup_cal_visible=!1,e.btn_crewlist_visible=!1,e.btn_duties_visible=!0;e.popup_cal={width:function(){return 1400},height:function(){return $(window).height()},fullScreen:!0,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"FDPs",icon:"airplane",onClick:function(t){e.btn_duties_visible=!1,e.btn_crewlist_visible=!0,e.dg_calfdp_ds=null,$(".dgcalcrew").fadeOut("200",function(){$(".dgcalfdp").fadeIn("200",function(){var t=new Date(e.cal_crew_current).getDatePartArray();if(e.dg_calcrew_selected){var i=e.dg_calcrew_selected.Id;e.bindValidFDP(i,t[0],t[1]+1)}})})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Crew List",icon:"group",onClick:function(t){e.btn_crewlist_visible=!1,e.btn_duties_visible=!0,$(".dgcalfdp").fadeOut("200",function(){$(".dgcalcrew").fadeIn("200",function(){})})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_cal_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.bind_calcrew(),e.cal_change()},onHiding:function(){e.btn_crewlist_visible=!1,e.btn_duties_visible=!0,$(".dgcalfdp").hide(),$(".dgcalcrew").show(),e.cal_crew_ds=[],e.cal_crew_instance&&e.cal_crew_instance.repaint(),e.rebind(),e.popup_cal_visible=!1},bindingOptions:{visible:"popup_cal_visible","toolbarItems[0].visible":"btn_duties_visible","toolbarItems[1].visible":"btn_crewlist_visible"}},e.FromDateEvent=null,e.ToDateEvent=null,e.date_from_event={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"FromDateEvent"}},e.date_to_event={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"ToDateEvent"}},e.event_status=null,e.popup_event_visible=!1,e.popup_event_title="",e.popup_event={width:300,height:260,position:"left top",fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Ok",icon:"check",validationGroup:"eventadd2",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i=e.dg_calcrew_selected.Id;1e4==e.event_status&&(e.loadingVisible=!0,a.IsRERRPValid(i,new Date(e.FromDateEvent),new Date(e.ToDateEvent)).then(function(t){if(e.loadingVisible=!1,t)General.ShowNotify(t,"error");else{var n={DateStart:new Date(e.FromDateEvent),DateEnd:new Date(e.ToDateEvent),CityId:-1,CrewId:i,DutyType:e.event_status};e.loadingVisible=!0,a.saveDuty(n).then(function(t){e.loadingVisible=!1,e.fdpCrews=[];var i=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();$.each(i,function(e,t){t.Synced=!1}),e.cal_crew_ds.push(t),e.cal_crew_instance.repaint(),e.popup_event_visible=!1,e.btn_crewlist_visible&&e.refreshValidFDP()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})),1167!=e.event_status&&1168!=e.event_status&&5e3!=e.event_status&&5001!=e.event_status||(e.loadingVisible=!0,a.IsEventValid(i,new Date(e.FromDateEvent),new Date(e.ToDateEvent),e.event_status).then(function(t){if(e.loadingVisible=!1,t)General.ShowNotify(t,"error");else{var n={DateStart:new Date(e.FromDateEvent),DateEnd:new Date(e.ToDateEvent),CityId:-1,CrewId:i,DutyType:e.event_status};e.loadingVisible=!0,a.saveDuty(n).then(function(t){e.loadingVisible=!1,e.fdpCrews=[];var i=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();$.each(i,function(e,t){t.Synced=!1}),e.cal_crew_ds.push(t),e.cal_crew_instance.repaint(),e.popup_event_visible=!1,e.btn_crewlist_visible&&e.refreshValidFDP()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.ToDateEvent=null,e.FromDateEvent=null,e.event_status=null},bindingOptions:{visible:"popup_event_visible",title:"popup_event_title"}},e.popup_event.toolbarItems[1].options.onClick=function(t){e.popup_event_visible=!1},e.crewFDPs=[],e.cal_change=function(){if(e.cal_crew_current&&e.dg_calcrew_selected){var t=new Date(e.cal_crew_current).getDatePartArray(),i=e.dg_calcrew_selected.Id;e.getCrewFDPs(t[0],t[1]+1,i,function(t){e.cal_crew_ds=t})}},e.getCrewFDPs=function(t,i,n,o){if(n){var l=Enumerable.From(e.crewFDPs).Where("$.CrewId=="+n+" && $.DateStartYear=="+t+" && $.DateStartMonth=="+i).FirstOrDefault();l?o(l.FDPs):(e.loadingVisible=!0,a.getCrewFDPByYearMonth(n,t,i).then(function(a){e.loadingVisible=!1;var l={CrewId:n,DateStartYear:t,DateStartMonth:i,FDPs:a};e.crewFDPs.push(l),o(a)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))}else o(null)},e.fdpCrews=[],e.bindAssignedCrew=function(t){var i=t.BoxId;if(!t.HasCrew)return void(e.assignedCrewDs=null);if(t.Synced){var n=Enumerable.From(e.fdpCrews).Where("$.Id=="+i).FirstOrDefault();return void(e.assignedCrewDs=Enumerable.From(n.crew).ToArray())}a.getFDPAssignedCrew(i).then(function(n){if(t.Synced=!0,n&&n.length>0){var a={Id:i,crew:[]};e.fdpCrews.push(a),$.each(n,function(e,t){t.fdpId=a.Id,a.crew.push(t)}),e.assignedCrewDs=Enumerable.From(a.crew).ToArray()}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.assignedCrewDs=[],e.assignedPosCrewDs=[],e.positions=[{title:"P1",ds:["Captain","FO","SO","TO"]},{title:"P2",ds:["FO","SO","TO"]},{title:"TRI",ds:["Captain","TRI","FO","SO","TO"]},{title:"TRE",ds:["Captain","TRE","FO","SO","TO"]},{title:"LTC",ds:["Captain","TRI","TRE","FO","SO","TO"]},{title:"CCM",ds:["FA"]},{title:"SCCM",ds:["Purser","FA"]},{title:"SCCM(i)",ds:["ISCCM","Purser","FA"]},{title:"ISCCM",ds:["ISCCM","Purser","FA"]}],e.positionIds=[{id:1160,title:"Captain"},{id:1161,title:"FO"},{id:1162,title:"SO"},{id:1163,title:"TO"},{id:1205,title:"TRI"},{id:1206,title:"TRE"},{id:1158,title:"FA"},{id:1157,title:"Purser"},{id:10002,title:"ISCCM"}],e.IsCockpitCrew=function(e){return"Purser"!=e.Position&&"FA"!=e.Position&&"SCCM(i)"!=e.Position&&"ISCCM"!=e.Position},e.IsCrewTileEditable=function(t){return e.IsCockpitCrew(t)==!!e.IsCockpit},e.setDefaultPosition=function(t){var i=Enumerable.From(e.positions).Where('$.title=="'+t.JobGroup+'"').FirstOrDefault(),n=i.ds[0],a=Enumerable.From(e.positionIds).Where('$.title=="'+n+'"').FirstOrDefault().id;t.Position=n,t.PositionId=a},e.getDefaultPosition=function(t){var i=Enumerable.From(e.positions).Where('$.title=="'+t+'"').FirstOrDefault(),n=i.ds[0];return Enumerable.From(e.positionIds).Where('$.title=="'+n+'"').FirstOrDefault().id},e.addFDP=function(t){var i=t.data.Id,n=Enumerable.From(e.dg_calfdp_ds).Where("$.Id=="+i).FirstOrDefault(),o=e.dg_calcrew_selected.Id,l=e.getDefaultPosition(e.dg_calcrew_selected.JobGroup),r={fdp:n.Id,crew:o,position:l,stby:n.StandById};e.loadingVisible=!0,a.saveAssignFDPToCrew2(r).then(function(t){e.loadingVisible=!1,e.fdpCrews=[];var i=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();$.each(i,function(e,t){t.Synced=!1}),e.cal_crew_ds.push(t),e.cal_crew_instance.repaint(),e.dg_calfdp_ds=null;var n=new Date(e.cal_crew_current).getDatePartArray();e.bindValidFDP(o,n[0],n[1]+1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.addCrew=function(t){var i=t.data.Id,n=Enumerable.From(e.fdpCrews).Where("$.Id=="+e.dg_box_selected.BoxId).FirstOrDefault();n||(n={Id:e.dg_box_selected.BoxId,crew:[]},e.fdpCrews.push(n));var o=Enumerable.From(e.dg_crew_ds).Where("$.Id=="+i).FirstOrDefault(),l=JSON.parse(JSON.stringify(o));l.CrewId=i,e.setDefaultPosition(l),l.fdpId=n.Id;var r={fdp:n.Id,crew:i,position:l.PositionId,stby:l.StandById};e.loadingVisible=!0,a.saveAssignFDPToCrew(r).then(function(t){var a=t.fdp;e.loadingVisible=!1,e.crewFDPs=[],l.Id=a.Id,n.crew.push(l),e.dg_crew_ds=Enumerable.From(e.dg_crew_ds).Where("$.Id!="+i).ToArray(),e.dg_crew_instance.refresh(),e.assignedCrewDs=Enumerable.From(n.crew).ToArray(),e.dg_box_selected.HasCrew=!0;var o=Enumerable.From(e.assignedCrewDs).Where("$.SexId==31").Count(),r=Enumerable.From(e.assignedCrewDs).Where("$.SexId==30").Count();e.dg_box_selected.MaleFemalError=0==r||0==o?1:0,e.dg_box_selected.MatchingListError=t.matchingError,$.each(e.dg_box_selected.BoxItems,function(t,i){i.MaleFemalError=e.dg_box_selected.MaleFemalError,i.MatchingListError=e.dg_box_selected.MatchingListError})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.posFDPCrews=[],e.addPosCrew=function(t){var i=t.data.Id,n=Enumerable.From(e.posFDPCrews).Where("$.Id=="+e.posFDP.Id).FirstOrDefault();n||(n={Id:e.posFDP.Id,crew:[]},e.posFDPCrews.push(n));var a=Enumerable.From(e.dg_pos_crew_ds).Where("$.Id=="+i).FirstOrDefault(),o=JSON.parse(JSON.stringify(a));o.CrewId=i,e.setDefaultPosition(o),o.fdpId=n.Id,o.Id=n.crew.length+1,n.crew.push(o),e.dg_pos_crew_ds=Enumerable.From(e.dg_pos_crew_ds).Where("$.Id!="+i).ToArray(),e.dg_pos_crew_instance.refresh(),console.log("assigned crew"),console.log(o),e.assignedPosCrewDs=Enumerable.From(n.crew).ToArray()},e.removeAssignedCrew=function(t,i,n){var o={fdp:t};e.loadingVisible=!0,a.saveDeleteFDP(o).then(function(t){e.loadingVisible=!1,e.crewFDPs=[];var a=Enumerable.From(e.fdpCrews).Where("$.Id=="+i).FirstOrDefault(),o=Enumerable.From(a.crew).Where("$.CrewId=="+n).FirstOrDefault(),l=JSON.parse(JSON.stringify(o));e.dg_crew_ds.push(l),e.dg_crew_instance.refresh(),a.crew=Enumerable.From(a.crew).Where("$.CrewId!="+n).ToArray(),e.assignedCrewDs=Enumerable.From(a.crew).ToArray(),e.dg_box_selected.HasCrew=e.assignedCrewDs.length>0;var r=Enumerable.From(e.assignedCrewDs).Where("$.SexId==31").Count(),d=Enumerable.From(e.assignedCrewDs).Where("$.SexId==30").Count();e.dg_box_selected.MaleFemalError=0==d||0==r?1:0,e.dg_box_selected.MatchingListError=t.matchingError,$.each(e.dg_box_selected.BoxItems,function(t,i){i.MaleFemalError=e.dg_box_selected.MaleFemalError,i.MatchingListError=e.dg_box_selected.MatchingListError})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.removeAssignedPosCrew=function(t,i,n){var a=Enumerable.From(e.posFDPCrews).Where("$.Id=="+i).FirstOrDefault(),o=Enumerable.From(a.crew).Where("$.CrewId=="+n).FirstOrDefault(),l=JSON.parse(JSON.stringify(o));e.dg_pos_crew_ds.push(l),e.dg_pos_crew_instance.refresh(),a.crew=Enumerable.From(a.crew).Where("$.CrewId!="+n).ToArray(),e.assignedPosCrewDs=Enumerable.From(a.crew).ToArray()},e.removeAssignedFDP=function(t){var i={fdp:t.Id};e.loadingVisible=!0,a.saveDeleteFDP(i).then(function(i){e.loadingVisible=!1,e.fdpCrews=[];var n=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();$.each(n,function(e,t){t.Synced=!1}),e.cal_crew_instance.deleteAppointment(t),e.cal_crew_instance.hideAppointmentTooltip(),e.btn_crewlist_visible&&e.refreshValidFDP()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.nextPosition=function(t,i,n){var o=Enumerable.From(e.fdpCrews).Where("$.Id=="+i).FirstOrDefault(),l=Enumerable.From(o.crew).Where("$.CrewId=="+n).FirstOrDefault(),r=l.Position,d=Enumerable.From(e.positions).Where('$.title=="'+l.JobGroup+'"').FirstOrDefault().ds,s=d.indexOf(r);s>=d.length-1?s=0:s++,l.Position=d[s];var c=Enumerable.From(e.positionIds).Where('$.title=="'+l.Position+'"').FirstOrDefault().id;if(l.PositionId=c,e.crewFDPs=[],r!=l.position){var g={fdp:t,position:c};e.loadingVisible=!0,a.saveUpdateFDPPosition(g).then(function(t){e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.prePosition=function(t,i,n){var o=Enumerable.From(e.fdpCrews).Where("$.Id=="+i).FirstOrDefault(),l=Enumerable.From(o.crew).Where("$.CrewId=="+n).FirstOrDefault(),r=l.Position,d=Enumerable.From(e.positions).Where('$.title=="'+l.JobGroup+'"').FirstOrDefault().ds,s=d.indexOf(r);s<=0?s=d.length-1:s--,l.Position=d[s];var c=Enumerable.From(e.positionIds).Where('$.title=="'+l.Position+'"').FirstOrDefault().id;if(l.PositionId=c,e.crewFDPs=[],r!=l.position){var g={fdp:t,position:c};e.loadingVisible=!0,a.saveUpdateFDPPosition(g).then(function(t){e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.nextPosPosition=function(t,i,n){var a=Enumerable.From(e.posFDPCrews).Where("$.Id=="+i).FirstOrDefault(),o=Enumerable.From(a.crew).Where("$.CrewId=="+n).FirstOrDefault(),l=o.Position,r=Enumerable.From(e.positions).Where('$.title=="'+o.JobGroup+'"').FirstOrDefault().ds,d=r.indexOf(l);d>=r.length-1?d=0:d++,o.Position=r[d];var s=Enumerable.From(e.positionIds).Where('$.title=="'+o.Position+'"').FirstOrDefault().id;o.PositionId=s},e.prePosPosition=function(t,i,n){var a=Enumerable.From(e.posFDPCrews).Where("$.Id=="+i).FirstOrDefault(),o=Enumerable.From(a.crew).Where("$.CrewId=="+n).FirstOrDefault(),l=o.Position,r=Enumerable.From(e.positions).Where('$.title=="'+o.JobGroup+'"').FirstOrDefault().ds,d=r.indexOf(l);d<=0?d=r.length-1:d--,o.Position=r[d];var s=Enumerable.From(e.positionIds).Where('$.title=="'+o.Position+'"').FirstOrDefault().id;o.PositionId=s},e.refreshValidFDP=function(){var t=e.dg_calcrew_selected.Id;e.dg_calfdp_ds=null;var i=new Date(e.cal_crew_current).getDatePartArray();e.bindValidFDP(t,i[0],i[1]+1)},e.nextCrew=function(){var t=e.dg_calcrew_instance.getSelectedRowKeys(),i=e.dg_calcrew_instance.getRowIndexByKey(t[0]);if(i++,e.dg_calcrew_instance.getKeyByRowIndex(i)){var n=[];n.push(i),e.dg_calcrew_instance.selectRowsByIndexes(n).done(function(t){e.btn_crewlist_visible&&e.refreshValidFDP()})}},e.preCrew=function(){var t=e.dg_calcrew_instance.getSelectedRowKeys(),i=e.dg_calcrew_instance.getRowIndexByKey(t[0]);if(i--,e.dg_calcrew_instance.getKeyByRowIndex(i)){var n=[];n.push(i),e.dg_calcrew_instance.selectRowsByIndexes(n).done(function(t){e.btn_crewlist_visible&&e.refreshValidFDP()})}},e.nextPosition2=function(t){var i=t.Position,n=Enumerable.From(e.positions).Where('$.title=="'+e.dg_calcrew_selected.JobGroup+'"').FirstOrDefault().ds,o=n.indexOf(i);o>=n.length-1?o=0:o++,t.Position=n[o];var l=Enumerable.From(e.positionIds).Where('$.title=="'+t.Position+'"').FirstOrDefault().id;t.PositionId=l,e.fdpCrews=[];var r=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();if($.each(r,function(e,t){t.Synced=!1}),i!=t.position){var d={fdp:t.Id,position:l};e.loadingVisible=!0,a.saveUpdateFDPPosition(d).then(function(t){e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.prePosition2=function(t){var i=t.Position,n=Enumerable.From(e.positions).Where('$.title=="'+e.dg_calcrew_selected.JobGroup+'"').FirstOrDefault().ds,o=n.indexOf(i);o<=0?o=n.length-1:o--,t.Position=n[o];var l=Enumerable.From(e.positionIds).Where('$.title=="'+t.Position+'"').FirstOrDefault().id;t.PositionId=l,e.fdpCrews=[];var r=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();if($.each(r,function(e,t){t.Synced=!1}),i!=t.position){var d={fdp:t.Id,position:l};e.loadingVisible=!0,a.saveUpdateFDPPosition(d).then(function(t){e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.bind_calcrew=function(){var t=e.IsCockpit?"cockpit":"cabin",i="odata/crew/valid/"+t+"/ordered/group/"+Config.CustomerId;e.dg_calcrew_ds||(e.dg_calcrew_ds={store:{type:"odata",url:n.serviceUrl+i,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(e){}},sort:[{getter:"GroupOrder",desc:!1},{getter:"JobGroup",desc:!1},{getter:"ScheduleName",desc:!1}]})},e.$on("$viewContentLoaded",function(){$(".crewassignreg").fadeIn(400,function(){}),$(document).on("click","._addCrew",function(t){t.preventDefault();var i=$(this).data("id"),n=Enumerable.From(e.fdpCrews).Where("$.Id=="+e.dg_box_selected.BoxId).FirstOrDefault();n||(n={Id:e.dg_box_selected.BoxId,crew:[]},e.fdpCrews.push(n));var o=Enumerable.From(e.dg_crew_ds).Where("$.Id=="+i).FirstOrDefault(),l=JSON.parse(JSON.stringify(o));l.CrewId=i,e.setDefaultPosition(l),l.fdpId=n.Id;var r={fdp:n.Id,crew:i,position:l.PositionId};e.loadingVisible=!0,a.saveAssignFDPToCrew(r).then(function(t){e.loadingVisible=!1,e.crewFDPs=[],l.Id=t.Id,n.crew.push(l),e.dg_crew_ds=Enumerable.From(e.dg_crew_ds).Where("$.Id!="+i).ToArray(),e.dg_crew_instance.refresh(),e.assignedCrewDs=Enumerable.From(n.crew).ToArray(),e.dg_box_selected.HasCrew=!0;Enumerable.From(e.assignedCrewDs).Where("$.SexId==31").Count(),Enumerable.From(e.assignedCrewDs).Where("$.SexId==30").Count();e.dg_box_selected.MaleFemalError=1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}),$(document).on("click","._addFDP",function(t){t.preventDefault();var i=$(this).data("id"),n=Enumerable.From(e.dg_calfdp_ds).Where("$.Id=="+i).FirstOrDefault(),o=e.dg_calcrew_selected.Id,l=e.getDefaultPosition(e.dg_calcrew_selected.JobGroup),r={fdp:n.Id,crew:o,position:l};e.loadingVisible=!0,a.saveAssignFDPToCrew2(r).then(function(t){e.loadingVisible=!1,e.fdpCrews=[];var i=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();$.each(i,function(e,t){t.Synced=!1}),e.cal_crew_ds.push(t),e.cal_crew_instance.repaint(),e.dg_calfdp_ds=null;var n=new Date(e.cal_crew_current).getDatePartArray();e.bindValidFDP(o,n[0],n[1]+1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}),$(document).on("click",".xati",function(){var t=$(this).data("id"),i=$("#task-"+t).parent(),n=Enumerable.From(e.dataSource).Where("$.Id=="+t).FirstOrDefault(),a=n.IsBox;n.BoxId;a?e.$apply(function(){e.selectedBox=n,e.selectedBoxId=n.BoxId}):(i.hasClass("flight-item-selected")?(e.selectedIds=Enumerable.From(e.selectedIds).Where("$!="+t).ToArray(),e.selectedItems=Enumerable.From(e.selectedItems).Where("$.Id!="+t).ToArray()):(e.selectedIds.push(t),e.selectedItems.push(n)),$("#task-"+t).parent().toggleClass("nobox").toggleClass("flight-item-selected"),e.selectedIdsChanged())})}),n.$broadcast("FlightLoaded",null)}catch(e){alert(e)}}]),app.controller("crewassign2Controller",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){l.isAuthorized()?n.page_title="> Crew":l.redirectToLogin(),e.prms=i.prms,e.IsCockpit=d.current.isCockpit,e.getContent1165=function(t){return"<table style='min-width:125px'>   <tr>        <td style='width:32px;'>            <a class='cellposition' href=''  style='background:white;width:28px;height:28px;border-radius:50%;color:gray;font-weight:bold;font-size:10px;text-align:center;display: inherit;vertical-align:middle;'>"+e.getPosition(t.Position)+"            </a>        </td>        <td style='text-align:left;'>            <div style='font-size:9px;font-weight:bold'>"+t.FDPTitle+"</div>            <div style='font-size:9px; '>"+t.FDPRemark+"</div>        </td>    </tr></table>"},e.getContentEvent=function(e,t){return"<table style='min-width:125px'>   <tr>        <td style='width:32px;'>            <a class='cellposition' href=''  style='background:white;width:28px;height:28px;border-radius:50%;color:gray;font-weight:bold;font-size:10px;text-align:center;display: inherit;vertical-align:middle;'>"+t+"            </a>        </td>        <td style='text-align:left;'>            <div style='font-size:10px;font-weight:bold'>"+e.FDPTitle+"</div>            <div style='font-size:10px; '>"+e.FDPRemark+"</div>        </td>    </tr></table>"},e.getContent=function(t){var i="<div class='cell-duty duty-"+t.DutyType+"' data-id='"+t.FDPId+"' data-type='"+t.DutyType+"' data-crew='"+t.CrewId+"' data-position='"+t.Position+"' style='margin-bottom:2px'>";switch(t.DutyType){case 1e4:case 10001:i+="<div style='font-size:11px;font-weight:bold;text-align:left'>"+t.FDPTitle+"</div>",i+="<div style='font-size:11px;text-align:left'>"+t.FDPRemark+"</div>";break;case 1167:i+=e.getContentEvent(t,"PM");break;case 1168:i+=e.getContentEvent(t,"AM");break;case 5e3:i+=e.getContentEvent(t,"TRN");break;case 5001:i+=e.getContentEvent(t,"OFC");break;case 1165:i+=e.getContent1165(t)}return i+="</div>"},e.currentFDPS=null,e.selectedYear=null,e.selectedMonth=null,e.selectedTabDateIndex=-1,e.tabsdatefirst=!0,e.$watch("selectedTabDateIndex",function(t){try{if(-1==e.selectedTabDateIndex)return;e.selectedTab=e.tabs_date[t],e.selectedDate=new Date(e.selectedTab.date),e.selectedYear=e.selectedTab.year,e.selectedMonth=e.selectedTab.month;var i=e.dg_timeline_instance.option("columns");i=[{dataField:"JobGroup",caption:"",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:85,fixed:!0,fixedPosition:"left"},{dataField:"ScheduleName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:160,fixed:!0,fixedPosition:"left"}];for(var n=e.selectedDate.getDaysInMonth(),a=new Date(e.selectedTab.date),o=new Date(e.selectedTab.date).addDays(n-1);a<=o;){var l=moment(a).format("YYYYMMDD"),r={dataField:l,caption:moment(a).format("YYYY-MM-DD"),allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1}
;r.date=new Date(a);var d=l;r.day=Number(d.substr(6,2)),r.month=Number(d.substr(4,2)),r.year=Number(d.substr(0,4)),r.cellTemplate=function(t,i){var n=i.column.dataField,a=Number(n.substr(0,4)),o=Number(n.substr(4,2)),l=Number(n.substr(6,2)),r=i.data.Id,d=Enumerable.From(e.currentFDPS).Where(function(e){var t=new Date(e.DutyEndLocal);0==t.getHours()&&0==t.getMinutes()&&0==t.getSeconds()&&t.setSeconds(t.getSeconds()-1);var i=new Date(General.getDayFirstHour(new Date(e.DutyStartLocal))),n=new Date(General.getDayFirstHour(new Date(t))),d=new Date(a,o-1,l,0,0,0);return e.CrewId==r&&d>=i&&d<=n}).OrderBy("$.DutyStartLocal").Distinct("$.FDPId").ToArray(),s="";$.each(d,function(t,i){s+=e.getContent(i)});var c=(i.value,new Date(a,o-1,l,0,0,0)),g=new Date(i.data.DateInactiveBegin),u=new Date(i.data.DateInactiveEnd);c>=g&&c<=u&&(s="<div style='padding:5px 10px 5px 10px;background:#ccc'>Inactive<div>");var p="<div>"+s+"</div>";$("<div>").append(p).appendTo(t)},i.push(r),a=new Date(a).addDays(1).setHours(0,0,0,0)}e.dg_timeline_instance.option("columns",i),e.dg_timeline_instance.repaint(),e.dg_timeline_ds=[];var s=[];$.each(e.crews,function(e,t){var i={};i.Id=t.Id,i.ScheduleName=t.ScheduleName,i.GroupId=t.GroupId,i.JobGroup=t.JobGroup,i.JobGroupCode=t.JobGroupCode,i.Name=t.Name,i.IsValid=t.IsValid,i.DateInactiveBegin=t.DateInactiveBegin,i.DateInactiveEnd=t.DateInactiveEnd,s.push(i)}),e.getFDPs(e.selectedYear,e.selectedMonth+1,function(t){e.currentFDPS=t,e.dg_timeline_ds=Enumerable.From(s).ToArray(),e.dg_timeline_instance.refresh()})}catch(e){alert(e)}}),e.tabs_date=[],e.tabsdatevisible=!1,e.tabs_date_options={scrollByContent:!0,showNavButtons:!0,elementAttr:{class:"tabsdate"},onItemClick:function(e){},onItemRendered:function(t){e.selectedTabDateIndex=-1,e.selectedTabDateIndex=0},bindingOptions:{visible:"tabsdatevisible",dataSource:{dataPath:"tabs_date",deep:!0},selectedIndex:"selectedTabDateIndex"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.crews=[],e.fdps=[],e.getCrews=function(t){a.getCrewGrouped(Config.CustomerId,e.IsCockpit).then(function(i){e.crews=i,t&&t()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getFDPs=function(t,i,n){var o=Enumerable.From(e.fdps).Where("$.Year=="+t+" && $.Month=="+i).FirstOrDefault();o?n(o.items):(e.loadingVisible=!0,a.getFDPs(e.IsCockpit,t,i).then(function(a){e.loadingVisible=!1;var o={Year:t,Month:i};o.items=Enumerable.From(a).ToArray(),e.fdps.push(o),n(o.items)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},e.btn_search={text:"Search",type:"success",icon:"search",width:120,validationGroup:"assigncrewdate",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.getCrews(function(){e.createTabs()})}},e._datefrom=new Date(General.getDayFirstHour(new Date)).setDate(1),e.date_from={type:"date",placeholder:"From",width:"100%",displayFormat:"monthAndYear",maxZoomLevel:"year",minZoomLevel:"century",bindingOptions:{value:"_datefrom"}},e._datefdp=null,e.date_fdp={type:"date",placeholder:"Select Date",width:"100%",onValueChanged:function(t){e.bindValidFDPDay()},bindingOptions:{value:"_datefdp"}},e.days_count=2,e.num_days={min:1,showSpinButtons:!1,bindingOptions:{value:"days_count"}},e.datefrom=null,e.dateEnd=null,e.dateto=null,e.BeginSearch=function(){e.datefrom=General.getDayFirstHour(new Date(e._datefrom)),e.dateEnd=General.getDayLastHour(new Date(new Date(e._datefrom).addDays(e.days_count-1))),e.dateto=General.getDayLastHour(new Date(e._datefrom)),e.search()},e.search=function(){e.bindFlights(!1)},Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.baseDate=null,e.ganttData=null,e.resourceGroups=[],e.resources=[],e.dataSource=[],e.createTabs=function(){var t=new Date(e._datefrom);e.tabsdatefirst=!0,e.tabs_date=[];var i;for(i=1;i<=e.days_count;i++){var n=moment(t).format("YYYY-MMM");e.tabs_date.push({text:n,id:i,date:moment(t).format("YYYY/MM/DD"),year:t.getFullYear(),month:t.getMonth()}),t=t.addMonths(1)}e.tabsdatevisible=!0,e.selectedTabDateIndex=0},e.bindFlights=function(t){e.selectedTabDateIndex=-1;var i=-1*(new Date).getTimezoneOffset(),n=new Date(e._datefrom),o=new Date(n.addDays(e.days_count-1));e.plansDto={CustomerId:1,Date:n.ToUTC(),DateTo:o.ToUTC(),Offset:i,Design:!1,PlanId:-1},e.loadingVisible=!0,a.getPlanItemsGanttCrewTest(e.plansDto).then(function(t){e.loadingVisible=!1,e.tabsdatefirst=!0,e.tabs_date=[];var i;for(i=1;i<=e.days_count;i++){var a=moment(n).format("DD-MMM-YYYY");e.tabs_date.push({text:a,id:i,date:moment(n).format("YYYY/MM/DD")}),n=n.addDays(1)}e.tabsdatevisible=!0,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource2(t.flights),Flight.activeDatasource=e.dataSource,e.selectedTabDateIndex=0})},e.rebind=function(){var t=-1*(new Date).getTimezoneOffset(),i=new Date(e._datefrom),n=new Date(i.addDays(e.days_count-1));e.plansDto={CustomerId:1,Date:i.ToUTC(),DateTo:n.ToUTC(),Offset:t,Design:!1,PlanId:-1},e.loadingVisible=!0,a.getPlanItemsGanttCrewTest(e.plansDto).then(function(t){e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource2(t.flights),Flight.activeDatasource=e.dataSource,$("#resourceGanttba").data("ejGantt")._refreshDataSource(e.dataSource),e.selectedBox=null,e.selectedBoxId=null,e.selectedIds=[],e.selectedItems=[]})},e.addSelectedFlight=function(e){},e.timeCellWidth=0,e.selectedDate=null,e.createGantt=function(t){new Date(e.datefrom).yyyymmddtimenow(!1);t||(t=.24*$(window).width());var i=$("#resourceGanttba").data("ejGantt");i&&i.destroy(),e.StartNowLineTimerFirst=!0;var n=$(window).height()-139-50+50-38;n+="px";var a=new Date(e.selectedDate).addDays(0),o=General.getDayFirstHour(new Date(e.selectedDate)),l=General.getDayLastHour(a);$("#resourceGanttba").ejGantt({scheduleStartDate:o,scheduleEndDate:l,taskbarBackground:"red",selectionMode:ej.Gantt.SelectionMode.Cell,selectionType:ej.Gantt.SelectionType.Single,taskbarClick:function(t){e.addSelectedFlight(t.data.item),$("#resourceGanttba").data("ejGantt").clearSelection()},dataSource:e.dataSource,allowColumnResize:!0,isResponsive:!0,taskIdMapping:"taskId",taskNameMapping:"taskName",fromLocationMapping:"from",startDateMapping:"startDate",endDateMapping:"endDate",progressMapping:"progress",durationMapping:"duration",groupNameMapping:"Title",groupIdMapping:"groupId",groupCollection:e.resourceGroups,resources:e.resources,resourceIdMapping:"resourceId",resourceNameMapping:"resourceName",resourceInfoMapping:"resourceId",notesMapping:"notes",rightTaskLabelMapping:"taskName",baselineStartDateMapping:"BaselineStartDate",baselineEndDateMapping:"BaselineEndDate",highlightWeekEnds:!0,includeWeekend:!1,rowHeight:50,taskbarHeight:30,predecessorMapping:"predecessor",allowGanttChartEditing:!1,allowDragAndDrop:!0,editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,editMode:"normal"},splitterSettings:{position:110},toolbarSettings:{showToolbar:!1,toolbarItems:[ej.Gantt.ToolbarItems.Add,ej.Gantt.ToolbarItems.Delete,ej.Gantt.ToolbarItems.Update,ej.Gantt.ToolbarItems.Cancel,ej.Gantt.ToolbarItems.ExpandAll,ej.Gantt.ToolbarItems.CollapseAll,ej.Gantt.ToolbarItems.NextTimeSpan,ej.Gantt.ToolbarItems.PrevTimeSpan]},enableContextMenu:!1,load:function(){e.ganttCreated=!0,this.getColumns()[0].width=110},create:function(t){try{$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(1e6),$(".e-scrollbar.e-js.e-widget.e-hscrollbar").remove(),e.renderTopTimeHeader(),e.renderTimeHeader(),$(".e-ganttviewerbodyContianer-stripLines").css("z-index",0),e.timeCellWidth=$(".e-schedule-day-headercell-content").width();var i=new Date,n=new Date(o),a=new Date(l);i.getTime()>=n.getTime()&&(i.getTime(),a.getTime())}catch(e){alert(e)}},cellSelecting:function(e){e&&"resourceTask"!=e.data.eResourceTaskType&&(e.cancel=!0)},cellSelected:function(t){$(".e-gantt-taskbarSelection").removeClass("e-gantt-taskbarSelection"),e.setSelectedResource(t.data)},actionBegin:function(e){e.requestType&&"beginedit"==e.requestType&&(e.cancel=!0)},actionComplete:function(t){"save"==t.requestType&&(e.doActionCompleteSave?setTimeout(function(){$("#resourceGanttba").data("ejGantt")._$ganttchartHelper.ejGanttChart("selectTaskbar",t.modifiedRecord)},100):e.doActionCompleteSave=!0)},workingTimeScale:"TimeScale24Hours",durationUnit:ej.Gantt.DurationUnit.Hour,scheduleHeaderSettings:{scheduleHeaderType:ej.Gantt.ScheduleHeaderType.Day,dayHeaderFormat:"dd-MM-yyyy",minutesPerInterval:ej.Gantt.minutesPerInterval.Auto,timescaleStartDateMode:ej.Gantt.TimescaleRoundMode.Auto,timescaleUnitSize:t+"%"},taskbarTemplate:"#taskbarTemplateBoxNew",leftTaskLabelTemplate:"#leftlableTemplate",viewType:ej.Gantt.ViewType.ResourceView,sizeSettings:{height:n},groupSettings:{},showStackedHeader:!1,taskSchedulingMode:ej.Gantt.TaskSchedulingMode.Manual,enableTaskbarTooltip:!1})},e.dg_timeline_columns=[],e.dg_timeline_selected=null,e.dg_timeline_instance=null,e.dg_timeline_ds=null,e.edit_selected_crewId=null,e.edit_selected_dutyId=null,e.edit_selected_position=null,e.dg_timeline={onContextMenuPreparing:function(t){if("content"==t.target&&(t.items||(t.items=[]),0!=t.row.data.IsValid)){var i=new Date(t.column.date),n=new Date(t.row.data.DateInactiveBegin),a=new Date(t.row.data.DateInactiveEnd);if(!(i>=n&&i<=a)){t.items.push({template:"<table><tr><td style='vertical-align:middle;'><div class='duty-1165' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign FDP</td></tr></table>",onItemClick:function(){e._datefdp=t.column.date,e.selectedCrewId=t.row.data.Id,e.popup_crew_visible=!0}},{template:"<table><tr><td style='vertical-align:middle;'><div class='duty-10000' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Day Off</td></tr></table>",text:"Assign Day Off",onItemClick:function(){e.selectedCrewId=t.row.data.Id,e.event_status=1e4,e.FromDateEvent=new Date(t.column.date).setHours(20,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addHours(36),e.popup_event_title="Day Off",e.popup_event_visible=!0}},{template:"<table><tr><td style='vertical-align:middle;'><div class='duty-1168' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Stand By AM</td></tr></table>",text:"Assign StandBy AM",onItemClick:function(){e.selectedCrewId=t.row.data.Id,e.event_status=1168,e.FromDateEvent=new Date(t.column.date).setHours(0,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addMinutes(720),e.popup_event_title="StandBy AM",e.popup_event_visible=!0}},{template:"<table><tr><td style='vertical-align:middle;'><div class='duty-1167' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Stand By PM</td></tr></table>",text:"Assign StandBy PM",onItemClick:function(){e.selectedCrewId=t.row.data.Id,e.event_status=1167,e.FromDateEvent=new Date(t.column.date).setHours(12,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addMinutes(720),e.popup_event_title="StandBy PM",e.popup_event_visible=!0}},{template:"<table><tr><td style='vertical-align:middle;'><div class='duty-5001' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Office</td></tr></table>",text:"Assign Office",onItemClick:function(){e.selectedCrewId=t.row.data.Id,e.event_status=5001,e.FromDateEvent=new Date(t.column.date).setHours(8,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addMinutes(540),e.popup_event_title="Office",e.popup_event_visible=!0}},{template:"<table><tr><td style='vertical-align:middle;'><div class='duty-5000' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Training</td></tr></table>",text:"Assign Training",onItemClick:function(){e.selectedCrewId=t.row.data.Id,e.event_status=5e3,e.FromDateEvent=new Date(t.column.date).setHours(8,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addMinutes(240),e.popup_event_title="Training",e.popup_event_visible=!0}});var o=$(t.targetElement).closest(".cell-duty");if(o&&o.length>0){var l=$(o).data("id"),r=$(o).data("type"),d=$(o).data("crew"),s=$(o).data("position");1e4!=r&&10001!=r&&1167!=r&&1168!=r&&5e3!=r&&5001!=r||t.items.push({template:"<table><tr><td style='vertical-align:middle;'><div   style='width:15px;height:15px;border-radius:50%;background:red'></div></td><td style='vertical-align:top;padding-left:5px;'>Delete</td></tr></table>",text:"Delete",onItemClick:function(){e.removeAssignedFDP(l,function(){e.currentFDPS=Enumerable.From(e.currentFDPS).Where("$.FDPId!="+l).ToArray(),$.each(e.fdps,function(e,t){t.items=Enumerable.From(t.items).Where("$.FDPId!="+l).ToArray()}),e.dg_timeline_instance.refresh()})}}),1165==r&&(t.items.push({template:"<table><tr><td style='vertical-align:middle;'><div   style='width:15px;height:15px;border-radius:50%;background:Green'></div></td><td style='vertical-align:top;padding-left:5px;'>Edit</td></tr></table>",text:"Edit",onItemClick:function(){e.edit_selected_crewId=d,e.edit_selected_dutyId=l,e.edit_selected_position=s,e.popup_edit_fdp_visible=!0}}),t.items.push({template:"<table><tr><td style='vertical-align:middle;'><div   style='width:15px;height:15px;border-radius:50%;background:red'></div></td><td style='vertical-align:top;padding-left:5px;'>Delete</td></tr></table>",text:"Delete",onItemClick:function(){e.removeAssignedFDP(l,function(){e.currentFDPS=Enumerable.From(e.currentFDPS).Where("$.FDPId!="+l).ToArray(),$.each(e.fdps,function(e,t){t.items=Enumerable.From(t.items).Where("$.FDPId!="+l).ToArray()}),e.dg_timeline_instance.refresh()})}}))}}}},onCellClick:function(e){},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"none"},columnMinWidth:100,columnAutoWidth:!0,height:"100%",columns:e.dg_timeline_columns,onContentReady:function(t){e.dg_timeline_instance||(e.dg_timeline_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_timeline_selected=i||null},onRowPrepared:function(e){},onCellPrepared:function(e){"data"!=e.rowType||"ScheduleName"!==e.column.dataField&&"JobGroup"!==e.column.dataField||0==e.data.IsValid&&e.cellElement.addClass("light-red")},bindingOptions:{dataSource:"dg_timeline_ds"}},e.ganttCreated=!1,e.renderTopTimeHeader=function(){var e=$(".e-schedule-week-headercell-content");$.each(e,function(e,t){var i=$(t),n=i.html().split("(")[0],a=Number(n.split("-")[2]),o=n.split("-"),l=o[1],r=o[0],d=new Date(a+"/"+l+"/"+r),s=n+" ("+new persianDate(d).format("DD/MM/YYYY")+")";i.html(s)})},e.renderTimeHeader=function(){var t=$(".e-schedule-day-headercell-content");$.each(t,function(t,i){var n=$(i),a=n.html(),o=Number(n.html());n.find("span").length>0&&(a=$(n.find("span")[1]).html(),o=Number(a));var l=0;e.IsUTC,l=getUTCHour(o);var r="<span style='font-size:10px;display:block;color:gray;text-align:left;padding-left:2px'>"+l+"</span><span style='font-size:13px;display:block;position:relative;top:-5px'>"+a+"</span>";n.html(r)})},e.selectedIds=[],e.selectedItems=[],e.selectedBox=null,e.selectedBoxId=null,e.selectedBoxChanged=function(){if(e.selectedBox){var t=[];$.each(e.selectedBox.BoxItems,function(i,n){0==i&&(e.SourceLocation=n.FromAirportIATA),t.push(n.FlightNumber+" ("+n.FromAirportIATA+"-"+n.ToAirportIATA+")")})}},e.selectedIdsChanged=function(){e.$apply(function(){e.selectedBox=null,e.selectedBoxId=null,e.AssignedCrew="Assigned Crew",e.dg_crew_ds=[],e.dg_sum_ds=[]})},e.$watch("selectedBox",function(){e.selectedBoxChanged()}),e.btn_box={text:"Group",type:"default",width:150,onClick:function(t){if(!(e.selectedIds.length<1)){if(e.selectedIds.length>10)return void General.ShowNotify("Invalid sector counts","error");var i=(Enumerable.From(e.selectedItems).Select("$.CalendarId").Distinct().ToArray(),{ids:e.selectedIds,cid:e.selectedItems[0].CalendarId});e.loadingVisible=!0,a.boxItems(i).then(function(t){e.loadingVisible=!1,e.rebind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}},e.btn_unbox={text:"UnGroup",type:"default",width:150,onClick:function(t){if(e.selectedBox){var i={id:e.selectedBox.BoxId};e.loadingVisible=!0,a.unboxItems(i).then(function(t){e.loadingVisible=!1,e.rebind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}},e.btn_fdp={text:"FDPs",type:"default",width:150,onClick:function(t){e.popup_fdp_visible=!0}},e.btn_cal={text:"Cal",type:"default",width:150,onClick:function(t){e.popup_cal_visible=!0}},e.crewGroup=null,e.sb_cabin={showClearButton:!1,searchEnabled:!1,height:35,dataSource:["Cockpit","Cabin"],onValueChanged:function(t){if(!t.value)return void(e.dg_crew_ds=null);e.IsCockpit="Cockpit"==t.value,e.dg_box_keys&&e.dg_box_keys.length>0&&e.bindValidCrew(e.dg_box_selected.BoxId,1,"Cockpit"==t.value?1:0)},bindingOptions:{value:"crewGroup"}},e.dg_valid_crew_columns=[{dataField:"ScheduleName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120},{dataField:"Id",caption:"",width:70,allowFiltering:!1,allowSorting:!1,cellTemplate:"addCrewTemplate"}],e.dg_valid_crew_selected=null,e.dg_valid_crew_instance=null,e.dg_valid_crew_ds=null,e.dg_valid_crew={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-200-120},columns:e.dg_valid_crew_columns,onContentReady:function(t){e.dg_valid_crew_instance||(e.dg_valid_crew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_valid_crew_selected=i||null},onRowPrepared:function(e){e.data&&-1!=e.data.StandById&&e.rowElement.css("background","#ffff80")},bindingOptions:{dataSource:"dg_valid_crew_ds"}},e.dg_box_columns=[{dataField:"FDPTitle",caption:"FDP",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FDPRemark",caption:"",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:120},{dataField:"Id",caption:"",width:65,allowFiltering:!1,allowSorting:!1,cellTemplate:"addFDPTemplate"}],e.dg_box_selected=null,e.dg_box_instance=null,e.dg_box_ds=null,e.dg_box_keys=null,e.dg_box={keyExpr:"Id",wordWrapEnabled:!0,headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-230},columns:e.dg_box_columns,onContentReady:function(t){e.dg_box_instance||(e.dg_box_instance=t.component)},onSelectionChanged:function(e){},onRowPrepared:function(e){e.data&&-1!=e.data.StandById&&e.rowElement.css("background","#ffff80")},bindingOptions:{dataSource:"dg_box_ds",selectedRowKeys:"dg_box_keys"}},e.dg_fdp_columns=[{dataField:"MatchingListErrors",caption:"ML",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:35,cellTemplate:function(e,t){t.value>0&&$("<div>").append('<i class="fas fa-puzzle-piece" style="font-size:13px;position: relative;left:0px;top:-1px;color:red"></i>').appendTo(e)}},{dataField:"MaleFemaleError",caption:"MF",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:37,cellTemplate:function(e,t){t.value>0&&$("<div>").append('<i class="fas fa-restroom" style="font-size:13px;position: relative;left:-2px;top:-1px;color:red"></i>').appendTo(e)}},{dataField:"DutyStartLocal",caption:"Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:110},{dataField:"FDPTitle",caption:"FDP",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FDPRemark",caption:"",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:110}],e.dg_fdp_selected=null,e.dg_fdp_instance=null,e.dg_fdp_ds=null,e.dg_fdp={wordWrapEnabled:!0,headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-115},columns:e.dg_fdp_columns,onContentReady:function(t){e.dg_fdp_instance||(e.dg_fdp_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_fdp_selected=i,e.bindAssignedCrew(i),e.dg_valid_crew_ds=null,e.bindValidCrew(i.Id,1,e.IsCockpit?1:0)):(e.dg_fdp_selected=null,e.assignedCrewDs=null)},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_fdp_ds"}},e.dg_calcrew_columns=[{dataField:"ScheduleName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120},{dataField:"GroupOrder",caption:"O",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120,visible:!1}],e.dg_calcrew_selected=null,e.dg_calcrew_instance=null,e.dg_calcrew_ds=null,e.dg_calcrew={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-114},columns:e.dg_calcrew_columns,onContentReady:function(t){e.dg_calcrew_instance||(e.dg_calcrew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_calcrew_selected=i,e.cal_change()):e.dg_calcrew_selected=null},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_calcrew_ds"}},e.dg_calfdp_columns=[{dataField:"DutyStart",caption:"Date",allowResizing:!0,alignment:"left",dataType:"date",allowEditing:!1,width:110},{dataField:"FDPTitle",caption:"Duty",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FDPRemark",caption:"Duration",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:110},{dataField:"Id",caption:"",width:65,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){$("<div>").append("<a   data-id='"+t.value+"'  href='' class='addFDP w3-button w3-block w3-blue' style=' margin:0 auto 0px auto;text-decoration:none;padding:5px 0px !important;border-radius:50%;text-align:center'>+</a>").appendTo(e)}}],e.dg_calfdp_selected=null,e.dg_calfdp_instance=null,e.dg_calfdp_ds=null,e.dg_calfdp={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-114},columns:e.dg_calfdp_columns,onContentReady:function(t){e.dg_calfdp_instance||(e.dg_calfdp_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_calfdp_selected=i,e.cal_change()):e.dg_calfdp_selected=null},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_calfdp_ds"}},e.cal_crew_current=new Date,e.$watch("cal_crew_current",function(t,i,n){e.cal_change()}),e.cal_crew_ds=null,e.cal_crew_instance=null,e.cal_crew={textExpr:"Flights",startDateExpr:"DutyStartLocal",endDateExpr:"DutyEndLocal",views:["month","day"],currentView:"month",startDayHour:0,appointmentTemplate:"appointmentTemplate",appointmentTooltipTemplate:"tooltip-template",height:function(){return $(window).height()-115-31},onContentReady:function(t){e.cal_crew_instance||(e.cal_crew_instance=t.component)},optionChanged:function(e){},onAppointmentClick:function(e){if($(e.event.target).hasClass("cellposition"))return void(e.cancel=!0)},bindingOptions:{currentDate:"cal_crew_current",dataSource:"cal_crew_ds"}},e.getDutyClass=function(e){switch(e.DutyType){case 1165:return"duty-1165";default:return""}},e.getPosition=function(e){switch(e){case"Captain":return"CPT";case"Purser":return"PU";case"SCCM(i)":return"SCI";default:return e}},e.cellPositionClicked=function(e){},e.bindValidCrew=function(t,i,n){e.loadingVisible=!0,a.getValidCrew(t,i,n).then(function(t){e.loadingVisible=!1,e.dg_valid_crew_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.bindValidFDP=function(t,i,n){e.loadingVisible=!0,a.getValidFDP(t,i,n).then(function(t){e.loadingVisible=!1,e.dg_calfdp_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.bindFDPs=function(){e.loadingVisible=!0,a.getFDPsByYearMonth(e.selectedYear,e.selectedMonth+1).then(function(t){e.loadingVisible=!1,e.dg_fdp_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getValidFDPDay=function(t,i,n,o,l){e.loadingVisible=!0,a.getValidFDPDay(t,i,n,o).then(function(t){e.loadingVisible=!1,l(t)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.bindValidFDPDay=function(){if(e.dg_box_ds=null,e._datefdp&&e.selectedCrewId){var t=new Date(e._datefdp),i=t.getFullYear(),n=t.getMonth()+1,a=t.getDate();e.loadingVisible=!0,e.getValidFDPDay(e.selectedCrewId,i,n,a,function(t){e.dg_box_ds=t})}},e.setSbPositionsDs=function(t){var i=Enumerable.From(e.crews).Where("$.Id=="+t).FirstOrDefault();e.sb_position_ds=Enumerable.From(e.positions).Where('$.title=="'+i.JobGroup+'"').FirstOrDefault().ds,e.crew_default_position=e.sb_position_ds[0]},e.setSbPositions2Ds=function(t){var i=Enumerable.From(e.crews).Where("$.Id=="+t).FirstOrDefault();e.sb_position2_ds=Enumerable.From(e.positions).Where('$.title=="'+i.JobGroup+'"').FirstOrDefault().ds,e.sb_position2_value=e.edit_selected_position},e.selectedCrewId=null,e.sb_crew={showClearButton:!1,searchEnabled:!1,displayExpr:"ScheduleName",valueExpr:"Id",height:35,onValueChanged:function(t){if(!t.value)return e.sb_position_ds=null,void(e.dg_box_ds=null);e.setSbPositionsDs(t.value),e.bindValidFDPDay()},bindingOptions:{dataSource:"crews",value:"selectedCrewId"}},e.sb_position_ds=null,e.crew_default_position=null,e.sb_position={showClearButton:!1,searchEnabled:!1,height:35,onValueChanged:function(e){},bindingOptions:{dataSource:"sb_position_ds",value:"crew_default_position"}},e.sb_position2_value=null,e.sb_position2_item=null,e.sb_position2_ds=null,e.sb_position2={showClearButton:!1,searchEnabled:!1,height:35,onValueChanged:function(e){},bindingOptions:{dataSource:"sb_position2_ds",value:"sb_position2_value",selectedItem:"sb_position2_item"}},e.popup_crew_visible=!1,e.popup_crew={width:function(){return 450},height:function(){return $(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_crew_visible=!1}},toolbar:"bottom"}],position:"right",visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.setSbPositionsDs(e.selectedCrewId),e.bindValidFDPDay()},onHiding:function(){e.popup_crew_visible=!1},bindingOptions:{visible:"popup_crew_visible"}},e.popup_fdp_visible=!1,e.popup_fdp={width:function(){return 930},height:function(){return $(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_fdp_visible=!1}},toolbar:"bottom"}],position:"right",visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.bindFDPs()},onHiding:function(){e.assignedCrewDs=null,e.dg_valid_crew_ds=null,e.dg_fdp_instance.clearSelection(),e.dg_fdp_ds=null,e.popup_fdp_visible=!1},bindingOptions:{visible:"popup_fdp_visible"}},e.popup_cal_visible=!1,e.btn_crewlist_visible=!1,e.btn_duties_visible=!0,e.popup_cal={width:function(){return 1400},height:function(){return $(window).height()},fullScreen:!0,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Day Off",icon:"card",onClick:function(t){e.event_status=1e4,e.popup_event_visible=!0}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Duties",icon:"card",onClick:function(t){e.btn_duties_visible=!1,e.btn_crewlist_visible=!0,e.dg_calfdp_ds=null,$(".dgcalcrew").fadeOut("200",function(){$(".dgcalfdp").fadeIn("200",function(){var t=new Date(e.cal_crew_current).getDatePartArray(),i=e.dg_calcrew_selected.Id;e.bindValidFDP(i,t[0],t[1]+1)})})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Crew List",icon:"card",onClick:function(t){e.btn_crewlist_visible=!1,e.btn_duties_visible=!0,$(".dgcalfdp").fadeOut("200",function(){$(".dgcalcrew").fadeIn("200",function(){})})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_cal_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.bind_calcrew(),e.cal_change()},onHiding:function(){e.btn_crewlist_visible=!1,e.btn_duties_visible=!0,$(".dgcalfdp").hide(),$(".dgcalcrew").show(),e.cal_crew_ds=[],e.cal_crew_instance.repaint(),e.popup_cal_visible=!1},bindingOptions:{visible:"popup_cal_visible","toolbarItems[1].visible":"btn_duties_visible","toolbarItems[2].visible":"btn_crewlist_visible"}},e.FromDateEvent=null,e.ToDateEvent=null,e.date_from_event={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"FromDateEvent"}},e.date_to_event={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"ToDateEvent"}},e.event_status=null,e.popup_event_visible=!1,e.popup_event_title="",e.popup_event={width:300,height:260,position:"left top",fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Ok",icon:"check",validationGroup:"eventadd2",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i=e.selectedCrewId;1e4==e.event_status&&(e.loadingVisible=!0,a.IsRERRPValid(i,e.FromDateEvent,e.ToDateEvent).then(function(t){if(e.loadingVisible=!1,t)General.ShowNotify(t,"error");else{var n={DateStart:new Date(e.FromDateEvent),DateEnd:new Date(e.ToDateEvent),CityId:-1,CrewId:i,DutyType:e.event_status};e.loadingVisible=!0,a.saveDutyDetail(n).then(function(t){e.loadingVisible=!1;for(var i=new Date(e.FromDateEvent).getMonth()+1,n=new Date(e.ToDateEvent).getMonth()+1,a=new Date(e.FromDateEvent),o=a.getFullYear();i<=n;){var l=Enumerable.From(e.fdps).Where("$.Year=="+o+" && $.Month=="+i).FirstOrDefault(),r=Enumerable.From(t).Where("$.DateStartYear=="+o+" && ($.DateStartMonth=="+i+" || $.DateEndMonth=="+i+")").ToArray();if(l)$.each(r,function(e,t){l.items.push(t)});else{var d={Year:o,Month:i};d.items=[],$.each(r,function(e,t){d.items.push(t)}),e.fdps.push(d)}i++}var s=e.selectedMonth+1,c=Enumerable.From(e.fdps).Where("$.Year=="+e.selectedYear+" && $.Month=="+s).FirstOrDefault();e.currentFDPS=c.items,
e.dg_timeline_instance.refresh(),e.popup_event_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})),1167!=e.event_status&&1168!=e.event_status&&5e3!=e.event_status&&5001!=e.event_status||(e.loadingVisible=!0,a.IsEventValid(i,e.FromDateEvent,e.ToDateEvent,e.event_status).then(function(t){if(e.loadingVisible=!1,t)General.ShowNotify(t,"error");else{var n={DateStart:new Date(e.FromDateEvent),DateEnd:new Date(e.ToDateEvent),CityId:-1,CrewId:i,DutyType:e.event_status};e.loadingVisible=!0,a.saveDutyDetail(n).then(function(t){e.loadingVisible=!1;for(var i=new Date(e.FromDateEvent).getMonth()+1,n=new Date(e.ToDateEvent).getMonth()+1,a=new Date(e.FromDateEvent),o=a.getFullYear();i<=n;){var l=Enumerable.From(e.fdps).Where("$.Year=="+o+" && $.Month=="+i).FirstOrDefault(),r=Enumerable.From(t).Where("$.DateStartYear=="+o+" && ($.DateStartMonth=="+i+" || $.DateEndMonth=="+i+")").ToArray();if(l)$.each(r,function(e,t){l.items.push(t)});else{var d={Year:o,Month:i};d.items=[],$.each(r,function(e,t){d.items.push(t)}),e.fdps.push(d)}i++}var s=e.selectedMonth+1,c=Enumerable.From(e.fdps).Where("$.Year=="+e.selectedYear+" && $.Month=="+s).FirstOrDefault();e.currentFDPS=c.items,e.dg_timeline_instance.refresh(),e.popup_event_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.ToDateEvent=null,e.FromDateEvent=null,e.event_status=null},bindingOptions:{visible:"popup_event_visible",title:"popup_event_title"}},e.popup_event.toolbarItems[1].options.onClick=function(t){e.popup_event_visible=!1},e.popup_edit_fdp_visible=!1,e.popup_edit_fdp_title="",e.popup_edit_fdp={width:300,height:180,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Ok",icon:"check",validationGroup:"edit_fdp",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i=Enumerable.From(e.positionIds).Where('$.title=="'+e.sb_position2_value+'"').FirstOrDefault().id,n={fdp:e.edit_selected_dutyId,position:i};e.loadingVisible=!0,a.saveUpdateFDPPosition(n).then(function(t){e.loadingVisible=!1;var n=Enumerable.From(e.currentFDPS).Where("$.FDPId=="+e.edit_selected_dutyId).ToArray();$.each(n,function(t,n){n.positionId=i,n.Position=e.sb_position2_value}),e.dg_timeline_instance.refresh(),e.popup_edit_fdp_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.setSbPositions2Ds(e.edit_selected_crewId)},onHiding:function(){e.sb_position2_value=null},bindingOptions:{visible:"popup_edit_fdp_visible",title:"popup_edit_fdp_title"}},e.popup_edit_fdp.toolbarItems[1].options.onClick=function(t){e.popup_edit_fdp_visible=!1},e.crewFDPs=[],e.cal_change=function(){if(e.cal_crew_current&&e.dg_calcrew_selected){var t=new Date(e.cal_crew_current).getDatePartArray(),i=e.dg_calcrew_selected.Id;e.getCrewFDPs(t[0],t[1]+1,i,function(t){e.cal_crew_ds=t})}},e.getCrewFDPs=function(t,i,n,o){if(n){var l=Enumerable.From(e.crewFDPs).Where("$.CrewId=="+n+" && $.DateStartYear=="+t+" && $.DateStartMonth=="+i).FirstOrDefault();l?o(l.FDPs):(e.loadingVisible=!0,a.getCrewFDPByYearMonth(n,t,i).then(function(a){e.loadingVisible=!1;var l={CrewId:n,DateStartYear:t,DateStartMonth:i,FDPs:a};e.crewFDPs.push(l),o(a)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))}else o(null)},e.fdpCrews=[],e.bindAssignedCrew=function(t){var i=Enumerable.From(e.currentFDPS).Where(function(e){return e.TemplateId==t.Id}).Distinct("$.FDPId").ToArray();e.assignedCrewDs=i,console.log("CFDP"),console.log(i)},e.assignedCrewDs=[],e.positions=[{title:"P1",ds:["Captain","FO","SO","TO"]},{title:"P2",ds:["FO","SO","TO"]},{title:"TRI",ds:["Captain","TRI","FO","SO","TO"]},{title:"TRE",ds:["Captain","TRE","FO","SO","TO"]},{title:"LTC",ds:["Captain","TRI","TRE","FO","SO","TO"]},{title:"CCM",ds:["FA"]},{title:"SCCM",ds:["Purser","FA"]},{title:"SCCM(i)",ds:["SCCM(i)","Purser","FA"]}],e.positionIds=[{id:1160,title:"Captain"},{id:1161,title:"FO"},{id:1162,title:"SO"},{id:1163,title:"TO"},{id:1205,title:"TRI"},{id:1206,title:"TRE"},{id:1158,title:"FA"},{id:1157,title:"Purser"},{id:10002,title:"SCCM(i)"}],e.setDefaultPosition=function(t){var i=Enumerable.From(e.positions).Where('$.title=="'+t.JobGroup+'"').FirstOrDefault(),n=i.ds[0],a=Enumerable.From(e.positionIds).Where('$.title=="'+n+'"').FirstOrDefault().id;t.Position=n,t.PositionId=a},e.getDefaultPosition=function(t){var i=Enumerable.From(e.positions).Where('$.title=="'+t+'"').FirstOrDefault(),n=i.ds[0];return Enumerable.From(e.positionIds).Where('$.title=="'+n+'"').FirstOrDefault().id},e.removeAssignedCrew=function(t){return void e.removeAssignedFDP(t,function(){e.assignedCrewDs=Enumerable.From(e.assignedCrewDs).Where("$.FDPId!="+t).ToArray(),e.currentFDPS=Enumerable.From(e.currentFDPS).Where("$.FDPId!="+t).ToArray(),$.each(e.fdps,function(e,i){i.items=Enumerable.From(i.items).Where("$.FDPId!="+t).ToArray()}),e.dg_timeline_instance.refresh()})},e.removeAssignedFDP=function(t,i){var n={fdp:t};e.loadingVisible=!0,a.saveDeleteFDP(n).then(function(t){e.loadingVisible=!1,i()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.nextPosition=function(t,i){var n=Enumerable.From(e.currentFDPS).Where("$.FDPId=="+i).ToArray();if(n&&0!=n.length){var o=n[0].JobGroup,l=Enumerable.From(e.positions).Where('$.title=="'+o+'"').FirstOrDefault().ds,r=n[0].Position,d=l.indexOf(r);d>=l.length-1?d=0:d++;var s=l[d],c=Enumerable.From(e.positionIds).Where('$.title=="'+s+'"').FirstOrDefault().id;t.Position=s,t.PositionId=c,$.each(n,function(e,t){t.Position=s,t.PositionId=c}),e.dg_timeline_instance.refresh();var g={fdp:i,position:c};e.loadingVisible=!0,a.saveUpdateFDPPosition(g).then(function(t){e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.prePosition=function(t,i){var n=Enumerable.From(e.currentFDPS).Where("$.FDPId=="+i).ToArray();if(n&&0!=n.length){var o=n[0].JobGroup,l=Enumerable.From(e.positions).Where('$.title=="'+o+'"').FirstOrDefault().ds,r=n[0].Position,d=l.indexOf(r);d<=0?d=l.length-1:d--;var s=l[d],c=Enumerable.From(e.positionIds).Where('$.title=="'+s+'"').FirstOrDefault().id;t.Position=s,t.PositionId=c,$.each(n,function(e,t){t.Position=s,t.PositionId=c}),e.dg_timeline_instance.refresh();var g={fdp:i,position:c};return e.loadingVisible=!0,void a.saveUpdateFDPPosition(g).then(function(t){e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")});var r,l,d,c,g}},e.refreshValidFDP=function(){var t=e.dg_calcrew_selected.Id;e.dg_calfdp_ds=null;var i=new Date(e.cal_crew_current).getDatePartArray();e.bindValidFDP(t,i[0],i[1]+1)},e.nextCrew=function(){var t=e.dg_calcrew_instance.getSelectedRowKeys(),i=e.dg_calcrew_instance.getRowIndexByKey(t[0]);if(i++,e.dg_calcrew_instance.getKeyByRowIndex(i)){var n=[];n.push(i),e.dg_calcrew_instance.selectRowsByIndexes(n).done(function(t){e.btn_crewlist_visible&&e.refreshValidFDP()})}},e.preCrew=function(){var t=e.dg_calcrew_instance.getSelectedRowKeys(),i=e.dg_calcrew_instance.getRowIndexByKey(t[0]);if(i--,e.dg_calcrew_instance.getKeyByRowIndex(i)){var n=[];n.push(i),e.dg_calcrew_instance.selectRowsByIndexes(n).done(function(t){e.btn_crewlist_visible&&e.refreshValidFDP()})}},e.nextPosition2=function(t){var i=t.Position,n=Enumerable.From(e.positions).Where('$.title=="'+e.dg_calcrew_selected.JobGroup+'"').FirstOrDefault().ds,o=n.indexOf(i);o>=n.length-1?o=0:o++,t.Position=n[o];var l=Enumerable.From(e.positionIds).Where('$.title=="'+t.Position+'"').FirstOrDefault().id;t.PositionId=l,e.fdpCrews=[];var r=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();if($.each(r,function(e,t){t.Synced=!1}),i!=t.position){var d={fdp:t.Id,position:l};e.loadingVisible=!0,a.saveUpdateFDPPosition(d).then(function(t){e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.prePosition2=function(t){var i=t.Position,n=Enumerable.From(e.positions).Where('$.title=="'+e.dg_calcrew_selected.JobGroup+'"').FirstOrDefault().ds,o=n.indexOf(i);o<=0?o=n.length-1:o--,t.Position=n[o];var l=Enumerable.From(e.positionIds).Where('$.title=="'+t.Position+'"').FirstOrDefault().id;t.PositionId=l,e.fdpCrews=[];var r=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();if($.each(r,function(e,t){t.Synced=!1}),i!=t.position){var d={fdp:t.Id,position:l};e.loadingVisible=!0,a.saveUpdateFDPPosition(d).then(function(t){e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.bind_calcrew=function(){var t="odata/crew/ordered/group/"+Config.CustomerId;e.dg_calcrew_ds||(e.dg_calcrew_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(e){}},sort:[{getter:"GroupOrder",desc:!1},{getter:"JobGroup",desc:!1},{getter:"ScheduleName",desc:!1}]})},e.addCrew=function(t){var i=e.dg_fdp_selected.Id,n=t.data.Id,o=e.getDefaultPosition(t.data.JobGroup),l={fdp:i,crew:n,position:o,stby:t.data.StandById};return e.loadingVisible=!0,void a.saveAssignFDPToCrew2Detail(l).then(function(t){if(e.loadingVisible=!1,t&&0!=t.length){e.dg_fdp_selected.MatchingListErrors=t[0].MatchingListErrors,e.dg_fdp_selected.MaleFemaleError=t[0].MaleFemaleError;for(var i=new Date(t[0].DutyStartLocal).getFullYear(),a=new Date(t[0].DutyStartLocal).getMonth()+1,o=new Date(t[0].DutyEndLocal).getMonth()+1;a<=o;){var l=Enumerable.From(e.fdps).Where("$.Year=="+i+" && $.Month=="+a).FirstOrDefault(),r=Enumerable.From(t).Where("$.DateStartYear=="+i+" && ($.DateStartMonth=="+a+" || $.DateEndMonth=="+a+")").ToArray();if(l)$.each(r,function(e,t){l.items.push(t)});else{var d={Year:i,Month:a};d.items=[],$.each(r,function(e,t){d.items.push(t)}),e.fdps.push(d)}a++}var s=e.selectedMonth+1,c=Enumerable.From(e.fdps).Where("$.Year=="+e.selectedYear+" && $.Month=="+s).FirstOrDefault();e.currentFDPS=c.items,e.bindAssignedCrew(e.dg_fdp_selected),e.dg_timeline_instance.refresh(),e.dg_valid_crew_ds=Enumerable.From(e.dg_valid_crew_ds).Where("$.Id!="+n).ToArray(),e.dg_valid_crew_instance.refresh()}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")});var n,l},e.addFDP=function(t){var i=t.row.data,n=i.Id,o=e.selectedCrewId,l=Enumerable.From(e.positionIds).Where('$.title=="'+e.crew_default_position+'"').FirstOrDefault().id,r={fdp:n,crew:o,position:l,stby:i.StandById};e.loadingVisible=!0,a.saveAssignFDPToCrew2Detail(r).then(function(t){e.loadingVisible=!1;var i=new Date(e._datefdp),n=i.getFullYear(),a=i.getMonth()+1,o=(i.getDate(),Enumerable.From(e.fdps).Where("$.Year=="+n+" && $.Month=="+a).FirstOrDefault());if(o)$.each(t,function(e,t){o.items.push(t)});else{var l={Year:n,Month:a};l.items=[],$.each(t,function(e,t){l.items.push(t)}),e.fdps.push(l)}e.currentFDPS=o.items,e.dg_timeline_instance.refresh(),e.bindValidFDPDay()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.$on("$viewContentLoaded",function(){var t=$(window).height()-139-50+20;$("#dg_container").height(t),$(".crewassign2").fadeIn(400,function(){}),$(document).on("click",".addCrew",function(t){t.preventDefault();var i=$(this).data("id"),n=Enumerable.From(e.fdpCrews).Where("$.Id=="+e.dg_box_selected.BoxId).FirstOrDefault();n||(n={Id:e.dg_box_selected.BoxId,crew:[]},e.fdpCrews.push(n));var o=Enumerable.From(e.dg_crew_ds).Where("$.Id=="+i).FirstOrDefault(),l=JSON.parse(JSON.stringify(o));l.CrewId=i,e.setDefaultPosition(l),l.fdpId=n.Id;var r={fdp:n.Id,crew:i,position:l.PositionId};e.loadingVisible=!0,a.saveAssignFDPToCrew(r).then(function(t){e.loadingVisible=!1,e.crewFDPs=[],l.Id=t.Id,n.crew.push(l),e.dg_crew_ds=Enumerable.From(e.dg_crew_ds).Where("$.Id!="+i).ToArray(),e.dg_crew_instance.refresh(),e.assignedCrewDs=Enumerable.From(n.crew).ToArray(),e.dg_box_selected.HasCrew=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}),$(document).on("click",".addFDP2",function(t){t.preventDefault();var i=$(this).data("id"),n=e.selectedCrewId,o=Enumerable.From(e.positionIds).Where('$.title=="'+e.crew_default_position+'"').FirstOrDefault().id,l={fdp:i,crew:n,position:o};return e.loadingVisible=!0,void a.saveAssignFDPToCrew2Detail(l).then(function(t){e.loadingVisible=!1;var i=new Date(e._datefdp),n=i.getFullYear(),a=i.getMonth()+1,o=(i.getDate(),Enumerable.From(e.fdps).Where("$.Year=="+n+" && $.Month=="+a).FirstOrDefault());if(o)o.items.push(t);else{var l={Year:n,Month:a};l.items=[],l.items.push(t),e.fdps.push(l)}e.currentFDPS=o,e.dg_timeline_instance.refresh(),e.bindValidFDPDay()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")});var l}),$(document).on("click",".xati",function(){var t=$(this).data("id"),i=$("#task-"+t).parent(),n=Enumerable.From(e.dataSource).Where("$.Id=="+t).FirstOrDefault(),a=n.IsBox;n.BoxId;a?e.$apply(function(){e.selectedBox=n,e.selectedBoxId=n.BoxId}):(i.hasClass("flight-item-selected")?(e.selectedIds=Enumerable.From(e.selectedIds).Where("$!="+t).ToArray(),e.selectedItems=Enumerable.From(e.selectedItems).Where("$.Id!="+t).ToArray()):(e.selectedIds.push(t),e.selectedItems.push(n)),$("#task-"+t).parent().toggleClass("nobox").toggleClass("flight-item-selected"),e.selectedIdsChanged())})}),n.$broadcast("FlightLoaded",null)}]),app.controller("flightController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.filterVisible=!1,e.entity={Id:null,Title:null,DateFrom:null,DateTo:null,DateFirst:null,DateLast:null,iDateFrom:new Date,iDateTo:new Date,CustomerId:Config.CustomerId,IsActive:!1,DateActive:null,Interval:null,Months:[],Days:[]},e.clearEntity=function(){e.entity.Id=null,e.entity.Title=null,e.entity.DateFrom=null,e.entity.DateTo=null,e.entity.DateFirst=null,e.entity.DateLast=null,e.entity.iDateFrom=new Date,e.entity.iDateTo=new Date,e.entity.CustomerId=Config.CustomerId,e.entity.IsActive=!1,e.entity.DateActive=null,e.entity.Interval=null,e.entity.Months=[],e.entity.Days=[],e.data=[]},e.bindEntity=function(t){e.entity.Id=t.Id,e.entity.Title=t.Title,e.entity.DateFrom=t.DateFrom,e.entity.DateTo=t.DateTo,e.entity.DateFirst=t.DateFirst,e.entity.DateLast=t.DateLast,e.entity.iDateFrom=t.DateFrom,e.entity.iDateTo=t.DateTo,e.entity.CustomerId=t.CustomerId,e.entity.IsActive=t.IsActive,e.entity.DateActive=t.DateActive,e.entity.Interval=t.Interval,e.entity.Months=t.Months,e.entity.Days=t.Days},e.tempData=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(e){})}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(t){e.entity.Id=-1,e.tempData=null,e.popup_add_visible=!0}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");a.getFlightPlan(e.dg_selected.Id).then(function(t){e.tempData=t,e.popup_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.btn_approve={text:"Approve",type:"default",icon:"check",width:150,onClick:function(t){return e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?e.dg_selected.Gaps>0||e.dg_selected.Overlaps>0||e.dg_selected.GapOverlaps>0?void General.ShowNotify("The plan has error(s).","error"):void General.Confirm(Config.Text_SimpleConfirm,function(t){t&&(e.loadingVisible=!0,a.closePlan(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))}):void General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_gantt={text:"Gantt View",type:"default",icon:"rowfield",width:150,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.dg_selected;n.$broadcast("InitFlightDesign",e.dg_selected)}},e.btn_grid={text:"Grid View",type:"default",icon:"menu",width:140,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.dg_selected;n.$broadcast("InitFlightDesignGrid",e.dg_selected)}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}};new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("03/18/2017"),new Date("03/22/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017");e.pop_width_employees=600,e.pop_height_employees=450,e.dg_height_full=100,e.scroll_height_full=400,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={width:1e3,height:620,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplan",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.entity.DateFrom=new Date(e.entity.iDateFrom).ToUTC(),e.entity.DateTo=new Date(e.entity.iDateTo).ToUTC(),e.entity.DateFirst=new Date(e.data[0].startDate).ToUTC(),100!=e.entity.Interval&&(e.entity.Months=[],e.entity.Days=[]),e.loadingVisible=!0,a.savePlan(e.entity).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind(),e.loadingVisible=!1,e.popup_add_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.tempData&&e.bindEntity(e.tempData)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1},bindingOptions:{visible:"popup_add_visible",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.isDouble=0;e.monthArray=[],e.dayArray=[],e.addCustom=function(t,i,n,a){if(n&&0!=n.length&&a&&0!=a.length)for(;t<=i;){var o=!1,l=!1;o=!n||0==n.length||-1!=n.indexOf(t.getMonth()),l=!a||0==a.length||-1!=a.indexOf(t.getDay()),o&&l&&e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(1)}},e.addDaily=function(t,i,n){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(n)},e.addMonthly=function(t,i){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(30)},e.fillSchedule=function(){if(e.data=[],e.entity.Interval&&e.entity.iDateFrom&&e.entity.iDateTo){var t=new Date(e.entity.iDateFrom);t=new Date(t.setHours(0,0,0,0));var i=new Date(e.entity.iDateTo);switch(i=new Date(i.setHours(23,59,59,999)),console.log(t),console.log(i),e.entity.Interval){case 1:e.addDaily(t,i,1);break;case 2:e.addDaily(t,i,7);break;case 3:e.addDaily(t,i,10);break;case 4:e.addDaily(t,i,14);break;case 5:e.addDaily(t,i,15);break;case 100:e.addCustom(t,i,e.entity.Months,e.entity.Days)}}},e.data=[],e.scheduler_instance=null,e.schedulerOptions={onContentReady:function(t){e.scheduler_instance||(e.scheduler_instance=t.component)},views:["month"],currentView:"month",startDayHour:0,endDayHour:24,currentDate:new Date("2019/01/01"),showCurrentTimeIndicator:!1,height:492,appointmentTemplate:function(e){return $("<div style='text-align:center; height:38px;color:green;background:white;margin-top:-5px'><i style='font-size:32px' class='icon ion-md-checkmark'></i></div>")},editing:{allowAdding:!1,allowUpdating:!1,allowDeleting:!0,allowResizing:!1,allowDragging:!1},onAppointmentClick:function(e){e.cancel=!0},onAppointmentDblClick:function(e){e.cancel=!0},onCellClick:function(e){e.cancel=!0},bindingOptions:{dataSource:"data",min:"entity.iDateFrom",max:"entity.iDateTo"}},e.date_from={type:"date",width:"100%",onValueChanged:function(t){e.fillSchedule()},bindingOptions:{value:"entity.iDateFrom"}},e.date_to={type:"date",width:"100%",onValueChanged:function(t){e.fillSchedule()},bindingOptions:{value:"entity.iDateTo"}},e.intervalTypes=[{Id:1,Title:"Daily"},{Id:2,Title:"Weekly"},{Id:3,Title:"Every 10 days"},{Id:4,Title:"Every 14 days"},{Id:5,Title:"Every 15 days"},{Id:100,Title:"Custom"}],e.sb_interval={showClearButton:!0,width:"100%",searchEnabled:!1,displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){e.customDisabled=t.selectedItem&&100!=t.selectedItem.Id,e.fillSchedule()},bindingOptions:{value:"entity.Interval",dataSource:"intervalTypes"}},e.customDisabled=!0,e.tag_months_instance=null,e.tag_months={dataSource:General.MonthDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_months_instance||(e.tag_months_instance=t.component)},onSelectionChanged:function(t){e.fillSchedule()},bindingOptions:{disabled:"customDisabled",value:"entity.Months"}},e.tag_days_instance=null,e.tag_days={dataSource:General.WeekDayDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_days_instance||(e.tag_days_instance=t.component)},onSelectionChanged:function(t){e.fillSchedule()},bindingOptions:{disabled:"customDisabled",value:"entity.Days"}},e.text_title={bindingOptions:{value:"entity.Title"}},e.dg_selected=null,e.dg_columns=[{dataField:"",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.data.IsApproved50?$("<div>").append("<i style='font-size:22px;color:#2196F3' class='icon ion-md-lock'></i>").appendTo(e):(t.data.Gaps>0||t.data.Overlaps>0)&&$("<div>").append("<i style='font-size:22px;color:red' class='icon ion-md-warning'></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"Id",caption:"No",allowResizing:!0,dataType:"number",allowEditing:!1,width:120,alignment:"center",sortIndex:1,sortOrder:"asc",fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:300},{dataField:"Types",caption:"Types",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:300},{dataField:"IntervalType",caption:"Interval",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:150},{dataField:"TotalFlights",caption:"Flights",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"Gaps",caption:"Gaps",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"Overlaps",caption:"Overlaps",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"GapOverlaps",caption:"Gap & Overlaps",allowResizing:!0,dataType:"number",allowEditing:!1,width:130,alignment:"center"},{dataField:"DateFrom",caption:"From",allowResizing:!0,dataType:"date",allowEditing:!1,width:200,alignment:"center",fixed:!0,fixedPosition:"right"},{dataField:"DateTo",caption:"To",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200,fixed:!0,fixedPosition:"right"}],e.dg_height=100,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},height:"100%",bindingOptions:{dataSource:"dg_ds"}},e.bind=function(){var t="odata/flightplans/opened/customer/"+Config.CustomerId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Id",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.getFlightsGantt=function(){e.loadingVisible=!0,a.getFlightsGantt(Config.CustomerId).then(function(t){e.loadingVisible=!1,e.flightData=t,$.each(e.flightData.flights,function(e,t){t.startDate=new Date(t.startDate)})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},l.isAuthorized()?(n.page_title="> Flights Planning",$(".flight").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onFlightPlanItemsSaved",function(t,i){e.doRefresh=!0}),e.$on("onFlightDesignHide",function(t,i){e.bind()}),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("homeController",["$scope","$routeParams","authService","activityService","libraryService","flightService","$rootScope",function(e,t,i,n,a,o,l){if(l.IsOnlyFlightView())return i.setModule(3),l.setTheme(),void l.navigate("/flight/board","flight_board");e.prms=t.prms,e.year=t.year,e.month=t.month,e.day=t.day,e.boardSummary={Arrived:"-",Departed:"-",TotalFlight:"-",BaggageWeight:"-",BlockTime:"-",Canceled:"-",Date:"-",Delay:"-",Diverted:"-",FuelActual:"-",Pax:"-",TotalSeat:"-",CargoPerPax:"-",DelayRatio:"-",PaxLoad:"-",DelayStr:"-",BlockTimeStr:"-"},l.page_title="> Home",$(".home").fadeIn(),l.setTheme();var r=($(window).height(),l.headerHeight),d=1-1*r/$(window).height();$(".wrapper").css("height",100*d+"%"),Chart.defaults.global.pointHitDetectionRadius=1,Chart.defaults.global.tooltips.enabled=!1,Chart.defaults.global.tooltips.mode="index",Chart.defaults.global.tooltips.position="nearest",Chart.defaults.global.pointHitDetectionRadius=1;Chart.defaults.global.tooltips.custom=CustomTooltips;var s=function(){return Math.round(100*Math.random())};if(e.year&&e.month&&e.day?(e.currentDate=General.getDayFirstHour(new Date(e.year,e.month-1,e.day,0,0,0)),e._datefrom=General.getDayFirstHour(new Date(e.year,e.month-1,e.day,0,0,0)),e._dateto=General.getDayFirstHour(new Date(e.year,e.month-1,e.day,0,0,0))):(e._datefrom=new Date,e._dateto=new Date,e.currentDate=General.getDayFirstHour(new Date)),e.date_from={type:"date",placeholder:"From",width:"100%",height:20,displayFormat:"yyyy-MM-dd",onValueChanged:function(e){},bindingOptions:{value:"_datefrom"}},e.date_to={type:"date",placeholder:"To",width:"100%",height:22,displayFormat:"yyyy-MM-dd",onValueChanged:function(e){},bindingOptions:{value:"_dateto"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.TopDelayedFlights=null,e.chart_most_delayed={palette:"Vintage",commonSeriesSettings:{barWidth:30,label:{font:{size:11},position:"inside"}},argumentAxis:{label:{font:{size:11},overlappingBehavior:"rotate",rotationAngle:-45,position:"inside"}},series:{argumentField:"Remark",valueField:"Delay",type:"bar"},legend:{visible:!1},scrollBar:{visible:!0,width:5},zoomAndPan:{argumentAxis:"both"},bindingOptions:{dataSource:"TopDelayedFlights"}},e.PaxLoadRoute=null,e.chart_paxload={palette:"Bright",commonSeriesSettings:{barWidth:30,label:{font:{size:11},position:"inside"}},argumentAxis:{label:{font:{size:11},overlappingBehavior:"rotate",rotationAngle:-45,position:"inside"}},series:{argumentField:"Route",valueField:"PaxLoad",type:"bar"},legend:{visible:!1},scrollBar:{visible:!0,width:5},zoomAndPan:{argumentAxis:"both"},bindingOptions:{dataSource:"PaxLoadRoute"}},e.DelayCategories=[],e.chart_delay_category={type:"doughnut",palette:"Soft Pastel",legend:{horizontalAlignment:"right",verticalAlignment:"top",margin:0,visible:!1},series:[{argumentField:"Category",valueField:"Delay",label:{visible:!0,font:{size:11},connector:{visible:!0},customizeText:function(e){return e.argumentText.substr(0,4)+" ("+e.percentText+")"}}}],bindingOptions:{dataSource:"DelayCategories"}},e.chart_pax={type:"doughnut",palette:"Bright",legend:{horizontalAlignment:"right",verticalAlignment:"top",margin:0,visible:!1},series:[{argumentField:"Route",valueField:"TotalPax",label:{visible:!0,font:{size:11},connector:{visible:!0},customizeText:function(e){return e.argumentText+" ("+e.percentText+")"}}}],bindingOptions:{dataSource:"PaxLoadRoute"}},e.BindSummary=function(){e.boardSummary={Arrived:"-",Departed:"-",TotalFlight:"-",BaggageWeight:"-",BaggageCount:"-",CargoCount:"-",CargoWeight:"-",BlockTime:"-",FlightTime:"-",FlightTimeActual:"-",FixTime:"-",SITATime:"-",Canceled:"-",DateFrom:"-",DateTo:"-",Delay:"-",Diverted:"-",FuelActual:"-",FuelUplift:"-",Pax:"-",PaxLoad:"-",TotalSeat:"-",CargoPerPax:"-",DelayRatio:"-",DelayStr:"-",DelayPerFlightStr:"-",BlockTimeStr:"-",FlightTimeStr:"-",FixTimeStr:"-",FlightTimeActualStr:"-",SITATimeStr:"-",Types:"-",Registers:"-",PaxAdult:"-",PaxChild:"-",PaxInfant:"-"};var t=new Date(e._datefrom),i=new Date(e._dateto),n=t.getFullYear(),a=t.getMonth()+1,l=t.getDate(),r=i.getFullYear(),d=i.getMonth()+1,s=i.getDate();e.loadingVisible=!0,o.getBoardSummaryTotal(Config.CustomerId,n,a,l,r,d,s).then(function(t){e.loadingVisible=!1,t&&(e.boardSummary=t),e.TopDelayedFlights=t.TopDelayedFlights,e.DelayCategories=t.DelayCategories,e.PaxLoadRoute=t.PaxLoadRoute,console.log(e.boardSummary)},function(t){e.loadingVisible=!1})},e.flight={chartDelayRatioConfig:{type:"doughnut",data:{labels:["Delay","Flight Time"],datasets:[{data:[],backgroundColor:["#FF6384","#36A2EB"],hoverBackgroundColor:["#FF6384","#36A2EB"]}]},options:{legend:{display:!0,position:"bottom"},responsive:!0,cutoutPercentage:70,layout:{padding:{left:0,right:0,top:0,bottom:0}}}},chartDelayRatio:null,chartMostDelayedConfig:{type:"bar",data:{
labels:[],datasets:[{label:"Count",backgroundColor:Chart.helpers.color(Colors.getColor(0)).alpha(.5).rgbString(),borderColor:Colors.getColor(0),borderWidth:1,data:[]}]},options:{responsive:!0,scales:{xAxes:[{maxBarThickness:50,ticks:{fontSize:9,autoSkip:!1}}],yAxes:[{ticks:{min:0,stepSize:5}}]},legend:{display:!1,position:"top"},title:{display:!1,text:"Chart.js Bar Chart"}}},chartMostDelay:null,chartPaxLoadConfig:{type:"bar",data:{labels:[],datasets:[{label:"Count",backgroundColor:Chart.helpers.color(Colors.getColor(3)).alpha(.5).rgbString(),borderColor:Colors.getColor(3),borderWidth:1,data:[]}]},options:{responsive:!0,scales:{xAxes:[{maxBarThickness:50,ticks:{fontSize:9,autoSkip:!1}}],yAxes:[{ticks:{min:0,max:1,stepSize:.1}}]},legend:{display:!1,position:"top"},title:{display:!1,text:"Chart.js Bar Chart"}}},chartPaxLoad:null,Init:function(e){$(".flight").fadeIn()},flightSummary:{},Airports:[],Bind:function(t){e.BindSummary()}},e.profile={RegisteringCourse:null,ActiveCourse:null,CompletedCourse:null,Passport:null,NDT:null,CAO:null,Medical:null,Certificate:null,chartEmployeesGroupConfig:{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],hoverBackgroundColor:[]}]},options:{title:{display:!0,text:"Groups",position:"top"},legend:{display:!0,position:"bottom",labels:{boxWidth:10,fontSize:10}},responsive:!0,cutoutPercentage:70,layout:{padding:{left:0,right:0,top:0,bottom:0}}}},chartEmployeesGroup:null,chartEmployeesDepartmentConfig:{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],hoverBackgroundColor:[]}]},options:{title:{display:!0,text:"Departments",position:"top"},legend:{display:!0,position:"bottom",labels:{boxWidth:10,fontSize:10}},responsive:!0,cutoutPercentage:70,layout:{padding:{left:0,right:0,top:0,bottom:0}}}},chartEmployeesDepartment:null,chartEmployeesStudyConfig:{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],hoverBackgroundColor:[]}]},options:{title:{display:!0,text:"Fields of Study",position:"top"},legend:{display:!0,position:"bottom",labels:{boxWidth:10,fontSize:10}},responsive:!0,cutoutPercentage:70,layout:{padding:{left:0,right:0,top:0,bottom:0}}}},chartEmployeesStudy:null,chartEmployeesDegreeConfig:{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],hoverBackgroundColor:[]}]},options:{title:{display:!0,text:"Education Degree",position:"top"},legend:{display:!0,position:"bottom",labels:{boxWidth:10,fontSize:10}},responsive:!0,cutoutPercentage:70,layout:{padding:{left:0,right:0,top:0,bottom:0}}}},chartEmployeesDegree:null,chartEmployeesSexConfig:{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],hoverBackgroundColor:[]}]},options:{title:{display:!0,text:"Gender",position:"top"},legend:{display:!0,position:"bottom",labels:{boxWidth:10,fontSize:10}},responsive:!0,cutoutPercentage:70,layout:{padding:{left:0,right:0,top:0,bottom:0}}}},chartEmployeesSex:null,chartEmployeesAgeConfig:{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],hoverBackgroundColor:[]}]},options:{title:{display:!0,text:"Age",position:"top"},legend:{display:!0,position:"bottom",labels:{boxWidth:5,fontSize:10}},responsive:!0,cutoutPercentage:70,layout:{padding:{left:0,right:0,top:0,bottom:0}}}},chartEmployeesAge:null,chartEmployeesExpConfig:{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],hoverBackgroundColor:[]}]},options:{title:{display:!0,text:"Experience",position:"top"},legend:{display:!0,position:"bottom",labels:{boxWidth:5,fontSize:10}},responsive:!0,cutoutPercentage:70,layout:{padding:{left:0,right:0,top:0,bottom:0}}}},chartEmployeesExp:null,chartEmployeesExpCompanyConfig:{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],hoverBackgroundColor:[]}]},options:{title:{display:!0,text:"Experience (Company)",position:"top"},legend:{display:!0,position:"bottom",labels:{boxWidth:5,fontSize:10}},responsive:!0,cutoutPercentage:70,layout:{padding:{left:0,right:0,top:0,bottom:0}}}},chartEmployeesExpCompany:null,chartCertificatesTypesConfig:{type:"bar",data:{labels:[],datasets:[{label:"Count",backgroundColor:Chart.helpers.color(Colors.getColor(1)).alpha(.5).rgbString(),borderColor:Colors.getColor(1),borderWidth:1,data:[]}]},options:{responsive:!0,scales:{xAxes:[{maxBarThickness:100,ticks:{fontSize:9,autoSkip:!1}}],yAxes:[{ticks:{min:0,stepSize:5}}]},legend:{display:!1,position:"top"},title:{display:!1,text:"Chart.js Bar Chart"}}},chartCertificatesTypes:null,Bind:function(t){console.log(t.EmployeesJobGroup),e.profile.RegisteringCourse=t.RegisteringCourse,e.profile.ActiveCourse=t.ActiveCourse,e.profile.CompletedCourse=t.CompletedCourse,e.profile.Passport=t.Passport,e.profile.NDT=t.NDT,e.profile.CAO=t.CAO,e.profile.Medical=t.Medical,e.profile.Certificate=t.Certificate,$.each(t.CertificatesTypes,function(t,i){e.profile.chartCertificatesTypesConfig.data.labels.push(i.CourseTypeTitle),e.profile.chartCertificatesTypesConfig.data.datasets[0].data.push(i.Count)}),$.each(t.EmployeesJobGroup,function(t,i){var n=Colors.getColor(t);e.profile.chartEmployeesGroupConfig.data.labels.push(i.RootTitle),e.profile.chartEmployeesGroupConfig.data.datasets[0].data.push(i.Count),e.profile.chartEmployeesGroupConfig.data.datasets[0].backgroundColor.push(n),e.profile.chartEmployeesGroupConfig.data.datasets[0].hoverBackgroundColor.push(n)}),$.each(t.EmployeesLocation,function(t,i){var n=Colors.getColorReverse(t);e.profile.chartEmployeesDepartmentConfig.data.labels.push(i.Title),e.profile.chartEmployeesDepartmentConfig.data.datasets[0].data.push(i.Count),e.profile.chartEmployeesDepartmentConfig.data.datasets[0].backgroundColor.push(n),e.profile.chartEmployeesDepartmentConfig.data.datasets[0].hoverBackgroundColor.push(n)}),$.each(t.EmployeesStudyField,function(t,i){var n=Colors.getRandom();e.profile.chartEmployeesStudyConfig.data.labels.push(i.StudyField),e.profile.chartEmployeesStudyConfig.data.datasets[0].data.push(i.Count),e.profile.chartEmployeesStudyConfig.data.datasets[0].backgroundColor.push(n),e.profile.chartEmployeesStudyConfig.data.datasets[0].hoverBackgroundColor.push(n)}),$.each(t.EmployeesDegree,function(t,i){var n=Colors.getRandom();e.profile.chartEmployeesDegreeConfig.data.labels.push(i.EducationDegree),e.profile.chartEmployeesDegreeConfig.data.datasets[0].data.push(i.Count),e.profile.chartEmployeesDegreeConfig.data.datasets[0].backgroundColor.push(n),e.profile.chartEmployeesDegreeConfig.data.datasets[0].hoverBackgroundColor.push(n)}),$.each(t.EmployeeSex,function(t,i){var n=Colors.getColor(t);e.profile.chartEmployeesSexConfig.data.labels.push(i.Sex),e.profile.chartEmployeesSexConfig.data.datasets[0].data.push(i.Count),e.profile.chartEmployeesSexConfig.data.datasets[0].backgroundColor.push(n),e.profile.chartEmployeesSexConfig.data.datasets[0].hoverBackgroundColor.push(n)});var i=Colors.getColor(9);e.profile.chartEmployeesExpConfig.data.labels.push("-5"),e.profile.chartEmployeesExpConfig.data.datasets[0].data.push(t.EmployeesExp.Exp0005),e.profile.chartEmployeesExpConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesExpConfig.data.datasets[0].hoverBackgroundColor.push(i),i=Colors.getColor(10),e.profile.chartEmployeesExpConfig.data.labels.push("5-10"),e.profile.chartEmployeesExpConfig.data.datasets[0].data.push(t.EmployeesExp.Exp0510),e.profile.chartEmployeesExpConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesExpConfig.data.datasets[0].hoverBackgroundColor.push(i),i=Colors.getColor(6),e.profile.chartEmployeesExpConfig.data.labels.push("10-20"),e.profile.chartEmployeesExpConfig.data.datasets[0].data.push(t.EmployeesExp.Exp1020),e.profile.chartEmployeesExpConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesExpConfig.data.datasets[0].hoverBackgroundColor.push(i),i=Colors.getColor(4),e.profile.chartEmployeesExpConfig.data.labels.push("+20"),e.profile.chartEmployeesExpConfig.data.datasets[0].data.push(t.EmployeesExp.Exp2000),e.profile.chartEmployeesExpConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesExpConfig.data.datasets[0].hoverBackgroundColor.push(i),i=Colors.getColor(9),e.profile.chartEmployeesExpCompanyConfig.data.labels.push("-5"),e.profile.chartEmployeesExpCompanyConfig.data.datasets[0].data.push(t.EmployeesExp.ExpCompany0005),e.profile.chartEmployeesExpCompanyConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesExpCompanyConfig.data.datasets[0].hoverBackgroundColor.push(i),i=Colors.getColor(10),e.profile.chartEmployeesExpCompanyConfig.data.labels.push("5-10"),e.profile.chartEmployeesExpCompanyConfig.data.datasets[0].data.push(t.EmployeesExp.ExpCompany0510),e.profile.chartEmployeesExpCompanyConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesExpCompanyConfig.data.datasets[0].hoverBackgroundColor.push(i),i=Colors.getColor(6),e.profile.chartEmployeesExpCompanyConfig.data.labels.push("10-20"),e.profile.chartEmployeesExpCompanyConfig.data.datasets[0].data.push(t.EmployeesExp.ExpCompany1020),e.profile.chartEmployeesExpCompanyConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesExpCompanyConfig.data.datasets[0].hoverBackgroundColor.push(i),i=Colors.getColor(4),e.profile.chartEmployeesExpCompanyConfig.data.labels.push("+20"),e.profile.chartEmployeesExpCompanyConfig.data.datasets[0].data.push(t.EmployeesExp.ExpCompany2000),e.profile.chartEmployeesExpCompanyConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesExpCompanyConfig.data.datasets[0].hoverBackgroundColor.push(i),i=Colors.getColor(9),e.profile.chartEmployeesAgeConfig.data.labels.push("-25"),e.profile.chartEmployeesAgeConfig.data.datasets[0].data.push(t.EmployeesAge.Age0025),e.profile.chartEmployeesAgeConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesAgeConfig.data.datasets[0].hoverBackgroundColor.push(i),i=Colors.getColor(10),e.profile.chartEmployeesAgeConfig.data.labels.push("25-30"),e.profile.chartEmployeesAgeConfig.data.datasets[0].data.push(t.EmployeesAge.Age2530),e.profile.chartEmployeesAgeConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesAgeConfig.data.datasets[0].hoverBackgroundColor.push(i),i=Colors.getColor(6),e.profile.chartEmployeesAgeConfig.data.labels.push("30-40"),e.profile.chartEmployeesAgeConfig.data.datasets[0].data.push(t.EmployeesAge.Age3040),e.profile.chartEmployeesAgeConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesAgeConfig.data.datasets[0].hoverBackgroundColor.push(i),i=Colors.getColor(4),e.profile.chartEmployeesAgeConfig.data.labels.push("40-50"),e.profile.chartEmployeesAgeConfig.data.datasets[0].data.push(t.EmployeesAge.Age4050),e.profile.chartEmployeesAgeConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesAgeConfig.data.datasets[0].hoverBackgroundColor.push(i),i=Colors.getColor(11),e.profile.chartEmployeesAgeConfig.data.labels.push("+50"),e.profile.chartEmployeesAgeConfig.data.datasets[0].data.push(t.EmployeesAge.Age5000),e.profile.chartEmployeesAgeConfig.data.datasets[0].backgroundColor.push(i),e.profile.chartEmployeesAgeConfig.data.datasets[0].hoverBackgroundColor.push(i)},Init:function(t){e.profile.chartEmployeesGroup=new Chart($("#chart-employees-group"),e.profile.chartEmployeesGroupConfig),e.profile.chartEmployeesDepartment=new Chart($("#chart-employees-department"),e.profile.chartEmployeesDepartmentConfig),e.profile.chartEmployeesStudy=new Chart($("#chart-employees-study"),e.profile.chartEmployeesStudyConfig),e.profile.chartEmployeesDegree=new Chart($("#chart-employees-degree"),e.profile.chartEmployeesDegreeConfig),e.profile.chartEmployeesSex=new Chart($("#chart-employees-sex"),e.profile.chartEmployeesSexConfig),e.profile.chartEmployeesAge=new Chart($("#chart-employees-age"),e.profile.chartEmployeesAgeConfig),e.profile.chartEmployeesExp=new Chart($("#chart-employees-exp"),e.profile.chartEmployeesExpConfig),e.profile.chartEmployeesExpCompany=new Chart($("#chart-employees-expcompany"),e.profile.chartEmployeesExpCompanyConfig),e.profile.chartCertificatesTypes=new Chart($("#chart-certificatestypes"),e.profile.chartCertificatesTypesConfig),e.profile.Bind(t),$(".profile").fadeIn()}},e.library={publishers:"-",authors:"-",journals:"-",DocumentsTotal:"-",BooksTotal:"-",PapersTotal:"-",VideosTotal:"-",DocumentsNotExposed:"-",BooksNotExposed:"-",PapersNotExposed:"-",VideosNotExposed:"-",Careless:"-",DownloadTotal:"-",Total:"-",chartDistributionConfig:{type:"doughnut",data:{labels:["Books","Videos","Papers"],datasets:[{data:[],backgroundColor:["#FF6384","#36A2EB","#FFCE56"],hoverBackgroundColor:["#FF6384","#36A2EB","#FFCE56"]}]},options:{legend:{display:!0,position:"bottom"},responsive:!0,cutoutPercentage:70,layout:{padding:{left:0,right:0,top:0,bottom:0}}}},chartDistribution:null,cardChartCarelessConfig:{type:"bar",data:{labels:["Books","Videos","Papers","Documents"],datasets:[{label:"",backgroundColor:"rgba(255,255,255,.2)",borderColor:"rgba(255,255,255,.55)",data:[]}]},options:{maintainAspectRatio:!1,legend:{display:!1},scales:{xAxes:[{display:!1,barPercentage:.5}],yAxes:[{display:!1}]}}},cardChartCareless:null,cardChartDownloads:null,cardChartDownloadsConfig:{type:"line",data:{labels:[],datasets:[{label:"Downloads",backgroundColor:"transparent",borderColor:"rgba(255,255,255,.55)",data:[]}]},options:{maintainAspectRatio:!1,legend:{display:!1},scales:{xAxes:[{gridLines:{color:"transparent",zeroLineColor:"transparent"},ticks:{fontSize:2,fontColor:"transparent"}}],yAxes:[{display:!1,ticks:{display:!1,min:0}}]},elements:{line:{borderWidth:1},point:{radius:4,hitRadius:10,hoverRadius:4}}}},cardChartItems:null,cardChartItemsConfig:{type:"line",data:{labels:[],datasets:[{label:"Added",backgroundColor:"transparent",borderColor:"rgba(255,255,255,.55)",data:[]}]},options:{maintainAspectRatio:!1,legend:{display:!1},scales:{xAxes:[{gridLines:{color:"transparent",zeroLineColor:"transparent"},ticks:{fontSize:2,fontColor:"transparent"}}],yAxes:[{display:!1,ticks:{display:!1,min:0}}]},elements:{line:{borderWidth:1},point:{radius:4,hitRadius:10,hoverRadius:4}}}},Bind:function(t){e.library.Total=t.DocumentsTotal+t.BooksTotal+t.PapersTotal+t.VideosTotal,e.library.Careless=t.Careless,e.library.DownloadTotal=t.DownloadTotal,e.library.publishers=t.Publishers,e.library.journals=t.Journals,e.library.authors=t.Authors,e.library.DocumentsTotal=t.DocumentsTotal,e.library.BooksTotal=t.BooksTotal,e.library.PapersTotal=t.PapersTotal,e.library.VideosTotal=t.VideosTotal,e.library.DocumentsNotExposed=t.DocumentsNotExposed,e.library.BooksNotExposed=t.BooksNotExposed,e.library.PapersNotExposed=t.PapersNotExposed,e.library.VideosNotExposed=t.VideosNotExposed,$(".libcount").fadeIn(),e.library.chartDistributionConfig.data.datasets[0].data.push(t.BooksTotal),e.library.chartDistributionConfig.data.datasets[0].data.push(t.VideosTotal),e.library.chartDistributionConfig.data.datasets[0].data.push(t.PapersTotal),e.library.chartDistribution.update(),e.library.cardChartCarelessConfig.data.datasets[0].data.push(t.CarelessBook),e.library.cardChartCarelessConfig.data.datasets[0].data.push(t.CarelessVideo),e.library.cardChartCarelessConfig.data.datasets[0].data.push(t.CarelessPaper),e.library.cardChartCarelessConfig.data.datasets[0].data.push(t.CarelessDocument),e.library.cardChartCareless.update();var i=0;$.each(t.Download,function(t,n){n.Total>i&&(i=n.Total),e.library.cardChartDownloadsConfig.data.labels.push(n.MonthName),e.library.cardChartDownloadsConfig.data.datasets[0].data.push(n.Total)}),e.library.cardChartDownloadsConfig.options.scales.yAxes[0].ticks.max=i+1,e.library.cardChartDownloads.update(),i=0,$.each(t.Add,function(t,n){n.Total>i&&(i=n.Total),e.library.cardChartItemsConfig.data.labels.push(n.MonthName),e.library.cardChartItemsConfig.data.datasets[0].data.push(n.Total)}),e.library.cardChartItemsConfig.options.scales.yAxes[0].ticks.max=i+1,e.library.cardChartItems.update(),a.getLastExposed(Config.CustomerId,20).then(function(t){$.each(t,function(e,t){if(t.ImageUrl)t.ImageUrl=l.clientsFilesUrl+t.ImageUrl;else{var i="";switch(Number(t.TypeId)){case 83:i="book";break;case 84:i="papers2";break;case 85:i="videos2";break;case 86:i="docs2"}t.ImageUrl="content/images/"+i+".png"}t.DateExposure=moment(t.DateExposure).format("MMMM Do YYYY, h:mm:ss a")}),e.recent=t,console.log(e.recent)},function(e){})},Init:function(t){e.library.cardChartCareless=new Chart($("#card-chart-careless"),e.library.cardChartCarelessConfig),e.library.cardChartDownloads=new Chart($("#card-chart-downloads"),e.library.cardChartDownloadsConfig);new Chart($("#card-chart-activity"),{type:"line",data:{labels:["January","February","March","April","May","June","July"],datasets:[{label:"Activities",backgroundColor:"transparent",borderColor:"#2A66B0",data:[s(),s(),s(),s(),s(),s(),s()]}]},options:{maintainAspectRatio:!1,legend:{display:!1},scales:{xAxes:[{gridLines:{color:"transparent",zeroLineColor:"transparent"},ticks:{fontSize:2,fontColor:"transparent"}}],yAxes:[{display:!1,ticks:{display:!1,min:0,max:110}}]},elements:{line:{borderWidth:2},point:{radius:4,hitRadius:10,hoverRadius:4}}}});e.library.cardChartItems=new Chart($("#card-chart-items"),e.library.cardChartItemsConfig);e.library.chartDistribution=new Chart($("#chart-distribution"),e.library.chartDistributionConfig);new Chart($("#chart-active"),{type:"doughnut",data:{labels:["Active","Inactive"],datasets:[{data:[70,30],backgroundColor:["#36A2EB","#FF6384"],hoverBackgroundColor:["#36A2EB","#FF6384"]}]},options:{legend:{display:!1},responsive:!0,cutoutPercentage:0,layout:{padding:{left:5,right:5,top:10,bottom:5}}}});e.library.Bind(t),$(".library").fadeIn()}},e.FillLibrary=function(e){},e.lastHits=[],e.lastActivities=[],e.recent=[],i.isAuthorized())if(3!=l.moduleId){var c=Enumerable.From(Config.MenuItems).Where(function(e){return e.moduleId==l.moduleId&&l.HasMenuAccess(e.key,l.moduleId)}).ToArray();e.lastHits=c,n.getDashboard(Config.CustomerId,l.moduleId).then(function(t){switch(Number(l.moduleId)){case 1:e.profile.Init(t);break;case 2:e.library.Init(t);break;case 3:e.flight.Init(t),e.flight.Bind()}n.getLastActivities(Config.CustomerId,l.moduleId,l.userId,10).then(function(t){$.each(t,function(e,t){t.ImageUrl=t.ImageUrl?l.clientsFilesUrl+t.ImageUrl:"content/images/imguser.png",t.Date=moment(t.Date).format("MMMM Do YYYY, h:mm:ss a")}),e.lastActivities=t},function(e){})},function(e){})}else e.flight.Init(),e.flight.Bind();else i.redirectToLogin()}]),app.controller("associateController",["$scope","$location","$timeout","authService",function(e,t,i,n){e.savedSuccessfully=!1,e.message="",e.registerData={userName:n.externalAuthData.userName,provider:n.externalAuthData.provider,externalAccessToken:n.externalAuthData.externalAccessToken},e.registerExternal=function(){n.registerExternal(e.registerData).then(function(t){e.savedSuccessfully=!0,e.message="User has been registered successfully, you will be redicted to orders page in 2 seconds.",a()},function(t){var i=[];for(var n in t.modelState)i.push(t.modelState[n]);e.message="Failed to register user due to:"+i.join(" ")})};var a=function(){var e=i(function(){i.cancel(e),t.path("/orders")},2e3)}}]),app.controller("courseTypeController",["$scope","$location","$routeParams","$rootScope","courseService","authService",function(e,t,i,n,a,o){e.prms=i.prms,e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.deleteCourseType(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(e){var t={Id:null};n.$broadcast("InitAddCourseType",t)}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitAddCourseType",i)}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.filters=[],e.dg_columns=[{cellTemplate:function(e,t){$("<div style='text-align:center'/>").html(t.rowIndex+1).appendTo(e)},caption:"#",width:60,fixed:!0,fixedPosition:"left",allowResizing:!1,cssClass:"rowHeader"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Interval2",caption:"Interval",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:300},{dataField:"CoursesCount",caption:"Courses",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+"odata/courses/types",key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:["Title"]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},o.isAuthorized()?(n.page_title="> Course Types",$(".coursetype").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onCourseTypeSaved",function(t,i){e.doRefresh=!0}),e.$on("onCourseTypeHide",function(t,i){e.bind()}),n.$broadcast("CourseTypeLoaded",null)}]),app.controller("coursepersonController",["$scope","$location","$routeParams","$rootScope","courseService","authService",function(e,t,i,n,a,o){e.prms=i.prms,e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(e){var t={Id:null};n.$broadcast("InitAddCourse",t)}},e.btn_employees={text:"Employees",type:"default",icon:"group",width:200,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.courseEmployee.Id=e.dg_selected.Id,e.popup_employees_visible=!0}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitAddCourse",i)}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitAddCourse",i)}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".filter").show())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_columns=[{dataField:"StatusId",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="pending-24";switch(t.value){case 1:i="registered-24";break;case-1:i="canceled-24";break;case 2:i="Attended-24";break;case 3:i="passed-24"}$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"Status",caption:"Status",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left",sortIndex:0,sortOrder:"desc"},{dataField:"No",caption:"No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300,fixed:!0,fixedPosition:"left"},{dataField:"CT_Title",caption:"Course Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Duration2",caption:"Duration",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"DateStart",caption:"DateStart",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,sortIndex:0,sortOrder:"asc"},{dataField:"DateEnd",caption:"DateEnd",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"Recurrent",caption:"Recurrent",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100},{dataField:"AircraftType",caption:"Aircraft Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:120},{dataField:"Organization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Instructor",caption:"Instructor",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"TrainingDirector",caption:"Training Director",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150}],e.dg_selected=null,e.summary={Pending:"-",Canceled:"-",Total:"-",Registered:"-",Attended:"-",Failed:"-",Passed:"-"},e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,e.summary={Pending:i.Pending,Canceled:i.Canceled,Total:i.Total,Registered:i.Registered,Attended:i.Attended,Failed:i.Failed,Passed:i.Passed}):(e.dg_selected=null,e.summary={Pending:"-",Canceled:"-",Total:"-",Registered:"-",Attended:"-",Failed:"-",Passed:"-"})},bindingOptions:{dataSource:"dg_ds"}},e.selectedEmployees=null,e.pop_width_employees=600,e.pop_height_employees=450,e.dg_height_full=100,e.scroll_height_full=400,e.popup_employees_visible=!1,e.popup_employees_title="Employees",e.popup_employees={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",width:200,text:"change Status",icon:"event",onClick:function(t){return e.selectedEmployees=n.getSelectedRows(e.dg_employees_instance),e.selectedEmployees?Enumerable.From(e.selectedEmployees).Select("$.StatusId").Distinct().ToArray().length>1?void General.ShowNotify("The selected statuses are different.","error"):(e.courseStatus.People=Enumerable.From(e.selectedEmployees).Select("$.PersonId").ToArray(),e.courseStatus.CourseId=e.courseEmployee.Id,e.courseStatus.OldStatus=e.selectedEmployees[0].Status,e.courseStatus.OldStatus||(e.courseStatus.OldStatus="Pending"),void(e.popup_status_visible=!0)):void General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",width:200,text:"Certification",icon:"check",onClick:function(t){if(e.selectedEmployees=n.getSelectedRows(e.dg_employees_instance),!e.selectedEmployees)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.courseStatus.People=[],e.courseStatus.People.push(e.selectedEmployees[0].PersonId),e.courseStatus.CourseId=e.courseEmployee.Id,e.courseStatus.Name=e.selectedEmployees[0].Name,e.courseStatus.OldStatus=e.selectedEmployees[0].Status,e.courseStatus.StatusId=71,e.courseStatus.OldStatus||(e.courseStatus.OldStatus="Pending"),e.popup_passed_visible=!0}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_employees_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=n.getWindowSize();e.pop_width_employees=i.width-20,e.pop_height_employees=$(window).height()-30,e.dg_height_full=e.pop_height_employees-133,e.dg_employees_height=e.dg_height_full-81,e.scroll_height_full=e.pop_height_employees-133},onShown:function(t){e.bindEmployees()},onHiding:function(){$(".cn").removeClass("w3-2017-flame"),e.courseEmployee={Id:-1,Total:"-",Pending:"-",Registered:"-",Attended:"-",Canceled:"-",Failed:"-",Passed:"-",ApplicablePeople:[]},e.popup_employees_visible=!1},bindingOptions:{visible:"popup_employees_visible",width:"pop_width_employees",height:"pop_height_employees",title:"popup_employees_title"}},e.popup_status_visible=!1,e.popup_status={height:340,width:550,fullScreen:!1,showTitle:!0,title:"Change Status",toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"statusChange",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.loadingVisible=!0,a.changeStatus(e.courseStatus).then(function(t){$.each(e.selectedEmployees,function(t,i){i.StatusId=72!=e.courseStatus.StatusId?e.courseStatus.StatusId:null,i.Status=72!=e.courseStatus.Status?e.courseStatus.Status:null,i.CerNumber=null,i.DateIssue=null}),e.courseEmployee.Failed=t.Failed,e.courseEmployee.Pending=t.Pending,e.courseEmployee.Total=t.Total,e.courseEmployee.Registered=t.Registered,e.courseEmployee.Canceled=t.Canceled,e.courseEmployee.Passed=t.Passed,e.courseEmployee.Attended=t.Attended,General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.dg_employees_instance.clearSelection(),e.popup_status_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{
widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_status_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHidden:function(){e.dg_employees_instance.refresh()},onHiding:function(){e.courseStatus={CourseId:null,SMS:!0,Email:!0,AppNotification:!0,StatusId:null,Status:null,OldStatus:null,Remark:null,IssueDate:null,No:null,People:[]},e.popup_status_visible=!1},bindingOptions:{visible:"popup_status_visible"}},e.popup_passed_visible=!1,e.popup_passed={height:440,width:550,fullScreen:!1,showTitle:!0,title:"Certification",toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"passed",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.loadingVisible=!0,a.changeStatus(e.courseStatus).then(function(t){e.selectedEmployees[0].StatusId=71,e.selectedEmployees[0].Status="Passed",e.selectedEmployees[0].CerNumber=e.courseStatus.No,e.selectedEmployees[0].DateIssue=e.courseStatus.IssueDate,e.courseEmployee.Failed=t.Failed,e.courseEmployee.Pending=t.Pending,e.courseEmployee.Total=t.Total,e.courseEmployee.Registered=t.Registered,e.courseEmployee.Canceled=t.Canceled,e.courseEmployee.Passed=t.Passed,e.courseEmployee.Attended=t.Attended,e.dg_employees_instance.refresh(),General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.popup_passed_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_passed_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.courseStatus={CourseId:null,SMS:!0,Email:!0,AppNotification:!0,StatusId:null,Status:null,OldStatus:null,Remark:null,IssueDate:null,No:null,People:[]},e.popup_passed_visible=!1},bindingOptions:{visible:"popup_passed_visible"}},e.scroll_employees={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height_full"}},e.txt_Title={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseEmployee.Title"}},e.txt_Type={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseEmployee.CT_Title"}},e.txt_No={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseEmployee.No"}},e.txt_Organization={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseEmployee.Organization"}},e.txt_Location={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseEmployee.Location"}},e.txt_Instructor={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseEmployee.Instructor"}},e.txt_TrainingDirector={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseEmployee.TrainingDirector"}},e.txt_Remark={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseEmployee.Remark"}},e.txt_Remaining={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseEmployee.RemainRegistration"}},e.date_DateStart={width:"100%",type:"date",displayFormat:n.DateBoxFormat,bindingOptions:{value:"courseEmployee.DateStart"}},e.date_DateEnd={width:"100%",type:"date",displayFormat:n.DateBoxFormat,bindingOptions:{value:"courseEmployee.DateEnd"}},e.date_DateDeadlineRegistration={width:"100%",type:"date",displayFormat:n.DateBoxFormat,bindingOptions:{value:"courseEmployee.DateDeadlineRegistration"}},e.dg_employees_columns=[{dataField:"StatusId",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="pending-24";switch(t.value){case 67:i="registered-24";break;case 69:i="canceled-24";break;case 68:i="Attended-24";break;case 70:i="failed-24";break;case 71:i="passed-24"}$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"Status",caption:"Status",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left",sortIndex:0,sortOrder:"desc"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250,fixed:!0,fixedPosition:"left",sortIndex:1,sortOrder:"asc"},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Mobile",caption:"Mobile",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"Email",caption:"Email",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"DateJoinCompany",caption:"Join Company",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"CaoCardNumber",caption:"CAO No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"NDTNumber",caption:"NDT No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"CerNumber",caption:"Certificate No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"DateIssue",caption:"Issue Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130}],e.dg_employees_height=100,e.dg_employees_selected=null,e.dg_employees_instance=null,e.dg_employees_ds=null,e.dg_employees={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"multiple"},columnAutoWidth:!1,height:"100%",columns:e.dg_employees_columns,onContentReady:function(t){e.dg_employees_instance||(e.dg_employees_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_employees_selected=i||null},bindingOptions:{dataSource:"courseEmployee.ApplicablePeople",height:"dg_employees_height"}},e.courseStatus={SMS:!0,Email:!0,AppNotification:!0,StatusId:null,Status:null,CourseId:null,OldStatus:null,Remark:null,IssueDate:null,No:null,Name:null,People:[]},e.isCertidicateDisabled=!0,e.sb_StatusId={showClearButton:!0,searchEnabled:!1,dataSource:n.getDatasourcePersonCourseStatus(),displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){if(t.selectedItem){var i=71==t.selectedItem.Id;e.isCertidicateDisabled=!i}},bindingOptions:{value:"courseStatus.StatusId",text:"courseStatus.Status"}},e.txt_OldStatus={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseStatus.OldStatus"}},e.chb_SMS={text:"Send SMS",bindingOptions:{value:"courseStatus.SMS"}},e.chb_Email={text:"Send Email",bindingOptions:{value:"courseStatus.Email"}},e.chb_AppNotification={text:"Send Notification",bindingOptions:{value:"courseStatus.AppNotification"}},e.txt_StatusRemark={hoverStateEnabled:!1,bindingOptions:{value:"courseStatus.Remark"}},e.txt_CertificateNo={hoverStateEnabled:!1,bindingOptions:{value:"courseStatus.No"}},e.txt_Name={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseStatus.Name"}},e.date_DateIssue={width:"100%",type:"date",displayFormat:n.DateBoxFormat,bindingOptions:{value:"courseStatus.IssueDate"}},e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+"odata/courses/active/"+Config.CustomerId,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}}}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.courseEmployee={Id:-1,Total:"-",Pending:"-",Registered:"-",Attended:"-",Canceled:"-",Failed:"-",Passed:"-",ApplicablePeople:[]},e.bindEmployees=function(){e.loadingVisible=!0,a.getActiveCourse(e.courseEmployee.Id).then(function(t){e.loadingVisible=!1,e.courseEmployee=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.filterStatus=function(t,i){var n=$(t.currentTarget).hasClass("w3-2017-flame");$(".cn").removeClass("w3-2017-flame"),n?i=null:$(t.currentTarget).addClass("w3-2017-flame"),i?-1!=i?e.dg_employees_instance.filter("StatusId","=",Number(i)):e.dg_employees_instance.filter("StatusId","=",null):e.dg_employees_instance.clearFilter()},o.isAuthorized()?(n.page_title="> Courses",$(".courseperson").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onCourseSaved",function(t,i){e.doRefresh=!0}),e.$on("onCourseHide",function(t,i){e.bind()}),$(".sum-wrapper").height($(window).height()-200),n.$broadcast("PersonLoaded",null)}]),app.controller("filterController",function(e,t,i,n){n.url();$("."+e.type).show(),e.table=Enumerable.From(Config.Types).Where("$.type =='"+e.type+"'").FirstOrDefault(),e.table&&(e.table=e.table.table),e.stringOperatorDs=[{Id:1,Title:"Contains"},{Id:2,Title:"Starts with"},{Id:3,Title:"Ends with"}],e.numberOperatorDs=[{Id:4,Title:"Equals"},{Id:5,Title:">"},{Id:6,Title:"<"}],e.operatorName=1,e.sb_city={showClearButton:!0,searchEnabled:!0,dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.ODataStore({url:t.serviceUrl+"odata/cities/all",version:4}),sort:["City"]}),searchExpr:["City","Country"],valueExpr:"Id",searchMode:"startsWith",displayExpr:"FullName"},e.sb_location={dataSource:t.getDatasourceLoctionCustomer(),itemTemplate:function(e){return t.getSbTemplateLocation2(e)},showClearButton:!0,searchEnabled:!0,searchExpr:["Title","FullCode"],valueExpr:"Id",displayExpr:"Title",bindingOptions:{value:"entity.LocationId",readOnly:"IsMainDisabled"}},this.$onInit=function(){},this.$postLink=function(){$(".sboption").each(function(e){var i=$(this).attr("pid");$(this).dxSelectBox("instance").option("dataSource",t.getDatasourceOption(Number(i)))}),$(".sbcity").each(function(e){})},e.onOptionInitialized=function(e){$(e.element).attr("pid")},e.getOperatorStr=function(e){switch(e){case 1:return"contains";case 2:return"startswith";case 3:return"endswith";case 4:return"=";case 5:return">";case 6:return"<";default:return""}},e.getIdStr=function(t){if(!e.table)return t;var i=Enumerable.From(Config.Fields).Where("$.key ==  '"+t+"'").FirstOrDefault();return i?i.value:t},e.$on("getFilterQuery",function(i,n){var a=[];$(".item").each(function(t){var i="",n=$(this).attr("id"),o=$(this).find(".operator").dxSelectBox("instance"),l=o.option("value"),r=$(this).find(".text"),d=$(this).find(".date"),s=$(this).find(".number"),c=$(this).find(".sb"),g=null;if(r.length>0){i=r.dxTextBox("instance").option("value"),g="text"}else d.length>0?(i=d.dxDateBox("instance").option("value"),g="date"):s.length>0?(i=s.dxNumberBox("instance").option("value"),g="number"):c.length>0&&(i=c.dxSelectBox("instance").option("value"),g="number");if(i&&"null"!=i){var u=[],p=e.getIdStr(n);u.push(p),u.push(e.getOperatorStr(l)),"number"==g?u.push(Number(i)):u.push(i),a.push(u),a.push("and")}}),a.length>0&&a.splice(-1,1),t.$broadcast("getFilterResponse",a)}),e.values={TypeId:null},e.$on("initFilters",function(t,i){i.key;$.each(i.values,function(t,i){i.value&&-1!=i.value&&(e.values[i.id]=i.value,$("#"+i.id).hide())})}),t.$broadcast("FilterLoaded",null)}),app.controller("indexController",["$scope","$location","authService",function(e,t,i){e.logOut=function(){i.logOut(),t.path("/home")},e.authentication=i.authentication}]),app.controller("crewReportController",["$scope","$location","$routeParams","$rootScope","flightService","weatherService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d,s){function c(e){var t=$("<iframe />");t[0].name="frame1",t.css({position:"absolute",top:"-1000000px"}),$("body").append(t);var i=t[0].contentWindow?t[0].contentWindow:t[0].contentDocument.document?t[0].contentDocument.document:t[0].contentDocument;i.document.open(),i.document.write("<html><head><title></title>"),i.document.write("<style>"),i.document.write("*{display: hidden;}"),i.document.write("img{display: block; width: 100%; }"),i.document.write("</style>"),i.document.write('</head><body class="gantt">'),i.document.write("<div style='height:100%'><div style='text-align:center;margin-top:30px'>Fly Persia</div><div style='text-align:center;margin-top:10px'>Flights</div><img style='margin-top:10px;height:65%'  src = '"+e.toDataURL()+"'/></div>"),i.document.write("</body></html>"),i.document.close(),setTimeout(function(){window.frames.frame1.focus(),window.frames.frame1.print(),t.remove()},500)}e.prms=i.prms,e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,airportService.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(e){var t={Id:null};n.$broadcast("InitAddPerson",t)}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitAddPerson",i)}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;e.InitAddAirport(i)}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,validationGroup:"crewreportsearch",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.dg_ds=null,e.$broadcast("getFilterQuery",null)}},e.selected_employee_id=null,e.btn_flight={text:"Flights",type:"default",icon:"airplane",width:120,bindingOptions:{},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.selected_employee_id=e.dg_selected.Id,e.fillPerson(e.dg_selected),e.doSearch=!1,e.popup_flight_visible=!0}},e.btn_person={text:"Details",type:"default",icon:"card",width:120,bindingOptions:{},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitViewPerson",i)}},e.btn_flight_total={text:"Flights(Total)",type:"default",icon:"datafield",width:180,bindingOptions:{},onClick:function(t){e.popup_flight_total_visible=!0}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dt_from=new Date,e.dt_to=(new Date).addDays(7),e.date_from={type:"date",placeholder:"From",width:"100%",bindingOptions:{value:"dt_from"}},e.filters=[],e.dg_columns=[{caption:"Base",columns:[{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:80,fixed:!1,fixedPosition:"left"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:180,fixed:!1,fixedPosition:"left"}]},{caption:"Flight",alignment:"center",columns:[{dataField:"Day1_Flight",caption:"Today",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95},{dataField:"Day28_Flight",caption:"28 D",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95,sortIndex:2,sortOrder:"desc"},{dataField:"Year_Flight",caption:"12 M",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95,sortIndex:0,sortOrder:"desc"},{dataField:"CYear_Flight",caption:"Year",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95,sortIndex:1,sortOrder:"desc"}]},{caption:"Duty",alignment:"center",columns:[{dataField:"Day1_Duty",caption:"Today",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95},{dataField:"Day7_Duty",caption:"7 D",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95},{dataField:"Day14_Duty",caption:"14 D",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95},{dataField:"Day28_Duty",caption:"28 D",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95}]},{caption:"Alerts",columns:[{dataField:"",caption:"MEDICAL",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsMedicalExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"Licence",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsLicenceExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsLicenceExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"LPR",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsLPRExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsLPRExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"LPC",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsProficiencyExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsProficiencyExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"CMC",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsCMCExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"CRM",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsUpsetRecoveryTrainingExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsUpsetRecoveryTrainingExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"CCRM",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsCCRMExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"AVSEC",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsAvSecExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"SEPT",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsSEPTExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"DG",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsDGExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"SMS",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsSMSExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"FIRSTAID",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsFirstAidExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsFirstAidExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"COLD W.",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsColdWeatherExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsColdWeatherExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"HOT W.",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsHotWeatherExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsHotWeatherExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}}]}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onCellPrepared:function(e){"data"===e.rowType&&"Day7_Duty"==e.column.dataField&&(e.data.ODay7_Duty>3600?e.cellElement.css("backgroundColor","#ff3333"):e.data.ODay7_Duty>2700&&e.cellElement.css("backgroundColor","#ffa64d")),"data"===e.rowType&&"Day14_Duty"==e.column.dataField&&(e.data.ODay14_Duty>6600?e.cellElement.css("backgroundColor","#ff3333"):e.data.ODay14_Duty>5700&&e.cellElement.css("backgroundColor","#ffa64d")),"data"===e.rowType&&"Day28_Duty"==e.column.dataField&&(e.data.ODay28_Duty>11400?e.cellElement.css("backgroundColor","#ff3333"):e.data.ODay28_Duty>10500&&e.cellElement.css("backgroundColor","#ffa64d")),"data"===e.rowType&&"Day28_Flight"==e.column.dataField&&(e.data.ODay28_Flight>6e3?e.cellElement.css("backgroundColor","#ff3333"):e.data.ODay28_Flight>5400&&e.cellElement.css("backgroundColor","#ffa64d")),"data"===e.rowType&&"Year_Flight"==e.column.dataField&&(e.data.OYear_Flight>6e4?e.cellElement.css("backgroundColor","#ff3333"):e.data.OYear_Flight>59400&&e.cellElement.css("backgroundColor","#ffa64d")),"data"===e.rowType&&"CYear_Flight"==e.column.dataField&&(e.data.OCYear_Flight>54e3?e.cellElement.css("backgroundColor","#ff3333"):e.data.OCYear_Flight>53400&&e.cellElement.css("backgroundColor","#ffa64d"))},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},export:{enabled:!0,fileName:"CrewReport",allowExportSelectedData:!0},bindingOptions:{dataSource:"dg_ds"}},e.person={FirstName:null,LastName:null,PID:null,JobGroup:null,Mobile:null},e.fillPerson=function(t){e.person.FirstName=t.FirstName,e.person.LastName=t.LastName,e.person.PID=t.PID,e.person.JobGroup=t.JobGroup,e.person.Mobile=t.Mobile},e.clearPerson=function(t){e.person.FirstName=null,e.person.LastName=null,e.person.PID=null,e.person.JobGroup=null,e.person.Mobile=null},e.txt_FirstName={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"person.FirstName"}},e.txt_LastName={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"person.LastName"}},e.txt_PID={readOnly:!0,hoverStateEnabled:!1,rtlEnabled:!1,bindingOptions:{value:"person.PID"}},e.txt_group={readOnly:!0,hoverStateEnabled:!1,rtlEnabled:!1,bindingOptions:{value:"person.JobGroup"}},e.txt_Mobile={readOnly:!0,hoverStateEnabled:!1,mask:"AB00-0000000",maskRules:{A:/[0]/,B:/[9]/},maskChar:"_",maskInvalidMessage:"Wrong value",bindingOptions:{value:"person.Mobile"}},e.dg_flight_columns=[{dataField:"Date",caption:"Date",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"yyyy-MMM-dd"},{dataField:"FlightNumber",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!1,fixedPosition:"left"},{dataField:"Position",caption:"Position",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{caption:"Route",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70}]},{caption:"Departure",columns:[{dataField:"STD",caption:"STD",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"}]},{caption:"Arrival",columns:[{dataField:"STA",caption:"STA",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"}]},{caption:"Times",fixed:!0,fixedPosition:"right",columns:[{dataField:"ScheduledFlightTime2",caption:"Flight Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"FixTime2",caption:"Fix Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"BlockTime2",caption:"Block Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100}]}],e.dg_flight_selected=null,e.dg_flight_instance=null,e.dg_flight_ds=null,e.dg_flight={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-235,columns:e.dg_flight_columns,onContentReady:function(t){e.dg_flight_instance||(e.dg_flight_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_flight_selected=i||null},summary:{totalItems:[{name:"FlightTimeTotal",showInColumn:"ScheduledFlightTime2",displayFormat:"{0}",summaryType:"custom"},{name:"BlockTimeTotal",showInColumn:"BlockTime2",displayFormat:"{0}",summaryType:"custom"},{name:"FixTimeTotal",showInColumn:"FixTime2",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"FlightTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.ScheduledFlightTime,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"BlockTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.BlockTime,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"FixTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.FixTime,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_flight_ds"}},e.dg_flight_total_columns=[{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",width:150,allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"Legs",caption:"Legs",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightTime2",caption:"Flight Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"BlockTime2",caption:"Block Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"FixTime2",caption:"Fix Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100}],e.dg_flight_total_selected=null,e.dg_flight_total_instance=null,e.dg_flight_total_ds=null,e.dg_flight_total={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_flight_total_columns,onContentReady:function(t){e.dg_flight_total_instance||(e.dg_flight_total_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_flight_total_selected=i||null},summary:{totalItems:[{name:"FlightTimeTotal",showInColumn:"FlightTime2",displayFormat:"{0}",summaryType:"custom"},{name:"BlockTimeTotal",showInColumn:"BlockTime2",displayFormat:"{0}",summaryType:"custom"},{name:"FixTimeTotal",showInColumn:"FixTime2",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"FlightTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.FlightTime,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"BlockTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.BlockTime,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"FixTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.FixTime,
e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_flight_total_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.jgroup="Cockpit",e.sb_group={showClearButton:!1,searchEnabled:!0,dataSource:["Cockpit","Cabin"],bindingOptions:{value:"jgroup"}},e.bind=function(){var t=moment(e.dt_from).format("YYYY-MM-DDTHH:mm:ss"),i="00101";"Cabin"==e.jgroup&&(i="00102");var a="odata/crew/report/main?date="+t+"&jc="+i;e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+a,key:"Id",version:4,onLoaded:function(e){$.each(e,function(e,t){t.Day1_Duty=pad(Math.floor(t.Day1_Duty/60)).toString()+":"+pad(Math.round(t.Day1_Duty%60)).toString(),t.ODay1_Flight=t.Day1_Flight,t.Day1_Flight=pad(Math.floor(t.Day1_Flight/60)).toString()+":"+pad(Math.round(t.Day1_Flight%60)).toString(),t.ODay7_Duty=t.Day7_Duty,t.Day7_Duty=pad(Math.floor(t.Day7_Duty/60)).toString()+":"+pad(Math.round(t.Day7_Duty%60)).toString(),t.ODay14_Duty=t.Day14_Duty,t.Day14_Duty=pad(Math.floor(t.Day14_Duty/60)).toString()+":"+pad(Math.round(t.Day14_Duty%60)).toString(),t.ODay28_Duty=t.Day28_Duty,t.Day28_Duty=pad(Math.floor(t.Day28_Duty/60)).toString()+":"+pad(Math.round(t.Day28_Duty%60)).toString(),t.ODay28_Flight=t.Day28_Flight,t.Day28_Flight=pad(Math.floor(t.Day28_Flight/60)).toString()+":"+pad(Math.round(t.Day28_Flight%60)).toString(),t.OYear_Flight=t.Year_Flight,t.Year_Flight=pad(Math.floor(t.Year_Flight/60)).toString()+":"+pad(Math.round(t.Year_Flight%60)).toString(),t.OCYear_Flight=t.CYear_Flight,t.CYear_Flight=pad(Math.floor(t.CYear_Flight/60)).toString()+":"+pad(Math.round(t.CYear_Flight%60)).toString()}),n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}}}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.formatMinutes=function(e){return pad(Math.floor(e/60)).toString()+":"+pad(e%60).toString()},e.getCrewFlights=function(t,i,n){var o=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0,a.getCrewFlights(t,i,n).then(function(t){console.log(t),e.loadingVisible=!1,$.each(t,function(t,i){i.STA=new Date(i.STA).addMinutes(o),i.STD=new Date(i.STD).addMinutes(o),i.ChocksIn&&(i.ChocksIn=new Date(i.ChocksIn).addMinutes(o)),i.ChocksOut&&(i.ChocksOut=new Date(i.ChocksOut).addMinutes(o)),i.Takeoff&&(i.Takeoff=new Date(i.Takeoff).addMinutes(o)),i.Landing&&(i.Landing=new Date(i.Landing).addMinutes(o)),i.DurationH=Math.floor(i.FlightTime/60),i.DurationM=i.FlightTime%60;var n=60*i.FlightH+i.FlightM;i.FlightTime2=pad(Math.floor(n/60)).toString()+":"+pad(n%60).toString(),i.ScheduledFlightTime2=e.formatMinutes(i.ScheduledFlightTime);i.ActualFlightHOffBlock,i.ActualFlightMOffBlock;i.BlockTime2=e.formatMinutes(i.BlockTime),i.FixTime2=e.formatMinutes(i.FixTime),i.Duty2=pad(Math.floor(i.Duty/60)).toString()+":"+pad(i.Duty%60).toString()}),e.dg_flight_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrewFlightsTotal=function(t,i){e.loadingVisible=!0,a.getCrewFlightsTotal(t,i).then(function(t){e.loadingVisible=!1,$.each(t,function(t,i){i.FlightTime2=e.formatMinutes(i.FlightTime),i.FixTime2=e.formatMinutes(i.FixTime),i.BlockTime2=e.formatMinutes(i.BlockTime)}),e.dg_flight_total_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.popup_flight_df=null,e.popup_flight_df_instance=null,e.popup_flight_dt=null,e.popup_flight_dt_instance=null,e.popup_flight_visible=!1,e.popup_flight_title="Flights",e.popup_flight={shading:!0,width:1100,height:650,fullScreen:!0,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxDateBox",location:"before",options:{onContentReady:function(t){e.popup_flight_df_instance||(e.popup_flight_df_instance=t.component)},width:150,placeholder:"From",onValueChanged:function(t){e.popup_flight_df=t.value}},toolbar:"bottom"},{widget:"dxDateBox",location:"before",options:{onContentReady:function(t){e.popup_flight_dt_instance||(e.popup_flight_dt_instance=t.component)},width:150,placeholder:"To",onValueChanged:function(t){e.popup_flight_dt=t.value}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"success",text:"Search",icon:"search",onClick:function(t){var i=e.popup_flight_dt?e.popup_flight_dt:new Date(2200,4,19,0,0,0),n=e.popup_flight_df?e.popup_flight_df:new Date(1900,4,19,0,0,0);e.getCrewFlights(e.selected_employee_id,n,i)}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"success",text:"Print",icon:"print",onClick:function(e){html2canvas(document.querySelector("._print_flight")).then(function(e){c(e)})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_flight_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){if($(".dx-toolbar-items-container").addClass("dx-border"),e.popup_flight_dt_instance&&e.popup_flight_total_dt&&e.popup_flight_dt_instance.option("value",e.popup_flight_total_dt),e.popup_flight_df_instance&&e.popup_flight_total_df&&e.popup_flight_df_instance.option("value",e.popup_flight_total_df),e.doSearch){var i=e.popup_flight_dt?e.popup_flight_dt:new Date(2200,4,19,0,0,0),n=e.popup_flight_df?e.popup_flight_df:new Date(1900,4,19,0,0,0);e.getCrewFlights(e.selected_employee_id,n,i)}},onHiding:function(){e.dg_crew_flight_ds=[],e.clearPerson(),e.popup_flight_visible=!1},bindingOptions:{visible:"popup_flight_visible",title:"popup_flight_title"}},e.popup_flight_total_df=null,e.popup_flight_total_dt=null,e.popup_flight_total_visible=!1,e.popup_flight_total_title="Flights (Total)",e.doSearch=!1,e.popup_flight_total={shading:!0,width:1100,height:650,fullScreen:!0,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxDateBox",location:"before",options:{width:150,placeholder:"From",onValueChanged:function(t){e.popup_flight_total_df=t.value}},toolbar:"bottom"},{widget:"dxDateBox",location:"before",options:{width:150,placeholder:"To",onValueChanged:function(t){e.popup_flight_total_dt=t.value}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"success",text:"Search",icon:"search",onClick:function(t){var i=e.popup_flight_total_dt?e.popup_flight_total_dt:new Date(2200,4,19,0,0,0),n=e.popup_flight_total_df?e.popup_flight_total_df:new Date(1900,4,19,0,0,0);e.getCrewFlightsTotal(n,i)}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Details",icon:"airplane",onClick:function(t){if(e.dg_flight_total_selected=n.getSelectedRow(e.dg_flight_total_instance),!e.dg_flight_total_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.selected_employee_id=e.dg_flight_total_selected.Id,e.fillPerson(e.dg_flight_total_selected),e.doSearch=!0,e.popup_flight_visible=!0}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_flight_total_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){$(".dx-toolbar-items-container").addClass("dx-border")},onHiding:function(){e.dg_crew_flight_total_ds=[],e.popup_flight_total_dt=null,e.popup_flight_total_df=null,e.popup_flight_total_visible=!1},bindingOptions:{visible:"popup_flight_total_visible",title:"popup_flight_total_title"}},r.isAuthorized()?(n.page_title="> Crew",$(".crewreport").fadeIn()):r.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onPersonSaved",function(t,i){e.doRefresh=!0}),e.$on("onPersonHide",function(t,i){e.bind()}),n.$broadcast("PersonLoaded",null)}]),app.controller("flightBoardAllController",["$scope","$location","$routeParams","$rootScope","flightService","weatherService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d,s){e.prms=i.prms,e.airport=i.airport,e.airportEntity=null,e.filterVisible=!1,e.IsDispatch=s.current.isDispatch,e.IsDepartureVisible=!1,e.IsArrivalVisible=!1,e.IsDepartureDisabled=!0,e.IsArrivalDisabled=!0,e.IsAdmin=1==i.admin,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".filter").show())}},e.flight=null,e.takeOffVisible=!1,e.offBlockVisible=!1,e.onBlockVisible=!1,e.landingVisible=!1,e.btn_takeoff={text:"Take Off",type:"default",icon:"fas fa-plane-departure",width:"120",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.takeOffReadOnly=!1,e.flight=e.selectedFlights[0],e.flightTakeOff=e.flight.ChocksOut,(new Date).getDatePart()==new Date(e.flight.STD).getDatePart()&&(e.flightTakeOff=new Date),e.popup_takeoff_visible=!0}},e.btn_information={text:"Information",type:"default",icon:"fas fa-info-circle",width:"100%",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.popup_inf_visible=!0}},e.record=null,e.btn_dep={text:"Departure",type:"default",icon:"fas fa-plane-departure",width:"120",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.calculateTotalPax(),e.popup_flight_visible=!0}},e.btn_arr={text:"Arrival",type:"default",icon:"fas fa-plane-arrival",width:"120",bindingOptions:{disabled:"IsArrivalDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.popup_arr_visible=!0}},e.btn_offblock={text:"Off Block",type:"default",icon:"far fa-square",width:"120",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.flightOffBlock=new Date(e.flight.baseStartDate),(new Date).getDatePart()==new Date(e.flight.STD).getDatePart()&&(e.flightOffBlock=new Date),e.popup_offblock_visible=!0}},e.btn_onblock={text:"On Block",type:"default",icon:"fas fa-square",width:"120",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.flightOnBlock=new Date(e.flight.Landing),(new Date).getDatePart()==new Date(e.flight.STD).getDatePart()&&(e.flightOnBlock=new Date),e.popup_onblock_visible=!0}},e.btn_landing={text:"Landing",type:"default",icon:"fas fa-plane-arrival",width:"120",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.takeOffReadOnly=!0,e.flightTakeOff=e.flight.Takeoff,e.flightLanding=e.flight.baseEndDate,(new Date).getDatePart()==new Date(e.flight.STA).getDatePart()&&(e.flightLanding=new Date),e.popup_landing_visible=!0}},e.btn_crew={text:"Crew",type:"default",icon:"fas fa-user-circle",width:"100",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.popup_crew_visible=!0}},e.btn_delay={text:"Delays",type:"default",icon:"clock",width:"110",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.popup_delay_visible=!0}},e.btn_pax={text:"Pax",type:"default",icon:"fas fa-user-tag",width:"100",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.depReadOnly=!1,e.paxSaved=!1,e.flight=e.selectedFlights[0],console.log(e.flight),e.calculateTotalPax(),e.popup_pax_visible=!0}},e.btn_cargo={text:"Cargo",type:"default",icon:"fas fa-boxes",width:"110",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.depReadOnly=!1,e.flight=e.selectedFlights[0],e.cargoSaved=!1,e.popup_cargo_visible=!0}},e.fuelDepSaved=!1,e.fuelArrSaved=!1,e.$dgrow=null,e.btn_fueldep={text:"Fuel(D)",type:"default",icon:"fas fa-burn",width:"110",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.depReadOnly=!1,e.flight=e.selectedFlights[0],e.fuelDepSaved=!1,e.$dgrow=$("#dg_flights").find(".dx-row.dx-selection"),e.popup_fueldep_visible=!0}},e.fuelArrSaved=!1,e.btn_fuelarr={text:"Fuel(A)",type:"default",icon:"fas fa-burn",width:"110",bindingOptions:{disabled:"IsArrivalDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],console.log(e.flight),e.fuelArrSaved=!1,e.popup_fuelarr_visible=!0}},e.IsCancelVisible=!1,e.IsRampVisible=!1,e.btn_cancel={text:"Cancel",type:"danger",icon:"fas fa-ban",width:"120",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.entity_cancel.CancelDate=new Date(Date.now()),e.popup_cancel_visible=!0}},e.btn_ramp={text:"Ramp",type:"danger",icon:"fas fa-long-arrow-alt-left",width:"100",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.entity_ramp.RampDate=new Date(e.flight.STD),e.flightRamp=e.entity_ramp.RampDate,e.popup_ramp_visible=!0}},e.IsRedirectVisible=!1,e.btn_redirect={text:"Redirect",type:"danger",icon:"fas fa-random",width:"120",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.entity_redirect.RedirectDate=new Date(Date.now()),e.popup_redirect_visible=!0}},e.getGantt=function(){return $("#resourceGanttba").data("ejGantt")},e.ganttData=null,e.resourceGroups=[],e.resources=[],e.dataSource=[],e.totalFlights="-",e.totalDelays="-",e.departedFlights="-",e.arrivedFlights="-",e.canceledFlights="-",e.departedPax="-",e.arrivedPax="-",e.calculateSummary=function(){e.totalFlights=e.dataSource.length,e.departedFlights=Enumerable.From(e.dataSource).Where("$.Takeoff && $.FromAirport=="+e.airportEntity.Id).ToArray().length,e.arrivedFlights=Enumerable.From(e.dataSource).Where("$.Landing && $.ToAirport=="+e.airportEntity.Id).ToArray().length,e.canceledFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==4").ToArray().length,e.redirectedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==17").ToArray().length,e.divertedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID== 7").ToArray().length,e.totalDelays=Enumerable.From(e.dataSource).Where("$.FromAirport=="+e.airportEntity.Id+" && $.ChocksOut").Select("$.delay").Sum(),e.departedPax=Enumerable.From(e.dataSource).Where("$.Takeoff && $.FromAirport=="+e.airportEntity.Id).Select("$.TotalPax").Sum(),e.arrivedPax=Enumerable.From(e.dataSource).Where("$.Landing && $.ToAirport=="+e.airportEntity.Id).Select("$.TotalPax").Sum()},e.gaugeOptions={valueIndicator:{indentFromCenter:50,spindleSize:0,type:"rangeBar"},subvalueIndicator:{type:"textcloud",text:{customizeText:function(e){return e.valueText}}},scale:{startValue:0,endValue:150,tickInterval:10,label:{useRangeColors:!0}},rangeContainer:{palette:"pastel",ranges:[{startValue:0,endValue:150}]},title:{text:"Departed",font:{size:14},verticalAlignment:"bottom"},size:{width:200,height:200},value:90,subvalues:[90]},e.footerfilter=!1,e.searched=!1,e.bindFlights=function(t){var i=0;if(t)try{i=$(".e-ganttviewerbodyContianer").data("ejScroller").scrollLeft()}catch(e){}var n={Status:e.filterStatus,Types:e.filterType,Registers:e.filterAircraft,From:e.filterFrom,To:e.filterTo};e.hideButtons2(),e.selectedFlights=[],e.dg_flights_instance.deselectAll();var o=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0,a.getFlightsGantt(Config.CustomerId,new Date(e.datefrom).toUTCDateTimeDigits(),new Date(e.dateto).toUTCDateTimeDigits(),o,e.IsAdmin?null:e.airportEntity.Id,n).then(function(n){e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=n,e.resourceGroups=n.resourceGroups,e.resources=n.resources,console.log("==========="),console.log(n.flights),e.dataSource=Flight.proccessDataSource(n.flights),console.log(e.dataSource),Flight.activeDatasource=e.dataSource,e.dg_flights_ds=e.dataSource,e.calculateSummary(),e.createGantt(),t&&e.scrollGanttX(i);var a=new Date,o=new Date(e.datefrom),l=new Date(e.dateto);a.getTime()>=o.getTime()&&a.getTime()<=l.getTime()&&e.scrollGanttNow(),e.footerfilter=!0,e.searched=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.baseDate=null,e.btn_search={text:"",type:"success",icon:"search",width:"35",bindingOptions:{},onClick:function(t){e.StopNowLineTimer(),e.updatedFlightsCount=0,e.updatedFlights=[],e.bindFlights(!1)}},e.fillFlight=function(e,t){e.FlightPlanId=t.FlightPlanId,e.BaggageCount=t.BaggageCount,e.CargoUnitID=t.CargoUnitID,e.CargoUnit=t.CargoUnit,e.CargoWeight=t.CargoWeight,e.PaxChild=t.PaxChild,e.PaxInfant=t.PaxInfant,e.PaxAdult=t.PaxAdult,e.FuelArrival=t.FuelArrival,e.FuelDeparture=t.FuelDeparture,e.FuelActual=t.FuelActual,e.FuelPlanned=t.FuelPlanned,e.GWLand=t.GWLand,e.GWTO=t.GWTO,e.BlockM=t.BlockM,e.BlockH=t.BlockH,e.FlightH=t.FlightH,e.FlightM=t.FlightM,e.ChocksIn=t.ChocksIn,e.Landing=t.Landing,e.Takeoff=t.Takeoff,e.ChocksOut=t.ChocksOut,e.STD=t.STD,e.STA=t.STA,e.FlightStatusID=t.FlightStatusID,e.RegisterID=t.RegisterID,e.FlightTypeID=t.FlightTypeID,e.TypeId=t.TypeId,e.AirlineOperatorsID=t.AirlineOperatorsID,e.FlightNumber=t.FlightNumber,e.FromAirport=t.FromAirport,e.ToAirport=t.ToAirport,e.STAPlanned=t.STAPlanned,e.STDPlanned=t.STDPlanned,e.FlightHPlanned=t.FlightHPlanned,e.FlightMPlanned=t.FlightMPlanned,e.FlightPlan=t.FlightPlan,e.CustomerId=t.CustomerId,e.IsActive=t.IsActive,e.DateActive=t.DateActive,e.FromAirportName=t.FromAirportName,e.FromAirportIATA=t.FromAirportIATA,e.FromAirportCityId=t.FromAirportCityId,e.ToAirportName=t.ToAirportName,e.ToAirportIATA=t.ToAirportIATA,e.ToAirportCityId=t.ToAirportCityId,e.FromAirportCity=t.FromAirportCity,e.ToAirportCity=t.ToAirportCity,e.AircraftType=t.AircraftType,e.Register=t.Register,e.MSN=t.MSN,e.FlightStatus=t.FlightStatus,e.FlightStatusBgColor=t.FlightStatusBgColor,e.FlightStatusColor=t.FlightStatusColor,e.FlightStatusClass=t.FlightStatusClass,e.from=t.from,e.to=t.to,e.notes=t.notes,e.status=t.status,e.progress=t.progress,e.taskName=t.taskName,e.startDate=t.startDate,e.duration=t.duration,e.taskId=t.taskId,e.FlightGroupID=t.FlightGroupID,e.PlanId=t.PlanId,e.ManufacturerId=t.ManufacturerId,e.Manufacturer=t.Manufacturer,e.ToCountry=t.ToCountry,e.ToSortName=t.ToSortName,e.ToCity=t.ToCity,e.FromSortName=t.FromSortName,e.FromContry=t.FromContry,e.FromCity=t.FromCity,e.FromLatitude=t.FromLatitude,e.FromLongitude=t.FromLongitude,e.ToLatitude=t.ToLatitude,e.ToLongitude=t.ToLongitude,e.CargoCount=t.CargoCount,e.BaggageWeight=t.BaggageWeight,e.FuelUnitID=t.FuelUnitID,e.ArrivalRemark=t.ArrivalRemark,e.DepartureRemark=t.DepartureRemark,e.TotalSeat=t.TotalSeat,e.EstimatedDelay=t.EstimatedDelay,e.PaxOver=t.PaxOver,e.TotalPax=t.TotalPax,e.FuelUnit=t.FuelUnit,e.DateStatus=t.DateStatus},e.doActionCompleteSave=!0,e.updatedFlightsCount=0,e.updatedFlights=[],e.addUpdatedFlights=function(t){e.updatedFlights=Enumerable.From(e.updatedFlights).Where("$.ID!="+t.ID).ToArray();var i={ID:t.ID,FlightNumber:t.FlightNumber,ToAirportIATA:t.ToAirportIATA,FromAirportIATA:t.FromAirportIATA,FlightStatus:t.FlightStatus,DateStatus:t.DateStatus};e.updatedFlights.push(i),e.updatedFlightsCount=e.updatedFlights.length},e.removeUpdatedFlights=function(t){e.updatedFlights=Enumerable.From(e.updatedFlights).Where("$.ID!="+t.ID).ToArray(),e.updatedFlightsCount=e.updatedFlights.length},e.showUpdatedFlights=function(){e.popup_upd_visible=!0},e.utimer=null,e.StartUTimer=function(){e.utimer=setTimeout(function(){var t={from:new Date(e.datefrom).toUTCString(),to:new Date(e.dateto).toUTCString(),baseDate:e.baseDate,airport:e.airportEntity.Id,customer:Config.CustomerId,tzoffset:-1*(new Date).getTimezoneOffset(),userid:n.userId};a.getUpdatedFlights(t).then(function(t){console.log(t),e.baseDate=new Date(Date.now()).toUTCString();var i=$("#resourceGanttba").data("ejGantt");$.each(t,function(t,n){var a=Enumerable.From(e.dataSource).Where("$.ID=="+n.ID).FirstOrDefault();a&&(e.doActionCompleteSave=!1,e.fillFlight(a,n),Flight.processDataOffBlock(a),e.addUpdatedFlights(a),i.updateRecordByTaskId(a),e.calculateSummary())})},function(e){}),e.StartUTimer()},6e4)},e.StopUTimer=function(){e.utimer&&clearTimeout(e.utimer)},e.nowlinetimer=null,e.nowlinelastdate=new Date,e.IsUTC=!1,e.StartNowLineTimer=function(t){e.nowlinetimer=setTimeout(function(){var t=(new Date).yyyymmddtimenow(e.IsUTC);$("#resourceGanttba").data("ejGantt").setModel2({stripLines:[{day:t,lineWidth:"2",lineColor:"ORange",lineStyle:"solid"}]},null,function(){}),e.nowlinelastdate=new Date;var i=$("#stripline0"),n="<div style='font-size:11px;font-weight:bold;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow()+"</div><div style='font-size:11px;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow(!0)+"</div>";e.IsUTC&&(n="<div style='font-size:11px;font-weight:bold;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow()+"</div><div style='font-size:11px;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow(!0)+"</div>"),i.html(n),e.renderTopTimeHeader(),e.renderTimeHeader(),e.StartNowLineTimer(10)},1e3*t)},e.StopNowLineTimer=function(){e.nowlinetimer&&clearTimeout(e.nowlinetimer)},e.autoUpdate=!1,e.check_autoupdate={width:"100%",text:"Auto Update",onValueChanged:function(t){t.value?e.StartUTimer():e.StopUTimer()},bindingOptions:{value:"autoUpdate"}},e.btn_update={text:"",type:"success",icon:"pulldown",width:"40",bindingOptions:{disabled:"autoUpdate"},onClick:function(t){var i={from:new Date(e.datefrom).toUTCString(),to:new Date(e.dateto).toUTCString(),baseDate:e.baseDate,airport:e.airportEntity.Id,customer:Config.CustomerId,tzoffset:-1*(new Date).getTimezoneOffset(),userid:n.userId};e.loadingVisible=!0,a.getUpdatedFlights(i).then(function(t){e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString();var i=$("#resourceGanttba").data("ejGantt");$.each(t,function(t,n){var a=Enumerable.From(e.dataSource).Where("$.ID=="+n.ID).FirstOrDefault();a&&(e.doActionCompleteSave=!1,e.fillFlight(a,n),Flight.processDataOffBlock(a),e.addUpdatedFlights(a),i.updateRecordByTaskId(a),e.calculateSummary())})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e._flightno="",e.text_flightno={bindingOptions:{value:"_flightno"}},e.btn_goflight={text:"",type:"success",icon:"arrowright",width:"35",bindingOptions:{},onClick:function(t){if(e._flightno){var i=Enumerable.From(e.dataSource).Where("$.FlightNumber.toLowerCase()=='"+e._flightno.toLowerCase()+"'").FirstOrDefault();if(!i)return void General.ShowNotify("Flight not found","error");e.scrollGantt(i)}}},e.ganttview=!0,e.gridview=!0,e.btn_swap={text:"",type:"default",icon:"fas fa-exchange-alt",width:"40",bindingOptions:{},onClick:function(t){e.ganttview?(e.ganttview=!1,$("#dg_flights_c").css("top","0px"),$("#gantt_container_ba").css("top","10000px")):(e.ganttview=!0,$("#dg_flights_c").css("top","10000px"),$("#gantt_container_ba").css("top","0px"))}},e.btn_test={text:"test",type:"success",icon:"search",width:"100%",bindingOptions:{},onClick:function(e){var t=$("#task-4908");console.log(t.length)}},e.datefrom=General.getDayFirstHour(new Date(Date.now())),e.date_from={type:"datetime",displayFormat:"yyyy-MM-dd HH:mm",width:"95%",interval:15,onValueChanged:function(e){if(e.value){new Date(e.value)}},bindingOptions:{value:"datefrom"}},e.dateto=General.getDayLastHour(new Date(Date.now())),e.date_to={type:"datetime",displayFormat:"yyyy-MM-dd HH:mm",width:"100%",interval:15,onValueChanged:function(e){if(e.value){new Date(e.value)}},bindingOptions:{value:"dateto"}},e.filterStatus=null,e.tag_status={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["title"],dataSource:Flight.filteredStatusDataSource,displayExpr:"title",valueExpr:"id",bindingOptions:{value:"filterStatus"}},e.filterType=null,e.tag_types={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsAcTypes(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterType"}},e.filterAircraft=null,e.tag_aircrafts={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsRegisters(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterAircraft"}},e.filterFrom=null,e.tag_from={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsFrom(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterFrom"}},e.filterTo=null,e.tag_to={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsTo(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterTo"}},e.checkOnBlock=!0,e.check_onblock={width:"100%",text:"On Block",bindingOptions:{value:"checkOnBlock"}},e.checkOffBlock=!0,e.check_offblock={width:"100%",text:"Off Block",bindingOptions:{value:"checkOffBlock"}},e.checkTakeOff=!0,e.check_takeoff={width:"100%",text:"Departued",bindingOptions:{value:"checkTakeOff"}},e.checkLanding=!0,e.check_landing={width:"100%",text:"Arrived",bindingOptions:{value:"checkLanding"}},e.checkScheduled=!0,e.check_scheduled={width:"100%",text:"Scheduled",bindingOptions:{value:"checkScheduled"}},e.applyNextFlight=!1,e.check_applynext={width:"100%",text:"Apply delay to next flights",bindingOptions:{value:"applyNextFlight"}},e.flightTakeOff=null,e.takeOffReadOnly=!1,e.time_takeoff={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightTakeOff",min:"flight.ChocksOut",readOnly:"takeOffReadOnly"}},e.flightTakeOff2=null,e.time_takeoff2={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightTakeOff2",min:"flight.baseStartDate",readOnly:"depReadOnly"}},e.flightOffBlock=null,e.time_offblock={type:"datetime",width:"100%",interval:5,bindingOptions:{value:"flightOffBlock"}},e.depReadOnly=!0,e.flightOffBlock2=null,e.time_offblock2={type:"datetime",width:"100%",interval:5,bindingOptions:{value:"flightOffBlock2",readOnly:"depReadOnly"}},e.flightOnBlock=null,e.time_onblock={type:"datetime",width:"100%",interval:5,bindingOptions:{value:"flightOnBlock"}},e.flightOnBlock2=null,e.time_onblock2={type:"datetime",width:"100%",interval:5,bindingOptions:{value:"flightOnBlock2",min:"flight.STA"}},e.flightLanding=null,e.landingReadOnly=!1,e.time_landing={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightLanding",min:"flight.STA",readOnly:"landingReadOnly"}},e.flightLanding2=null,e.time_landing2={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightLanding2"}},e.flightRamp=null,e.landingReadOnly=!1,e.time_ramp={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightRamp"}},e.time_std={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.STD"}},e.time_sta={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.STA"}},e.time_baseStart={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.baseStartDate"}},e.time_baseEnd={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.baseEndDate"}},e.time_chocksout={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.ChocksOut"}},e.time_chocksin={type:"time",width:"100%",readOnly:!0,bindingOptions:{value:"flight.ChocksIn"}},e.time_landed={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.Landing"}},e.remark_dep={bindingOptions:{value:"flight.DepartureRemark",readOnly:"depReadOnly"}},e.remark_arr={bindingOptions:{value:"flight.ArrivalRemark"}},e.fuel_dep={min:0,bindingOptions:{value:"flight.FuelDeparture",readOnly:"depReadOnly"}},e.fuel_arr={min:0,bindingOptions:{value:"flight.FuelArrival"}},e.paxTotal=0,e.paxOver=0,e.calculateTotalPax=function(){e.paxTotal=0;var t=0;e.flight.PaxAdult&&(t+=e.flight.PaxAdult),e.flight.PaxChild&&(t+=e.flight.PaxChild),e.flight.PaxInfant&&(t+=e.flight.PaxInfant),e.flight.TotalSeat&&t>e.flight.TotalSeat?e.flight.PaxOver=t-e.flight.TotalSeat:e.flight.PaxOver=0,e.flight.TotalPax=t},e.total_seats={readOnly:!0,bindingOptions:{value:"flight.TotalSeat"}},e.total_pax={readOnly:!0,bindingOptions:{value:"flight.TotalPax"}},e.pax_adult={readOnly:!1,min:0,onValueChanged:function(t){e.calculateTotalPax()},bindingOptions:{value:"flight.PaxAdult",readOnly:"depReadOnly"}},e.pax_child={readOnly:!1,min:0,onValueChanged:function(t){e.calculateTotalPax()},bindingOptions:{value:"flight.PaxChild",readOnly:"depReadOnly"}},e.pax_infant={readOnly:!1,min:0,onValueChanged:function(t){e.calculateTotalPax()},bindingOptions:{value:"flight.PaxInfant",readOnly:"depReadOnly"}},e.pax_over={readOnly:!1,min:0,bindingOptions:{readOnly:"depReadOnly",value:"flight.PaxOver"}},e.cargo_piece={readOnly:!1,min:0,bindingOptions:{value:"flight.CargoCount",readOnly:"depReadOnly"}},e.cargo_weight={readOnly:!1,min:0,bindingOptions:{value:"flight.CargoWeight",readOnly:"depReadOnly"}},e.cargo_excess={readOnly:!1,min:0,bindingOptions:{readOnly:"depReadOnly"}},e.bag_piece={readOnly:!1,min:0,bindingOptions:{value:"flight.BaggageCount",readOnly:"depReadOnly"}},e.bag_weight={readOnly:!1,min:0,bindingOptions:{value:"flight.BaggageWeight",readOnly:"depReadOnly"}},e.bag_excess={readOnly:!1,min:0,bindingOptions:{readOnly:"depReadOnly"}},e.sb_massunit={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(110),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.CargoUnitID",readOnly:"depReadOnly"}},e.sb_volumeunit={showClearButton:!0,searchEnabled:!1,dataSource:n.getDatasourceOption(113),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.FuelUnitID",text:"flight.FuelUnit",readOnly:"depReadOnly"}},e.sb_volumeunit2={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(113),displayExpr:"Title",valueExpr:"Id",readOnly:!0,bindingOptions:{value:"flight.FuelUnitID"}},e.entity_cancel={UserId:null,FlightId:null,CancelReasonId:null,CancelRemark:null,CancelDate:null},e.cleat_entity_cancel=function(){e.entity_cancel.UserId=null,e.entity_cancel.FlightId=null,e.entity_cancel.CancelReasonId=null,e.entity_cancel.CancelRemark=null,e.entity_cancel.CancelDate=null},e.entity_ramp={UserId:null,FlightId:null,RampReasonId:null,RampRemark:null,RampDate:null},e.clear_entity_ramp=function(){e.entity_ramp.UserId=null,e.entity_ramp.FlightId=null,e.entity_ramp.CancelReasonId=null,e.entity_ramp.CancelRemark=null,e.entity_ramp.CancelDate=null},e.entity_redirect={UserId:null,FlightId:null,RedirectReasonId:null,RedirectRemark:null,RedirectDate:null,AirportId:null,STA:null,OAirportIATA:null,
AirportIATA:null,Airport:null},e.clear_entity_redirect=function(){e.entity_redirect.UserId=null,e.entity_redirect.FlightId=null,e.entity_redirect.RedirectReasonId=null,e.entity_redirect.RedirectRemark=null,e.entity_redirect.RedirectDate=null,e.entity_redirect.AirportId=null,e.entity_redirect.Airport=null,e.entity_redirect.STA=null},e.sb_cancel_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1136),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity_cancel.CancelReasonId"}},e.sb_ramp_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1136),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity_ramp.RampReasonId"}},e.sb_redirect_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1147),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity_redirect.RedirectReasonId"}},e.time_redirect={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entity_redirect.RedirectDate"}},e.txt_cancel_remark={bindingOptions:{value:"entity_cancel.CancelRemark"}},e.txt_ramp_remark={bindingOptions:{value:"entity_ramp.RampRemark"}},e.txt_redirect_remark={bindingOptions:{value:"entity_redirect.RedirectRemark"}},e.time_redirect_sta={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"entity_redirect.STA",min:"flight.Takeoff"}},e.sb_redirect_airport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceAirport(),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(e){},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity_redirect.AirportId",selectedItem:"entity_redirect.Airport"}},e.moment=function(e){return moment(e).format("MMMM Do YYYY")},e.momenttime=function(e){return e?moment(e).format("HH:mm"):"--"},e.setStatus=function(t,i){var n=Enumerable.From(Flight.statusDataSource).Where("$.id=="+i).FirstOrDefault();t.status=i,e.flight.FlightStatusID=i,t.FlightStatus=n.title},e.getStatusClass=function(e){return"col-lg-2 col-md-3 col-sm-3 col-xs-3 font-inherit "+Enumerable.From(Flight.statusDataSource).Where("$.id=="+e.status).FirstOrDefault().class},e.popup_inf_visible=!1,e.popup_inf_title="Flight Information",e.popup_inf={elementAttr:{class:"popup_inf"},shading:!1,position:{my:"left",at:"left",of:window,offset:"5 0"},width:450,height:function(){return.95*$(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){$(e.titleElement).css("background-color","#f2552c")},onShowing:function(t){e.setWeather()},onShown:function(e){},onHiding:function(){e.popup_inf_visible=!1},bindingOptions:{visible:"popup_inf_visible",title:"popup_inf_title"}},e.popup_inf.toolbarItems[0].options.onClick=function(t){e.popup_inf_visible=!1},e.scroll_1={scrollByContent:!0,scrollByThumb:!0,height:531},e.scroll2_height=300,e.scroll_2={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll2_height"}},e.scroll_dep={scrollByContent:!0,scrollByThumb:!0,height:497},e.scroll_arr={scrollByContent:!0,scrollByThumb:!0,height:497};var c=[{text:"Main",id:"departure",visible:!0},{text:"Delays",id:"delays",visible:!0}],g=[{text:"Main",id:"arrival",visible:!0},{text:"Departure",id:"depparr",visible:!0}];e.tabs=c,e.selectedTabIndex=-1,e.$watch("selectedTabIndex",function(t){try{e.selectedTab=c[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_instance.repaint()}catch(e){}}),e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex"}},e.tabs2=g,e.selectedTabIndex2=-1,e.$watch("selectedTabIndex2",function(t){try{e.selectedTab2=g[t],$(".tab").hide(),$("."+e.selectedTab2.id).fadeIn(100,function(){}),e.dg2_instance.repaint()}catch(e){}}),e.tabs2_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs2",deep:!0},selectedIndex:"selectedTabIndex2"}},e.popup_arr_visible=!1,e.popup_arr_title="Arrival",e.popup_arr={elementAttr:{class:"popup_arr"},shading:!0,width:1200,height:647,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacarr",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightLanding2)<new Date(e.flight.STA))return void General.ShowNotify(Config.Text_Landing,"error");if(e.flightOnBlock2&&new Date(e.flightOnBlock2)<new Date(e.flightLanding2))return void General.ShowNotify(Config.Text_OnBlock,"error");var i={StatusLog:[]},o=$("#resourceGanttba").data("ejGantt");e.flight.Landing=e.flightLanding2,i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:3,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.flightOnBlock2?(e.flight.ChocksIn=e.flightOnBlock2,Flight.calculateDelayLandingOnBlock(e.flight),e.setStatus(e.flight,15)):e.setStatus(e.flight,3),e.fillDto(i),e.fillArrival(i),e.loadingVisible=!0,a.saveFlightArr(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),o.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_arr_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.flightOnBlock2=e.flight.ChocksIn,e.flightLanding2=e.flight.Landing,e.flightOffBlock2=e.flight.ChocksOut,e.flightTakeOff2=e.flight.Takeoff,e.depReadOnly=!0,e.selectedTabIndex2=0,e.setWeather()},onShown:function(t){e.flight.delays?e.dg2_ds=e.flight.delays:(e.loadingVisible=!0,a.getFlightDelayCodes(e.flight.ID).then(function(t){e.loadingVisible=!1,e.flight.delays=t,e.dg2_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},onHiding:function(){e.selectedTabIndex2=-1,e.popup_arr_visible=!1},bindingOptions:{visible:"popup_arr_visible",title:"popup_arr_title"}},e.popup_arr.toolbarItems[1].options.onClick=function(t){e.popup_arr_visible=!1},e.popup_fueldep_visible=!1,e.popup_fueldep_title="Departure Fuel",e.fuelDepInit={},e.popup_fueldep={elementAttr:{class:"popup_fueldep"},shading:!0,width:400,height:200,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacfueldep",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={ID:e.flight.ID,FuelDeparture:e.flight.FuelDeparture,FuelUnitID:e.flight.FuelUnitID};e.loadingVisible=!0,a.saveFlightFuelDeparture(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.fuelDepSaved=!0,e.loadingVisible=!1,e.popup_fueldep_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.fuelDepInit.FuelUnitID=e.flight.FuelUnitID,e.fuelDepInit.FuelDeparture=e.flight.FuelDeparture},onShown:function(e){},onHiding:function(){e.fuelDepSaved||(e.flight.FuelDeparture=e.fuelDepInit.FuelDeparture,e.flight.FuelUnitID=e.fuelDepInit.FuelUnitID),e.popup_fueldep_visible=!1},bindingOptions:{visible:"popup_fueldep_visible",title:"popup_fueldep_title"}},e.popup_fueldep.toolbarItems[1].options.onClick=function(t){e.popup_fueldep_visible=!1},e.popup_fuelarr_visible=!1,e.popup_fuelarr_title="Arrival Fuel",e.fuelArrInit={},e.popup_fuelarr={elementAttr:{class:"popup_fuelarr"},shading:!0,width:400,height:200,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacfuelarr",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={ID:e.flight.ID,FuelArrival:e.flight.FuelArrival};e.loadingVisible=!0,a.saveFlightFuelArrival(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.fuelArrSaved=!0,e.loadingVisible=!1,e.popup_fuelarr_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.fuelArrInit.FuelArrival=e.flight.FuelArrival},onShown:function(e){},onHiding:function(){e.fuelArrSaved||(e.flight.FuelArrival=e.fuelArrInit.FuelArrival),e.popup_fuelarr_visible=!1},bindingOptions:{visible:"popup_fuelarr_visible",title:"popup_fuelarr_title"}},e.popup_fuelarr.toolbarItems[1].options.onClick=function(t){e.popup_fuelarr_visible=!1},e.popup_pax_visible=!1,e.popup_pax_title="Pax",e.paxSaved=!1,e.paxInit={},e.popup_pax={elementAttr:{class:"popup_pax"},shading:!0,width:400,height:290,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacpax",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={ID:e.flight.ID,PaxAdult:e.flight.PaxAdult,PaxChild:e.flight.PaxChild,PaxInfant:e.flight.PaxInfant};e.loadingVisible=!0,a.saveFlightPax(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.paxSaved=!0,e.loadingVisible=!1,e.popup_pax_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.paxInit.PaxAdult=e.flight.PaxAdult,e.paxInit.PaxChild=e.flight.PaxChild,e.paxInit.PaxInfant=e.flight.PaxInfant},onShown:function(e){},onHiding:function(){e.paxSaved||(e.flight.PaxAdult=e.paxInit.PaxAdult,e.flight.PaxChild=e.paxInit.PaxChild,e.flight.PaxInfant=e.paxInit.PaxInfant,e.calculateTotalPax()),e.popup_pax_visible=!1},bindingOptions:{visible:"popup_pax_visible",title:"popup_pax_title"}},e.popup_pax.toolbarItems[1].options.onClick=function(t){e.popup_pax_visible=!1},e.popup_cargo_visible=!1,e.popup_cargo_title="Cargo/Baggage",e.cargoSaved=!1,e.cargoInit={},e.popup_cargo={elementAttr:{class:"popup_cargo"},shading:!0,width:400,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaccargo",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={ID:e.flight.ID,CargoUnitID:e.flight.CargoUnitID,CargoWeight:e.flight.CargoWeight,CargoCount:e.flight.CargoCount,BaggageWeight:e.flight.BaggageWeight,BaggageCount:e.flight.BaggageCount};e.loadingVisible=!0,a.saveFlightCargo(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.cargoSaved=!0,e.loadingVisible=!1,e.popup_cargo_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.cargoInit.CargoUnitID=e.flight.CargoUnitID,e.cargoInit.CargoWeight=e.flight.CargoWeight,e.cargoInit.CargoCount=e.flight.CargoCount,e.cargoInit.BaggageWeight=e.flight.BaggageWeight,e.cargoInit.BaggageCount=e.flight.BaggageCount},onShown:function(e){},onHiding:function(){e.cargoSaved||(e.flight.CargoUnitID=e.cargoInit.CargoUnitID,e.flight.CargoWeight=e.cargoInit.CargoWeight,e.flight.CargoCount=e.cargoInit.CargoCount,e.flight.BaggageWeight=e.cargoInit.BaggageWeight,e.flight.BaggageCount=e.cargoInit.BaggageCount),e.popup_cargo_visible=!1},bindingOptions:{visible:"popup_cargo_visible",title:"popup_cargo_title"}},e.popup_cargo.toolbarItems[1].options.onClick=function(t){e.popup_cargo_visible=!1},e.fillDto=function(t){t.ID=e.flight.ID,t.UserId=n.userId,t.FlightStatusID=e.flight.FlightStatusID,t.Delays=[];var i=Enumerable.From(e.flight.delays).Where("$.Selected==1").ToArray();$.each(i,function(i,a){t.Delays.push({FlightId:e.flight.ID,DelayCodeId:a.DelayCodeId,HH:a.HH,MM:a.MM,UserId:n.userId})})},e.fillDeparture=function(t){t.ChocksOut=new Date(e.flight.ChocksOut).toUTCString(),e.flight.Takeoff&&(t.Takeoff=new Date(e.flight.Takeoff).toUTCString()),t.DepartureRemark=e.flight.DepartureRemark,t.GWTO=e.flight.GWTO,t.FuelDeparture=e.flight.FuelDeparture,t.PaxAdult=e.flight.PaxAdult,t.PaxInfant=e.flight.PaxInfant,t.PaxChild=e.flight.PaxChild,t.CargoWeight=e.flight.CargoWeight,t.CargoUnitID=e.flight.CargoUnitID,t.BaggageCount=e.flight.BaggageCount,t.CargoCount=e.flight.CargoCount,t.BaggageWeight=e.flight.BaggageWeight,t.FuelUnitID=e.flight.FuelUnitID,t.EstimatedDelays=[];var i=Enumerable.From(e.dataSource).Where("$.EstimatedDelayChanged && $.EstimatedDelayChanged==true && $.EstimatedDelay>0 && $.status==1 && $.startDate.getDatePart()=="+e.flight.startDate.getDatePart()+" && $.startDate.getTime() > "+e.flight.startDate.getTime()+"  && $.RegisterID=="+e.flight.RegisterID).OrderBy("$.startDate").ToArray();$.each(i,function(e,i){t.EstimatedDelays.push({FlightId:i.ID,Delay:Math.floor(i.EstimatedDelay)})})},e.fillArrival=function(t){t.Landing=new Date(e.flight.Landing).toUTCString(),e.flight.ChocksIn&&(t.ChocksIn=new Date(e.flight.ChocksIn).toUTCString()),t.BlockH=e.flight.BlockH,t.BlockM=e.flight.BlockM,t.GWLand=e.flight.GWLand,t.FuelArrival=e.flight.FuelArrival,t.ArrivalRemark=e.flight.ArrivalRemark},e.popup_flight_visible=!1,e.popup_flight_title="Departure",e.popup_flight={elementAttr:{class:"popup_flight"},shading:!0,width:1200,height:647,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacflight",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightOffBlock2)<new Date(e.flight.STD))return void General.ShowNotify(Config.Text_OffBlock,"error");if(e.flightTakeOff2&&new Date(e.flightTakeOff2)<new Date(e.flightOffBlock2))return void General.ShowNotify(Config.Text_TakeOff,"error");var i={StatusLog:[]},o=$("#resourceGanttba").data("ejGantt"),l=!e.flight.ChocksOut&&e.flightOffBlock2||new Date(e.flight.ChocksOut).getTime()!=new Date(e.flightOffBlock2).getTime();e.flight.ChocksOut=e.flightOffBlock2,Flight.calculateDelayOffBlock(e.flight),l&&e.applyNextFlight&&Flight.calculateNextTaskDelayOffBlock(e.flight,e.dataSource,o),i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:14,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.flightTakeOff2?(e.flight.Takeoff=e.flightTakeOff2,4!=e.flight.FlightStatusID&&e.setStatus(e.flight,2),i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:2,Date:new Date(Date.now()).toUTCString(),UserId:n.userId})):4!=e.flight.FlightStatusID&&e.setStatus(e.flight,14),e.fillDto(i),e.fillDeparture(i),e.loadingVisible=!0,a.saveFlightDep(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),o.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_flight_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.flight.ChocksOut?e.flightOffBlock2=e.flight.ChocksOut:e.flightOffBlock2=Flight.getEstimatedOffBlock(e.flight),e.flightTakeOff2=e.flight.Takeoff,e.depReadOnly=!1,e.selectedTabIndex=0,e.setWeather()},onShown:function(t){e.flight.delays?e.dg_ds=e.flight.delays:(e.loadingVisible=!0,a.getFlightDelayCodes(e.flight.ID).then(function(t){e.loadingVisible=!1,e.flight.delays=t,e.dg_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})),e.dg_instance.repaint()},onHiding:function(){e.selectedTabIndex=-1,e.popup_flight_visible=!1},bindingOptions:{visible:"popup_flight_visible",title:"popup_flight_title"}},e.popup_flight.toolbarItems[1].options.onClick=function(t){e.popup_flight_visible=!1},e.popup_takeoff_visible=!1,e.popup_takeoff_title="Take Off",e.popup_takeoff={width:400,height:400,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbactakeoff",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightTakeOff)<new Date(e.flight.ChocksOut))return void General.ShowNotify(Config.Text_TakeOff,"error");var i=$("#resourceGanttba").data("ejGantt");e.flight.Takeoff=e.flightTakeOff,e.setStatus(e.flight,2);var o={Takeoff:new Date(e.flight.Takeoff).toUTCString(),StatusLog:[],EstimatedDelays:[]};o.ID=e.flight.ID,o.UserId=n.userId,o.FlightStatusID=e.flight.FlightStatusID,o.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:2,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.loadingVisible=!0,a.saveFlightTakeOff(o).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_takeoff_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_takeoff_visible=!1},bindingOptions:{visible:"popup_takeoff_visible",title:"popup_takeoff_title"}},e.popup_takeoff.toolbarItems[1].options.onClick=function(t){e.popup_takeoff_visible=!1},e.dg_selected=null,e.dg_columns=[{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Selected",caption:"",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!0,width:90,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!0,fixedPosition:"left"},{dataField:"MM",caption:"Minute(s)",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!0,width:90},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_height=100,e.dg_instance=null,e.dg_ds=null,e.dg={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},onEditingStart:function(e){"MM"!=e.column.dataField||e.key.Selected||(e.cancel=!0)},onRowUpdating:function(e){e.newData.hasOwnProperty("Selected")&&(e.newData.Selected||(e.newData.HH=null,e.newData.MM=null))},onRowUpdated:function(e){},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},height:497,summary:{totalItems:[{column:"MM",summaryType:"sum"}]},bindingOptions:{dataSource:"dg_ds"}},e.dg2_selected=null,e.dg2_columns=[{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Selected",caption:"",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!0,width:90,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!0,fixedPosition:"left"},{dataField:"MM",caption:"Minute(s)",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!0,width:90},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg2_height=100,e.dg2_instance=null,e.dg2_ds=null,e.dg2={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},onEditingStart:function(e){"MM"!=e.column.dataField||e.key.Selected||(e.cancel=!0)},onRowUpdating:function(e){e.newData.hasOwnProperty("Selected")&&(e.newData.Selected||(e.newData.HH=null,e.newData.MM=null))},onRowUpdated:function(e){},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg2_columns,onContentReady:function(t){e.dg2_instance||(e.dg2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg2_selected=i||null},height:330,summary:{totalItems:[{column:"MM",summaryType:"sum"}]},bindingOptions:{dataSource:"dg2_ds"}},e.dg_delay_selected=null,e.dg_delay_columns=[{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left",sortOrder:"asc",sortIndex:0},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!0,fixedPosition:"left"},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Selected",caption:"",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!0,width:90,fixed:!0,fixedPosition:"right"},{dataField:"MM",caption:"Minute(s)",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!0,width:90,fixed:!0,fixedPosition:"right"}],e.dg_delay_height=100,e.dg_delay_instance=null,e.dg_delay_ds=null,e.dg_delay={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},onEditingStart:function(e){"MM"!=e.column.dataField||e.key.Selected||(e.cancel=!0)},onRowUpdating:function(e){e.newData.hasOwnProperty("Selected")&&(e.newData.Selected||(e.newData.HH=null,e.newData.MM=null))},onRowUpdated:function(e){},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_delay_columns,onContentReady:function(t){e.dg_delay_instance||(e.dg_delay_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_delay_selected=i||null},height:485,summary:{totalItems:[{column:"MM",summaryType:"sum"}]},bindingOptions:{dataSource:"dg_delay_ds"}},e.popup_delay_visible=!1,e.popup_delay_title="Delays",e.popup_delay={shading:!0,width:1150,height:600,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",bindingOptions:{disabled:"IsApproved"},onClick:function(t){var i=$("#resourceGanttba").data("ejGantt"),o={ID:e.flight.ID};o.Delays=[];var l=Enumerable.From(e.flight.delays).Where("$.Selected==1").ToArray(),r=0;$.each(l,function(t,i){o.Delays.push({FlightId:e.flight.ID,DelayCodeId:i.DelayCodeId,HH:i.HH,MM:i.MM,UserId:n.userId}),r+=i.MM}),e.loadingVisible=!0,a.saveFlightDelays(o).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.flight.EstimatedDelay=r,Flight.calculateEstimatedDelay(e.flight),i.updateRecordByTaskId(e.flight),e.loadingVisible=!1,e.popup_delay_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_delay_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.flight.delays?e.dg_delay_ds=e.flight.delays:(e.loadingVisible=!0,a.getFlightDelayCodes(e.flight.ID).then(function(t){e.loadingVisible=!1,e.flight.delays=t,e.dg_delay_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},onHiding:function(){e.dg_delay_ds=[],e.popup_delay_visible=!1},bindingOptions:{visible:"popup_delay_visible",title:"popup_delay_title"}},e.dg_upd_selected=null,e.dg_upd_columns=[{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"DateStatus",caption:"Date",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,format:"yyyy-MMM-dd, HH:mm",sortIndex:0,sortOrder:"asc"}],e.dg_upd_height=100,e.dg_upd_instance=null,e.dg_upd={editing:{allowUpdating:!1,mode:"cell"},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_upd_columns,onContentReady:function(t){e.dg_upd_instance||(e.dg_upd_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_upd_selected=i||null},height:"100%",bindingOptions:{dataSource:"updatedFlights"}},e.popup_upd_visible=!1,e.popup_upd_title="Updated Flights",e.popup_upd={elementAttr:{class:"popup_upd"},shading:!1,position:{my:"left",at:"left",of:window,offset:"5 5"},width:500,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Flight",icon:"arrowright",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(e.dg_upd_selected){var i=Enumerable.From(e.dataSource).Where("$.ID=="+e.dg_upd_selected.ID).FirstOrDefault();i&&(e.scrollGantt(i),e.scrollGrid(i))}}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){$(e.titleElement).css("background-color","#8BC34A")},onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_upd_visible=!1},bindingOptions:{visible:"popup_upd_visible",title:"popup_upd_title"}},e.popup_upd.toolbarItems[1].options.onClick=function(t){e.popup_upd_visible=!1},e.popup_offblock_visible=!1,e.popup_offblock_title="Off Block",e.popup_offblock={shading:!0,width:380,height:"380",fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacoffblock",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightOffBlock)<new Date(e.flight.STD))return void General.ShowNotify(Config.Text_OffBlock,"error");var i=$("#resourceGanttba").data("ejGantt"),o=!e.flight.ChocksOut&&e.flightOffBlock||new Date(e.flight.ChocksOut).getTime()!=new Date(e.flightOffBlock).getTime();e.flight.ChocksOut=e.flightOffBlock,Flight.calculateDelayOffBlock(e.flight),o&&e.applyNextFlight&&Flight.calculateNextTaskDelayOffBlock(e.flight,e.dataSource,i),e.setStatus(e.flight,14);var l={ChocksOut:new Date(e.flight.ChocksOut).toUTCString(),StatusLog:[],EstimatedDelays:[]};l.ID=e.flight.ID,l.UserId=n.userId,l.FlightStatusID=e.flight.FlightStatusID,l.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:14,Date:new Date(Date.now()).toUTCString(),UserId:n.userId});var r=Enumerable.From(e.dataSource).Where("$.EstimatedDelayChanged && $.EstimatedDelayChanged==true && $.EstimatedDelay>0 && $.status==1 && $.startDate.getDatePart()=="+e.flight.startDate.getDatePart()+" && $.startDate.getTime() > "+e.flight.startDate.getTime()+"  && $.RegisterID=="+e.flight.RegisterID).OrderBy("$.startDate").ToArray();$.each(r,function(e,t){l.EstimatedDelays.push({FlightId:t.ID,Delay:Math.floor(t.EstimatedDelay)})}),e.loadingVisible=!0,a.saveFlightOffBlock(l).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_offblock_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_offblock_visible=!1},bindingOptions:{visible:"popup_offblock_visible",title:"popup_offblock_title"}},e.popup_offblock.toolbarItems[1].options.onClick=function(t){e.popup_offblock_visible=!1},e.popup_landing_visible=!1,e.popup_landing_title="Take Off",e.popup_landing={width:400,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaclanding",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightLanding)<new Date(e.flight.STA))return void General.ShowNotify(Config.Text_Landing,"error");var i=$("#resourceGanttba").data("ejGantt");17!=e.flight.status?e.setStatus(e.flight,3):e.setStatus(e.flight,7),e.flight.Landing=e.flightLanding;var o={StatusLog:[]};o.ID=e.flight.ID,o.UserId=n.userId,o.Landing=new Date(e.flight.Landing).toUTCString(),o.FlightStatusID=e.flight.FlightStatusID,o.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:3,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.loadingVisible=!0,a.saveFlightLanding(o).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_landing_visible=!1,e.doGridSelectedChanged=!1,
e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_landing_visible=!1},bindingOptions:{visible:"popup_landing_visible",title:"popup_landing_title"}},e.popup_landing.toolbarItems[1].options.onClick=function(t){e.popup_landing_visible=!1},e.popup_onblock_visible=!1,e.popup_onblock_title="Off Block",e.popup_onblock={width:400,height:270,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaconblock",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(e.flightOnBlock&&new Date(e.flightOnBlock)<new Date(e.flight.Landing))return void General.ShowNotify(Config.Text_OnBlock,"error");var i={StatusLog:[]};$("#resourceGanttba").data("ejGantt");17!=e.flight.status&&7!=e.flight.status?e.setStatus(e.flight,15):e.setStatus(e.flight,7),e.flight.ChocksIn=e.flightOnBlock,console.log("Before"),console.log(JSON.stringify(e.flight)),i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:15,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),i.ID=e.flight.ID,i.UserId=n.userId,i.ChocksIn=new Date(e.flight.ChocksIn).toUTCString(),i.FlightStatusID=e.flight.FlightStatusID,e.loadingVisible=!0,a.saveFlightOnBlock(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.popup_onblock_visible=!1,e.bindFlights(!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_onblock_visible=!1},bindingOptions:{visible:"popup_onblock_visible",title:"popup_onblock_title"}},e.popup_onblock.toolbarItems[1].options.onClick=function(t){e.popup_onblock_visible=!1},e.popup_cancel_visible=!1,e.popup_cancel_title="Cancel",e.popup_cancel={shading:!0,width:360,height:"380",fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaccancel",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.entity_cancel.Date=new Date(Date.now()).toUTCString(),e.entity_cancel.CancelDate=new Date(e.entity_cancel.CancelDate).toUTCString(),e.entity_cancel.UserId=n.userId,e.entity_cancel.FlightId=e.flight.ID;var i=$("#resourceGanttba").data("ejGantt");return e.setStatus(e.flight,4),e.loadingVisible=!0,void a.saveFlightCancel(e.entity_cancel).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_cancel_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")});var i}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.cleat_entity_cancel(),e.popup_cancel_visible=!1},bindingOptions:{visible:"popup_cancel_visible",title:"popup_cancel_title"}},e.popup_ramp_visible=!1,e.popup_ramp_title="Ramp",e.popup_ramp={shading:!0,width:360,height:"380",fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacramp",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.entity_ramp.Date=new Date(Date.now()).toUTCString(),e.entity_ramp.RampDate=new Date(e.flightRamp).toUTCString(),e.entity_ramp.UserId=n.userId,e.entity_ramp.FlightId=e.flight.ID;var i=$("#resourceGanttba").data("ejGantt");e.setStatus(e.flight,9),e.loadingVisible=!0,a.saveFlightRamp(e.entity_ramp).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.flight.RampDate=e.flightRamp,i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_ramp_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.clear_entity_ramp(),e.popup_ramp_visible=!1},bindingOptions:{visible:"popup_ramp_visible",title:"popup_ramp_title"}},e.popup_ramp.toolbarItems[1].options.onClick=function(t){e.popup_ramp_visible=!1},e.popup_redirect_visible=!1,e.popup_redirect_title="Redirect",e.popup_redirect={shading:!0,width:360,height:"490",fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacredirect",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.entity_redirect.Date=new Date(Date.now()).toUTCString(),e.entity_redirect.RedirectDate=new Date(e.entity_redirect.RedirectDate).toUTCString(),e.entity_redirect.UserId=n.userId,e.entity_redirect.FlightId=e.flight.ID,e.entity_redirect.STA=new Date(e.entity_redirect.STA).toUTCString(),e.entity_redirect.OAirportIATA=e.flight.ToAirportIATA,e.entity_redirect.Airport=null;$("#resourceGanttba").data("ejGantt");e.setStatus(e.flight,17),e.loadingVisible=!0,a.saveFlightRedirect(e.entity_redirect).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.showButtons2(e.flight),e.updatedFlightsCount=0,e.updatedFlights=[],e.bindFlights(!1),e.popup_redirect_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.clear_entity_redirect(),e.popup_redirect_visible=!1},bindingOptions:{visible:"popup_redirect_visible",title:"popup_redirect_title"}},e.popup_redirect.toolbarItems[1].options.onClick=function(t){e.popup_redirect_visible=!1},e.getCrew=function(t){e.loadingVisible=!0,a.getFlightCrew2(t).then(function(t){e.loadingVisible=!1,e.dg_crew_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getBoxFlights=function(t){var i=-1*(new Date).getTimezoneOffset();a.getBoxFlights(t).then(function(t){$.each(t,function(e,t){t.STA=new Date(t.STA).addMinutes(i),t.STD=new Date(t.STD).addMinutes(i),t.ChocksIn&&(t.ChocksIn=new Date(t.ChocksIn).addMinutes(i)),t.ChocksOut&&(t.ChocksOut=new Date(t.ChocksOut).addMinutes(i)),t.Takeoff&&(t.Takeoff=new Date(t.Takeoff).addMinutes(i)),t.Landing&&(t.Landing=new Date(t.Landing).addMinutes(i))}),e.dg_boxflight_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.dg_crew_columns=[{fixed:!0,fixedPosition:"left",dataField:"ImageUrl",width:85,alignment:"center",caption:"",allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){$("<div>").append($("<img>",{src:n.clientsFilesUrl+(t.value?t.value:"imguser.png"),css:{height:"50px",width:"50px",borderRadius:"100%"}})).appendTo(e)}},{dataField:"Position",caption:"Position",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:140,fixed:!0,fixedPosition:"left"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:180,fixed:!0,fixedPosition:"left"},{dataField:"PID",caption:"PID",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left"},{dataField:"Address",caption:"Address",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"Mobile",caption:"Mobile",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"",caption:"Passport",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";t.data.IsPassportExpired||!t.data.PassportNumber?(i="red",n="ion-md-alert"):t.data.IsPassportExpiring&&(i="orange",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"CAO",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";t.data.IsCAOExpired||!t.data.CaoCardNumber?(i="red",n="ion-md-alert"):t.data.IsCAOExpiring&&(i="orange",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"Medical",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsMedicalExpired?(i="red",n="ion-md-alert"):t.data.IsMedicalExpiring&&(i="orange",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"PPLExpireStatus",caption:"PPL",width:60,alignment:"center",allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";switch(t.value){case 1:i="red",n="ion-md-alert";break;case 2:i="orange",n="ion-md-alert";break;case 3:i="green";break;default:i="red",n="ion-md-alert"}$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"CPLExpireStatus",caption:"CPL",width:60,alignment:"center",allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";switch(t.value){case 1:i="red",n="ion-md-alert";break;case 2:i="orange",n="ion-md-alert";break;case 3:i="green";break;default:i="red",n="ion-md-alert"}$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"ATPLExpireStatus",caption:"ATPL",width:60,alignment:"center",allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";switch(t.value){case 1:i="red",n="ion-md-alert";break;case 2:i="orange",n="ion-md-alert";break;case 3:i="green";break;default:i="red",n="ion-md-alert"}$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"MCCExpireStatus",caption:"MCC",width:60,alignment:"center",allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";switch(t.value){case 1:i="red",n="ion-md-alert";break;case 2:i="orange",n="ion-md-alert";break;case 3:i="green";break;default:i="red",n="ion-md-alert"}$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"CurrentLocationAirporIATA",caption:"Location",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"PassportNumber",caption:"Passport No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"DatePassportExpire",caption:"Passport Expire",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"CaoCardNumber",caption:"CAO No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"DateCaoCardExpire",caption:"CAO Expire",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130}],e.dg_crew_selected=null,e.dg_crew_instance=null,e.dg_crew_ds=null,e.dg_crew={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:320,columns:e.dg_crew_columns,onContentReady:function(t){e.dg_crew_instance||(e.dg_crew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew_selected=i||null},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_crew_ds"}},e.dg_boxflight_columns=[{caption:"Flights",columns:[{dataField:"FlightNumber",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"FlightH",caption:"HH",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60},{dataField:"FlightM",caption:"MM",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:150,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:150,format:"HH:mm"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]}],e.dg_boxflight_selected=null,e.dg_boxflight_instance=null,e.dg_boxflight_ds=null,e.dg_boxflight={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:200,columns:e.dg_boxflight_columns,onContentReady:function(t){e.dg_boxflight_instance||(e.dg_boxflight_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_boxflight_selected=i||null},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_boxflight_ds"}},e.popup_crew_visible=!1,e.popup_crew_title="Crew",e.popup_crew={shading:!0,width:1100,height:650,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Make GD",icon:"fas fa-file-excel",validationGroup:"fbacredirect",bindingOptions:{disabled:"IsApproved"},onClick:function(e){if(!e.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Transport",icon:"fas fa-taxi",validationGroup:"fbacredirect",bindingOptions:{disabled:"IsApproved"},onClick:function(e){if(!e.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Notification",icon:"fas fa-bell",validationGroup:"fbacredirect",bindingOptions:{disabled:"IsApproved"},onClick:function(e){if(!e.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_crew_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.getCrew(e.flight.ID),e.getBoxFlights(e.flight.BoxId)},onHiding:function(){e.dg_crew_ds=[],e.popup_crew_visible=!1},bindingOptions:{visible:"popup_crew_visible",title:"popup_crew_title"}},e.scrollGrid=function(t){var i=e.dg_flights_instance.getView("rowsView")._scrollable,n=e.dg_flights_instance.getRowIndexByKey(t),a=e.dg_flights_instance.getRowElement(n);i.scrollToElement(a)},e.scrollGantt=function(t){var i=new Date(t.STD),n=new Date(e.datefrom),a=Flight.subtractDatesHours(i,n)*$(".e-schedule-day-headercell").width()-50;$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(a)},e.scrollGanttX=function(e){$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(e)},e.scrollGanttNow=function(){var t=new Date(Date.now()),i=new Date(t),n=new Date(e.datefrom),a=Flight.subtractDatesHours(i,n)*($(".e-schedule-day-headercell").width()-0)-50;$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(a)},e.dg_flights_selected=null,e.dg_flights_columns=[{dataField:"delay1",caption:"",width:50,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="lightgray";t.data.FlightStatusID>1&&(i=t.data.delay>0||t.data.delayLanding>0?"#e51400":"#60a917"),$("<div>").append('<i class="fas fa-clock" style="color:'+i+';font-size:16px"></i>').appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"FlightStatusID",caption:"",width:50,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i=Flight.getStatus(t.value),n=i.bgcolor,a=t.data.FlightStatus;switch(a="",t.value){case 1:$("<div>").append('<i class="fas fa-calendar-day" style="color:lightgray;font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 14:$("<div>").append('<i class="far fa-square" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 2:$("<div>").append('<i class="fas fa-plane-departure" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 3:$("<div>").append('<i class="fas fa-plane-arrival" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 4:$("<div>").append('<i class="fas fa-ban" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 15:$("<div>").append('<i class="fas fa-square" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 17:$("<div>").append('<i class="fas fa-random" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 7:$("<div>").append('<i class="fas fa-level-down-alt" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e)}},fixed:!0,fixedPosition:"left"},{dataField:"ID",caption:"ID",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90,fixed:!0,fixedPosition:"left"},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:110,fixed:!0,fixedPosition:"left"},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{caption:"Airports",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90}]},{caption:"Departure",columns:[{dataField:"STD",caption:"Scheduled Dep.",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:170,alignment:"center",format:"yyyy-MMM-dd, HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Arrival",columns:[{dataField:"STA",caption:"Scheduled Arr.",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Pax",columns:[{dataField:"PaxAdult",caption:"Adult",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxChild",caption:"Child",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxInfant",caption:"Infant",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"TotalPax",caption:"Total",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center",name:"totalpax"},{dataField:"TotalSeat",caption:"Seats",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxOver",caption:"Over",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Cargo",columns:[{dataField:"CargoUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"CargoWeight",caption:"Weight",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"cargoweight"},{dataField:"CargoCount",caption:"Count",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Baggage",columns:[{dataField:"CargoUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"BaggageWeight",caption:"Weight",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"baggageweight"},{dataField:"BaggageCount",caption:"Count",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Fuel",columns:[{dataField:"FuelUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"FuelDeparture",caption:"Dep.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FuelArrival",caption:"Arr.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"}]},{caption:"Delays",fixed:!0,fixedPosition:"right",columns:[{dataField:"delay",caption:"Dep.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"delay"},{dataField:"delayLanding",caption:"Arr.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"delayLanding"}]}],e.dg_flights_height=$(window).height()-139-50,e.dg_flights_instance=null,e.dg_flights_ds=null,e.dg_flights={searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,scrolling:{mode:"infinite",showScrollbar:"always"},paging:{pageSize:100},columns:e.dg_flights_columns,onContentReady:function(t){e.dg_flights_instance||(e.dg_flights_instance=t.component)},onSelectionChanged:function(t){if(!e.doGridSelectedChanged){e.doGridSelectedChanged=!0;var i=t.component.getView("rowsView")._scrollable,n=t.component.element().find("tr.dx-selection");return void i.scrollToElement(n)}var a=t.selectedRowsData[0];if(a){e.dg_flights_selected=a,e.addSelectedFlight2(a);var o=$("#resourceGanttba").data("ejGantt"),l=o._getRecordByTaskId(a.ID.toString());o._$ganttchartHelper.ejGanttChart("selectTaskbar",l),e.scrollGantt(a)}else e.dg_flights_selected=null},summary:{totalItems:[{name:"delay",showInColumn:"delay",displayFormat:"{0}",summaryType:"custom"},{name:"delayLanding",showInColumn:"delayLanding",displayFormat:"{0}",summaryType:"custom"},{name:"totalpax",showInColumn:"totalpax",displayFormat:"{0}",summaryType:"custom"},{name:"cargoweight",showInColumn:"cargoweight",displayFormat:"{0}",summaryType:"custom"},{name:"baggageweight",showInColumn:"baggageweight",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"delay"===e.name&&("start"===e.summaryProcess&&(e.delay=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.delay+=e.value.delay)),"finalize"===e.summaryProcess&&(e.totalValue=e.delay)),"delayLanding"===e.name&&("start"===e.summaryProcess&&(e.delayLanding=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.delayLanding+=e.value.delayLanding)),"finalize"===e.summaryProcess&&(e.totalValue=e.delayLanding)),"totalpax"===e.name&&("start"===e.summaryProcess&&(e.totalpax=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.totalpax+=e.value.TotalPax)),"finalize"===e.summaryProcess&&(e.totalValue=e.totalpax)),"cargoweight"===e.name&&("start"===e.summaryProcess&&(e.cargoweight=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.cargoweight+=e.value.CargoWeight)),"finalize"===e.summaryProcess&&(e.totalValue=e.cargoweight)),"baggageweight"===e.name&&("start"===e.summaryProcess&&(e.baggageweight=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.baggageweight+=e.value.BaggageWeight)),"finalize"===e.summaryProcess&&(e.totalValue=e.baggageweight))}},bindingOptions:{dataSource:"dg_flights_ds",visible:"gridview",height:"dg_flights_height"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.scroll=0,e.bind=function(){var t="odata/flightplans/customer/"+Config.CustomerId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Id",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},r.isAuthorized()?n.page_title="> Flights":r.redirectToLogin(),e.hideButtons=function(){e.$apply(function(){e.offBlockVisible=!1,e.takeOffVisible=!1,e.landingVisible=!1,e.onBlockVisible=!1,e.IsDepartureVisible=!1,e.IsArrivalVisible=!1,e.IsDepartureDisabled=!0,e.IsArrivalDisabled=!0,e.IsCancelVisible=!1,e.IsRampVisible=!1})},e.hideButtons2=function(){e.offBlockVisible=!1,e.takeOffVisible=!1,e.landingVisible=!1,e.onBlockVisible=!1,e.IsDepartureVisible=!1,e.IsArrivalVisible=!1,e.IsDepartureDisabled=!0,e.IsArrivalDisabled=!0,e.IsCancelVisible=!1,e.IsRampVisible=!1},e.showButtons=function(t){e.$apply(function(){e.offBlockVisible=(1==t.status||9==t.status)&&(t.FromAirportIATA==e.airport||e.IsAdmin),e.takeOffVisible=14==t.status&&(t.FromAirportIATA==e.airport||e.IsAdmin),e.landingVisible=(2==t.status||17==t.status)&&(t.ToAirportIATA==e.airport||e.IsAdmin)||17==t.status&&(t.FromAirportIATA==e.airport||e.IsAdmin),e.onBlockVisible=(3==t.status||7==t.status)&&(t.ToAirportIATA==e.airport||e.IsAdmin)||7==t.status&&(t.FromAirportIATA==e.airport||e.IsAdmin),e.IsDepartureVisible=t.FromAirportIATA==e.airport,e.IsArrivalVisible=t.ToAirportIATA==e.airport||t.FromAirportIATA==e.airport&&(7==t.status||17==t.status),e.IsDepartureDisabled=null!=t.Landing,e.IsArrivalDisabled=null==t.Takeoff,e.IsCancelVisible=!t.Takeoff&&4!=t.status&&(t.FromAirportIATA==e.airport||e.IsAdmin),e.IsRedirectVisible=t.Takeoff&&7!=t.status&&(t.FromAirportIATA==e.airport||e.IsAdmin),e.IsRampVisible=(t.FromAirportIATA==e.airport||e.IsAdmin)&&9!=t.status})},e.showButtons2=function(t){e.offBlockVisible=(1==t.status||9==t.status)&&(t.FromAirportIATA==e.airport||e.IsAdmin),e.takeOffVisible=14==t.status&&(t.FromAirportIATA==e.airport||e.IsAdmin),e.landingVisible=(2==t.status||17==t.status)&&(t.ToAirportIATA==e.airport||e.IsAdmin)||17==t.status&&(t.FromAirportIATA==e.airport||e.IsAdmin),e.onBlockVisible=(3==t.status||7==t.status)&&(t.ToAirportIATA==e.airport||e.IsAdmin)||7==t.status&&(t.FromAirportIATA==e.airport||e.IsAdmin),e.IsDepartureVisible=t.FromAirportIATA==e.airport,e.IsArrivalVisible=t.ToAirportIATA==e.airport||t.FromAirportIATA==e.airport&&(7==t.status||17==t.status),e.IsDepartureDisabled=null!=t.Landing,e.IsArrivalDisabled=null==t.Takeoff,e.IsCancelVisible=!t.Takeoff&&4!=t.status&&(t.FromAirportIATA==e.airport||e.IsAdmin),e.IsRedirectVisible=t.Takeoff&&(t.FromAirportIATA==e.airport||e.IsAdmin),e.IsRampVisible=(t.FromAirportIATA==e.airport||e.IsAdmin)&&9!=t.status},e.weatherUpdateTime=null,e.weatherUpdateTimePassed=0,e.AirportWeatherVisible=!1,e.AirportWeather={currently:{},hourly:{}},e.FromWeather={currently:{}},e.FromWeatherVisible=!0,e.ToWeather={currently:{}},e.ToWeatherVisible=!0,e.getIcon=function(e){return e?e.currently.icon+" wicon":""},e.getIcon2=function(e){return e+" wicon"},e.prepareWeather=function(e){var t=90+Number(e.currently.windBearing);if(e.latitude=Number(e.latitude).toFixed(4),e.longitude=Number(e.longitude).toFixed(4),e.currently.windDeg="rotate("+t+"deg)",e.currently.windPoint="Winds from the "+Weather.getCompassPoint(Number(e.currently.windBearing)),e.currently.humidity=(100*Number(e.currently.humidity)).toFixed(1),e.currently.cloudCover=(100*Number(e.currently.cloudCover)).toFixed(1),e.currently.visibility=(1e3*Number(e.currently.visibility)).toFixed(0),e.hourly){e.hourly.h1={},e.hourly.h2={},e.hourly.h3={},e.hourly.h4={};for(var i=1;i<=4;i++){var n=e.hourly.data[i],a=null;switch(i){case 1:a=e.hourly.h1;break;case 2:a=e.hourly.h2;break;case 3:a=e.hourly.h3;break;case 4:a=e.hourly.h4}a.time=formatHourAMPM(new Date(1e3*n.time)),a.icon=n.icon,a.summary=n.summary,a.temperature=n.temperature,a.windtotal=n.windSpeed+" "+Weather.getCompassPoint(Number(n.windBearing)),a.visibility=1e3*Number(n.visibility),a.cloudCover=(100*Number(n.cloudCover)).toFixed(1)}}},e.setWeather=function(){if(e.flight){e.ToWeatherVisible=!1,e.FromWeatherVisible=!1;new Date(e.flight.STD).toUTCDateTimeDigits(),new Date(e.flight.STA).toUTCDateTimeDigits();o.getFlight(e.flight.ID,-1).then(function(t){e.FromWeather=t,e.prepareWeather(e.FromWeather),e.FromWeatherVisible=!0,o.getFlight(e.flight.ID,-2).then(function(t){e.ToWeather=t,e.prepareWeather(e.ToWeather),e.ToWeatherVisible=!0},function(e){General.ShowNotify(e.message,"error")})},function(e){
General.ShowNotify(e.message,"error")})}},e.selectedFlights=[],e.clearSelectedFlights=function(){e.selectedFlights=[],e.hideButtons()},e.doGridSelectedChanged=!0,e.addSelectedFlight=function(t){e.removeUpdatedFlights(t),e.hideButtons(),Enumerable.From(e.selectedFlights).Where("$.taskId=="+t.taskId).FirstOrDefault()?(e.selectedFlights=[],e.$apply(function(){e.popup_inf_visible=!1})):(e.selectedFlights=[],e.selectedFlights.push(t),e.flight=t,e.showButtons(t),e.popup_inf_visible&&e.setWeather(),e.doGridSelectedChanged=!1,e.dg_flights_instance.selectRows([t],!1))},e.addSelectedFlight2=function(t){e.removeUpdatedFlights(t),e.hideButtons2(),Enumerable.From(e.selectedFlights).Where("$.taskId=="+t.taskId).FirstOrDefault()?(e.selectedFlights=[],e.popup_inf_visible=!1):(e.selectedFlights=[],e.selectedFlights.push(t),e.flight=t,e.showButtons2(t),e.popup_inf_visible&&e.setWeather())},e.selectedResource=null,e.setSelectedResource=function(t){var i=t.index;e.selectedResource&&e.setSelectedResource.index==i?(e.selectedResource=null,$("#resourceGanttba").data("ejGantt").clearSelection(i),alert("x")):e.selectedResource={index:t.index,item:t.item}},e.ganttCreated=!1,e.renderTopTimeHeader=function(){var e=$(".e-schedule-week-headercell-content");$.each(e,function(e,t){var i=$(t),n=i.html().split("(")[0],a=Number(n.split(",")[1]),o=n.split(",")[0].split(" "),l=o[1],r=o[3],d=new Date(a+"/"+l+"/"+r),s=n+" ("+new persianDate(d).format("DD/MM/YYYY")+")";i.html(s)})},e.renderTimeHeader=function(){var t=$(".e-schedule-day-headercell-content");$.each(t,function(t,i){var n=$(i),a=n.html(),o=Number(n.html());n.find("span").length>0&&(a=$(n.find("span")[0]).html(),o=Number(a));var l=0;e.IsUTC,l=getUTCHour(o);var r="<span style='font-size:13px'>"+a+"</span><span style='font-size:11px;display:inline-block;margin-left:3px;color:gray'>"+l+"</span>";n.html(r)})},e.createGantt=function(){var t=$("#resourceGanttba").data("ejGantt");t&&t.destroy();var i=$(window).height()-139-50;i+="px",$("#resourceGanttba").ejGantt({selectionMode:ej.Gantt.SelectionMode.Cell,selectionType:ej.Gantt.SelectionType.Single,taskbarClick:function(t){e.addSelectedFlight(t.data.item),$("#resourceGanttba").data("ejGantt").clearSelection()},dataSource:e.dataSource,allowColumnResize:!0,isResponsive:!0,taskIdMapping:"taskId",taskNameMapping:"taskName",fromLocationMapping:"from",startDateMapping:"startDate",endDateMapping:"endDate",progressMapping:"progress",durationMapping:"duration",groupNameMapping:"Title",groupIdMapping:"groupId",groupCollection:e.resourceGroups,resources:e.resources,resourceIdMapping:"resourceId",resourceNameMapping:"resourceName",resourceInfoMapping:"resourceId",notesMapping:"notes",rightTaskLabelMapping:"taskName",baselineStartDateMapping:"BaselineStartDate",baselineEndDateMapping:"BaselineEndDate",highlightWeekEnds:!0,includeWeekend:!1,rowHeight:"material"==window.theme?48:"office-365"==window.theme?36:40,taskbarHeight:35,scheduleStartDate:e.datefrom,scheduleEndDate:e.dateto,predecessorMapping:"predecessor",allowGanttChartEditing:!1,allowDragAndDrop:!0,editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,editMode:"normal"},splitterSettings:{position:180},toolbarSettings:{showToolbar:!1,toolbarItems:[ej.Gantt.ToolbarItems.Add,ej.Gantt.ToolbarItems.Delete,ej.Gantt.ToolbarItems.Update,ej.Gantt.ToolbarItems.Cancel,ej.Gantt.ToolbarItems.ExpandAll,ej.Gantt.ToolbarItems.CollapseAll,ej.Gantt.ToolbarItems.NextTimeSpan,ej.Gantt.ToolbarItems.PrevTimeSpan]},enableContextMenu:!1,load:function(){console.log("load"),e.ganttCreated=!0,this.getColumns()[0].width=180},create:function(t){$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(e.scroll);var i=new Date,n=new Date(e.datefrom),a=new Date(e.dateto);i.getTime()>=n.getTime()&&i.getTime()<=a.getTime()&&e.StartNowLineTimer(1)},cellSelecting:function(e){e&&"resourceTask"!=e.data.eResourceTaskType&&(e.cancel=!0)},cellSelected:function(t){$(".e-gantt-taskbarSelection").removeClass("e-gantt-taskbarSelection"),e.setSelectedResource(t.data)},actionBegin:function(e){e.requestType&&"beginedit"==e.requestType&&(e.cancel=!0)},actionComplete:function(t){console.log(t),"save"==t.requestType&&(e.doActionCompleteSave?setTimeout(function(){$("#resourceGanttba").data("ejGantt")._$ganttchartHelper.ejGanttChart("selectTaskbar",t.modifiedRecord)},100):e.doActionCompleteSave=!0)},workingTimeScale:"TimeScale24Hours",durationUnit:ej.Gantt.DurationUnit.Hour,scheduleHeaderSettings:{scheduleHeaderType:ej.Gantt.ScheduleHeaderType.Day,dayHeaderFormat:"MMM MM ddd dd , yyyy",minutesPerInterval:ej.Gantt.minutesPerInterval.ThirtyMinutes,timescaleUnitSize:"500%"},taskbarTemplate:"#taskbarTemplate",leftTaskLabelTemplate:"#leftlableTemplate",viewType:ej.Gantt.ViewType.ResourceView,sizeSettings:{height:i},groupSettings:{},showStackedHeader:!1,taskSchedulingMode:ej.Gantt.TaskSchedulingMode.Manual,enableTaskbarTooltip:!1})},e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.wtimer=null,e.StartWTimer=function(){e.wtimer=setTimeout(function(){var t=Number(subtractDates(new Date(Date.now()),e.weatherUpdateTime)).toFixed(0);e.$apply(function(){e.weatherUpdateTimePassed=t}),e.StartWTimer()},1e4)},e.StopWTimer=function(){e.wtimer&&clearTimeout(e.wtimer)},e.getAirportWeather=function(){e.weatherUpdateTimePassed=0,e.StopWTimer(),e.AirportWeatherVisible=!1,o.getCurrentHourly(e.airportEntity.Latitude,e.airportEntity.Longitude).then(function(t){e.weatherUpdateTime=new Date(Date.now()),e.AirportWeather=t,e.prepareWeather(e.AirportWeather),e.StartWTimer(),e.AirportWeatherVisible=!0},function(e){General.ShowNotify(e.message,"error")})},e.updateWeather=function(){e.getAirportWeather()},e.$on("$viewContentLoaded",function(){e.scroll2_height=$(window).height()-266.5+87,$(".flightboardall").fadeIn(400,function(){e.loadingVisible=!0,a.getAirportByIATA(e.airport).then(function(t){e.airportEntity=t,e.airportEntity.Latitude2=Number(e.airportEntity.Latitude).toFixed(3),e.airportEntity.Longitude2=Number(e.airportEntity.Longitude).toFixed(3),e.airportEntity.LtLg="("+e.airportEntity.Latitude2+", "+e.airportEntity.Longitude2+")",e.loadingVisible=!1,e.getAirportWeather()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})})}),n.$broadcast("FlightBoardAllLoaded",null)}]),app.controller("flightPlanApplyController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.filterVisible=!1,e.tempData=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.btn_view={text:"View",type:"default",icon:"info",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.loadingVisible=!0,a.getFlightPlanView(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,e.tempData=t,e.popup_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.IsApproveDisabled=!0,e.btn_approve={text:"Approve",type:"default",icon:"check",width:150,bindingOptions:{disabled:"IsApproveDisabled"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_SimpleConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.approvePlanRegisters(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.IsApproveDisabled=!0,e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_height_full=100,e.scroll_height_full=400,e.dg_selected=null,e.dg_columns=[{dataField:"",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.data.IsApproved100&&0!=t.data.IsApproved100?$("<div>").append("<i style='font-size:22px;color:#8bc34a!important' class='icon ion-md-checkmark-circle'></i>").appendTo(e):$("<div>").append("<i style='font-size:22px;color:#ff5722!important' class='icon ion-md-help-circle '></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"Id",caption:"No",allowResizing:!0,dataType:"number",allowEditing:!1,width:120,alignment:"center",sortIndex:1,sortOrder:"asc",fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:200},{dataField:"Types",caption:"Types",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:200},{dataField:"IntervalType",caption:"Interval",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:150},{dataField:"TotalFlights",caption:"Flights",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"DateFrom",caption:"From",allowResizing:!0,dataType:"date",allowEditing:!1,width:200,alignment:"center",fixed:!1,fixedPosition:"right"},{dataField:"DateTo",caption:"To",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200,fixed:!1,fixedPosition:"right"}],e.dg_height=100,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];if(i)if(e.dg_selected=i,e.IsApproveDisabled=1==i.IsApproved100,e.dg_selected.assignedRegisters)e.dg_reg_ds=e.dg_selected.assignedRegisters;else{e.loadingVisible=!0;var o=-1*(new Date).getTimezoneOffset();a.getFlightPlanAssignedRegisters(e.dg_selected.Id,o).then(function(t){e.loadingVisible=!1,n.MSNs=t,e.dg_selected.assignedRegisters=t,e.dg_reg_ds=e.dg_selected.assignedRegisters},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else e.dg_selected=null,e.IsApproveDisabled=!0,e.dg_reg_ds=[]},height:"100%",bindingOptions:{dataSource:"dg_ds"}},e.dg_reg_columns=[{dataField:"DateFromTo",caption:"Date",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,groupIndex:0,width:200},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,groupIndex:1,width:200},{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Dep.",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:120,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arr.",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:120,format:"HH:mm"}],e.dg_reg_selected=null,e.dg_reg_instance=null,e.dg_reg_ds=null,e.dg_reg_height=null,e.dg_reg={grouping:{autoExpandAll:!0,allowCollapsing:!0},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_reg_columns,onContentReady:function(t){e.dg_reg_instance||(e.dg_reg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_reg_selected=i||null},height:function(){return window.innerHeight-180},bindingOptions:{dataSource:"dg_reg_ds"}},e.bind=function(){var t="odata/flightplans/approved/customer/"+Config.CustomerId+"/70";!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Id",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},l.isAuthorized()?(n.page_title="> Flight Plans(Apply) ",$(".flightplanapply").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("flightPlanningGanttViewController",["$scope","$location","flightService","aircraftService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o,l){e.Day0="05/06/2019",e.Day1="05/07/2019",e.Day2="05/07/2019 23:59:00.000",Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.scroll=0,e.addSelectedFlight=function(t){e.selectedFlight?e.selectedFlight=null:e.selectedFlight=t,console.log(e.selectedFlight)};var r,d=function(){var t=this;t.flightData=ko.observable(),t.details="vahid",t.startDate=ko.observable(new Date(e.Day1)),t.endDate=ko.observable(new Date(e.Day2)),t.flights=ko.observable([]),t.resourceGroups=ko.observable([]),t.resources=ko.observableArray([]),t.viewType=ko.observable(ej.Gantt.ViewType.ResourceView),t.height=ko.observable("300px"),t.datasource=ko.observableArray([]),t.selectedTask=ko.observable(),t.selectedTaskData=ko.observable(),t.gantt_option={selectionMode:ej.Gantt.SelectionMode.Cell,selectionType:ej.Gantt.SelectionType.Single,taskbarClick:function(t){console.log("taskbarClick"),e.addSelectedFlight(t.data.item)},dataSource:[],allowColumnResize:!0,isResponsive:!0,taskIdMapping:"taskId",taskNameMapping:"taskName",fromLocationMapping:"from",startDateMapping:"startDate",endDateMapping:"endDate",progressMapping:"progress",durationMapping:"duration",groupNameMapping:"Title",groupIdMapping:"groupId",groupCollection:t.resourceGroups,resources:t.resources,resourceIdMapping:"resourceId",resourceNameMapping:"resourceName",resourceInfoMapping:"resourceId",notesMapping:"notes",rightTaskLabelMapping:"taskName",baselineStartDateMapping:"BaselineStartDate",baselineEndDateMapping:"BaselineEndDate",highlightWeekEnds:!0,includeWeekend:!1,rowHeight:"material"==window.theme?48:"office-365"==window.theme?36:40,taskbarHeight:35,scheduleStartDate:t.startDate,scheduleEndDate:t.endDate,predecessorMapping:"predecessor",allowGanttChartEditing:!1,allowDragAndDrop:!0,editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,editMode:"normal"},splitterSettings:{position:180},toolbarSettings:{showToolbar:!1,toolbarItems:[ej.Gantt.ToolbarItems.Add,ej.Gantt.ToolbarItems.Delete,ej.Gantt.ToolbarItems.Update,ej.Gantt.ToolbarItems.Cancel,ej.Gantt.ToolbarItems.ExpandAll,ej.Gantt.ToolbarItems.CollapseAll,ej.Gantt.ToolbarItems.NextTimeSpan,ej.Gantt.ToolbarItems.PrevTimeSpan]},enableContextMenu:!1,load:function(){this.getColumns()[0].width=180},create:function(t){e.tempFlight&&e.addFlight(e.tempFlight),$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(e.scroll)},rowSelected:function(e){},actionBegin:function(e){e.requestType&&"beginedit"==e.requestType&&(e.cancel=!0)},actionComplete:function(e){},rowDataBound:function(e){e.data.eResourceTaskType},beginEdit:function(e){},workingTimeScale:"TimeScale24Hours",durationUnit:ej.Gantt.DurationUnit.Hour,scheduleHeaderSettings:{scheduleHeaderType:ej.Gantt.ScheduleHeaderType.Hour,dayHeaderFormat:"DAY dd",minutesPerInterval:ej.Gantt.minutesPerInterval.ThirtyMinutes,timescaleUnitSize:"255%"},taskbarTemplate:"#taskbarTemplate",leftTaskLabelTemplate:"#leftlableTemplate",viewType:t.viewType,sizeSettings:{height:t.height},groupSettings:{},showStackedHeader:!1,taskSchedulingMode:ej.Gantt.TaskSchedulingMode.Manual,enableTaskbarTooltip:!1},t.test=ko.observable("vahid"),t.date_takeoff=ko.observable(),t.date_takeoff_options=ko.observable({type:"datetime",value:t.date_takeoff})};e.entity={Id:-1,FlightPlanId:null,TypeId:null,RegisterID:null,FlightTypeID:null,AirlineOperatorsID:null,FlightNumber:null,FromAirport:null,ToAirport:null,STD:null,STA:null,FlightH:null,FlightM:null,Unknown:null,RouteId:null},e.clearEntity=function(){e.entity.Id=null,e.entity.TypeId=null,e.entity.RegisterID=null,e.entity.FlightTypeID=null,e.entity.FlightNumber=null,e.entity.FromAirport=null,e.entity.ToAirport=null,e.entity.STD=null,e.entity.STA=null,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.Unknown=null,e.start=null,e.entity.RouteId=null},e.refreshEntity=function(){e.entity.Id=null,e.entity.FlightTypeID=null,e.entity.AirlineOperatorsID=null,e.entity.FlightNumber=null,e.entity.FromAirport=e.entity.ToAirport,e.entity.ToAirport=null,e.entity.STD=e.entity.STA,e.start=e.entity.STD,e.entity.STA=null,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.Unknown=null,e.entity.RouteId=null},e.selectedFlight=null,e.tempToAirport=null,e.InitUpdate=function(){var t=Enumerable.From(r.datasource()).Where("$.taskId=="+e.selectedFlight.taskId).FirstOrDefault();t&&(e.entity.Id=t.Id,e.entity.FlightNumber=t.FlightNumber,e.entity.FlightTypeID=t.FlightTypeID,e.entity.FromAirport=t.FromAirport,e.entity.ToAirport=t.ToAirport,e.tempToAirport=t.ToAirport,e.entity.TypeId=t.TypeId,e.entity.RegisterID=t.RegisterID,e.start=new Date(t.STD),e.entity.FlightH=t.FlightH,e.entity.FlightM=t.FlightM,e.entity.STA=new Date(t.STA),e.entity.STD=new Date(t.STD),e.IsNew=!1,e.popup_item_title="Update",e.popup_item_visible=!0,e.entity.status=t.status,e.entity.initStatus=t.initStatus,e.entity.isnew=!1)},e.setArrival=function(){if(null!=e.entity.STD&&null!=e.entity.FlightH&&null!=e.entity.FlightM){var t=new Date(e.entity.STD);e.entity.STA=new Date(t.addHours(e.entity.FlightH).addMinutes(e.entity.FlightM))}else e.entity.STA=null},e.selectedType=null,e.sb_type={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(e){return l.getSbTemplateAircraft(e)},searchExpr:["Type","Manufacturer"],dataSource:l.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",onSelectionChanged:function(t){e.ds_msn=[],e.msn_readOnly=!0,t&&t.selectedItem?n.getVirtualMSNsByType(Config.CustomerId,t.selectedItem.Id).then(function(t){e.msn_readOnly=!1,e.ds_msn=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}):(e.msn_readOnly=!0,e.ds_msn=[])},bindingOptions:{value:"entity.TypeId",selectedItem:"selectedType"}},e.ds_msn=[],e.msn_readOnly=!0,e.unknown_readOnly=!1,e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(t){if(t.selectedItem&&1==e.IsNew){var i=Flight.getLastFlight(r.datasource(),t.selectedItem.ID);i&&(e.entity.FromAirport=i.ToAirport,e.entity.ToAirport=null,e.entity.STD=new Date(i.STA),e.start=new Date(e.entity.STD))}},bindingOptions:{value:"entity.RegisterID",disabled:"msn_readOnly",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.getAverageRouteTime=function(){1==e.IsNew&&e.entity.FromAirport&&e.entity.ToAirport&&(e.loadingVisible=!0,i.getAverageRouteTime(e.entity.FromAirport,e.entity.ToAirport).then(function(t){e.loadingVisible=!1,e.entity.FlightH=t.FlightH,e.entity.FlightM=t.FlightM,e.setArrival()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},e.sb_flighttype={showClearButton:!0,searchEnabled:!0,dataSource:l.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.FlightTypeID"}},e.selectedFromAirport=null,e.selectedToAirport=null,e.sb_FromAirport={showClearButton:!0,searchEnabled:!0,dataSource:l.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return l.getSbTemplateAirport(e)},onSelectionChanged:function(t){if(e.entity.ToAirport=null,!t.selectedItem)return void(e.ds_toairport=[]);e.loadingVisible=!0,i.getRouteDestination(Config.AirlineId,t.selectedItem.Id).then(function(t){e.loadingVisible=!1,e.ds_toairport=t,e.tempToAirport&&(e.entity.ToAirport=e.tempToAirport,e.tempToAirport=null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.FromAirport",selectedItem:"selectedFromAirport"}},e.ds_toairport=[],e.sb_ToAirport={showClearButton:!0,searchEnabled:!0,itemTemplate:function(e){return l.getSbTemplateRouteTo(e)},onSelectionChanged:function(t){t.selectedItem?(e.entity.RouteId=t.selectedItem.Id,e.entity.FlightH=t.selectedItem.FlightH,e.entity.FlightM=t.selectedItem.FlightM):(e.entity.RouteId=null,e.entity.FlightH=null,e.entity.FlightM=null),e.setArrival()},searchExpr:["ToAirportIATA","ToCity"],displayExpr:"ToAirportIATA",valueExpr:"ToAirportId",bindingOptions:{value:"entity.ToAirport",selectedItem:"selectedRoute",dataSource:"ds_toairport"}},e.selectedRoute=null,e.sb_route={showClearButton:!0,searchEnabled:!0,dataSource:l.getDatasourceRoutes(Config.AirlineId),itemTemplate:function(e){return l.getSbTemplateRoute(e)},onSelectionChanged:function(t){t.selectedItem?(e.entity.FromAirport=t.selectedItem.FromAirportId,e.entity.ToAirport=t.selectedItem.ToAirportId,e.entity.FlightH=t.selectedItem.FlightH,e.entity.FlightM=t.selectedItem.FlightM):(e.entity.FromAirport=null,e.entity.ToAirport=null,e.entity.FlightH=null,e.entity.FlightM=null),e.setArrival()},searchExpr:["FromAirportIATA","FromCity"],displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.RouteId",selectedItem:"selectedRoute"}},e.start=null,e.time_start={type:"time",width:"100%",interval:15,onValueChanged:function(t){if(t.value){var i=new Date(t.value),n=i.getHours(),a=i.getMinutes(),o=n+":"+a+":00",l=e.Day1+" "+o,r=new Date(l);e.entity.STD=r}else e.entity.STD=null;e.setArrival()},bindingOptions:{value:"start"}},e.time_end={readOnly:!0,type:"time",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entity.STA"}},e.text_flighth={min:0,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.FlightH"}},e.text_flightm={min:0,max:59,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.FlightM"}},e.text_unknown={bindingOptions:{value:"entity.Unknown",disabled:"unknown_readOnly"}},e.text_flightnumber={bindingOptions:{value:"entity.FlightNumber"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.scroll_height=200,e.dg_height=200,e.dg_height2=200,e.scroll_main={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.deleted=[],e.pop_width=900,e.pop_height=600,e.popup_add_visible=!1,e.popup_add_title="New",e.apply=!1,e.gaps="Gaps: 0",e.overlaps="Overlaps: 0",e.gapoverlaps="Gap & Overlaps: 0",e.gapsn=0,e.overlapsn=0,e.gapoverlapsn=e.popup_add={fullScreen:!0,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"default",text:"",width:40,icon:"plus",onClick:function(t){e.IsNew=!0,e.popup_item_visible=!0,e.popup_item_title="Add"}}},{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"default",text:"",width:40,icon:"edit",onClick:function(t){if(!e.selectedFlight)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.InitUpdate()}}},{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"danger",text:"",width:40,icon:"remove",onClick:function(t){if(!e.selectedFlight)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.deleted.push(e.selectedFlight.taskId);var i=e.selectedFlight.RegisterID,n=Enumerable.From(r.datasource()).Where("$.taskId!="+e.selectedFlight.taskId).ToArray(),a=$("#resourceGantt").data("ejGantt");Flight.findGaps(n,r.resources()),Flight.findOverlaps(n,i),a._refreshDataSource(n),e.selectedFlight=null,r.datasource(n),Flight.activeDatasource=n,e.getErrors()}}},{widget:"dxTextBox",location:"after",options:{width:70,readOnly:!0,bindingOptions:{value:"gaps"}},toolbar:"bottom"},{widget:"dxTextBox",location:"after",options:{width:100,readOnly:!0,bindingOptions:{value:"overlaps"}},toolbar:"bottom"},{widget:"dxTextBox",location:"after",options:{width:130,readOnly:!0,bindingOptions:{value:"gapoverlaps"}},toolbar:"bottom"},{widget:"dxCheckBox",location:"after",options:{visible:!1,width:100,text:"Apply",onValueChanged:function(t){e.apply=t.value}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{visible:!1,type:"success",text:"Save",icon:"check",onClick:function(t){if(1==e.apply&&(e.gapsn>0||e.overlapsn>0))return void General.ShowNotify(Config.Text_GanttErrors,"error");var n=Enumerable.From(r.datasource()).ToArray(),a=[];$.each(n,function(t,i){a.push({Id:i.Id,FlightPlanId:e.planId,TypeId:i.TypeId,RegisterID:i.RegisterID,FlightTypeID:i.FlightTypeID,AirlineOperatorsID:i.AirlineOperatorsID,FlightNumber:i.FlightNumber,FromAirport:i.FromAirport,ToAirport:i.ToAirport,STD:new Date(i.startDate).toUTCString(),STA:new Date(i.endDate).toUTCString(),FlightH:i.FlightH,FlightM:i.FlightM,StatusId:i.status})});var o={};o.Plan=e.plan,o.Items=a,o.Deleted=e.deleted,o.Apply=e.apply,e.loadingVisible=!0,i.savePlanItems(o).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success");var i=Enumerable.From(r.datasource()).ToArray();$.each(i,function(e,i){if(i.Id>=1e6){var n=Enumerable.From(t).Where("$.InitId=="+i.Id).FirstOrDefault();i.Id=n.Id}});var n=$("#resourceGantt").data("ejGantt");n._refreshDataSource(i),r.datasource(i),n.reRenderChart(),e.selectedFlight=null,e.loadingVisible=!1,l.$broadcast("onFlightPlanItemsSaved",null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_add_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){$("#gantt_container").append('<div id="resourceGantt" style="height:450px;width:100%;" data-bind="ejGantt: gantt_option" />')},onShown:function(t){e.IsBase?e.bind(e.planId):e.bindDto()},onHiding:function(){var t=$("#resourceGantt")[0];ko.cleanNode(t),$("#resourceGantt").remove(),e.clearEntity(),e.popup_add_visible=!1,l.$broadcast("onFlightDesignHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title","toolbarItems[0].visible":"false","toolbarItems[1].visible":"false","toolbarItems[2].visible":"false","toolbarItems[3].visible":"IsEditView","toolbarItems[4].visible":"IsEditView","toolbarItems[5].visible":"IsEditView","toolbarItems[7].visible":"IsEditView"}},e.detailType="gantt",e.copy=function(e,t){t.Id=e.Id,t.taskId=e.taskId,t.FlightPlanId=e.FlightPlanId,t.TypeId=e.TypeId,t.RegisterID=e.RegisterID,t.FlightTypeID=e.FlightTypeID,t.AirlineOperatorsID=e.AirlineOperatorsID,t.FlightNumber=e.FlightNumber,t.FromAirport=e.FromAirport,t.ToAirport=e.ToAirport,t.STA=new Date(e.STA),t.STD=new Date(e.STD),t.FlightH=e.FlightH,t.FlightM=e.FlightM,t.Unknown=e.Unknown,t.FlightPlan=e.FlightPlan,t.CustomerId=e.CustomerId,t.IsActive=e.IsActive,t.DateActive=e.DateActive,t.DateFrom=e.DateFrom,t.DateTo=e.DateTo,t.Customer=e.Customer,t.FromAirportName=e.FromAirportName,t.FromAirportIATA=e.FromAirportIATA,t.from=e.from,t.FromAirportCityId=e.FromAirportCityId,t.ToAirportName=e.ToAirportName,t.ToAirportIATA=e.ToAirportIATA,t.to=e.to,t.ToAirportCityId=e.ToAirportCityId,t.notes=e.notes,t.status=e.status,t.progress=e.progress,t.duration=e.duration,t.startDate=new Date(e.startDate),t.taskName=e.taskName,t.FromAirportCity=e.FromAirportCity,t.ToAirportCity=e.ToAirportCity,t.MSN=e.MSN,t.Register=e.Register,t.AircraftType=e.AircraftType,t.resourceId=e.resourceId,t.initStatus=e.initStatus,t.delay=e.delay,t.delayLanding=e.delayLanding,t.baseDuration=e.baseDuration,t.baseEndDate=new Date(e.baseEndDate),t.baseStartDate=new Date(e.baseStartDate),t.endDate=new Date(e.endDate),t.BaselineStartDate=e.BaselineStartDate,t.BaselineEndDate=e.BaselineEndDate,t.serialNumber=e.serialNumber,t.isnew=e.isnew},e.IsNew=!0,e.tempFlight=null,e.addFlight=function(t){1==e.IsNew?(t.taskId=e.taskIndex,t.Id=t.taskId,e.taskIndex=e.taskIndex+1):t.taskId=t.Id,e.IsNew?(t.isnew=!0,t.status=1,t.initStatus=[1]):t.isnew;var i=$("#resourceGantt").data("ejGantt");e.tempFlight=null;var n=JSON.parse(JSON.stringify(t));if(n.startDate=new Date(t.startDate),n.endDate=new Date(t.endDate),Flight.processData(n),e.IsNew)i.addRecord(n,0),r.datasource().push(n),e.refreshEntity();else{var a=Enumerable.From(r.datasource()).Where("$.taskId=="+t.taskId).FirstOrDefault();e.copy(n,a),i.updateRecordByTaskId(n),e.popup_item_visible=!1}Flight.findGaps(r.datasource(),r.resources(),function(){Flight.findOverlaps(r.datasource(),t.RegisterID,function(){Flight.activeDatasource=r.datasource()})}),e.getErrors(),i.reRenderChart()},e.popup_item_visible=!1,e.popup_item_title="Add",e.popup_item={fullScreen:!1,showTitle:!0,height:480,width:600,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplanitem",onClick:function(t){if(e.scroll=$(".e-ganttviewerbodyContianer").data("ejScroller").scrollLeft(),!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(!e.entity.RegisterID&&!e.entity.Unknown)return void General.ShowNotify(Config.Text_FillRequired,"error");if(0==e.entity.FlightH&&0==e.entity.FlightM)return void General.ShowNotify(Config.Text_FillRequired,"error");e.entity.from=e.selectedFromAirport.IATA,e.entity.to=e.selectedRoute.ToAirportIATA,e.entity.taskName=e.selectedFromAirport.IATA+(e.entity.FlightNumber?" -"+e.entity.FlightNumber+"- ":" -?- ")+e.selectedRoute.ToAirportIATA,e.entity.startDate=new Date(e.entity.STD),e.entity.endDate=new Date(e.entity.STA),e.entity.notes="green",e.entity.progress=0,e.entity.delay=0,e.entity.delayLanding=0,e.entity.duration=Flight.calculateDuration(e.entity.FlightH,e.entity.FlightM),e.entity.baseDuration=e.entity.duration,e.entity.resourceId=[],e.entity.resourceId.push(e.entity.RegisterID);var i=$("#resourceGantt").data("ejGantt");if(!Enumerable.From(r.resourceGroups()).Where("$.groupId=="+e.entity.TypeId).FirstOrDefault()){var n=r.resourceGroups();n.push({groupId:e.entity.TypeId,Title:e.selectedType.Type}),r.resourceGroups(n)}if(!Enumerable.From(r.resources()).Where("$.resourceId=="+e.entity.RegisterID).FirstOrDefault()){var a=r.resources();a.push({resourceName:e.selectedMsn.Register,groupId:e.selectedMsn.AircraftTypeId,resourceId:e.entity.RegisterID}),r.resources(a)}e.tempFlight={},e.copy(e.entity,e.tempFlight),i.reRenderChart()}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_item_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!0,closeOnOutsideClick:!1,onShowing:function(e){},
onShown:function(e){},onHiding:function(){e.clearEntity(),e.popup_expose_visible=!1},bindingOptions:{visible:"popup_item_visible",title:"popup_item_title"}},e.applied=!1,e.aircraftTypes=null,e.msns=null,e.buildResources=function(){var t=[];$.each(e.aircraftTypes,function(e,i){t.push({groupId:Number(i.Id),Title:i.Type})});var i=[];i.push({resourceName:"Vahid",groupId:6,resourceId:1}),r.resourceGroups(t),r.resources(i)},e.getErrors=function(){e.gapsn=Enumerable.From(r.datasource()).Where("$.status==11").ToArray().length,e.gaps="Gaps: "+e.gapsn,e.overlapsn=Enumerable.From(r.datasource()).Where("$.status==10").ToArray().length,e.overlaps="Overlaps: "+e.overlapsn,e.gapoverlapsn=Enumerable.From(r.datasource()).Where("$.status==16").ToArray().length,e.gapoverlaps="Gap & Overlaps: "+e.gapoverlapsn},e.bind=function(t){var a=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0,n.getAircraftTypes(Config.CustomerId).then(function(o){e.aircraftTypes=o,n.getMSNs(Config.CustomerId).then(function(n){e.msns=n,i.getFlightPlanGantt(t,a).then(function(t){e.loadingVisible=!1,$.each(t.flights,function(e,t){t.startDate=new Date(t.startDate),t.initStatus=[1],1!=t.status&&t.initStatus.push(t.status)}),r.flightData(t),r.resourceGroups(t.resourceGroups),r.resources(t.resources),e.applied=!0,ko.applyBindings(r,document.getElementById("resourceGantt"));var i=$(window).height()-100;r.height(i+"px");var n=Flight.proccessDataSource(t.flights);Flight.activeDatasource=n,r.datasource(n),e.getErrors(),$("#resourceGantt").data("ejGantt")._refreshDataSource(r.datasource())},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.bindDto=function(){(new Date).getTimezoneOffset();e.loadingVisible=!0,n.getAircraftTypes(Config.CustomerId).then(function(t){e.aircraftTypes=t,n.getMSNs(Config.CustomerId).then(function(t){e.msns=t,i.getPlanItemsGantt(e.plansDto).then(function(t){e.loadingVisible=!1,$.each(t.flights,function(e,t){t.startDate=new Date(t.startDate),t.initStatus=[1],1!=t.status&&t.initStatus.push(t.status)}),r.flightData(t),r.resourceGroups(t.resourceGroups),r.resources(t.resources),e.applied=!0,ko.applyBindings(r,document.getElementById("resourceGantt"));var i=$(window).height()-100;r.height(i+"px");var n=Flight.proccessDataSource(t.flights);Flight.activeDatasource=n,r.datasource(n),e.getErrors(),$("#resourceGantt").data("ejGantt")._refreshDataSource(r.datasource())},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.tempData=null,e.plan=null,e.planId=null,e.$on("InitFlightDesign",function(t,i){e.plan=i,e.planId=i.Id,e.entity.FlightPlanId=e.planId,e.taskIndex=1e6,r=new d,e.tempData=null,e.popup_add_title="Plan Items",e.popup_add_visible=!0}),e.IsReadonly=!1,e.IsEditView=!0,e.IsBase=!1,e.plansDto=null,e.$on("InitFlightPlanningGanttView",function(t,i){if(e.IsBase=!1,e.plan=i,e.IsReadonly=!0,e.IsEditView=!0,e.IsBase)e.planId=i.FlightPlanId;else{var n=-1*(new Date).getTimezoneOffset();e.plansDto={CustomerId:Config.CustomerId,Date:new Date(i.DateFrom).ToUTC(),Offset:n,Design:!0}}e.entity.FlightPlanId=e.planId,e.taskIndex=1e6,r=new d,e.tempData=null,e.popup_add_title="Flights",e.popup_add_visible=!0}),e.$on("InitFlightPlanningGanttViewBase",function(t,i){e.IsBase=!0,e.plan=i,e.IsReadonly=!0,e.IsEditView=!0,e.planId=i.FlightPlanId,e.entity.FlightPlanId=e.planId,e.taskIndex=1e6,r=new d,e.tempData=null,e.popup_add_title="Flights",e.popup_add_visible=!0})}]),app.controller("flightPlanPermitController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.typeId=50,e.filterVisible=!1,e.entity={Id:null,Title:null,DateFrom:null,DateTo:null,iDateFrom:new Date,iDateTo:new Date,CustomerId:Config.CustomerId,IsActive:!1,DateActive:null,Interval:null,Months:[],Days:[]},e.clearEntity=function(){e.entity.Id=null,e.entity.Title=null,e.entity.DateFrom=null,e.entity.DateTo=null,e.entity.iDateFrom=new Date,e.entity.iDateTo=new Date,e.entity.CustomerId=Config.CustomerId,e.entity.IsActive=!1,e.entity.DateActive=null,e.entity.Interval=null,e.entity.Months=[],e.entity.Days=[],e.data=[]},e.bindEntity=function(t){var i=t.Month,n=t.Days;t=t.plan,e.entity=t,e.entity.iDateFrom=new Date(t.DateFrom),e.entity.iDateTo=new Date(t.DateTo),e.entity.Months=i,e.entity.Days=n},e.tempData=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.btn_view={text:"View",type:"default",icon:"info",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.loadingVisible=!0,a.getFlightPlanView(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,e.tempData=t,e.popup_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.IsApproveDisabled=!0,e.btn_approve={text:"Approve",type:"default",icon:"check",width:150,bindingOptions:{disabled:"IsApproveDisabled"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_SimpleConfirm,function(t){t&&(e.loadingVisible=!0,a.approvePlan60(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))})}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}};new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("03/18/2017"),new Date("03/22/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017");e.pop_width_employees=600,e.pop_height_employees=450,e.dg_height_full=100,e.scroll_height_full=400,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={width:1e3,height:620,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Flights (Gantt)",icon:"rowfield",width:200,onClick:function(t){n.$broadcast("InitFlightDesignView",e.entity)}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Flights (Grid)",icon:"menu",width:200,onClick:function(t){n.$broadcast("InitFlightDesignGridView",e.entity)}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_add_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.tempData&&e.bindEntity(e.tempData)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1},bindingOptions:{visible:"popup_add_visible",title:"popup_add_title"}},e.isDouble=0;e.monthArray=[],e.dayArray=[],e.addCustom=function(t,i,n,a){if(n&&0!=n.length&&a&&0!=a.length)for(;t<=i;){var o=!1,l=!1;o=!n||0==n.length||-1!=n.indexOf(t.getMonth()),l=!a||0==a.length||-1!=a.indexOf(t.getDay()),o&&l&&e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(1)}},e.addDaily=function(t,i,n){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(n)},e.addMonthly=function(t,i){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(30)},e.fillSchedule=function(){if(e.data=[],e.entity.Interval&&e.entity.iDateFrom&&e.entity.iDateTo){var t=new Date(e.entity.iDateFrom);t=new Date(t.setHours(0,0,0,0));var i=new Date(e.entity.iDateTo);switch(i=new Date(i.setHours(23,59,59,999)),console.log(t),console.log(i),e.entity.Interval){case 1:e.addDaily(t,i,1);break;case 2:e.addDaily(t,i,7);break;case 3:e.addDaily(t,i,10);break;case 4:e.addDaily(t,i,14);break;case 5:e.addDaily(t,i,15);break;case 100:e.addCustom(t,i,e.entity.Months,e.entity.Days)}}},e.data=[],e.scheduler_instance=null,e.schedulerOptions={onContentReady:function(t){e.scheduler_instance||(e.scheduler_instance=t.component)},views:["month"],currentView:"month",startDayHour:0,endDayHour:24,showCurrentTimeIndicator:!1,height:492,appointmentTemplate:function(e){return $("<div style='text-align:center; height:38px;color:green;background:white;margin-top:-5px'><i style='font-size:32px' class='icon ion-md-checkmark'></i></div>")},editing:{allowAdding:!1,allowUpdating:!1,allowDeleting:!0,allowResizing:!1,allowDragging:!1},onAppointmentClick:function(e){e.cancel=!0},onAppointmentDblClick:function(e){e.cancel=!0},onCellClick:function(e){e.cancel=!0},bindingOptions:{dataSource:"data",min:"entity.iDateFrom",max:"entity.iDateTo"}},e.date_from={type:"date",width:"100%",readOnly:!0,onValueChanged:function(t){e.fillSchedule()},bindingOptions:{value:"entity.iDateFrom"}},e.date_to={type:"date",width:"100%",readOnly:!0,onValueChanged:function(t){e.fillSchedule()},bindingOptions:{value:"entity.iDateTo"}},e.intervalTypes=[{Id:1,Title:"Daily"},{Id:2,Title:"Weekly"},{Id:3,Title:"Every 10 days"},{Id:4,Title:"Every 14 days"},{Id:5,Title:"Every 15 days"},{Id:100,Title:"Custom"}],e.sb_interval={readOnly:!0,showClearButton:!0,width:"100%",searchEnabled:!1,displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){e.customDisabled=t.selectedItem&&100!=t.selectedItem.Id,e.fillSchedule()},bindingOptions:{value:"entity.Interval",dataSource:"intervalTypes"}},e.customDisabled=!0,e.tag_months_instance=null,e.tag_months={readOnly:!0,dataSource:General.MonthDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_months_instance||(e.tag_months_instance=t.component)},onSelectionChanged:function(t){e.fillSchedule()},bindingOptions:{disabled:"customDisabled",value:"entity.Months"}},e.tag_days_instance=null,e.tag_days={readOnly:!0,dataSource:General.WeekDayDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_days_instance||(e.tag_days_instance=t.component)},onSelectionChanged:function(t){e.fillSchedule()},bindingOptions:{disabled:"customDisabled",value:"entity.Days"}},e.text_title={readOnly:!0,bindingOptions:{value:"entity.Title"}},e.text_types={readOnly:!0,bindingOptions:{value:"entity.Types"}},e.text_no={readOnly:!0,bindingOptions:{value:"entity.Id"}},e.text_flights={readOnly:!0,bindingOptions:{value:"entity.TotalFlights"}},e.dg_selected1=null,e.dg_columns1=[{dataField:"",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.data.IsApproved60&&0!=t.data.IsApproved60?$("<div>").append("<i style='font-size:22px;color:#8bc34a!important' class='icon ion-md-checkmark-circle'></i>").appendTo(e):$("<div>").append("<i style='font-size:22px;color:#ff5722!important' class='icon ion-md-help-circle '></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"Id",caption:"No",allowResizing:!0,dataType:"number",allowEditing:!1,width:120,alignment:"center",sortIndex:1,sortOrder:"asc",fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:200},{dataField:"Types",caption:"Types",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:200},{dataField:"IntervalType",caption:"Interval",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:150},{dataField:"TotalFlights",caption:"Flights",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"DateFrom",caption:"From",allowResizing:!0,dataType:"date",allowEditing:!1,width:200,alignment:"center",fixed:!0,fixedPosition:"right"},{dataField:"DateTo",caption:"To",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200,fixed:!0,fixedPosition:"right"}],e.dg_height1=100,e.dg_instance1=null,e.dg_ds1=null,e.dg1={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,e.IsApproveDisabled=1==i.IsApproved60):(e.dg_selected=null,e.IsApproveDisabled=!0)},height:"100%",bindingOptions:{dataSource:"dg_ds"}},e.dg_selected=null,e.dg_columns=[{dataField:"Date",caption:"Date",allowResizing:!0,dataType:"date",allowEditing:!1,width:200,alignment:"center",groupIndex:0},{dataField:"BaseIATA",caption:"Base",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"Types",caption:"Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150}],e.dg_height=$(window).height()-135,e.dg_instance=null,e.dg_ds=null,e.dg={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,e.IsPermitDisabled=1==i.IsApproved60,i.permits?e.dg_permits_ds=i.permits:(e.loadingVisible=!0,a.getFlightPlanItemPermits(i.Id,i.CalendarId).then(function(t){e.loadingVisible=!1,i.permits=t||[],e.dg_permits_ds=i.permits},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))):(e.dg_selected=null,e.IsPermitDisabled=!0)},onCellPrepared:function(e){if("data"==e.rowType&&"BaseIATA"===e.column.dataField){var t=Flight.getBaseMetaData(e.data.BaseIATA);t&&e.cellElement.css("background",t.bgcolor)}},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.IsPermitDisabled=!0,e.btn_permit_add={text:"",type:"default",icon:"plus",width:40,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.popup_permit_add_visible=!0},bindingOptions:{disabled:"IsPermitDisabled"}},e.btn_permit_delete={text:"",type:"danger",icon:"remove",width:40,onClick:function(e){},bindingOptions:{disabled:"IsPermitDisabled"}},e.sb_permit={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceFlightPermits(),onSelectionChanged:function(t){t.selectedItem?e.permitEntity.Title=t.selectedItem.Title:e.permitEntity.Title=null},searchExpr:["Title"],displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"permitEntity.PermitId"}},e.date_permit={type:"date",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"permitEntity.Date"}},e.dg_permits_selected=null,e.dg_permits_columns=[{dataField:"Date",caption:"Date",allowResizing:!0,dataType:"date",allowEditing:!1,width:150,alignment:"center"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1}],e.dg_permits_height=$(window).height()-220,e.dg_permits_instance=null,e.dg_permits_ds=null,e.dg_permits={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_permits_columns,onContentReady:function(t){e.dg_permits_instance||(e.dg_permits_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_permits_selected=i||null},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_permits_ds",height:"dg_permits_height"}},e.permitEntity={},e.clearPermitEntity=function(){e.permitEntity.Title=null,e.permitEntity.Date=null,e.permitEntity.Remark="",e.permitEntity.PermitId=null,e.permitEntity.DateFlight=null,e.permitEntity.CalanderId=null},e.popup_permit_add_visible=!1,e.popup_permit_add_title="New",e.popup_permit_add={width:600,height:270,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"permitadd",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.permitEntity.Id=-1,e.permitEntity.Remark="",e.permitEntity.FlightPlanId=e.dg_selected.Id,e.permitEntity.DateFlight=e.dg_selected.Date,e.permitEntity.CalanderId=e.dg_selected.CalendarId,e.loadingVisible=!0,a.saveFlightPlanItemPermit(e.permitEntity).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1;var i=JSON.parse(JSON.stringify(e.permitEntity));e.dg_permits_ds.push(i),e.clearPermitEntity()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_permit_add_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.clearPermitEntity(),e.popup_permit_add_visible=!1},bindingOptions:{visible:"popup_permit_add_visible",title:"popup_permit_add_title"}};var s=-1*(new Date).getTimezoneOffset();e.bind=function(){var t="odata/flight/plans/items/calendar/"+Config.CustomerId+"/"+e.typeId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,version:4,onLoaded:function(e){$.each(e,function(e,t){t.STD=new Date(t.STD).addMinutes(s),t.STA=new Date(t.STA).addMinutes(s)}),n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Id",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.getFlightsGantt=function(){e.loadingVisible=!0,a.getFlightsGantt(Config.CustomerId).then(function(t){e.loadingVisible=!1,e.flightData=t,$.each(e.flightData.flights,function(e,t){t.startDate=new Date(t.startDate)})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},l.isAuthorized()?(n.page_title="> Flight Plans Permits",$(".flightplanpermit").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("airportController",["$scope","$location","$routeParams","$rootScope","airportService","authService","$route",function(e,t,i,n,a,o,l){e.prms=i.prms,e.IsDispatch=l.current.isDispatch,e.IsBase=!e.IsDispatch,e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,bindingOptions:{visible:"IsBase"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(e){var t={Id:null};n.$broadcast("InitAddAirport",t)},bindingOptions:{visible:"IsBase"}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitAddAirport",i)},bindingOptions:{visible:"IsBase"}},e.btn_flights={text:"Flights",type:"default",icon:"rowfield",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.navigateairport(i.IATA)},bindingOptions:{visible:"IsDispatch"}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;e.InitAddAirport(i)}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.filters=[],e.dg_columns=[{cellTemplate:function(e,t){$("<div style='text-align:center'/>").html(t.rowIndex+1).appendTo(e)},caption:"#",width:60,fixed:!0,fixedPosition:"left",allowResizing:!1,cssClass:"rowHeader"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"IATA",caption:"IATA",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,sortIndex:1,sortOrder:"asc"},{dataField:"ICAO",caption:"ICAO",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"City",caption:"City",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"SortName",caption:"Sort Name",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:200},{dataField:"Country",caption:"Country",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:200,sortIndex:0,sortOrder:"asc"}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+"odata/airports/all",key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}}}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},o.isAuthorized()?(n.page_title="> Airports",$(".airport").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onAirportSaved",function(t,i){e.doRefresh=!0}),e.$on("onAirportHide",function(t,i){e.bind()}),n.$broadcast("AirportLoaded",null)}]),app.controller("flightPlansCalendarMaintenanceController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.typeId=60,e.typeId=50,e.typeId=-1,e.filterVisible=!1,e.tempData=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.entity={Id:null,PlanId:null,CalendarId:null,RegisterId:null,VirtualId:null,Date:null},e.btn_register={text:"Assign Register",type:"default",icon:"airplane",width:"100%",bindingOptions:{disabled:"unlockvisible"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.Id=e.dg_selected.FlightPlanRegisterId,e.entity.Id||(e.entity.Id=-1),e.entity.PlanId=e.dg_selected.Id,e.entity.CalendarId=e.dg_selected.CalendarId,e.entity.Date=e.dg_selected.Date,e.entity.RegisterId=e.dg_selected.RegisterId,e.entity.VirtualId=e.dg_selected.VirtualRegisterId,o.getAvailableMSNsByType(Config.CustomerId,e.dg_selected.VirtualTypeId).then(function(t){e.loadingVisible=!1,e.ds_msn=t,e.popup_registers_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.lockvisible=!1,e.unlockvisible=!1,e.btn_lock={text:"Lock",type:"default",icon:"icon ion-md-lock",width:"100%",bindingOptions:{visible:"lockvisible"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i={id:e.dg_selected.FlightPlanRegisterId};e.loadingVisible=!0,a.lockPlanRegister(i).then(function(t){e.loadingVisible=!1,e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.btn_unlock={text:"UnLock",type:"default",icon:"icon ion-md-unlock",width:"100%",bindingOptions:{visible:"unlockvisible"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i={id:e.dg_selected.FlightPlanRegisterId};e.loadingVisible=!0,a.unlockPlanRegister(i).then(function(t){e.loadingVisible=!1,e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.btn_delete={text:"Remove Register",type:"danger",icon:"clear",width:"100%",bindingOptions:{disabled:"unlockvisible"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.dg_selected.FlightPlanRegisterId&&General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.FlightPlanRegisterId};e.loadingVisible=!0,a.deletePlanRegister(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.IsApproveDisabled=!0,e.btn_approve={text:"Approve Assigned Regsiters",type:"default",icon:"check",width:300,bindingOptions:{disabled:"IsApproveDisabled"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_SimpleConfirm,function(t){t&&(e.loadingVisible=!0,a.approvePlan70(e.dg_selected.Id).then(function(t){e.IsApproveDisabled=!0,e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))})}},e.btn_search={text:"Search",type:"success",icon:"search",width:"100%",validationGroup:"fpcsearch",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.$broadcast("getFilterQuery",null)}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_height_full=100,e.scroll_height_full=400,e.dg_selected=null,e.dg_columns=[{dataField:"",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.data.IsLocked?$("<div>").append("<i style='font-size:22px;color:red!important' class='icon ion-md-lock '></i>").appendTo(e):$("<div>").append("<i style='font-size:22px;color:green!important' class='icon ion-md-unlock'></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"IsLocked",caption:"",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:70},{dataField:"BaseIATA",caption:"Base",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:150},{dataField:"Date",caption:"Date",allowResizing:!0,dataType:"date",allowEditing:!1,width:200,alignment:"center",fixed:!1,fixedPosition:"right"},{dataField:"IntervalType",caption:"Interval",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:150},{dataField:"TotalFlights",caption:"Flights",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"DateFrom",caption:"From",allowResizing:!0,dataType:"date",allowEditing:!1,width:170,alignment:"center",fixed:!1,fixedPosition:"right"},{dataField:"DateTo",caption:"To",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:170,fixed:!1,fixedPosition:"right"},{dataField:"Types",caption:"Type",allowResizing:!0,alignment:"left",
dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:150},{dataField:"VirtualRegister",caption:"Design Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:180},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"}],e.dg_height=$(window).height()-135,e.dg_instance=null,e.dg_ds=null,e.dg={masterDetail:{enabled:!0,template:"detail"},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.lockvisible=i.RegisterId&&i.IsOpen,e.unlockvisible=i.RegisterId&&i.IsLocked,e.dg_selected=i,e.IsApproveDisabled=1==i.IsApproved70||100!=i.RegisterAssignProgress):(e.lockvisible=!1,e.unlockvisible=!1,e.dg_selected=null,e.IsApproveDisabled=!0,e.IsApproveDisabled=!0)},onRowPrepared:function(e){e.data&&!e.data.FlightPlanRegisterId&&e.rowElement.css("background","#ffdddd")},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.dg_detail_ds=null,e.getDetailGridSettings=function(e){var t=-1*(new Date).getTimezoneOffset();return{scrolling:{mode:"infinite"},paging:{pageSize:100},dataSource:{store:{type:"odata",url:n.serviceUrl+"odata/flightplanitems/plan/"+e+"/"+t+"/",key:"Id",version:4,onLoaded:function(e){$.each(e,function(e,i){i.STD=new Date(i.STD).addMinutes(t),i.STA=new Date(i.STA).addMinutes(t)})}},sort:[{getter:"DateFrom",desc:!0},"BaseIATA","STD"]},columnAutoWidth:!0,showBorders:!0,columns:[{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:400}]}},e.dt_from=new Date,e.dt_to=(new Date).addDays(7),e.date_from={type:"date",placeholder:"From",width:"100%",bindingOptions:{value:"dt_from"}},e.date_to={type:"date",width:"100%",placeholder:"To",bindingOptions:{value:"dt_to"}},e.date_flight={type:"date",width:"100%",readOnly:!0,bindingOptions:{value:"entity.Date"}},e.ds_msn=[],e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(e){e.selectedItem},bindingOptions:{value:"entity.RegisterId",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.popup_registers_visible=!1,e.popup_registers_title="Set Registers",e.popup_registers={width:600,height:200,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fpcregisteradd",onClick:function(t){return t.validationGroup.validate().isValid?(e.loadingVisible=!0,void a.checkOverlap(e.dg_selected.Id,e.dg_selected.VirtualRegisterId,e.entity.RegisterId,new Date(e.entity.Date).toUTCDateTimeDigits(),new Date(e.entity.Date).toUTCDateTimeDigits()).then(function(t){if(!t)return e.loadingVisible=!1,void General.ShowNotify("Overlap","error");a.savePlanRegister(e.entity).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.loadingVisible=!1,e.popup_registers_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):void General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.entity.Id=null,e.entity.CalendarId=null,e.entity.PlanId=null,e.entity.VirtualId=null,e.entity.RegisterId=null,e.entity.Date=null,e.doRefresh&&e.bind(),e.popup_registers_visible=!1},bindingOptions:{visible:"popup_registers_visible",title:"popup_registers_title"}},e.popup_registers.toolbarItems[1].options.onClick=function(t){e.popup_registers_visible=!1},e.bind=function(){var t="odata/flightplans/calendar/"+Config.CustomerId+"/"+e.typeId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){t.params.$filter=(t.params.$filter?t.params.$filter+" and ":"")+"(Date ge "+new Date(e.dt_from).ToUTC2(1)+") and (Date le "+new Date(e.dt_to).ToUTC2()+")",console.log(t.params),e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Date",desc:!0}]}),e.doRefresh&&(e.dg_instance.refresh(),e.doRefresh=!1)},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){e.filters=[["Date",">=",new Date(e.dt_from)],"and",["Date","<=",new Date(e.dt_to)]];var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.getFlightsGantt=function(){e.loadingVisible=!0,a.getFlightsGantt(Config.CustomerId).then(function(t){e.loadingVisible=!1,e.flightData=t,$.each(e.flightData.flights,function(e,t){t.startDate=new Date(t.startDate)})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},l.isAuthorized()?(n.page_title="> Flight Plans",$(".flightplanscalendarmaintenance").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){console.log(i),e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onRegisterAssigned",function(t,i){e.doRefresh=!0}),e.$on("onFlightRegistersHide",function(t,i){e.bind()}),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("flightPlanCrewController",["$scope","$location","$routeParams","$rootScope","flightService","courseService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d,s){e.prms=i.prms,e.typeId=60,e.typeId=50,e.filterVisible=!1,e.tempData=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.entity={Id:null,PlanId:null,CalendarId:null,RegisterId:null,VirtualId:null,Date:null},e.IsCrewDisabled=!1,e.btn_crew_add={text:"",type:"default",icon:"plus",width:40,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.popup_crew_visible=!0},bindingOptions:{disabled:"IsCrewDisabled"}},e.btn_crew_delete={text:"",type:"danger",icon:"remove",width:40,onClick:function(t){if(e.dg_crew_selected=n.getSelectedRow(e.dg_crew_instance),!e.dg_crew_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_crew_selected.Id};e.loadingVisible=!0,a.deleteFlightPlanCrew(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.getCrew(e.dg_selected.Id,e.dg_selected.CalendarId),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})},bindingOptions:{disabled:"IsCrewDisabled"}},e.btn_register={text:"Assign Register",type:"default",icon:"airplane",width:"100%",bindingOptions:{disabled:"unlockvisible"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.entity.Id=e.dg_selected.FlightPlanRegisterId,e.entity.Id||(e.entity.Id=-1),e.entity.PlanId=e.dg_selected.Id,e.entity.CalendarId=e.dg_selected.CalendarId,e.entity.Date=e.dg_selected.Date,e.entity.RegisterId=e.dg_selected.RegisterId,e.entity.VirtualId=e.dg_selected.VirtualRegisterId,l.getAvailableMSNsByType(Config.CustomerId,e.dg_selected.VirtualTypeId).then(function(t){e.loadingVisible=!1,e.ds_msn=t,e.popup_registers_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.lockvisible=!1,e.unlockvisible=!1,e.btn_lock={text:"Lock",type:"default",icon:"icon ion-md-lock",width:"100%",bindingOptions:{visible:"lockvisible"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i={id:e.dg_selected.FlightPlanRegisterId};e.loadingVisible=!0,a.lockPlanRegister(i).then(function(t){e.loadingVisible=!1,e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.btn_unlock={text:"UnLock",type:"default",icon:"icon ion-md-unlock",width:"100%",bindingOptions:{visible:"unlockvisible"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i={id:e.dg_selected.FlightPlanRegisterId};e.loadingVisible=!0,a.unlockPlanRegister(i).then(function(t){e.loadingVisible=!1,e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.btn_delete={text:"Remove Register",type:"danger",icon:"clear",width:"100%",bindingOptions:{disabled:"unlockvisible"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.dg_selected.FlightPlanRegisterId&&General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.FlightPlanRegisterId};e.loadingVisible=!0,a.deletePlanRegister(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.IsApproveDisabled=!0,e.btn_approve={text:"Approve Assigned Regsiters",type:"default",icon:"check",width:300,bindingOptions:{disabled:"IsApproveDisabled"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_SimpleConfirm,function(t){t&&(e.loadingVisible=!0,a.approvePlan70(e.dg_selected.Id).then(function(t){e.IsApproveDisabled=!0,e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))})}},e.btn_search={text:"Search",type:"success",icon:"search",width:"100%",validationGroup:"fpcsearch",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.$broadcast("getFilterQuery",null)}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_height_full=100,e.scroll_height_full=400,e.getCrew=function(t,i){t||(e.dg_crew_ds=[]),e.loadingVisible=!0,a.getFlightPlanCrew(t,i).then(function(t){e.loadingVisible=!1,e.dg_crew_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.dg_selected=null,e.dg_columns=[{dataField:"BaseIATA",caption:"Base",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:150},{dataField:"TotalFlights",caption:"Flights",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"Types",caption:"Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:150},{dataField:"Date",caption:"Date",allowResizing:!0,dataType:"date",allowEditing:!1,width:200,alignment:"center",fixed:!1,fixedPosition:"right"},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"}],e.dg_height=$(window).height()-135,e.dg_instance=null,e.dg_ds=null,e.dg={masterDetail:{enabled:!0,template:"detail"},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,e.getCrew(e.dg_selected.Id,e.dg_selected.CalendarId)):(e.dg_selected=null,e.getCrew(null,null))},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.dg_detail_ds=null,e.getDetailGridSettings=function(e){var t=-1*(new Date).getTimezoneOffset();return{scrolling:{mode:"infinite"},paging:{pageSize:100},dataSource:{store:{type:"odata",url:n.serviceUrl+"odata/flightplanitems/plan/"+e+"/"+t+"/",key:"Id",version:4,onLoaded:function(e){}},sort:[{getter:"DateFrom",desc:!0},"BaseIATA","STD"]},columnAutoWidth:!0,showBorders:!0,columns:[{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:400}]}},e.dg_crew_selected=null,e.dg_crew_columns=[{dataField:"JobGroup",caption:"",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:200},{dataField:"Name",caption:"Name",allowResizing:!0,dataType:"string",allowEditing:!1,width:300},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Mobile",caption:"Phone",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:200}],e.dg_crew_height=$(window).height()-220,e.dg_crew_instance=null,e.dg_crew_ds=null,e.dg_crew={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_crew_columns,onContentReady:function(t){e.dg_crew_instance||(e.dg_crew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew_selected=i||null},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_crew_ds",height:"dg_crew_height"}},e.dt_from=new Date,e.dt_to=(new Date).addDays(7),e.date_from={type:"date",placeholder:"From",width:"100%",bindingOptions:{value:"dt_from"}},e.date_to={type:"date",width:"100%",placeholder:"To",bindingOptions:{value:"dt_to"}},e.date_flight={type:"date",width:"100%",readOnly:!0,bindingOptions:{value:"entity.Date"}},e.ds_msn=[],e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(e){e.selectedItem},bindingOptions:{value:"entity.RegisterId",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.group_id=null,e.sb_group={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceGroups(),itemTemplate:function(e){return n.getSbTemplateGroup(e)},displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"group_id"}},e.dg_person_columns=[{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250,fixed:!0,fixedPosition:"left"},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130,fixed:!0,fixedPosition:"left"},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"left"},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Mobile",caption:"Mobile",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Location",caption:"Department",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"PassportNumber",caption:"Passport No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"DatePassportExpire",caption:"Passport Expire",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"CaoCardNumber",caption:"CAO No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"DateCaoCardExpire",caption:"CAO Expire",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"Types",caption:"Types",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200,fixed:!1,fixedPosition:"left"}],e.dg_person_selected=null,e.dg_person_instance=null,e.dg_person_ds=null,e.dg_person={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:490,columns:e.dg_person_columns,onContentReady:function(t){e.dg_person_instance||(e.dg_person_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_person_selected=i,e.group_id=i.GroupId,e.loadingVisible=!0,a.getCrewSummary(i.Id).then(function(t){e.dg_sum_ds=[],e.dg_sum_ds.push({Id:1,Title:"Past 24 Hours",Value:t.Past24?t.Past24:0}),e.dg_sum_ds.push({Id:2,Title:"Past 48 Hours",Value:t.Past48?t.Past48:0}),e.dg_sum_ds.push({Id:3,Title:"Past Week",Value:t.PastWeek?t.PastWeek:0}),e.dg_sum_ds.push({Id:4,Title:"Past Month",Value:t.PastMonth?t.PastMonth:0}),e.dg_sum_instance.refresh(),o.getPersonLastCertificates(i.PersonId).then(function(t){e.loadingVisible=!1,e.dg_certificate_ds=t},function(e){General.ShowNotify(e.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):(e.dg_person_selected=null,e.group_id=null,e.dg_sum_ds=null)},bindingOptions:{dataSource:"dg_person_ds"}},e.dg_sum_columns=[{dataField:"Title",caption:"Summary",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Value",caption:"Hours",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:130}],e.dg_sum_selected=null,e.dg_sum_instance=null,e.dg_sum_ds=null,e.dg_sum={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:235,columns:e.dg_sum_columns,onContentReady:function(t){e.dg_sum_instance||(e.dg_sum_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_sum_selected=i||null},bindingOptions:{dataSource:"dg_sum_ds"}},e.dg_certificate_columns=[{caption:"Certificates",columns:[{dataField:"ExpireStatus",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="green";switch(t.value){case 1:i="red";break;case 2:i="orange"}$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"CerNumber",caption:"Certificate No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130,fixed:!0,fixedPosition:"left"},{dataField:"Remain",caption:"Remain",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:70,fixed:!1,fixedPosition:"left"},{dataField:"CourseTitle",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300,fixed:!0,fixedPosition:"left"}]}],e.dg_certificate_selected=null,e.dg_certificate_instance=null,e.dg_certificate_ds=null,e.dg_certificate={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:298,columns:e.dg_certificate_columns,onContentReady:function(t){e.dg_certificate_instance||(e.dg_certificate_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_certificate_selected=i||null},bindingOptions:{dataSource:"dg_certificate_ds"}},e.popup_crew_visible=!1,e.popup_crew_title="Crew",e.popup_crew={width:1300,height:650,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Add",icon:"check",validationGroup:"crewadd",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(e.dg_person_selected=n.getSelectedRow(e.dg_person_instance),!e.dg_person_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i={Id:-1,EmployeeId:e.dg_person_selected.Id,FlightPlanId:e.dg_selected.Id,CalanderId:e.dg_selected.CalendarId,GroupId:e.group_id};e.loadingVisible=!0,a.saveFlightPlanCrew(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.group_id=null},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Calendar"},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Flights"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.dg_person_instance.repaint(),e.bindPeople()},onHiding:function(){e.group_id=null,e.doRefreshPeople=!0,e.dg_person_ds=null,e.getCrew(e.dg_selected.Id,e.dg_selected.CalendarId),e.doRefresh&&e.bind(),e.popup_crew_visible=!1},bindingOptions:{visible:"popup_crew_visible",title:"popup_crew_title"}},e.popup_crew.toolbarItems[1].options.onClick=function(t){e.popup_crew_visible=!1},e.bind=function(){var t="odata/flightplans/calendar/"+Config.CustomerId+"/"+e.typeId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){t.params.$filter=(t.params.$filter?t.params.$filter+" and ":"")+"(Date ge "+new Date(e.dt_from).ToUTC2(1)+") and (Date le "+new Date(e.dt_to).ToUTC2()+")",console.log(t.params),e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Date",desc:!0}]}),e.doRefresh&&(e.dg_instance.refresh(),e.doRefresh=!1)},e.doRefreshPeople=!0,e.bindPeople=function(){var t=(new Date).toDateTimeDigits(),i="odata/crew/available/"+Config.CustomerId+"/"+e.dg_selected.VirtualTypeId+"/"+t;!e.dg_person_ds&&e.doRefreshPeople&&(e.dg_person_ds={store:{type:"odata",url:n.serviceUrl+i,version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(e){n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Name",desc:!1}]}),e.dg_person_instance.refresh(),e.doRefreshPeople=!1},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){e.filters=[["Date",">=",new Date(e.dt_from)],"and",["Date","<=",new Date(e.dt_to)]];var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.getFlightsGantt=function(){e.loadingVisible=!0,a.getFlightsGantt(Config.CustomerId).then(function(t){e.loadingVisible=!1,e.flightData=t,$.each(e.flightData.flights,function(e,t){t.startDate=new Date(t.startDate)})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},r.isAuthorized()?(n.page_title="> Flight Crew",$(".flightplancrew").fadeIn(400,function(){})):r.redirectToLogin(),e.$on("getFilterResponse",function(t,i){console.log(i),e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onRegisterAssigned",function(t,i){e.doRefresh=!0}),e.$on("onFlightRegistersHide",function(t,i){e.bind()}),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("flightPlanApply2Controller",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.filterVisible=!1,e.plan={},e.IsDetailsVisible=!0,e.IsTabDisabled=!1,e.tabs=[{text:"Flights",id:"flights"},{text:"Permits",id:"permits"},{text:"Crew",id:"crew"}],e.$watch("selectedTabIndex",function(t){try{e.selectedTab=e.tabs[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_flight_instance.repaint(),e.dg_permits_instance.repaint(),e.dg_crew_instance.repaint()}catch(e){}}),e.selectedTabIndex=0,e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex",disabled:"IsTabDisabled"}},e.minDate=new Date,e.maxDate=new Date,e.scheduleCurrentDate=null,e.data=[],e.scheduler_instance=null,e.schedulerOptions={onContentReady:function(t){e.scheduler_instance||(e.scheduler_instance=t.component)},views:["month"],currentView:"month",startDayHour:0,endDayHour:24,showCurrentTimeIndicator:!1,height:function(){return window.innerHeight-180},appointmentTemplate:function(e){return $("<div style='text-align:center; height:30px;color:green;background:white;margin-top:-5px'><i style='font-size:24px' class='icon ion-md-checkmark'></i></div>")},editing:{allowAdding:!1,allowUpdating:!1,allowDeleting:!0,allowResizing:!1,allowDragging:!1},onAppointmentClick:function(e){e.cancel=!0},onAppointmentDblClick:function(e){e.cancel=!0},onCellClick:function(e){e.cancel=!0},bindingOptions:{dataSource:"data",min:"plan.DateFrom",max:"plan.DateTo",currentDate:"scheduleCurrentDate"}},e.scroll_height=200,e.scroll_calendar={scrollByContent:!0,scrollByThumb:!0,height:function(){return window.innerHeight-180}},e.scroll_info={scrollByContent:!0,scrollByThumb:!0,height:function(){return window.innerHeight-180}},e.tempData=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.btn_view={text:"View",type:"default",icon:"info",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.loadingVisible=!0,a.getFlightPlanView(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,e.tempData=t,e.popup_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.IsApproveDisabled=!0,e.btn_approve={text:"Approve",type:"default",icon:"check",width:150,bindingOptions:{disabled:"IsApproveDisabled"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_SimpleConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.approvePlanRegisters(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.IsApproveDisabled=!0,e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.IsApproveDisabled=!0,e.btn_approve={text:"Apply",type:"default",icon:"check",width:150,bindingOptions:{disabled:"IsApproveDisabled"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_SimpleConfirm,function(t){if(t){var i={Id:e.dg_selected.FlightPlanRegisterId};e.loadingVisible=!0,a.applyPlanCalander(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.IsApproveDisabled=!0,e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.addCustom=function(t,i,n,a){if(n&&0!=n.length&&a&&0!=a.length)for(;t<=i;){var o=!1,l=!1;o=!n||0==n.length||-1!=n.indexOf(t.getMonth()),l=!a||0==a.length||-1!=a.indexOf(t.getDay()),o&&l&&e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(1)}},e.addDaily=function(t,i,n){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(n)},e.addMonthly=function(t,i){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(30)},e.fillSchedule=function(){if(e.data=[],e.plan.Interval&&e.plan.DateFrom&&e.plan.DateTo){var t=new Date(e.plan.DateFrom);t=new Date(t.setHours(0,0,0,0));var i=new Date(e.plan.DateTo);switch(i=new Date(i.setHours(23,59,59,999)),e.plan.Interval){case 1:e.addDaily(t,i,1);break;case 2:e.addDaily(t,i,7);break;case 3:e.addDaily(t,i,10);break;case 4:e.addDaily(t,i,14);break;case 5:e.addDaily(t,i,15);break;case 100:e.addCustom(t,i,e.plan.Months,e.plan.Days)}}e.scheduler_instance.repaint()},e.date_from={type:"date",readOnly:!0,width:"100%",bindingOptions:{value:"plan.DateFrom"}},e.date_to={type:"date",readOnly:!0,width:"100%",bindingOptions:{value:"plan.DateTo"}},e.text_interval={readOnly:!0,width:"100%",bindingOptions:{value:"plan.IntervalType"}},e.text_month={readOnly:!0,width:"100%",bindingOptions:{value:"plan.MonthsStr"}},e.text_day={readOnly:!0,width:"100%",bindingOptions:{value:"plan.DaysStr"}},e.text_type={
readOnly:!0,width:"100%",bindingOptions:{value:"plan.Types"}},e.dg_height_full=100,e.scroll_height_full=400,e.fillPlan=function(t){e.plan=t,e.plan.Interval=Number(e.plan.Interval),e.scheduleCurrentDate=new Date(e.plan.DateFrom),e.fillSchedule()},e.dg_selected=null,e.dg_columns=[{dataField:"",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.data.IsApplied?$("<div>").append("<i style='font-size:22px;color:green!important' class='icon ion-md-checkmark-circle '></i>").appendTo(e):$("<div>").append("<i style='font-size:22px;color:red!important' class='icon ion-md-help-circle'></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"Date",caption:"Date",allowResizing:!0,dataType:"date",allowEditing:!1,width:200,alignment:"center",fixed:!1,fixedPosition:"right"},{dataField:"BaseIATA",caption:"Base",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:150},{dataField:"Types",caption:"Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:200},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"TotalFlights",caption:"Flights",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"}],e.mih=140,e.dg_height=$(window).height()-135-e.mih,e.dg_instance=null,e.dg_ds=null;var s=-1*(new Date).getTimezoneOffset();e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onRowExpanding:function(e){},onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,e.IsApproveDisabled=1==i.IsApplied,e.loadingVisible=!0,a.getFlightPlanItems(e.dg_selected.Id,s).then(function(t){e.dg_flight_ds=t,a.getFlightPlanPermits(i.Id,i.CalendarId).then(function(t){e.dg_permits_ds=t,a.getFlightPlanCrew(i.Id,i.CalendarId).then(function(t){e.loadingVisible=!1,e.dg_crew_ds=t,e.bindGantt()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):(e.dg_selected=null,e.IsApproveDisabled=!0,e.dg_flight_ds=null,e.dg_crew_ds=null,e.dg_permits_ds=null)},onRowPrepared:function(e){e.data&&!e.data.FlightPlanRegisterId&&e.rowElement.css("background","#ffdddd")},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.dg_flight_columns=[{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:400}],e.dg_flight_selected=null,e.dg_flight_instance=null,e.dg_flight_ds=null,e.dg_flight_height=null,e.dg_flight={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_flight_columns,onContentReady:function(t){e.dg_flight_instance||(e.dg_flight_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_flight_selected=i||null},height:function(){return window.innerHeight-173-e.mih},bindingOptions:{dataSource:"dg_flight_ds"}},e.dg_permits_columns=[{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130,groupIndex:0},{dataField:"Date",caption:"Date",allowResizing:!0,dataType:"date",allowEditing:!1,width:150,alignment:"center"},{dataField:"Title",caption:"Title",allowResizing:!0,dataType:"string",allowEditing:!1}],e.dg_permits_selected=null,e.dg_permits_instance=null,e.dg_permits_ds=null,e.dg_permits_height=null,e.dg_permits={grouping:{autoExpandAll:!0,allowCollapsing:!0},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_permits_columns,onContentReady:function(t){e.dg_permits_instance||(e.dg_permits_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_permits_selected=i||null},height:function(){return window.innerHeight-173-e.mih},bindingOptions:{dataSource:"dg_permits_ds"}},e.dg_crew_columns=[{dataField:"Flights",caption:"Flights",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:200,groupIndex:0},{dataField:"JobGroup",caption:"",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Name",caption:"Name",allowResizing:!0,dataType:"string",allowEditing:!1,width:300},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Mobile",caption:"Phone",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:200}],e.dg_crew_selected=null,e.dg_crew_instance=null,e.dg_crew_ds=null,e.dg_crew_height=null,e.dg_crew={grouping:{autoExpandAll:!0,allowCollapsing:!0},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_crew_columns,onContentReady:function(t){e.dg_crew_instance||(e.dg_crew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew_selected=i||null},height:function(){return window.innerHeight-173-e.mih},bindingOptions:{dataSource:"dg_crew_ds"}},e.dg_reg_columns=[{dataField:"DateFromTo",caption:"Date",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,groupIndex:0,width:200},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,groupIndex:1,width:200},{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Dep.",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:120,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arr.",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:120,format:"HH:mm"}],e.dg_reg_selected=null,e.dg_reg_instance=null,e.dg_reg_ds=null,e.dg_reg_height=null,e.dg_reg={grouping:{autoExpandAll:!0,allowCollapsing:!0},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_reg_columns,onContentReady:function(t){e.dg_reg_instance||(e.dg_reg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_reg_selected=i||null},height:function(){return window.innerHeight-173-e.mih},bindingOptions:{dataSource:"dg_reg_ds"}},e.Day0="05/06/2019",e.Day1="05/08/2019",e.Day2="05/08/2019 23:59:00.000",e.CurrentDate=new Date(2019,4,17,0,0,0),Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.flight=null,e.getGantt=function(){return $("#resourceGanttba").data("ejGantt")},e.ganttData=null,e.resourceGroups=[],e.resources=[],e.dataSource=[],e.scrollGantt=function(t){var i=new Date(t.STD),n=new Date(e.datefrom),a=Flight.subtractDatesHours(i,n)*$(".e-schedule-day-headercell").width()-50;$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(a)},e.scrollGanttNow=function(){var t=new Date(Date.now()),i=new Date(t),n=new Date(e.datefrom),a=Flight.subtractDatesHours(i,n)*$(".e-schedule-day-headercell").width()-50;$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(a)},Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.ganttCreated=!1,e.createGantt=function(){var t=$("#resourceGanttba").data("ejGantt");t&&t.destroy();var i=125;i+="px",$("#resourceGanttba").ejGantt({selectionMode:ej.Gantt.SelectionMode.Cell,selectionType:ej.Gantt.SelectionType.Multiple,taskbarClick:function(e){},dataSource:e.dataSource,allowColumnResize:!0,isResponsive:!0,taskIdMapping:"taskId",taskNameMapping:"taskName",fromLocationMapping:"from",startDateMapping:"startDate",endDateMapping:"endDate",progressMapping:"progress",durationMapping:"duration",groupNameMapping:"Title",groupIdMapping:"groupId",resources:e.resources,resourceIdMapping:"resourceId",resourceNameMapping:"resourceName",resourceInfoMapping:"resourceId",notesMapping:"notes",rightTaskLabelMapping:"taskName",baselineStartDateMapping:"BaselineStartDate",baselineEndDateMapping:"BaselineEndDate",highlightWeekEnds:!0,includeWeekend:!1,rowHeight:55,taskbarHeight:40,scheduleStartDate:e.dataSource[0].STD,scheduleEndDate:e.dateto,predecessorMapping:"predecessor",allowGanttChartEditing:!1,allowDragAndDrop:!0,editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,editMode:"normal"},splitterSettings:{position:180},toolbarSettings:{showToolbar:!1,toolbarItems:[ej.Gantt.ToolbarItems.Add,ej.Gantt.ToolbarItems.Delete,ej.Gantt.ToolbarItems.Update,ej.Gantt.ToolbarItems.Cancel,ej.Gantt.ToolbarItems.ExpandAll,ej.Gantt.ToolbarItems.CollapseAll,ej.Gantt.ToolbarItems.NextTimeSpan,ej.Gantt.ToolbarItems.PrevTimeSpan]},enableContextMenu:!1,load:function(){console.log("load"),e.ganttCreated=!0,this.getColumns()[0].width=180},create:function(t){$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(e.scroll)},cellSelecting:function(e){e&&"resourceTask"!=e.data.eResourceTaskType&&(e.cancel=!0)},cellSelected:function(t){$(".e-gantt-taskbarSelection").removeClass("e-gantt-taskbarSelection"),e.setSelectedResource(t.data)},actionBegin:function(e){e.requestType&&"beginedit"==e.requestType&&(e.cancel=!0)},actionComplete:function(t){console.log(t),"save"==t.requestType&&(e.doActionCompleteSave?setTimeout(function(){$("#resourceGanttba").data("ejGantt")._$ganttchartHelper.ejGanttChart("selectTaskbar",t.modifiedRecord)},100):e.doActionCompleteSave=!0)},workingTimeScale:"TimeScale24Hours",durationUnit:ej.Gantt.DurationUnit.Hour,scheduleHeaderSettings:{scheduleHeaderType:ej.Gantt.ScheduleHeaderType.Day,dayHeaderFormat:"MMM MM ddd dd , yyyy",minutesPerInterval:ej.Gantt.minutesPerInterval.ThirtyMinutes,timescaleUnitSize:"500%"},taskbarTemplate:"#taskbarTemplateBox",leftTaskLabelTemplate:"#leftlableTemplate",viewType:ej.Gantt.ViewType.ResourceView,sizeSettings:{height:i},groupSettings:{},showStackedHeader:!1,taskSchedulingMode:ej.Gantt.TaskSchedulingMode.Manual,enableTaskbarTooltip:!1})},e.bindGantt=function(){var t=-1*(new Date).getTimezoneOffset();e.plansDto={CustomerId:1,Date:new Date(e.dg_selected.Date).ToUTC(),Offset:t,Design:!1,PlanId:e.dg_selected.Id},e.loadingVisible=!0,a.getPlanItemsGanttCrewTest(e.plansDto).then(function(t){e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,t.flights.length>0&&(e.CalanderId=t.flights[0].CalendarId),e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource(t.flights),Flight.activeDatasource=e.dataSource,e.createGantt()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.bind=function(){var t="odata/flightplans/calendar/"+Config.CustomerId+"/-1";!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){t.params.$filter=(t.params.$filter?t.params.$filter+" and ":"")+"(IsLocked eq 1)",console.log(t.params.$filter),e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Date",desc:!0}]}),e.doRefresh&&(e.dg_instance.refresh(),e.doRefresh=!1)},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},l.isAuthorized()?(n.page_title="> Flight Plans",$(".flightplanapply2").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("courseTypeAddController",["$scope","$location","courseService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.entity={Id:null,CalenderTypeId:null,CourseCategoryId:null,LicenseResultBasicId:null,Title:null,Remark:null,Interval:null,IsGeneral:null,Status:null},e.clearEntity=function(){e.entity.Id=null,e.entity.CalenderTypeId=null,e.entity.CourseCategoryId=null,e.entity.LicenseResultBasicId=null,e.entity.Title=null,e.entity.Remark=null,e.entity.Interval=null,e.entity.IsGeneral=null,e.entity.Status=null},e.bind=function(t){console.log(t),e.entity.Id=t.Id,e.entity.CalenderTypeId=t.CalenderTypeId,e.entity.CourseCategoryId=t.CourseCategoryId,e.entity.LicenseResultBasicId=t.LicenseResultBasicId,e.entity.Title=t.Title,e.entity.Remark=t.Remark,e.entity.Interval=t.Interval,e.entity.IsGeneral=t.IsGeneral,e.entity.Status=t.Status},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.txt_Title={hoverStateEnabled:!1,bindingOptions:{value:"entity.Title"}},e.txt_Remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.Remark"}},e.txt_Interval={min:1,bindingOptions:{value:"entity.Interval"}},e.sb_CalanderTypeId={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(11),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.CalenderTypeId"}},e.pop_width=600,e.pop_height=380,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Save",icon:"check",validationGroup:"coursetypeadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();i.width<=600&&(e.pop_width=i.width,e.pop_height=i.height)},onShown:function(t){e.isNew,null!=e.tempData&&e.bind(e.tempData)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,o.$broadcast("onCourseTypeHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.isNew&&(e.entity.Id=-1),e.loadingVisible=!0,i.saveType(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onCourseTypeSaved",t),e.loadingVisible=!1,e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.tempData=null,e.$on("InitAddCourseType",function(t,i){e.tempData=null,i.Id?(e.popup_add_title="Edit",e.tempData=i,e.isNew=!1):(e.isNew=!0,e.popup_add_title="New"),e.popup_add_visible=!0})}]),app.controller("ceoFlightBoardController",["$scope","$location","$routeParams","$rootScope","flightService","weatherService","aircraftService","authService","notificationService","$route","$window",function(e,t,i,n,a,o,l,r,d,s,c){function g(e){var t=$("<iframe />");t[0].name="frame1",t.css({position:"absolute",top:"-1000000px"}),$("body").append(t);var i=t[0].contentWindow?t[0].contentWindow:t[0].contentDocument.document?t[0].contentDocument.document:t[0].contentDocument;i.document.open(),i.document.write("<html><head><title></title>"),i.document.write("<style>"),i.document.write("*{display: hidden;}"),i.document.write("img{display: block; width: 100%; }"),i.document.write("</style>"),i.document.write('</head><body class="gantt" style="padding:0 !important;">'),i.document.write("<div style='height:100%'><div style='text-align:center;margin-top:30px'>Fly Persia</div><div style='text-align:center;margin-top:10px'>Flights</div><img style='margin-top:10px;height:75%'  src = '"+e.toDataURL()+"'/></div>"),i.document.write("</body></html>"),i.document.close(),setTimeout(function(){window.frames.frame1.focus(),window.frames.frame1.print(),t.remove()},500)}function u(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}function p(e){var t=e.html(),i=$("<iframe />");i[0].name="frame1",i.css({position:"absolute",top:"-1000000px"}),$("body").append(i);var n=i[0].contentWindow?i[0].contentWindow:i[0].contentDocument.document?i[0].contentDocument.document:i[0].contentDocument;n.document.open(),n.document.write("<html><head><title></title>"),n.document.write("</head><body>"),n.document.write('<link href="content/css/bootstrap.css" rel="stylesheet" />'),n.document.write('<link href="content/css/main.css" rel="stylesheet" />'),n.document.write(t),n.document.write("</body></html>"),n.document.close(),setTimeout(function(){window.frames.frame1.focus(),window.frames.frame1.print(),i.remove()},500)}e.prms=i.prms,r.setModule(3),e.IsPlanning=n.HasMenuAccess("flight_planning",3),e.airport=i.airport,e.airportEntity=null,e.filterVisible=!1,e.IsDispatch=s.current.isDispatch,e.IsDepartureVisible=!0,e.IsArrivalVisible=!0,e.IsDepartureDisabled=!0,e.IsArrivalDisabled=!0,e.IsAdmin=!0,e.IsEditable=n.IsFlightBoardEditable(),e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").hide()):(e.filterVisible=!0,$(".filter").show())}},e.flight=null,e.takeOffVisible=!1,e.offBlockVisible=!1,e.onBlockVisible=!1,e.landingVisible=!1,e.btn_takeoff={text:"Take Off",type:"default",icon:"fas fa-plane-departure",width:"150",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.takeOffReadOnly=!1,e.flight=e.selectedFlights[0],e.flightTakeOff=e.flight.ChocksOut,(new Date).getDatePart()==new Date(e.flight.STD).getDatePart()&&(e.flightTakeOff=new Date),e.popup_takeoff_visible=!0}},e.btn_information={text:"Information",type:"default",icon:"fas fa-info-circle",width:"100%",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.popup_inf_visible=!0}},e.record=null,e.btn_dep={text:"Dep",type:"default",icon:"fas fa-plane-departure",width:"100%",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.calculateTotalPax(),e.popup_flight_visible=!0}},e.showLog=function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.flight.FuelUnitID||(e.flight.FuelUnitID=115),e.flight.CargoUnitID||(e.flight.CargoUnitID=111),e.flight.STA2=new Date(e.flight.STA),e.flight.STD2=new Date(e.flight.STD),e.calculateTotalPax(),t?e.$apply(function(){$(window).width()>1400?e.popup_log_visible=!0:e.popup_xlog_visible=!0}):$(window).width()>1400?e.popup_log_visible=!0:e.popup_xlog_visible=!0},e.btn_log={text:"Log",type:"default",icon:"fas fa-plane-departure",width:"100%",bindingOptions:{},onClick:function(t){e.showLog()}},e.btn_log_mobile={text:"",type:"default",icon:"fas fa-plane-departure",width:"40",bindingOptions:{},onClick:function(t){e.showLog()}},e.btn_arr={text:"Arrival",type:"default",icon:"fas fa-plane-arrival",width:"100%",bindingOptions:{disabled:"IsArrivalDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.popup_arr_visible=!0}},e.btn_offblock={text:"Off Block",type:"default",icon:"far fa-square",width:"150",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.flightOffBlock=new Date(e.flight.baseStartDate),(new Date).getDatePart()==new Date(e.flight.STD).getDatePart()&&(e.flightOffBlock=new Date),e.popup_offblock_visible=!0}},e.btn_onblock={text:"On Block",type:"default",icon:"fas fa-square",width:"150",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.flightOnBlock=new Date(e.flight.Landing),(new Date).getDatePart()==new Date(e.flight.STD).getDatePart()&&(e.flightOnBlock=new Date),e.popup_onblock_visible=!0}},e.btn_landing={text:"Landing",type:"default",icon:"fas fa-plane-arrival",width:"150",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.takeOffReadOnly=!0,e.flightTakeOff=e.flight.Takeoff,e.flightLanding=e.flight.baseEndDate,(new Date).getDatePart()==new Date(e.flight.STA).getDatePart()&&(e.flightLanding=new Date),e.popup_landing_visible=!0}},e.btn_crew={text:"Crew",type:"default",icon:"fas fa-user-circle",width:"100%",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.popup_crew_visible=!0}},e.linked_flight={},e.linkEntity={},e.time_ir_std_date=null,e.time_ir_std_time=null,e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.moment2=function(e){return e?moment(e).format("MM-DD-YYYY HH:mm"):""},e.setArrival=function(){if(e.linkEntity&&null!=e.time_ir_std_date&&null!=e.time_ir_std_time&&null!=e.linkEntity.FlightH&&null!=e.linkEntity.FlightM){var t=new Date(e.time_ir_std_date).getDatePartArray(),i=new Date(e.time_ir_std_time).getTimePartArray(),n=new Date(t[0],t[1],t[2],i[0],i[1],0,0),a=new Date(n.addHours(e.linkEntity.FlightH).addMinutes(e.linkEntity.FlightM));e.time_ir_sta_date=General.getDayFirstHour(new Date(a)),e.time_ir_sta_time=new Date(a)}else e.time_ir_sta_date=null,e.time_ir_sta_time=null},e.text_ir_flightnumber={bindingOptions:{value:"linkEntity.FlightNumber"}},e.text_ir_flighth={min:0,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"linkEntity.FlightH"}},e.text_ir_flightm={min:0,max:59,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"linkEntity.FlightM"}},e.txt_ir_LinkedRemark={bindingOptions:{value:"linkEntity.LinkedRemark"}},e.useCrew=!0,e.chk_ir_crew={text:"Use Crew",bindingOptions:{value:"useCrew"}},e.time_ir_start={type:"date",width:"100%",interval:15,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"time_ir_std_date"}},e.time_ir_start_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"time_ir_std_time"}},e.time_ir_end={type:"date",width:"100%",interval:15,readOnly:!0,onValueChanged:function(e){},bindingOptions:{value:"time_ir_sta_date"}},e.time_ir_end_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,readOnly:!0,onValueChanged:function(e){},bindingOptions:{value:"time_ir_sta_time"}},e.sb_ir_fromairport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceAirport(),onSelectionChanged:function(t){e.getIrRoute()},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"linkEntity.FromAirportId"}},e.sb_ir_toairport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceAirport(),onSelectionChanged:function(t){e.getIrRoute()},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"linkEntity.ToAirportId"}},e.sb_ir_flighttype={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"linkEntity.FlightTypeID"}},e.getRealMSNs=function(e){return new DevExpress.data.DataSource({store:new DevExpress.data.ODataStore({url:n.serviceUrl+"odata/aircrafts/customer/"+e,version:4}),sort:["AircraftType","Register"]})},e.getSbTemplateAircraft=function(e){return"<div><div class='tmpl-col-left'>"+e.Register+"</div><div class='tmpl-col-right'>"+e.AircraftType+"</div></div>"},e.sb_ir_msn={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(t){return e.getSbTemplateAircraft(t)},searchExpr:["Register","MSN"],dataSource:e.getRealMSNs(Config.CustomerId),displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(e){},bindingOptions:{value:"linkEntity.RegisterID"}},e.getIrRoute=function(){e.linkEntity&&e.linkEntity.FromAirportId&&e.linkEntity.ToAirportId&&(e.loadingVisible=!0,a.getRoute(e.linkEntity.FromAirportId,e.linkEntity.ToAirportId).then(function(t){t&&(e.linkEntity.FlightH=t.FlightH,e.linkEntity.FlightM=t.FlightM),e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},e.btn_link={text:"Link",type:"default",icon:"fas fa-link",width:120,onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.linkEntity={ID:-1,CustomerId:Config.CustomerId},e.linkEntity.LinkedFlight=e.flight.ID,e.flight.RedirectReasonId&&(e.linkEntity.ToAirportId=e.flight.OToAirportId,e.linkEntity.ToAirportIATA=e.flight.OToAirportIATA,e.linkEntity.FlightNumber=null,e.linkEntity.FlightPlanId=null,e.linkEntity.FromAirportId=e.flight.ToAirport,e.linkEntity.FromAirportIATA=e.flight.ToAirportIATA,e.time_ir_std_date=General.getDayFirstHour(new Date(e.flight.STD)),e.time_ir_std_time=null,e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.linkEntity.FlightTypeID=null,e.linkEntity.RegisterID=e.flight.RegisterID),e.popup_link_visible=!0}},e.btn_free={text:"Nonscheduled Flight",type:"default",icon:"airplane",width:250,onClick:function(t){e.linkEntity={ID:-1,CustomerId:Config.CustomerId};var i=General.getDayFirstHour(new Date(e.selectedDate));e.time_ir_std_date=new Date(i),e.popup_free_visible=!0}},e.before_refreshed_flight=null,e.undoRefresh=function(){e.flight.FlightStatusID=e.before_refreshed_flight.FlightStatusID,e.flight.DepartureRemark=e.before_refreshed_flight.DepartureRemark,e.flight.CancelReasonId=e.before_refreshed_flight.CancelReasonId,e.flight.CancelRemark=e.before_refreshed_flight.CancelRemark,e.flight.CancelDate=e.before_refreshed_flight.CancelDate,e.flight.RedirectReasonId=e.before_refreshed_flight.RedirectReasonId,e.flight.RedirectRemark=e.before_refreshed_flight.RedirectRemark,e.flight.RedirectDate=e.before_refreshed_flight.RedirectDate,e.flight.RampReasonId=e.before_refreshed_flight.RampReasonId,e.flight.RampRemark=e.before_refreshed_flight.RampRemark,e.flight.RampDate=e.before_refreshed_flight.RampDate,e.flight.ToAirport=e.before_refreshed_flight.ToAirport,e.flight.ToAirportIATA=e.before_refreshed_flight.ToAirportIATA,e.flight.OToAirportId=e.before_refreshed_flight.OToAirportId,e.flight.OToAirportIATA=e.before_refreshed_flight.OToAirportIATA,e.flight.FPFlightHH=e.before_refreshed_flight.FPFlightHH,e.flight.FPFlightMM=e.before_refreshed_flight.FPFlightMM,e.flight.FPFuel=e.before_refreshed_flight.FPFuel,e.flight.Defuel=e.before_refreshed_flight.Defuel,e.flight.TotalDelayHH=e.before_refreshed_flight.TotalDelayHH,e.flight.TotalDelayMM=e.before_refreshed_flight.TotalDelayMM,e.flight.TotalDelayTotalMM=e.before_refreshed_flight.TotalDelayTotalMM,e.flight.PaxAdult=e.before_refreshed_flight.PaxAdult,e.flight.PaxChild=e.before_refreshed_flight.PaxChild,e.flight.PaxInfant=e.before_refreshed_flight.PaxInfant,e.flight.BaggageCount=e.before_refreshed_flight.BaggageCount,e.flight.BaggageWeight=e.before_refreshed_flight.BaggageWeight,e.flight.CargoWeight=e.before_refreshed_flight.CargoWeight,e.flight.CargoCount=e.before_refreshed_flight.CargoCount,e.flight.FuelDeparture=e.before_refreshed_flight.FuelDeparture,e.flight.FuelArrival=e.before_refreshed_flight.FuelArrival,e.flight.ChocksOut=e.before_refreshed_flight.ChocksOut,e.flight.Takeoff=e.before_refreshed_flight.Takeoff,e.flight.Landing=e.before_refreshed_flight.Landing,e.flight.ChocksIn=e.before_refreshed_flight.ChocksIn,e.flightOffBlock2=e.flight.ChocksOut,e.flightOffBlock2||(e.flightOffBlock2=e.flight.STD),e.flightTakeOff2=e.flight.Takeoff,e.flightTakeOff2||(e.flightTakeOff2=e.flight.STD),e.flightOnBlock2=e.flight.ChocksIn,e.flightOnBlock2||(e.flightOnBlock2=e.flight.STA),e.flightLanding2=e.flight.Landing,e.flightLanding2||(e.flightLanding2=e.flight.STA)},e.btn_refresh={text:"Refresh",type:"danger",width:120,onClick:function(t){e.before_refreshed_flight=JSON.parse(JSON.stringify(e.flight)),e.flight.FlightStatusID=1,e.flight.DepartureRemark=null,e.time_status_value=null,e.flight.CancelReasonId=null,e.flight.CancelRemark=null,e.flight.CancelDate=null,e.flight.RedirectReasonId=null,e.flight.RedirectRemark=null,e.flight.RedirectDate=null,e.flight.RampReasonId=null,e.flight.RampRemark=null,e.flight.RampDate=null,e.flight.OToAirportId&&(e.flight.ToAirport=e.flight.OToAirportId,e.flight.ToAirportIATA=e.flight.OToAirportIATA),e.flight.FPFlightHH=null,e.flight.FPFlightMM=null,e.flight.FPFuel=null,e.flight.Defuel=null,e.flight.TotalDelayHH=null,e.flight.TotalDelayMM=null,e.flight.TotalDelayTotalMM=0,e.flight.PaxAdult=null,e.flight.PaxChild=null,e.flight.PaxInfant=null,e.flight.BaggageCount=null,e.flight.BaggageWeight=null,e.flight.CargoWeight=null,e.flight.CargoCount=null,e.flight.FuelDeparture=null,e.flight.FuelArrival=null,e.dg_delay_ds=[],e.flight.ChocksOut=null,e.flight.Takeoff=null,e.flight.Landing=null,e.flight.ChocksIn=null,e.flightOffBlock2=e.flight.ChocksOut,e.flightOffBlock2||(e.flightOffBlock2=e.flight.STD),e.flightTakeOff2=e.flight.Takeoff,e.flightTakeOff2||(e.flightTakeOff2=e.flight.STD),e.flightOnBlock2=e.flight.ChocksIn,e.flightOnBlock2||(e.flightOnBlock2=e.flight.STA),e.flightLanding2=e.flight.Landing,e.flightLanding2||(e.flightLanding2=e.flight.STA)}},e.jl={},
e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){return e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.flight.FlightPlanId?void General.ShowNotify("The selected item cannot be deleted.","error"):void General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.flight.ID};e.loadingVisible=!0,a.deleteFlight(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.BeginSearch()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})):void General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.btn_print={text:"Print",type:"default",icon:"print",width:110,onClick:function(e){html2canvas(document.querySelector("#gantt_container_ba")).then(function(e){g(e)})}},e.btn_pax={text:"Pax",type:"default",icon:"fas fa-user-tag",width:"100%",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.depReadOnly=!1,e.paxSaved=!1,e.flight=e.selectedFlights[0],e.calculateTotalPax(),e.popup_pax_visible=!0}},e.btn_cargo={text:"Cargo",type:"default",icon:"fas fa-boxes",width:"100%",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.depReadOnly=!1,e.flight=e.selectedFlights[0],e.cargoSaved=!1,e.popup_cargo_visible=!0}},e.fuelDepSaved=!1,e.fuelArrSaved=!1,e.$dgrow=null,e.btn_fueldep={text:"Fuel(D)",type:"default",icon:"fas fa-burn",width:"100%",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.depReadOnly=!1,e.flight=e.selectedFlights[0],e.fuelDepSaved=!1,e.$dgrow=$("#dg_flights").find(".dx-row.dx-selection"),e.popup_fueldep_visible=!0}},e.fuelArrSaved=!1,e.btn_fuelarr={text:"Fuel(A)",type:"default",icon:"fas fa-burn",width:"100%",bindingOptions:{disabled:"IsArrivalDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.fuelArrSaved=!1,e.popup_fuelarr_visible=!0}},e.IsCancelVisible=!1,e.btn_cancel={text:"Cancel",type:"danger",icon:"fas fa-ban",width:"150",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.entity_cancel.CancelDate=new Date(Date.now()),e.popup_cancel_visible=!0}},e.IsRedirectVisible=!1,e.btn_redirect={text:"Redirect",type:"danger",icon:"fas fa-random",width:"150",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.entity_redirect.RedirectDate=new Date(Date.now()),e.popup_redirect_visible=!0}},e.getGantt=function(){return $("#resourceGanttba").data("ejGantt")},e.ganttData=null,e.resourceGroups=[],e.resources=[],e.dataSource=[],e.totalFlights="-",e.totalDelays="-",e.departedFlights="-",e.arrivedFlights="-",e.canceledFlights="-",e.departedPax="-",e.arrivedPax="-",e.calculateSummary=function(){e.totalFlights=e.dataSource.length,e.departedFlights=Enumerable.From(e.dataSource).Where("$.Takeoff").ToArray().length,e.arrivedFlights=Enumerable.From(e.dataSource).Where("$.Landing").ToArray().length,e.canceledFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==4").ToArray().length,e.redirectedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==17").ToArray().length,e.divertedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID== 7").ToArray().length,e.totalDelays=Enumerable.From(e.dataSource).Where("$.ChocksOut").Select("$.delay").Sum(),e.departedPax=Enumerable.From(e.dataSource).Where("$.Takeoff").Select("$.TotalPax").Sum(),e.arrivedPax=Enumerable.From(e.dataSource).Where("$.Landing").Select("$.TotalPax").Sum(),e.airportEntity&&(e.totalFlights=e.dataSource.length,e.departedFlights=Enumerable.From(e.dataSource).Where("$.Takeoff && $.FromAirport=="+e.airportEntity.Id).ToArray().length,e.arrivedFlights=Enumerable.From(e.dataSource).Where("$.Landing && $.ToAirport=="+e.airportEntity.Id).ToArray().length,e.canceledFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==4").ToArray().length,e.redirectedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==17").ToArray().length,e.divertedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID== 7").ToArray().length,e.totalDelays=Enumerable.From(e.dataSource).Where("$.FromAirport=="+e.airportEntity.Id+" && $.ChocksOut").Select("$.delay").Sum(),e.departedPax=Enumerable.From(e.dataSource).Where("$.Takeoff && $.FromAirport=="+e.airportEntity.Id).Select("$.TotalPax").Sum(),e.arrivedPax=Enumerable.From(e.dataSource).Where("$.Landing && $.ToAirport=="+e.airportEntity.Id).Select("$.TotalPax").Sum())},e.gaugeOptions={valueIndicator:{indentFromCenter:50,spindleSize:0,type:"rangeBar"},subvalueIndicator:{type:"textcloud",text:{customizeText:function(e){return e.valueText}}},scale:{startValue:0,endValue:150,tickInterval:10,label:{useRangeColors:!0}},rangeContainer:{palette:"pastel",ranges:[{startValue:0,endValue:150}]},title:{text:"Departed",font:{size:14},verticalAlignment:"bottom"},size:{width:200,height:200},value:90,subvalues:[90]};var h=-1*(new Date).getTimezoneOffset();e.footerfilter=!1,e.searched=!1,e.baseSum=null,e.btn_persiandate={type:"default",icon:"event",width:35,bindingOptions:{},onClick:function(t){e.popup_date_visible=!0}},e.popup_date_visible=!1,e.popup_date_title="Date Picker";var f=null;e.popup_date={title:"Shamsi Date Picker",shading:!0,height:150,width:300,fullScreen:!1,showTitle:!0,dragEnabled:!0,visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(e){},onShown:function(t){f=$(".date1").pDatepicker({format:"l",autoClose:!0,calendar:{persian:{locale:"en"}},onSelect:function(t){e.$apply(function(){e._datefrom=new Date(t)})}}),f.setDate(new Date(e.datefrom.getTime()))},onHiding:function(){f.destroy(),e.StopUTimer(),e.BeginSearch(),e.popup_date_visible=!1},showCloseButton:!0,bindingOptions:{visible:"popup_date_visible"}},e.bindFlights=function(t){h=-1*(new Date).getTimezoneOffset(),new Date(e.datefrom)<new Date(2020,2,21,0,0,0,0)&&(h-=60);if(t)try{$(".e-ganttviewerbodyContianer").data("ejScroller").scrollLeft()}catch(e){}var i={Status:e.filterStatus,Types:e.filterType,Registers:e.filterAircraft,From:e.filterFrom,To:e.filterTo};e.hideButtons2(),e.selectedFlights=[],e.dg_flights_instance.deselectAll(),e.selectedTabDateIndex=-1,e.loadingVisible=!0;var n=new Date(e.dateEnd).toUTCDateTimeDigits();a.getFlightsGantt(Config.CustomerId,new Date(e.datefrom).toUTCDateTimeDigits(),n,h,e.IsAdmin?null:e.airportEntity.Id,i).then(function(t){e.tabsdatefirst=!0,e.tabs_date=[];var i,n=new Date(e._datefrom);for(i=1;i<=e.days_count;i++){var a=moment(n).format("ddd DD-MMM-YYYY");e.tabs_date.push({text:a,id:i,date:moment(n).format("YYYY/MM/DD")}),n=n.addDays(1)}e.tabsdatevisible=!0,e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,e.baseSum=e.ganttData.baseSummary,e.resourceGroups=t.resourceGroups,e.resources=t.resources,console.log("*********************"),console.log(t.flights),u()&&$.each(t.flights,function(e,t){t.STD=new Date(t.STD).addMinutes(-270),t.STA=new Date(t.STA).addMinutes(-270),t.ChocksIn=new Date(t.ChocksIn).addMinutes(-270),t.ChocksOut=new Date(t.ChocksOut).addMinutes(-270),t.Landing=new Date(t.Landing).addMinutes(-270),t.STAPlanned=new Date(t.STAPlanned).addMinutes(-270),t.STDPlanned=new Date(t.STDPlanned).addMinutes(-270),t.Takeoff=new Date(t.Takeoff).addMinutes(-270),t.baseStartDate=new Date(t.baseStartDate).addMinutes(-270),t.baseEndDate=new Date(t.baseEndDate).addMinutes(-270),t.endDate=new Date(t.endDate).addMinutes(-270),t.startDate=new Date(t.startDate).addMinutes(-270)}),e.dataSource=Flight.proccessDataSource(t.flights),Flight.activeDatasource=e.dataSource,e.dg_flights_ds=e.dataSource,e.calculateSummary(),e.selectedTabDateIndex=0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.baseDate=null,e.search=function(){e.updatedFlightsCount=0,e.updatedFlights=[],e.bindFlights(!1)},e.fillFlight=function(e,t){e.FlightPlanId=t.FlightPlanId,e.BaggageCount=t.BaggageCount,e.CargoUnitID=t.CargoUnitID,e.CargoUnit=t.CargoUnit,e.CargoWeight=t.CargoWeight,e.PaxChild=t.PaxChild,e.PaxInfant=t.PaxInfant,e.PaxAdult=t.PaxAdult,e.FuelArrival=t.FuelArrival,e.FuelDeparture=t.FuelDeparture,e.FuelActual=t.FuelActual,e.FuelPlanned=t.FuelPlanned,e.GWLand=t.GWLand,e.GWTO=t.GWTO,e.BlockM=t.BlockM,e.BlockH=t.BlockH,e.FlightH=t.FlightH,e.FlightM=t.FlightM,e.ChocksIn=t.ChocksIn,e.Landing=t.Landing,e.Takeoff=t.Takeoff,e.ChocksOut=t.ChocksOut,e.STD=t.STD,e.STA=t.STA,e.FlightStatusID=t.FlightStatusID,e.RegisterID=t.RegisterID,e.FlightTypeID=t.FlightTypeID,e.TypeId=t.TypeId,e.AirlineOperatorsID=t.AirlineOperatorsID,e.FlightNumber=t.FlightNumber,e.FromAirport=t.FromAirport,e.ToAirport=t.ToAirport,e.STAPlanned=t.STAPlanned,e.STDPlanned=t.STDPlanned,e.FlightHPlanned=t.FlightHPlanned,e.FlightMPlanned=t.FlightMPlanned,e.FlightPlan=t.FlightPlan,e.CustomerId=t.CustomerId,e.IsActive=t.IsActive,e.DateActive=t.DateActive,e.FromAirportName=t.FromAirportName,e.FromAirportIATA=t.FromAirportIATA,e.FromAirportCityId=t.FromAirportCityId,e.ToAirportName=t.ToAirportName,e.ToAirportIATA=t.ToAirportIATA,e.ToAirportCityId=t.ToAirportCityId,e.FromAirportCity=t.FromAirportCity,e.ToAirportCity=t.ToAirportCity,e.AircraftType=t.AircraftType,e.Register=t.Register,e.MSN=t.MSN,e.FlightStatus=t.FlightStatus,e.FlightStatusBgColor=t.FlightStatusBgColor,e.FlightStatusColor=t.FlightStatusColor,e.FlightStatusClass=t.FlightStatusClass,e.from=t.from,e.to=t.to,e.notes=t.notes,e.status=t.status,e.progress=t.progress,e.taskName=t.taskName,e.startDate=t.startDate,e.duration=t.duration,e.taskId=t.taskId,e.FlightGroupID=t.FlightGroupID,e.PlanId=t.PlanId,e.ManufacturerId=t.ManufacturerId,e.Manufacturer=t.Manufacturer,e.ToCountry=t.ToCountry,e.ToSortName=t.ToSortName,e.ToCity=t.ToCity,e.FromSortName=t.FromSortName,e.FromContry=t.FromContry,e.FromCity=t.FromCity,e.FromLatitude=t.FromLatitude,e.FromLongitude=t.FromLongitude,e.ToLatitude=t.ToLatitude,e.ToLongitude=t.ToLongitude,e.CargoCount=t.CargoCount,e.BaggageWeight=t.BaggageWeight,e.FuelUnitID=t.FuelUnitID,e.ArrivalRemark=t.ArrivalRemark,e.DepartureRemark=t.DepartureRemark,e.TotalSeat=t.TotalSeat,e.EstimatedDelay=t.EstimatedDelay,e.PaxOver=t.PaxOver,e.TotalPax=t.TotalPax,e.FuelUnit=t.FuelUnit,e.DateStatus=t.DateStatus},e.doActionCompleteSave=!0,e.updatedFlightsCount=0,e.updatedFlights=[],e.addUpdatedFlights=function(t){e.updatedFlights=Enumerable.From(e.updatedFlights).Where("$.ID!="+t.ID).ToArray();var i={ID:t.ID,FlightNumber:t.FlightNumber,ToAirportIATA:t.ToAirportIATA,FromAirportIATA:t.FromAirportIATA,FlightStatus:t.FlightStatus,DateStatus:t.DateStatus};e.updatedFlights.push(i),e.updatedFlightsCount=e.updatedFlights.length},e.removeUpdatedFlights=function(t){e.updatedFlights=Enumerable.From(e.updatedFlights).Where("$.ID!="+t.ID).ToArray(),e.updatedFlightsCount=e.updatedFlights.length},e.showUpdatedFlights=function(){e.popup_upd_visible=!0},e.utimer=null,e.StartUTimer=function(){e.utimer=setTimeout(function(){console.log(new Date);var t=$("#resourceGanttba").data("ejGantt"),i={from:new Date(e.datefrom).toUTCString(),to:new Date(e.dateto).toUTCString(),baseDate:e.baseDate,airport:e.airportEntity?e.airportEntity.Id:-1,customer:Config.CustomerId,tzoffset:-1*(new Date).getTimezoneOffset(),userid:n.userId?n.userId:-1};a.getUpdatedFlights(i).then(function(i){if(console.log("UpdatedFlights"),console.log(i),e.baseDate=new Date(Date.now()).toUTCString(),$.each(i.flights,function(i,n){var a=Enumerable.From(e.dataSource).Where("$.ID=="+n.ID).FirstOrDefault();a&&(e.doActionCompleteSave=!1,e.fillFlight(a,n),Flight.processDataOffBlock(a),e.addUpdatedFlights(a),t.reRenderChart(),e.flight&&$(".task-"+e.flight.ID).parent().addClass("e-gantt-taskbarSelection"),e.calculateSummary())}),-1!=i.summary&&(e.baseSum=i.summary),i&&i.flights&&i.flights.length>0){var n=i.flights[0];moment(n.DateStatus).format("MMMM Do YYYY, h:mm:ss a"),n.FromAirportIATA,n.ToAirportIATA,n.FlightNumber,n.FlightStatus}e.getBoardSummary(e.selectedDate)},function(e){}),e.StartUTimer()},6e4)},e.StopUTimer=function(){e.utimer&&clearTimeout(e.utimer)},e.nowlinetimer=null,e.nowlinelastdate=new Date,e.IsUTC=!1,e.StartNowLineTimerFirst=!0,e.StartNowLineTimerFirstTime=null,e.nowlineInitLeft=null,e.StartNowLineTimer=function(t){e.nowlinetimer=setTimeout(function(){if(e.StartNowLineTimerFirst){e.StartNowLineTimerFirst=!1,e.StartNowLineTimerFirstTime=(new Date).getTime();var t=(new Date).yyyymmddtimenow(e.IsUTC);$("#resourceGanttba").data("ejGantt").setModel2({stripLines:[{day:t,lineWidth:"1",lineColor:"#ffdab3",lineStyle:"solid"}]},null,function(){}),$("#stripline0").height($("#ganttviewerbodyContianerejGanttChartresourceGanttba").height())}else if($("#stripline0").height($("#ganttviewerbodyContianerejGanttChartresourceGanttba").height()),e.nowlineInitLeft||(e.nowlineInitLeft=$("#stripline0").position().left),e.nowlineInitLeft){var i=(new Date).getTime(),n=(i-e.StartNowLineTimerFirstTime)/1e3;e.StartNowLineTimerFirstTime=i;var a=e.timeCellWidth*n*1/3600;e.nowlineInitLeft=Number(e.nowlineInitLeft+a),$("#stripline0").css({left:e.nowlineInitLeft})}e.nowlinelastdate=new Date;var o=$("#stripline0"),l="<div style='font-size:11px;font-weight:bold;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow()+"</div><div style='font-size:11px;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow(!0)+"</div>";e.IsUTC&&(l="<div style='font-size:11px;font-weight:bold;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow()+"</div><div style='font-size:11px;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow(!0)+"</div>"),o.html(l),e.renderTopTimeHeader(),e.renderTimeHeader(),e.StartNowLineTimer(10)},1e3*t)},e.StopNowLineTimer=function(){e.nowlinetimer&&clearTimeout(e.nowlinetimer)},e.boardSummary={Arrived:"-",Departed:"-",TotalFlight:"-",BaggageWeight:"-",BlockTime:"-",Canceled:"-",Date:"-",Delay:"-",Diverted:"-",FuelActual:"-",Pax:"-",TotalSeat:"-",CargoPerPax:"-",DelayRatio:"-",PaxLoad:"-",DelayStr:"-",BlockTimeStr:"-"},e.getBoardSummary=function(t){e.boardSummary={Arrived:"-",Departed:"-",TotalFlight:"-",BaggageWeight:"-",BlockTime:"-",Canceled:"-",Date:"-",Delay:"-",Diverted:"-",FuelActual:"-",Pax:"-",TotalSeat:"-",CargoPerPax:"-",DelayRatio:"-",PaxLoad:"-",DelayStr:"-",BlockTimeStr:"-"};var i=t.getFullYear(),n=t.getMonth()+1,o=t.getDate();a.getBoardSummary(Config.CustomerId,i,n,o).then(function(t){t&&(e.boardSummary=t),console.log(e.boardSummary)},function(t){e.loadingVisible=!1})},e.selectedTabDateIndex=-1,e.tabsdatefirst=!0,e.$watch("selectedTabDateIndex",function(t){try{if(-1==e.selectedTabDateIndex)return;e.selectedTab=e.tabs_date[t],e.selectedDate=new Date(e.selectedTab.date),e.StopNowLineTimer(),e.createGantt(),e.getBoardSummary(e.selectedDate),e.footerfilter=!0,e.searched=!0,e.autoUpdate&&e.StartUTimer()}catch(e){alert(e)}}),e.tabs_date=[],e.tabs_date_options={scrollByContent:!0,showNavButtons:!0,elementAttr:{class:"tabsdate"},onItemClick:function(e){},onItemRendered:function(t){e.selectedTabDateIndex=-1,e.selectedTabDateIndex=0},bindingOptions:{visible:"tabsdatevisible",dataSource:{dataPath:"tabs_date",deep:!0},selectedIndex:"selectedTabDateIndex"}},e.autoUpdate=!0,e.check_autoupdate={width:"100%",text:"Auto Update",onValueChanged:function(t){t.value?e.StartUTimer():e.StopUTimer()},bindingOptions:{value:"autoUpdate"}},e.btn_update={text:"Refresh",type:"success",icon:"pulldown",width:"150",bindingOptions:{disabled:"autoUpdate"},onClick:function(t){console.log("update");var i={from:new Date(e.datefrom).toUTCString(),to:new Date(e.dateto).toUTCString(),baseDate:e.baseDate,airport:e.airportEntity?e.airportEntity.Id:-1,customer:Config.CustomerId,tzoffset:-1*(new Date).getTimezoneOffset(),userid:n.userId?n.userId:-1};e.loadingVisible=!0,a.getUpdatedFlights(i).then(function(t){e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString();var i=$("#resourceGanttba").data("ejGantt");$.each(t.flights,function(t,n){var a=Enumerable.From(e.dataSource).Where("$.ID=="+n.ID).FirstOrDefault();a&&(e.doActionCompleteSave=!1,e.fillFlight(a,n),Flight.processDataOffBlock(a),e.addUpdatedFlights(a),i.updateRecordByTaskId(a),e.calculateSummary(),console.log("updated 2"),console.log(a))}),e.getBoardSummary(e.selectedDate)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e._flightno="",e.text_flightno={bindingOptions:{value:"_flightno"}},e.btn_goflight={text:"",type:"success",icon:"arrowright",width:"35",bindingOptions:{},onClick:function(t){if(e._flightno){var i=Enumerable.From(e.dataSource).Where("$.FlightNumber.toLowerCase()=='"+e._flightno.toLowerCase()+"'").FirstOrDefault();if(!i)return void General.ShowNotify("Flight not found","error");e.scrollGantt(i)}}},e.ganttview=!0,e.gridview=!0,e.btn_swap={text:"",type:"default",icon:"fas fa-exchange-alt",width:"40",bindingOptions:{},onClick:function(t){e.createGantt()}},e.btn_plan_new={type:"default",icon:"plus",width:"40",onClick:function(t){e.doRefresh=!1,e.planEntity.Id=-1,e.tempData=null,e.IsNew=!0,e.addMode=!0,e.popup_plan_add_visible=!0},bindingOptions:{visible:"IsPlanning"}},e.btn_plan_delete={type:"danger",icon:"clear",width:"40",onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");var i=e.selectedFlights[0];General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var n={Id:i.FlightPlanId};e.loadingVisible=!0,a.deletePlanItem(n).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.BeginSearch()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})},bindingOptions:{visible:"IsPlanning"}},e.btn_plan_edit={type:"default",icon:"edit",width:40,onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");var i=-1*(new Date).getTimezoneOffset(),n=e.selectedFlights[0];e.loadingVisible=!0,a.getFlightPlanItem(n.FlightPlanId,i).then(function(t){e.loadingVisible=!1,e.IsNew=!1,e.tempData=t,e.doRefresh=!1,e.popup_plan_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.btn_interval={type:"default",icon:"event",width:40,onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");var i=((new Date).getTimezoneOffset(),e.selectedFlights[0]);a.getFlightPlanView(i.PlanId).then(function(t){e.entityInterval.FlightPlanId=t.plan.Id,e.entityInterval.DateFrom=t.plan.DateFrom,e.entityInterval.DateTo=t.plan.DateTo,e.entityInterval.Interval=t.plan.Interval,e.entityInterval.BaseIATA=t.plan.BaseIATA,e.entityInterval.Register=t.plan.VirtualRegister,e.entityInterval.Months=[],e.entityInterval.Days=[],100==e.entityInterval.Interval||(e.popup_interval_visible=!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.popup_plan_add_visible=!1,e.popup_plan_add_title="New",e.popup_plan_add={width:1200,height:530,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplan2",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.planEntity.DateFrom=new Date(e.planEntity.iDateFrom).ToUTC(),e.planEntity.DateTo=new Date(e.planEntity.iDateTo).ToUTC(),e.planEntity.STD=new Date(e.planEntity.STD).toUTCString(),e.planEntity.STA=new Date(e.planEntity.STA).toUTCString(),100!=e.planEntity.Interval&&(e.planEntity.Months=[],e.planEntity.Days=[]),e.loadingVisible=!0,a.savePlanItem(e.planEntity).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.refreshPlanEntity(),e.IsNew?(e.isBaseDisabled=!0,e.planEntity.STD=new Date(e.planEntity.STA).addMinutes(60),e.start=e.planEntity.STD,e.planEntity.STA=null,e.planEntity.FromAirport=e.planEntity.ToAirport,e.planEntity.ToAirport=null,t.STD=new Date(t.STD).addMinutes(h),t.STA=new Date(t.STA).addMinutes(h),e.plan_dg2_ds.push(t),e.plan_dg2_instance.refresh()):e.popup_plan_add_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.tempData&&e.bindPlanEntity(e.tempData)},onHiding:function(){e.clearPlanEntity(),e.plan_dg2_ds=[],e.plan_dg2_instance.refresh(),e.popup_plan_add_visible=!1,e.doRefresh&&e.BeginSearch()},bindingOptions:{visible:"popup_plan_add_visible",title:"popup_plan_add_title"}},e.popup_plan_add.toolbarItems[1].options.onClick=function(t){e.popup_plan_add_visible=!1},e.popup_interval_visible=!1,e.popup_interval_title="Interval",e.popup_interval={width:600,height:460,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplaninterval2",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={Id:e.entityInterval.FlightPlanId,DateFrom:new Date(e.entityInterval.DateFrom).ToUTC(),DateTo:new Date(e.entityInterval.DateTo).ToUTC(),Interval:e.entityInterval.Interval,Months:e.entityInterval.Months,Days:e.entityInterval.Days,DateFirst:new Date(e.entityInterval.DateFrom).ToUTC()};e.loadingVisible=!0,a.savePlanInterval(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.clearEntityInterval(),e.popup_interval_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_interval_visible=!1,e.doRefresh&&e.BeginSearch()},bindingOptions:{visible:"popup_interval_visible",title:"popup_interval_title"}},e.popup_interval.toolbarItems[1].options.onClick=function(t){e.popup_interval_visible=!1},e.text_base={readOnly:!0,bindingOptions:{value:"entityInterval.BaseIATA"}},e.text_msn={readOnly:!0,bindingOptions:{value:"entityInterval.Register"}},e.date_from2={type:"date",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entityInterval.DateFrom"}},e.date_to2={type:"date",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entityInterval.DateTo"}},e.intervalTypes=[{Id:1,Title:"Daily"}],e.sb_interval2={showClearButton:!0,width:"100%",searchEnabled:!1,displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){e.customDisabled=t.selectedItem&&100!=t.selectedItem.Id},bindingOptions:{value:"entityInterval.Interval",dataSource:"intervalTypes"}},e.customDisabled=!0,e.tag_months_instance=null,e.tag_months={dataSource:General.MonthDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_months_instance||(e.tag_months_instance=t.component)},onSelectionChanged:function(e){},bindingOptions:{disabled:"customDisabled",value:"entityInterval.Months"}},e.tag_days_instance=null,e.tag_days={dataSource:General.WeekDayDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_days_instance||(e.tag_days_instance=t.component)},onSelectionChanged:function(e){},bindingOptions:{disabled:"customDisabled",value:"entityInterval.Days"}},e.entityInterval={FlightPlanId:null,DateFrom:null,DateTo:null,Interval:null,BaseIATA:null,Register:null,Months:[],Days:[]},e.clearEntityInterval=function(){e.entityInterval.FlightPlanId=null,e.entityInterval.DateFrom=null,e.entityInterval.DateTo=null,e.entityInterval.Interval=null,e.entityInterval.BaseIATA=null,e.entityInterval.Register=null,e.entityInterval.Months=[],e.entityInterval.Days=[]},e.planEntity={Id:null,Title:null,DateFrom:null,DateTo:null,DateFirst:null,DateLast:null,BaseId:null,iDateFrom:new Date,iDateTo:new Date,CustomerId:Config.CustomerId,IsActive:!1,DateActive:null,Interval:1,TypeId:null,RegisterID:null,FlightTypeID:null,FromAirport:null,ToAirport:null,STA:null,STD:null,FlightH:null,FlightM:null,FlightNumber:null,RouteId:null,FlightPlanId:-1,Months:[],Days:[]},e.refreshPlanEntity=function(){e.planEntity.Id=-1,e.planEntity.DateFirst=null,e.planEntity.DateLast=null,e.planEntity.CustomerId=Config.CustomerId,e.planEntity.IsActive=!1,e.planEntity.DateActive=null,e.planEntity.Interval=101,e.planEntity.FlightH=null,e.planEntity.FlightM=null,e.planEntity.FlightNumber=null,e.planEntity.RouteId=null},e.clearPlanEntity=function(){e.planEntity.Id=null,e.planEntity.BaseId=null,e.planEntity.Title=null,e.planEntity.DateFrom=null,e.planEntity.DateTo=null,e.planEntity.DateFirst=null,e.planEntity.DateLast=null,e.planEntity.iDateFrom=new Date,e.planEntity.iDateTo=new Date,e.planEntity.CustomerId=Config.CustomerId,e.planEntity.IsActive=!1,e.planEntity.DateActive=null,e.planEntity.Interval=101,e.planEntity.TypeId=null,e.planEntity.RegisterID=null,e.planEntity.FlightTypeID=null,e.planEntity.FromAirport=null,e.planEntity.ToAirport=null,e.planEntity.STA=null,e.planEntity.STD=null,e.planEntity.FlightH=null,e.planEntity.FlightM=null,e.planEntity.FlightNumber=null,e.planEntity.RouteId=null,e.planEntity.Months=[],e.planEntity.Days=[],e.data=[]},e.DotBlockToBlock=!0,e.bindPlanEntity=function(t){e.DotBlockToBlock=!1,e.planEntity.Id=t.Id,e.planEntity.BaseId=t.BaseId,e.planEntity.Title=t.Title,e.planEntity.DateFrom=t.DateFrom,e.planEntity.DateTo=t.DateTo,e.planEntity.DateFirst=t.DateFirst,e.planEntity.DateLast=t.DateLast,e.planEntity.iDateFrom=t.DateFrom,e.planEntity.iDateTo=t.DateTo,e.planEntity.CustomerId=t.CustomerId,e.planEntity.IsActive=t.IsActive,e.planEntity.DateActive=t.DateActive,e.planEntity.Interval=t.Interval,e.planEntity.Months=t.Months,e.planEntity.Days=t.Days,e.planEntity.FlightPlanId=t.FlightPlanId,e.planEntity.TypeId=t.TypeId,e.planEntity.RegisterID=t.RegisterID,e.planEntity.FlightTypeID=t.FlightTypeID,e.planEntity.AirlineOperatorsID=t.AirlineOperatorsID,e.planEntity.FlightNumber=t.FlightNumber,e.planEntity.FromAirport=t.FromAirport,e.planEntity.ToAirport=t.ToAirport,e.planEntity.STA=t.STA,e.planEntity.STD=t.STD,e.planEntity.FlightH=t.FlightH,e.planEntity.FlightM=t.FlightM,e.planEntity.FlightStatus=t.FlightStatus,e.start=new Date(e.planEntity.STD),e.tempToAirport=e.planEntity.ToAirport},e.plan_dg2_selected=null,e.plan_dg2_columns=[{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300}],e.plan_dg2_height=400,e.plan_dg2_instance=null,e.plan_dg2_ds=[],e.plan_dg2={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.plan_dg2_columns,onContentReady:function(t){e.plan_dg2_instance||(e.plan_dg2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.plan_dg2_selected=i||null},onCellPrepared:function(e){},bindingOptions:{dataSource:"plan_dg2_ds",height:"plan_dg2_height"}},e.plan_date_from={type:"date",width:"100%",onValueChanged:function(t){e.planEntity.iDateTo=t.value},bindingOptions:{value:"planEntity.iDateFrom"}},e.selectedType=null,e.ds_msn=[],e.msn_readOnly=!0,e.sb_type={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(e){return n.getSbTemplateAircraft(e)},searchExpr:["Type","Manufacturer"],dataSource:n.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",onSelectionChanged:function(t){e.ds_msn=[],e.msn_readOnly=!0,t&&t.selectedItem?(e.planEntity.AircraftType=t.selectedItem.Type,l.getVirtualMSNsByType(Config.CustomerId,t.selectedItem.Id).then(function(t){e.msn_readOnly=!1,e.ds_msn=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):(e.msn_readOnly=!0,e.ds_msn=[],e.planEntity.AircraftType=null)},bindingOptions:{value:"planEntity.TypeId",selectedItem:"selectedType"}},e.unknown_readOnly=!1,e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(t){if(t.selectedItem){e.planEntity.Register=t.selectedItem.Register;var i=-1*(new Date).getTimezoneOffset(),n={CustomerId:Config.CustomerId,Date:new Date(e.planEntity.iDateFrom).ToUTC(),RegisterId:t.selectedItem.ID,Offset:i};e.loadingVisible=!0,a.getPlanLastItem(n).then(function(t){e.loadingVisible=!1,t&&-1!=t.Id?(e.isBaseDisabled=!0,e.planEntity.BaseId=t.BaseId,e.IsNew&&(e.planEntity.FromAirport=t.ToAirport,e.planEntity.ToAirport=null,e.planEntity.STD=new Date(t.STA),e.start=new Date(e.planEntity.STD)),a.getPlanItems(n).then(function(t){e.plan_dg2_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):e.isBaseDisabled=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else e.planEntity.Register=null,e.planEntity.BaseId=null,e.isBaseDisabled=!0},bindingOptions:{value:"planEntity.RegisterID",disabled:"msn_readOnly",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.isBaseDisabled=!0,e.sb_Base={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){e.isBaseDisabled||(e.planEntity.FromAirport=t.selectedItem.Id)},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"planEntity.BaseId",disabled:"isBaseDisabled"}},e.tempToAirport=null,e.selectedFromAirport=null,e.selectedToAirport=null,e.sb_FromAirport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){if(e.planEntity.ToAirport=null,!t.selectedItem)return e.ds_toairport=[],void(e.planEntity.FromAirportIATA=null);e.planEntity.FromAirportIATA=t.selectedItem.IATA,e.loadingVisible=!0,a.getRouteDestination(Config.AirlineId,t.selectedItem.Id).then(function(t){e.loadingVisible=!1,e.ds_toairport=t,e.tempToAirport&&(e.planEntity.ToAirport=e.tempToAirport,e.tempToAirport=null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},
searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"planEntity.FromAirport",selectedItem:"selectedFromAirport"}},e.ds_toairport=[],e.sb_ToAirport={showClearButton:!0,searchEnabled:!0,itemTemplate:function(e){return n.getSbTemplateRouteTo(e)},onSelectionChanged:function(t){t.selectedItem?(e.planEntity.RouteId=t.selectedItem.Id,e.DotBlockToBlock?(e.planEntity.FlightH=t.selectedItem.FlightH,e.planEntity.FlightM=t.selectedItem.FlightM):e.DotBlockToBlock=!0,e.planEntity.ToAirportIATA=t.selectedItem.ToAirportIATA):(e.planEntity.RouteId=null,e.planEntity.FlightH=null,e.planEntity.FlightM=null,e.planEntity.ToAirportIATA=null),e.setArrivalPlan()},searchExpr:["ToAirportIATA","ToCity"],displayExpr:"ToAirportIATA",valueExpr:"ToAirportId",bindingOptions:{value:"planEntity.ToAirport",selectedItem:"selectedRoute",dataSource:"ds_toairport"}},e.selectedRoute=null,e.setArrivalPlan=function(){if(null!=e.planEntity.STD&&null!=e.planEntity.FlightH&&null!=e.planEntity.FlightM){var t=new Date(e.planEntity.STD);e.planEntity.STA=new Date(t.addHours(e.planEntity.FlightH).addMinutes(e.planEntity.FlightM))}else e.planEntity.STA=null},e.start=null,e.time_start={type:"time",width:"100%",interval:15,onValueChanged:function(t){if(t.value){var i=new Date(t.value),n=i.getHours(),a=i.getMinutes(),o=n+":"+a+":00",l=new Date(e.planEntity.iDateFrom).getDatePartSlash()+" "+o,r=new Date(l);e.planEntity.STD=r}else e.planEntity.STD=null;e.setArrivalPlan()},bindingOptions:{value:"start"}},e.time_end={readOnly:!0,type:"time",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"planEntity.STA"}},e.text_flighth={min:0,onValueChanged:function(t){e.setArrivalPlan()},bindingOptions:{value:"planEntity.FlightH"}},e.text_flightm={min:0,max:59,onValueChanged:function(t){e.setArrivalPlan()},bindingOptions:{value:"planEntity.FlightM"}},e.text_flightnumber={bindingOptions:{value:"planEntity.FlightNumber"}},e.plan_sb_flighttype={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"planEntity.FlightTypeID"}},e.dateEnd=null,e.tabsdatevisible=!1,e.BeginSearch=function(){e.datefrom=General.getDayFirstHour(new Date(e._datefrom)),e.dateEnd=General.getDayLastHour(new Date(new Date(e._datefrom).addDays(e.days_count-1))),e.dateto=General.getDayLastHour(new Date(e._datefrom)),e.StopNowLineTimer(),e.search()},e.btn_search={text:"Search",type:"success",icon:"search",width:120,validationGroup:"flightboarddate",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.StopUTimer(),e.BeginSearch()}},e.btn_search_mobile={text:"",type:"success",icon:"search",width:40,validationGroup:"flightboarddate",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.StopUTimer(),e.BeginSearch()}},e.datefrom=General.getDayFirstHour(new Date(2019,5,6,0,0,0)),e.dateto=General.getDayLastHour(new Date(2019,5,6,0,0,0)),e._datefrom=new Date,e.date_from={type:"date",placeholder:"From",width:"130px",displayFormat:"yyyy-MM-dd",adaptivityEnabled:!0,pickerType:"rollers",bindingOptions:{value:"_datefrom"}},e.days_count=2,e.num_days={min:1,showSpinButtons:!1,bindingOptions:{value:"days_count"}},e.btn_test={text:"test",type:"success",icon:"search",width:"100%",bindingOptions:{},onClick:function(e){var t=$("#task-4908");console.log(t.length)}},e.date_to={type:"datetime",displayFormat:"yyyy-MM-dd HH:mm",width:"100%",interval:15,onValueChanged:function(e){if(e.value){new Date(e.value)}},bindingOptions:{value:"dateto"}},e.filterStatus=null,e.tag_status={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["title"],dataSource:Flight.filteredStatusDataSource,displayExpr:"title",valueExpr:"id",bindingOptions:{value:"filterStatus"}},e.filterType=null,e.tag_types={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsAcTypes(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterType"}},e.filterAircraft=null,e.tag_aircrafts={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsRegisters(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterAircraft"}},e.filterFrom=null,e.tag_from={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsFrom(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterFrom"}},e.filterTo=null,e.tag_to={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsTo(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterTo"}},e.checkOnBlock=!0,e.check_onblock={width:"100%",text:"On Block",bindingOptions:{value:"checkOnBlock"}},e.checkOffBlock=!0,e.check_offblock={width:"100%",text:"Off Block",bindingOptions:{value:"checkOffBlock"}},e.checkTakeOff=!0,e.check_takeoff={width:"100%",text:"Departued",bindingOptions:{value:"checkTakeOff"}},e.checkLanding=!0,e.check_landing={width:"100%",text:"Arrived",bindingOptions:{value:"checkLanding"}},e.checkScheduled=!0,e.check_scheduled={width:"100%",text:"Scheduled",bindingOptions:{value:"checkScheduled"}},e.applyNextFlight=!1,e.check_applynext={width:"100%",text:"Apply delay to next flights",bindingOptions:{value:"applyNextFlight"}},e.flightTakeOff=null,e.takeOffReadOnly=!1,e.time_takeoff={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightTakeOff",min:"flight.ChocksOut",readOnly:"takeOffReadOnly"}},e.calculateTotalDelay=function(){if(!e.flightOffBlock2)return e.flight.TotalDelayHH=null,e.flight.TotalDelayMM=null,void(e.flight.TotalDelayTotalMM=0);var t=new Date(e.flight.STD),i=new Date(e.flightOffBlock2);if(t>i)return e.flight.TotalDelayHH=0,e.flight.TotalDelayMM=0,void(e.flight.TotalDelayTotalMM=0);var n=subtractDates(t,i),a=Math.floor(n/60),o=n%60;e.flight.TotalDelayHH=a,e.flight.TotalDelayMM=o,e.flight.TotalDelayTotalMM=n,n&&n>0?$(".tdelay").addClass("pink"):$(".tdelay").removeClass("pink")},e.flightTakeOff2=null,e.time_takeoff2={type:"date",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightTakeOff2",readOnly:"IsTakeOffReadOnly",disabled:"IsTakeOffReadOnly"}},e.time_takeoff2_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(e){},bindingOptions:{value:"flightTakeOff2",readOnly:"IsTakeOffReadOnly",disabled:"IsTakeOffReadOnly"}},e.flightOffBlock=null,e.time_offblock={type:"datetime",width:"100%",interval:5,bindingOptions:{value:"flightOffBlock",min:"flight.baseStartDate"}},e.depReadOnly=!0,e.flightOffBlock2=null,e.time_offblock2={type:"date",width:"100%",onValueChanged:function(t){e.calculateTotalDelay()},interval:5,bindingOptions:{value:"flightOffBlock2",readOnly:"IsOffBlockReadOnly",disabled:"IsOffBlockReadOnly"}},e.time_offblock2_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(t){e.calculateTotalDelay()},bindingOptions:{value:"flightOffBlock2",readOnly:"IsOffBlockReadOnly",disabled:"IsOffBlockReadOnly"}},e.flightOnBlock=null,e.time_onblock={type:"datetime",width:"100%",interval:5,bindingOptions:{value:"flightOnBlock"}},e.flightOnBlock2=null,e.time_onblock2={type:"date",width:"100%",interval:5,bindingOptions:{value:"flightOnBlock2",readOnly:"IsOnBlockReadOnly",disabled:"IsOnBlockReadOnly"}},e.time_onblock2_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(e){},bindingOptions:{value:"flightOnBlock2",readOnly:"IsOnBlockReadOnly",disabled:"IsOnBlockReadOnly"}},e.flightLanding=null,e.landingReadOnly=!1,e.time_landing={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightLanding",min:"flight.STA",readOnly:"landingReadOnly"}},e.flightLanding2=null,e.time_landing2={type:"date",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightLanding2",readOnly:"IsLandingReadOnly",disabled:"IsLandingReadOnly"}},e.time_landing2_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(e){},bindingOptions:{value:"flightLanding2",readOnly:"IsLandingReadOnly",disabled:"IsLandingReadOnly"}},e.time_std={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.STD"}},e.time_sta={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.STA"}},e.time_baseStart={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.baseStartDate"}},e.time_baseEnd={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.baseEndDate"}},e.time_chocksout={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.ChocksOut"}},e.time_chocksin={type:"time",width:"100%",readOnly:!0,bindingOptions:{value:"flight.ChocksIn"}},e.time_landed={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.Landing"}},e.remark_dep={bindingOptions:{value:"flight.DepartureRemark",readOnly:"depReadOnly"}},e.remark_arr={bindingOptions:{value:"flight.ArrivalRemark"}},e.fuel_dep={min:0,bindingOptions:{value:"flight.FuelDeparture",readOnly:"depReadOnly"}},e.fuel_fp={min:0,bindingOptions:{value:"flight.FPFuel",readOnly:"depReadOnly"}},e.fuel_defuel={min:0,bindingOptions:{value:"flight.Defuel",readOnly:"depReadOnly"}},e.fuel_arr={min:0,bindingOptions:{value:"flight.FuelArrival"}},e.paxTotal=0,e.paxOver=0,e.calculateTotalPax=function(){e.paxTotal=0;var t=0;if(e.flight.PaxAdult&&(t+=e.flight.PaxAdult),e.flight.PaxChild&&(t+=e.flight.PaxChild),e.flight.TotalSeat&&t>e.flight.TotalSeat?e.flight.PaxOver=t-e.flight.TotalSeat:e.flight.PaxOver=0,e.flight.TotalPax=t,e.flight.TotalSeat){var i=round2(100*t/(1*e.flight.TotalSeat),2);e.loadPax=i+" %"}},e.total_seats={readOnly:!0,bindingOptions:{value:"flight.TotalSeat"}},e.total_pax={readOnly:!0,bindingOptions:{value:"flight.TotalPax"}},e.loadPax=null,e.load_pax={readOnly:!0,bindingOptions:{value:"loadPax"}},e.pax_adult={readOnly:!1,min:0,showSpinButtons:!0,onValueChanged:function(t){e.calculateTotalPax()},bindingOptions:{value:"flight.PaxAdult",readOnly:"depReadOnly"}},e.pax_child={readOnly:!1,showSpinButtons:!0,min:0,onValueChanged:function(t){e.calculateTotalPax()},bindingOptions:{value:"flight.PaxChild",readOnly:"depReadOnly"}},e.pax_infant={readOnly:!1,showSpinButtons:!0,min:0,onValueChanged:function(t){e.calculateTotalPax()},bindingOptions:{value:"flight.PaxInfant",readOnly:"depReadOnly"}},e.pax_over={readOnly:!1,min:0,bindingOptions:{readOnly:"depReadOnly",value:"flight.PaxOver"}},e.cargo_piece={readOnly:!1,min:0,bindingOptions:{value:"flight.CargoCount",readOnly:"depReadOnly"}},e.cargo_weight={readOnly:!1,min:0,bindingOptions:{value:"flight.CargoWeight",readOnly:"depReadOnly"}},e.cargo_excess={readOnly:!1,min:0,bindingOptions:{readOnly:"depReadOnly"}},e.bag_piece={readOnly:!1,min:0,bindingOptions:{value:"flight.BaggageCount",readOnly:"depReadOnly"}},e.bag_weight={readOnly:!1,min:0,bindingOptions:{value:"flight.BaggageWeight",readOnly:"depReadOnly"}},e.bag_excess={readOnly:!1,min:0,bindingOptions:{readOnly:"depReadOnly"}},e.convertToUTC=function(){var t=-1*(new Date).getTimezoneOffset();t*=-1,e.flight.STA2=new Date(e.flight.STA).addMinutes(t),e.flight.STD2=new Date(e.flight.STD).addMinutes(t),e.flightOffBlock2=new Date(e.flightOffBlock2).addMinutes(t),e.flightTakeOff2=new Date(e.flightTakeOff2).addMinutes(t),e.flightLanding2=new Date(e.flightLanding2).addMinutes(t),e.flightOnBlock2=new Date(e.flightOnBlock2).addMinutes(t),e.time_status_value=new Date(e.time_status_value).addMinutes(t)},e.convertToLCL=function(){var t=-1*(new Date).getTimezoneOffset();e.flight.STA2=new Date(e.flight.STA).addMinutes(t),e.flight.STD2=new Date(e.flight.STD).addMinutes(t),e.flightOffBlock2=new Date(e.flightOffBlock2).addMinutes(t),e.flightTakeOff2=new Date(e.flightTakeOff2).addMinutes(t),e.flightLanding2=new Date(e.flightLanding2).addMinutes(t),e.flightOnBlock2=new Date(e.flightOnBlock2).addMinutes(t),e.time_status_value=new Date(e.time_status_value).addMinutes(t)},e.otimes=null,e.timeBase="LCB",e.sb_timebase={showClearButton:!0,searchEnabled:!0,dataSource:["UTC","LCL","LCB"],onValueChanged:function(t){"UTC"!=t.value||"LCL"!=t.previousValue&&"LCB"!=t.previousValue?"LCL"!=t.value&&"LCB"!=t.value||"UTC"!=t.previousValue||e.convertToLCL():e.convertToUTC()},bindingOptions:{value:"timeBase"}},e.remark_status_height=128,e.remark_status={bindingOptions:{value:"flight.DepartureRemark",height:"remark_status_height"}},e.isTimeStatusVisible=!1,e.time_status_value=null,e.time_status={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"time_status_value"}},e.time_redirect_value=null,e.time_redirect={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"time_redirect_value"}};e.remark_redirect={bindingOptions:{value:"flight.RedirectRemark",height:"82"}},e.time_ramp_value=null,e.time_ramp={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"time_ramp_value"}},e.remark_ramp={bindingOptions:{value:"flight.RampRemark",height:"134"}},e.delayCodeId=21,e.delayCode={Id:21,HH:null,MM:null,Code:null,Title:null,Remark:null,Total:null},e.clearDelayCode=function(){e.delayCode.HH=null,e.delayCode.MM=null,e.delayCode.Remark=null,e.delayCode.Total=null},e.fillDelayCode=function(t){e.delayCode.Id=t.Id,e.delayCode.Code=t.Code,e.delayCode.Title=t.Title},e.txt_delay_remark={width:"100%",bindingOptions:{value:"delayCode.Remark"}},e.num_delayhh={max:99,min:0,width:40,showSpinButtons:!0,bindingOptions:{value:"delayCode.HH"}},e.num_delaymm={max:59,min:0,width:45,showSpinButtons:!0,bindingOptions:{value:"delayCode.MM"}},e.sb_delay={showClearButton:!1,searchEnabled:!0,onSelectionChanged:function(t){t&&t.selectedItem?e.fillDelayCode(t.selectedItem):e.clearDelayCode()},displayExpr:"Title2",valueExpr:"Id",bindingOptions:{value:"delayCodeId",dataSource:"delayCodes"}},e.btn_add_delay={text:"",type:"default",icon:"plus",width:"20",validationGroup:"movdelay",bindingOptions:{},onClick:function(t){if(e.delayCode.HH||(e.delayCode.HH=0),e.delayCode.MM||(e.delayCode.MM=0),0==e.delayCode.HH&&0==e.delayCode.MM)return void General.ShowNotify("Amount is not valid","error");var i=JSON.parse(JSON.stringify(e.delayCode));i.Amount=pad(e.delayCode.HH)+":"+pad(e.delayCode.MM),i.Total=60*e.delayCode.HH+e.delayCode.MM,e.dg_delay_ds.push(i),e.clearDelayCode()}},e.btn_remove_delay={text:"",type:"danger",icon:"close",width:"20",bindingOptions:{},onClick:function(t){if(e.dg_delay_selected=n.getSelectedRow(e.dg_delay_instance),!e.dg_delay_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=Enumerable.From(e.dg_delay_ds).Where("$.Id!="+e.dg_delay_selected.Id).ToArray();e.dg_delay_ds=i}},e.IsOffBlockReadOnly=!1,e.IsTakeOffReadOnly=!1,e.IsLandingReadOnly=!1,e.IsOnBlockReadOnly=!1,e.isRedirectReasonVisible=!0,e.isRampReasonVisible=!0,e.sb_status={showClearButton:!1,searchEnabled:!0,dataSource:Enumerable.From(Flight.statusDataSource).Where("$.selectable").ToArray(),onSelectionChanged:function(t){t&&t.selectedItem&&(t.selectedItem.bgcolor,t.selectedItem.color),e.remark_status_height=128,e.isTimeStatusVisible=!1,e.isCancelReasonVisible=!1,4==t.selectedItem.id&&(e.isCancelReasonVisible=!0,e.remark_status_height=74,e.isTimeStatusVisible=!0,e.time_status_value=e.flight.CancelDate?new Date(e.flight.CancelDate):null),9==t.selectedItem.id&&(e.remark_status_height=74,e.isTimeStatusVisible=!0,e.time_status_value=e.flight.RampDate?new Date(e.flight.RampDate):null),17==t.selectedItem.id&&(e.remark_status_height=40)},displayExpr:"title",valueExpr:"id",bindingOptions:{value:"flight.FlightStatusID"}},e.sb_flighttype={readOnly:!0,showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.FlightTypeID"}},e.sb_massunit={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(110),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.CargoUnitID",readOnly:"depReadOnly"}},e.sb_volumeunit={showClearButton:!0,searchEnabled:!1,dataSource:n.getDatasourceOption(113),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.FuelUnitID",text:"flight.FuelUnit",readOnly:"depReadOnly"}},e.sb_volumeunit2={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(113),displayExpr:"Title",valueExpr:"Id",readOnly:!0,bindingOptions:{value:"flight.FuelUnitID"}},e.entity_cancel={UserId:null,FlightId:null,CancelReasonId:null,CancelRemark:null,CancelDate:null},e.cleat_entity_cancel=function(){e.entity_cancel.UserId=null,e.entity_cancel.FlightId=null,e.entity_cancel.CancelReasonId=null,e.entity_cancel.CancelRemark=null,e.entity_cancel.CancelDate=null},e.entity_redirect={UserId:null,FlightId:null,RedirectReasonId:null,RedirectRemark:null,RedirectDate:null,AirportId:null,STA:null,OAirportIATA:null,AirportIATA:null,Airport:null},e.clear_entity_redirect=function(){e.entity_redirect.UserId=null,e.entity_redirect.FlightId=null,e.entity_redirect.RedirectReasonId=null,e.entity_redirect.RedirectRemark=null,e.entity_redirect.RedirectDate=null,e.entity_redirect.AirportId=null,e.entity_redirect.Airport=null,e.entity_redirect.STA=null},e.isCancelReasonVisible=!1,e.sb_cancel_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1136),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.CancelReasonId"}},e.sb_redirect_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1147),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.RedirectReasonId"}},e.sb_ramp_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1136),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.RampReasonId"}},e.num_fphh={max:99,min:0,width:50,showSpinButtons:!0,bindingOptions:{value:"flight.FPFlightHH"}},e.num_fpmm={max:59,min:0,width:50,showSpinButtons:!0,bindingOptions:{value:"flight.FPFlightMM"}},e.num_totaldelayhh={max:99,min:0,width:45,showSpinButtons:!1,readOnly:!0,bindingOptions:{value:"flight.TotalDelayHH"}},e.num_totaldelayhhmm={max:59,min:0,width:45,showSpinButtons:!1,readOnly:!0,bindingOptions:{value:"flight.TotalDelayMM"}},e._time_redirect={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entity_redirect.RedirectDate"}},e.txt_cancel_remark={bindingOptions:{value:"entity_cancel.CancelRemark"}},e.txt_redirect_remark={bindingOptions:{value:"entity_redirect.RedirectRemark"}},e.txt_charterer={readOnly:!0,bindingOptions:{}},e.time_redirect_sta={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"entity_redirect.STA",min:"flight.Takeoff"}},e.sb_redirect_airport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceAirport(),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(e){},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity_redirect.AirportId",selectedItem:"entity_redirect.Airport"}},e.moment=function(e){return moment(e).format("MMMM Do YYYY")},e.momenttime=function(e){return e?moment(e).format("HH:mm"):"--"},e.setStatus=function(t,i){var n=Enumerable.From(Flight.statusDataSource).Where("$.id=="+i).FirstOrDefault();t.status=i,e.flight.FlightStatusID=i,t.FlightStatus=n.title},e.getStatusClass=function(e){return"col-lg-2 col-md-3 col-sm-3 col-xs-3 font-inherit "+Enumerable.From(Flight.statusDataSource).Where("$.id=="+e.status).FirstOrDefault().class},e.popup_inf_visible=!1,e.popup_inf_title="Flight Information",e.popup_inf={elementAttr:{class:"popup_inf"},shading:!1,position:{my:"left",at:"left",of:window,offset:"5 0"},width:450,height:function(){return.95*$(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){$(e.titleElement).css("background-color","#f2552c")},onShowing:function(t){e.setWeather()},onShown:function(e){},onHiding:function(){e.popup_inf_visible=!1},bindingOptions:{visible:"popup_inf_visible",title:"popup_inf_title"}},e.popup_inf.toolbarItems[0].options.onClick=function(t){e.popup_inf_visible=!1},e.scroll_1={scrollByContent:!0,scrollByThumb:!0,height:function(){return $(window).height()-120}},e.scroll2_height=300,e.scroll_2={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll2_height"}},e.scroll_dep={scrollByContent:!0,scrollByThumb:!0,height:497},e.scroll_arr={scrollByContent:!0,scrollByThumb:!0,height:497};var m=[{text:"Main",id:"departure",visible:!0},{text:"Delays",id:"delays",visible:!0}],w=[{text:"Main",id:"arrival",visible:!0},{text:"Departure",id:"depparr",visible:!0}];e.tabs=m,e.selectedTabIndex=-1,e.$watch("selectedTabIndex",function(t){try{e.selectedTab=m[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_instance.repaint()}catch(e){}}),e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex"}},e.tabs2=w,e.selectedTabIndex2=-1,e.$watch("selectedTabIndex2",function(t){try{e.selectedTab2=w[t],$(".tab").hide(),$("."+e.selectedTab2.id).fadeIn(100,function(){}),e.dg2_instance.repaint()}catch(e){}}),e.tabs2_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs2",deep:!0},selectedIndex:"selectedTabIndex2"}},e.popup_arr_visible=!1,e.popup_arr_title="Arrival",e.popup_arr={elementAttr:{class:"popup_arr"},shading:!0,width:1200,height:647,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacarr",bindingOptions:{disabled:"IsApproved"},visible:!1,onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightLanding2)<new Date(e.flight.STA))return void General.ShowNotify(Config.Text_Landing,"error");if(e.flightOnBlock2&&new Date(e.flightOnBlock2)<new Date(e.flightLanding2))return void General.ShowNotify(Config.Text_OnBlock,"error");var i={StatusLog:[]},o=$("#resourceGanttba").data("ejGantt");e.flight.Landing=e.flightLanding2,i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:3,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.flightOnBlock2?(e.flight.ChocksIn=e.flightOnBlock2,Flight.calculateDelayLandingOnBlock(e.flight),e.setStatus(e.flight,15)):e.setStatus(e.flight,3),e.fillDto(i),e.fillArrival(i),e.loadingVisible=!0,a.saveFlightArr(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),o.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_arr_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.flightOnBlock2=e.flight.ChocksIn,e.flightLanding2=e.flight.Landing,e.flightOffBlock2=e.flight.ChocksOut,e.flightTakeOff2=e.flight.Takeoff,e.depReadOnly=!0,e.selectedTabIndex2=0,e.setWeather()},onShown:function(t){e.flight.delays?e.dg2_ds=e.flight.delays:(e.loadingVisible=!0,a.getFlightDelayCodes(e.flight.ID).then(function(t){e.loadingVisible=!1,e.flight.delays=t,e.dg2_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},onHiding:function(){e.selectedTabIndex2=-1,e.popup_arr_visible=!1},bindingOptions:{visible:"popup_arr_visible",title:"popup_arr_title"}},e.popup_arr.toolbarItems[1].options.onClick=function(t){e.popup_arr_visible=!1},e.popup_fueldep_visible=!1,e.popup_fueldep_title="Departure Fuel",e.fuelDepInit={},e.popup_fueldep={elementAttr:{class:"popup_fueldep"},shading:!0,width:400,height:200,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacfueldep",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={ID:e.flight.ID,FuelDeparture:e.flight.FuelDeparture,FuelUnitID:e.flight.FuelUnitID};e.loadingVisible=!0,a.saveFlightFuelDeparture(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.fuelDepSaved=!0,e.loadingVisible=!1,e.popup_fueldep_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.fuelDepInit.FuelUnitID=e.flight.FuelUnitID,e.fuelDepInit.FuelDeparture=e.flight.FuelDeparture},onShown:function(e){},onHiding:function(){e.fuelDepSaved||(e.flight.FuelDeparture=e.fuelDepInit.FuelDeparture,e.flight.FuelUnitID=e.fuelDepInit.FuelUnitID),e.popup_fueldep_visible=!1},bindingOptions:{visible:"popup_fueldep_visible",title:"popup_fueldep_title"}},e.popup_fueldep.toolbarItems[1].options.onClick=function(t){e.popup_fueldep_visible=!1},e.popup_fuelarr_visible=!1,e.popup_fuelarr_title="Arrival Fuel",e.fuelArrInit={},e.popup_fuelarr={elementAttr:{class:"popup_fuelarr"},shading:!0,width:400,height:200,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacfuelarr",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={ID:e.flight.ID,FuelArrival:e.flight.FuelArrival};e.loadingVisible=!0,a.saveFlightFuelArrival(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.fuelArrSaved=!0,e.loadingVisible=!1,e.popup_fuelarr_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.fuelArrInit.FuelArrival=e.flight.FuelArrival},onShown:function(e){},onHiding:function(){e.fuelArrSaved||(e.flight.FuelArrival=e.fuelArrInit.FuelArrival),e.popup_fuelarr_visible=!1},bindingOptions:{visible:"popup_fuelarr_visible",title:"popup_fuelarr_title"}},e.popup_fuelarr.toolbarItems[1].options.onClick=function(t){e.popup_fuelarr_visible=!1},e.popup_pax_visible=!1,e.popup_pax_title="Pax",e.paxSaved=!1,e.paxInit={},e.popup_pax={elementAttr:{class:"popup_pax"},shading:!0,width:400,height:290,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacpax",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={ID:e.flight.ID,PaxAdult:e.flight.PaxAdult,PaxChild:e.flight.PaxChild,PaxInfant:e.flight.PaxInfant};e.loadingVisible=!0,a.saveFlightPax(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.paxSaved=!0,e.loadingVisible=!1,e.popup_pax_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.paxInit.PaxAdult=e.flight.PaxAdult,e.paxInit.PaxChild=e.flight.PaxChild,e.paxInit.PaxInfant=e.flight.PaxInfant},onShown:function(e){},onHiding:function(){e.paxSaved||(e.flight.PaxAdult=e.paxInit.PaxAdult,e.flight.PaxChild=e.paxInit.PaxChild,e.flight.PaxInfant=e.paxInit.PaxInfant,e.calculateTotalPax()),e.popup_pax_visible=!1},bindingOptions:{visible:"popup_pax_visible",title:"popup_pax_title"}},e.popup_pax.toolbarItems[1].options.onClick=function(t){e.popup_pax_visible=!1},e.popup_link_visible=!1,e.popup_link_title="Linked Flight",e.popup_link={elementAttr:{class:"popup_link"},shading:!0,height:490,width:700,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fblink",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i=new Date(e.time_ir_std_date).getDatePartArray(),n=new Date(e.time_ir_std_time).getTimePartArray(),o=new Date(i[0],i[1],i[2],n[0],n[1],0,0),l=new Date(e.time_ir_sta_date).getDatePartArray(),r=new Date(e.time_ir_sta_time).getTimePartArray(),d=new Date(l[0],l[1],l[2],r[0],r[1],0,0),s=JSON.parse(JSON.stringify(e.linkEntity));s.FlightStatusID=1,s.STD=new Date(o).toUTCString(),s.STA=new Date(d).toUTCString(),s.LinkedReason=1133,e.loadingVisible=!0,a.saveFlight(s).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.popup_link_visible=!1,e.BeginSearch()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(e){},onShown:function(e){},onHiding:function(){e.linkEntity.ToAirportId=null,e.linkEntity.FromAirportId=null,e.time_ir_std_date=null,e.time_ir_std_time=null,e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.linkEntity=null,e.popup_link_visible=!1},bindingOptions:{visible:"popup_link_visible",title:"popup_link_title"}},e.popup_link.toolbarItems[1].options.onClick=function(t){e.popup_link_visible=!1},e.popup_free_visible=!1,e.popup_free_title="Nonscheduled Flight",e.freeSaved=!1,e.popup_free={elementAttr:{class:"popup_free"},shading:!0,height:350,width:750,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fblink",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i=new Date(e.time_ir_std_date).getDatePartArray(),n=new Date(e.time_ir_std_time).getTimePartArray(),o=new Date(i[0],i[1],i[2],n[0],n[1],0,0),l=new Date(e.time_ir_sta_date).getDatePartArray(),r=new Date(e.time_ir_sta_time).getTimePartArray(),d=new Date(l[0],l[1],l[2],r[0],r[1],0,0),s=JSON.parse(JSON.stringify(e.linkEntity));s.FlightStatusID=1,s.STD=new Date(o).toUTCString(),s.STA=new Date(d).toUTCString(),e.loadingVisible=!0,a.saveFlight(s).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.linkEntity.FlightNumber=null,e.linkEntity.FromAirportId=e.linkEntity.ToAirportId,e.linkEntity.ToAirportId=null,e.linkEntity.FlightH=null,e.linkEntity.FlightM=null,e.time_ir_std_date=General.getDayFirstHour(new Date(e.time_ir_sta_date)),e.time_ir_std_time=new Date(e.time_ir_sta_time).addMinutes(60),e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.loadingVisible=!1,e.freeSaved=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,
onTitleRendered:function(e){},onShowing:function(e){},onShown:function(e){},onHiding:function(){e.freeSaved&&e.BeginSearch(),e.freeSaved=!1,e.linkEntity.ToAirportId=null,e.linkEntity.FromAirportId=null,e.time_ir_std_date=null,e.time_ir_std_time=null,e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.linkEntity=null,e.popup_free_visible=!1},bindingOptions:{visible:"popup_free_visible",title:"popup_free_title"}},e.popup_free.toolbarItems[1].options.onClick=function(t){e.popup_free_visible=!1},e.popup_cargo_visible=!1,e.popup_cargo_title="Cargo/Baggage",e.cargoSaved=!1,e.cargoInit={},e.popup_cargo={elementAttr:{class:"popup_cargo"},shading:!0,width:400,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaccargo",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={ID:e.flight.ID,CargoUnitID:e.flight.CargoUnitID,CargoWeight:e.flight.CargoWeight,CargoCount:e.flight.CargoCount,BaggageWeight:e.flight.BaggageWeight,BaggageCount:e.flight.BaggageCount};e.loadingVisible=!0,a.saveFlightCargo(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.cargoSaved=!0,e.loadingVisible=!1,e.popup_cargo_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.cargoInit.CargoUnitID=e.flight.CargoUnitID,e.cargoInit.CargoWeight=e.flight.CargoWeight,e.cargoInit.CargoCount=e.flight.CargoCount,e.cargoInit.BaggageWeight=e.flight.BaggageWeight,e.cargoInit.BaggageCount=e.flight.BaggageCount},onShown:function(e){},onHiding:function(){e.cargoSaved||(e.flight.CargoUnitID=e.cargoInit.CargoUnitID,e.flight.CargoWeight=e.cargoInit.CargoWeight,e.flight.CargoCount=e.cargoInit.CargoCount,e.flight.BaggageWeight=e.cargoInit.BaggageWeight,e.flight.BaggageCount=e.cargoInit.BaggageCount),e.popup_cargo_visible=!1},bindingOptions:{visible:"popup_cargo_visible",title:"popup_cargo_title"}},e.popup_cargo.toolbarItems[1].options.onClick=function(t){e.popup_cargo_visible=!1},e.fillDto=function(t){t.ID=e.flight.ID,t.UserId=n.userId,t.FlightStatusID=e.flight.FlightStatusID,t.Delays=[];var i=Enumerable.From(e.dg_delay_ds).ToArray();$.each(i,function(i,a){console.log(a),97==a.Id&&(e.flight.notes=97),t.Delays.push({FlightId:e.flight.ID,DelayCodeId:a.Id,HH:a.HH,MM:a.MM,Remark:a.Remark,UserId:n.userId})})},e.fillLog=function(t){e.flight.ChocksOut&&(t.ChocksOut=new Date(e.flight.ChocksOut).toUTCString()),e.flight.Takeoff&&(t.Takeoff=new Date(e.flight.Takeoff).toUTCString()),t.DepartureRemark=e.flight.DepartureRemark,t.GWTO=e.flight.GWTO,t.FuelDeparture=e.flight.FuelDeparture,t.PaxAdult=e.flight.PaxAdult,t.PaxInfant=e.flight.PaxInfant,t.PaxChild=e.flight.PaxChild,t.CargoWeight=e.flight.CargoWeight,t.CargoUnitID=e.flight.CargoUnitID,t.BaggageCount=e.flight.BaggageCount,t.CargoCount=e.flight.CargoCount,t.BaggageWeight=e.flight.BaggageWeight,t.FuelUnitID=e.flight.FuelUnitID,t.FPFlightHH=e.flight.FPFlightHH,t.FPFlightMM=e.flight.FPFlightMM,t.FPFuel=e.flight.FPFuel,t.Defuel=e.flight.Defuel,e.flight.Landing&&(t.Landing=new Date(e.flight.Landing).toUTCString()),e.flight.ChocksIn&&(t.ChocksIn=new Date(e.flight.ChocksIn).toUTCString()),t.BlockH=e.flight.BlockH,t.BlockM=e.flight.BlockM,t.GWLand=e.flight.GWLand,t.FuelArrival=e.flight.FuelArrival,t.ArrivalRemark=e.flight.ArrivalRemark,9==e.flight.FlightStatusID&&(e.flight.RampDate=new Date(e.time_status_value).toUTCString(),t.RampDate=new Date(e.time_status_value).toUTCString(),t.RampReasonId=e.flight.RampReasonId),e.flight.RedirectReasonId&&(e.flight.RedirectDate=new Date(e.time_redirect_value).toUTCString(),t.RedirectDate=new Date(e.time_redirect_value).toUTCString(),e.flight.ToAirportId=e.entity_redirect.Airport.Id,e.flight.ToAirport=e.entity_redirect.Airport.Id,t.ToAirportId=e.entity_redirect.Airport.Id,e.flight.OToAirportIATA||(e.flight.OToAirportIATA=e.flight.ToAirportIATA),e.flight.ToAirportIATA=e.entity_redirect.Airport.IATA,t.RedirectReasonId=e.flight.RedirectReasonId,t.RedirectRemark=e.flight.RedirectRemark),4==e.flight.FlightStatusID&&(e.flight.CancelDate=new Date(e.time_status_value).toUTCString(),t.CancelDate=new Date(e.time_status_value).toUTCString(),t.CancelReasonId=e.flight.CancelReasonId),t.EstimatedDelays=[]},e.fillDeparture=function(t){t.ChocksOut=new Date(e.flight.ChocksOut).toUTCString(),e.flight.Takeoff&&(t.Takeoff=new Date(e.flight.Takeoff).toUTCString()),t.DepartureRemark=e.flight.DepartureRemark,t.GWTO=e.flight.GWTO,t.FuelDeparture=e.flight.FuelDeparture,t.PaxAdult=e.flight.PaxAdult,t.PaxInfant=e.flight.PaxInfant,t.PaxChild=e.flight.PaxChild,t.CargoWeight=e.flight.CargoWeight,t.CargoUnitID=e.flight.CargoUnitID,t.BaggageCount=e.flight.BaggageCount,t.CargoCount=e.flight.CargoCount,t.BaggageWeight=e.flight.BaggageWeight,t.FuelUnitID=e.flight.FuelUnitID,t.EstimatedDelays=[];var i=Enumerable.From(e.dataSource).Where("$.EstimatedDelayChanged && $.EstimatedDelayChanged==true && $.EstimatedDelay>0 && $.status==1 && $.startDate.getDatePart()=="+e.flight.startDate.getDatePart()+" && $.startDate.getTime() > "+e.flight.startDate.getTime()+"  && $.RegisterID=="+e.flight.RegisterID).OrderBy("$.startDate").ToArray();$.each(i,function(e,i){t.EstimatedDelays.push({FlightId:i.ID,Delay:Math.floor(i.EstimatedDelay)})})},e.fillArrival=function(t){t.Landing=new Date(e.flight.Landing).toUTCString(),e.flight.ChocksIn&&(t.ChocksIn=new Date(e.flight.ChocksIn).toUTCString()),t.BlockH=e.flight.BlockH,t.BlockM=e.flight.BlockM,t.GWLand=e.flight.GWLand,t.FuelArrival=e.flight.FuelArrival,t.ArrivalRemark=e.flight.ArrivalRemark},e.popup_flight_visible=!1,e.popup_flight_title="Departure",e.popup_flight={elementAttr:{class:"popup_flight"},shading:!0,width:1200,height:647,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacflight",bindingOptions:{disabled:"IsApproved"},visible:!0,onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightOffBlock2)<new Date(e.flight.STD))return void General.ShowNotify(Config.Text_OffBlock,"error");if(e.flightTakeOff2&&new Date(e.flightTakeOff2)<new Date(e.flightOffBlock2))return void General.ShowNotify(Config.Text_TakeOff,"error");var i={StatusLog:[]},o=$("#resourceGanttba").data("ejGantt"),l=!e.flight.ChocksOut&&e.flightOffBlock2||new Date(e.flight.ChocksOut).getTime()!=new Date(e.flightOffBlock2).getTime();e.flight.ChocksOut=e.flightOffBlock2,Flight.calculateDelayOffBlock(e.flight),l&&e.applyNextFlight&&Flight.calculateNextTaskDelayOffBlock(e.flight,e.dataSource,o),i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:14,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.flightTakeOff2?(e.flight.Takeoff=e.flightTakeOff2,4!=e.flight.FlightStatusID&&e.setStatus(e.flight,2),i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:2,Date:new Date(Date.now()).toUTCString(),UserId:n.userId})):4!=e.flight.FlightStatusID&&e.setStatus(e.flight,14),e.fillDto(i),e.fillDeparture(i),e.loadingVisible=!0,a.saveFlightDep(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),o.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_flight_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.flight.ChocksOut?e.flightOffBlock2=e.flight.ChocksOut:e.flightOffBlock2=Flight.getEstimatedOffBlock(e.flight),e.flightTakeOff2=e.flight.Takeoff,e.depReadOnly=!1,e.selectedTabIndex=0,e.setWeather()},onShown:function(t){e.flight.delays?e.dg_ds=e.flight.delays:(e.loadingVisible=!0,a.getFlightDelayCodes(e.flight.ID).then(function(t){e.loadingVisible=!1,e.flight.delays=t,e.dg_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},onHiding:function(){e.selectedTabIndex=-1,e.popup_flight_visible=!1},bindingOptions:{visible:"popup_flight_visible",title:"popup_flight_title"}},e.popup_flight.toolbarItems[1].options.onClick=function(t){e.popup_flight_visible=!1},e.popup_log_visible=!1,e.popup_log_title="Log",e.popup_log={elementAttr:{class:"popup_log"},shading:!0,width:1520,height:687,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_log_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.flight.ChocksOut&&(e.flightOffBlock2=e.flight.ChocksOut),e.flightOffBlock2||(e.flightOffBlock2=e.flight.STD),e.flightTakeOff2=e.flight.Takeoff,e.flightTakeOff2||(e.flightTakeOff2=e.flight.STD),e.flightOnBlock2=e.flight.ChocksIn,e.flightOnBlock2||(e.flightOnBlock2=e.flight.STA),e.flightLanding2=e.flight.Landing,e.flightLanding2||(e.flightLanding2=e.flight.STA),4==e.flight.FlightStatusID?e.time_status_value=new Date(e.flight.CancelDate):9==e.flight.FlightStatusID&&(e.time_status_value=new Date(e.flight.RampDate)),e.flight.RedirectReasonId&&(e.time_redirect_value=new Date(e.flight.RedirectDate),e.entity_redirect.AirportId=e.flight.ToAirport),e.depReadOnly=!1},onShown:function(t){e.loadingVisible=!0,a.getFlightDelays(e.flight.ID).then(function(t){e.loadingVisible=!1,$.each(t,function(t,i){var n={Id:i.DelayCodeId,HH:i.DelayHH?i.DelayHH:0,MM:i.DelayMM?i.DelayMM:0,Code:i.Code,Title:i.Title,Remark:i.Remark,Total:null};n.Total=60*n.HH+n.MM,n.Amount=pad(n.HH.toString())+":"+pad(n.MM.toString()),e.dg_delay_ds.push(n)}),e.getCrewAbs(e.flight.ID)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},onHiding:function(){e.before_refreshed_flight&&(e.undoRefresh(),e.before_refreshed_flight=null),e.timeBase="LCL",e.dg_delay_ds=[],e.flightTakeOff2=null,e.flightOnBlock2=null,e.flightOffBlock2=null,e.flightLanding2=null,e.time_status_value=null,e.entity_redirect.ToAirportId=null,e.popup_log_visible=!1},bindingOptions:{visible:"popup_log_visible",title:"popup_log_title"}},e.popup_xlog_visible=!1,e.popup_xlog_title="Log",e.popup_xlog={elementAttr:{class:"popup_xlog"},shading:!0,width:1520,height:687,fullScreen:!0,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_xlog_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.flight.ChocksOut&&(e.flightOffBlock2=e.flight.ChocksOut),e.flightOffBlock2||(e.flightOffBlock2=e.flight.STD),e.flightTakeOff2=e.flight.Takeoff,e.flightTakeOff2||(e.flightTakeOff2=e.flight.STD),e.flightOnBlock2=e.flight.ChocksIn,e.flightOnBlock2||(e.flightOnBlock2=e.flight.STA),e.flightLanding2=e.flight.Landing,e.flightLanding2||(e.flightLanding2=e.flight.STA),4==e.flight.FlightStatusID?e.time_status_value=new Date(e.flight.CancelDate):9==e.flight.FlightStatusID&&(e.time_status_value=new Date(e.flight.RampDate)),e.flight.RedirectReasonId&&(e.time_redirect_value=new Date(e.flight.RedirectDate),e.entity_redirect.AirportId=e.flight.ToAirport),e.depReadOnly=!1},onShown:function(t){e.loadingVisible=!0,a.getFlightDelays(e.flight.ID).then(function(t){e.loadingVisible=!1,$.each(t,function(t,i){var n={Id:i.DelayCodeId,HH:i.DelayHH?i.DelayHH:0,MM:i.DelayMM?i.DelayMM:0,Code:i.Code,Title:i.Title,Remark:i.Remark,Total:null};n.Total=60*n.HH+n.MM,n.Amount=pad(n.HH.toString())+":"+pad(n.MM.toString()),e.dg_delay_ds.push(n)}),e.getCrewAbs(e.flight.ID)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},onHiding:function(){e.before_refreshed_flight&&(e.undoRefresh(),e.before_refreshed_flight=null),e.timeBase="LCL",e.dg_delay_ds=[],e.flightTakeOff2=null,e.flightOnBlock2=null,e.flightOffBlock2=null,e.flightLanding2=null,e.time_status_value=null,e.entity_redirect.ToAirportId=null,e.popup_xlog_visible=!1},bindingOptions:{visible:"popup_xlog_visible",title:"popup_xlog_title"}},e.popup_takeoff_visible=!1,e.popup_takeoff_title="Take Off",e.popup_takeoff={width:400,height:400,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbactakeoff",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightTakeOff)<new Date(e.flight.ChocksOut))return void General.ShowNotify(Config.Text_TakeOff,"error");var i=$("#resourceGanttba").data("ejGantt");e.flight.Takeoff=e.flightTakeOff,e.setStatus(e.flight,2);var o={Takeoff:new Date(e.flight.Takeoff).toUTCString(),StatusLog:[],EstimatedDelays:[]};o.ID=e.flight.ID,o.UserId=n.userId,o.FlightStatusID=e.flight.FlightStatusID,o.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:2,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.loadingVisible=!0,a.saveFlightTakeOff(o).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_takeoff_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_takeoff_visible=!1},bindingOptions:{visible:"popup_takeoff_visible",title:"popup_takeoff_title"}},e.popup_takeoff.toolbarItems[1].options.onClick=function(t){e.popup_takeoff_visible=!1},e.dg_selected=null,e.dg_columns=[{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Selected",caption:"",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!0,width:90,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!0,fixedPosition:"left"},{dataField:"MM",caption:"Minute(s)",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!0,width:90},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_height=100,e.dg_instance=null,e.dg_ds=null,e.dg={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},onEditingStart:function(e){"MM"!=e.column.dataField||e.key.Selected||(e.cancel=!0)},onRowUpdating:function(e){e.newData.hasOwnProperty("Selected")&&(e.newData.Selected||(e.newData.HH=null,e.newData.MM=null))},onRowUpdated:function(e){},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},height:497,summary:{totalItems:[{column:"MM",summaryType:"sum"}]},bindingOptions:{dataSource:"dg_ds"}},e.dg2_selected=null,e.dg2_columns=[{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Selected",caption:"",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!0,width:90,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!0,fixedPosition:"left"},{dataField:"MM",caption:"Minute(s)",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!0,width:90},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg2_height=100,e.dg2_instance=null,e.dg2_ds=null,e.dg2={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},onEditingStart:function(e){"MM"!=e.column.dataField||e.key.Selected||(e.cancel=!0)},onRowUpdating:function(e){e.newData.hasOwnProperty("Selected")&&(e.newData.Selected||(e.newData.HH=null,e.newData.MM=null))},onRowUpdated:function(e){},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg2_columns,onContentReady:function(t){e.dg2_instance||(e.dg2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg2_selected=i||null},height:330,summary:{totalItems:[{column:"MM",summaryType:"sum"}]},bindingOptions:{dataSource:"dg2_ds"}},e.dg_crew_abs_columns=[{caption:"Crew",columns:[{dataField:"IsPositioning",caption:"DH",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:60},{dataField:"Position",caption:"Pos.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90,fixed:!0,fixedPosition:"left"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}]}],e.dg_crew_abs_selected=null,e.dg_crew_abs_instance=null,e.dg_crew_abs_ds=null,e.dg_crew_abs={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:274,columns:e.dg_crew_abs_columns,onContentReady:function(t){e.dg_crew_abs_instance||(e.dg_crew_abs_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew_abs_selected=i||null},onRowPrepared:function(e){e.data&&e.data.IsPositioning&&e.rowElement.css("background","#ffccff")},bindingOptions:{dataSource:"dg_crew_abs_ds"}},e.dg_crew_abs2_columns=[{caption:"Crew",columns:[{dataField:"Position",caption:"Pos.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"left"},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90,fixed:!0,fixedPosition:"left"},{dataField:"ScName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"left"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}]}],e.dg_crew_abs2_selected=null,e.dg_crew_abs2_instance=null,e.dg_crew_abs2_ds=null,e.dg_crew_abs2={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:200,columns:e.dg_crew_abs2_columns,onContentReady:function(t){e.dg_crew_abs2_instance||(e.dg_crew_abs2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?e.dg_crew_abs_selected=i:e.dg_crew_abs2_selected=null},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_crew_abs2_ds"}},e.dg_delay_selected=null,e.dg_delay_columns=[{caption:"Delay",columns:[{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",width:70,dataType:"string",allowEditing:!1},{dataField:"Remark",caption:"Remark",allowResizing:!0,dataType:"string",allowEditing:!1},{dataField:"Amount",caption:"Amount",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!0,width:80}]}],e.dg_delay_height=100,e.dg_delay_instance=null,e.dg_delay_ds=[],e.dg_delay={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_delay_columns,onContentReady:function(t){e.dg_delay_instance||(e.dg_delay_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_delay_selected=i||null},height:210,summary:{totalItems:[{name:"TotalDelay",showInColumn:"Amount",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"TotalDelay"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.Total,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_delay_ds"}},e.dg_upd_selected=null,e.dg_upd_columns=[{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"DateStatus",caption:"Date",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,format:"yyyy-MMM-dd, HH:mm",sortIndex:0,sortOrder:"asc"}],e.dg_upd_height=100,e.dg_upd_instance=null,e.dg_upd={editing:{allowUpdating:!1,mode:"cell"},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_upd_columns,onContentReady:function(t){e.dg_upd_instance||(e.dg_upd_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_upd_selected=i||null},height:"100%",bindingOptions:{dataSource:"updatedFlights"}},e.popup_upd_visible=!1,e.popup_upd_title="Updated Flights",e.popup_upd={elementAttr:{class:"popup_upd"},shading:!1,position:{my:"left",at:"left",of:window,offset:"5 5"},width:500,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Flight",icon:"arrowright",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(e.dg_upd_selected){var i=Enumerable.From(e.dataSource).Where("$.ID=="+e.dg_upd_selected.ID).FirstOrDefault();i&&(e.scrollGantt(i),e.scrollGrid(i))}}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){$(e.titleElement).css("background-color","#8BC34A")},onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_upd_visible=!1},bindingOptions:{visible:"popup_upd_visible",title:"popup_upd_title"}},e.popup_upd.toolbarItems[1].options.onClick=function(t){e.popup_upd_visible=!1},e.popup_offblock_visible=!1,e.popup_offblock_title="Off Block",e.popup_offblock={shading:!0,width:380,height:"380",fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacoffblock",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightOffBlock)<new Date(e.flight.STD))return void General.ShowNotify(Config.Text_OffBlock,"error");var i=$("#resourceGanttba").data("ejGantt"),o=!e.flight.ChocksOut&&e.flightOffBlock||new Date(e.flight.ChocksOut).getTime()!=new Date(e.flightOffBlock).getTime();e.flight.ChocksOut=e.flightOffBlock,Flight.calculateDelayOffBlock(e.flight),o&&e.applyNextFlight&&Flight.calculateNextTaskDelayOffBlock(e.flight,e.dataSource,i),e.setStatus(e.flight,14);var l={ChocksOut:new Date(e.flight.ChocksOut).toUTCString(),StatusLog:[],EstimatedDelays:[]};l.ID=e.flight.ID,l.UserId=n.userId,l.FlightStatusID=e.flight.FlightStatusID,l.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:14,Date:new Date(Date.now()).toUTCString(),UserId:n.userId});var r=Enumerable.From(e.dataSource).Where("$.EstimatedDelayChanged && $.EstimatedDelayChanged==true && $.EstimatedDelay>0 && $.status==1 && $.startDate.getDatePart()=="+e.flight.startDate.getDatePart()+" && $.startDate.getTime() > "+e.flight.startDate.getTime()+"  && $.RegisterID=="+e.flight.RegisterID).OrderBy("$.startDate").ToArray();$.each(r,function(e,t){l.EstimatedDelays.push({FlightId:t.ID,Delay:Math.floor(t.EstimatedDelay)})}),e.loadingVisible=!0,a.saveFlightOffBlock(l).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_offblock_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_offblock_visible=!1},bindingOptions:{visible:"popup_offblock_visible",title:"popup_offblock_title"}},e.popup_offblock.toolbarItems[1].options.onClick=function(t){e.popup_offblock_visible=!1},e.popup_landing_visible=!1,e.popup_landing_title="Take Off",e.popup_landing={width:400,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaclanding",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightLanding)<new Date(e.flight.STA))return void General.ShowNotify(Config.Text_Landing,"error");var i=$("#resourceGanttba").data("ejGantt");17!=e.flight.status?e.setStatus(e.flight,3):e.setStatus(e.flight,7),e.flight.Landing=e.flightLanding;var o={StatusLog:[]};o.ID=e.flight.ID,o.UserId=n.userId,o.Landing=new Date(e.flight.Landing).toUTCString(),o.FlightStatusID=e.flight.FlightStatusID,o.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:3,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.loadingVisible=!0,a.saveFlightLanding(o).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_landing_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_landing_visible=!1},bindingOptions:{visible:"popup_landing_visible",title:"popup_landing_title"}},e.popup_landing.toolbarItems[1].options.onClick=function(t){e.popup_landing_visible=!1},e.popup_onblock_visible=!1,e.popup_onblock_title="Off Block",e.popup_onblock={width:400,height:270,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaconblock",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(e.flightOnBlock&&new Date(e.flightOnBlock)<new Date(e.flight.Landing))return void General.ShowNotify(Config.Text_OnBlock,"error");var i={StatusLog:[]};$("#resourceGanttba").data("ejGantt");17!=e.flight.status&&7!=e.flight.status?e.setStatus(e.flight,15):e.setStatus(e.flight,7),e.flight.ChocksIn=e.flightOnBlock,i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:15,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),i.ID=e.flight.ID,i.UserId=n.userId,i.ChocksIn=new Date(e.flight.ChocksIn).toUTCString(),i.FlightStatusID=e.flight.FlightStatusID,e.loadingVisible=!0,a.saveFlightOnBlock(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.popup_onblock_visible=!1,e.bindFlights(!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_onblock_visible=!1},bindingOptions:{visible:"popup_onblock_visible",title:"popup_onblock_title"}},e.popup_onblock.toolbarItems[1].options.onClick=function(t){e.popup_onblock_visible=!1},e.popup_cancel_visible=!1,e.popup_cancel_title="Cancel",e.popup_cancel={shading:!0,width:360,height:"380",fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaccancel",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.entity_cancel.Date=new Date(Date.now()).toUTCString(),e.entity_cancel.CancelDate=new Date(e.entity_cancel.CancelDate).toUTCString(),e.entity_cancel.UserId=n.userId,e.entity_cancel.FlightId=e.flight.ID;var i=$("#resourceGanttba").data("ejGantt");return e.setStatus(e.flight,4),e.loadingVisible=!0,void a.saveFlightCancel(e.entity_cancel).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_cancel_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")});var i}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.cleat_entity_cancel(),e.popup_cancel_visible=!1},bindingOptions:{visible:"popup_cancel_visible",title:"popup_cancel_title"}},e.popup_cancel.toolbarItems[1].options.onClick=function(t){e.popup_cancel_visible=!1},e.popup_redirect_visible=!1,e.popup_redirect_title="Redirect",e.popup_redirect={shading:!0,width:360,height:"490",fullScreen:!1,showTitle:!0,dragEnabled:!0,
toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacredirect",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.entity_redirect.Date=new Date(Date.now()).toUTCString(),e.entity_redirect.RedirectDate=new Date(e.entity_redirect.RedirectDate).toUTCString(),e.entity_redirect.UserId=n.userId,e.entity_redirect.FlightId=e.flight.ID,e.entity_redirect.STA=new Date(e.entity_redirect.STA).toUTCString(),e.entity_redirect.OAirportIATA=e.flight.ToAirportIATA,e.entity_redirect.Airport=null;$("#resourceGanttba").data("ejGantt");e.setStatus(e.flight,17),e.loadingVisible=!0,a.saveFlightRedirect(e.entity_redirect).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.showButtons2(e.flight),e.updatedFlightsCount=0,e.updatedFlights=[],e.bindFlights(!1),e.popup_redirect_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.clear_entity_redirect(),e.popup_redirect_visible=!1},bindingOptions:{visible:"popup_redirect_visible",title:"popup_redirect_title"}},e.popup_redirect.toolbarItems[1].options.onClick=function(t){e.popup_redirect_visible=!1},e.getReporting=function(t){e.loadingVisible=!0,a.getReporting(t).then(function(t){e.loadingVisible=!1;var i=Enumerable.From(t).OrderBy("$.GroupOrder").ThenBy("$.Name").ToArray();e.dg_crew_ds=i},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrew=function(t){e.loadingVisible=!0,a.getFlightCrew2(t).then(function(t){if(e.loadingVisible=!1,$.each(t,function(e,t){t.ReportingTime=new Date(t.ReportingTime).addMinutes(h)}),e.dg_boxflight_ds&&e.dg_boxflight_ds.length>0){new Date(e.dg_boxflight_ds[0].STD).addHours(-1)}e.dg_crew_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrewAbs=function(t){e.loadingVisible=!0,e.loadingVisible=!0,a.getFlightCrews(t).then(function(t){e.loadingVisible=!1,e.dg_crew_abs_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrewAbs2=function(t){e.loadingVisible=!0,a.getFlightCrew2(t).then(function(t){e.loadingVisible=!1,e.dg_crew_abs2_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getBoxFlights=function(t,i){var n=-1*(new Date).getTimezoneOffset();a.getBoxFlights(t).then(function(t){$.each(t,function(e,t){t.STA=new Date(t.STA).addMinutes(n),t.STD=new Date(t.STD).addMinutes(n),t.ChocksIn&&(t.ChocksIn=new Date(t.ChocksIn).addMinutes(n)),t.ChocksOut&&(t.ChocksOut=new Date(t.ChocksOut).addMinutes(n)),t.Takeoff&&(t.Takeoff=new Date(t.Takeoff).addMinutes(n)),t.Landing&&(t.Landing=new Date(t.Landing).addMinutes(n))}),e.dg_boxflight_ds=t,i&&i()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.dg_crew_columns=[{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"RP",caption:"Reporting Time",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!0,width:200}],e.dg_crew_selected=null,e.dg_crew_instance=null,e.dg_crew_ds=null,e.dg_crew={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",editing:{mode:"cell",allowUpdating:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-250,columns:e.dg_crew_columns,onContentReady:function(t){e.dg_crew_instance||(e.dg_crew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew_selected=i||null},onRowPrepared:function(e){},onRowUpdated:function(t){var i=new Date(t.data.RP).toUTCString(),n=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0;var o={CrewId:t.key.CrewId,FDPId:t.key.FDPId,Date:i,Offset:n};a.saveReportingTime(o).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success")},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},bindingOptions:{dataSource:"dg_crew_ds"}},e.dg_boxflight_columns=[{caption:"Flights",columns:[{dataField:"FlightNumber",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"FlightH",caption:"HH",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60},{dataField:"FlightM",caption:"MM",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:150,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:150,format:"HH:mm"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]}],e.dg_boxflight_selected=null,e.dg_boxflight_instance=null,e.dg_boxflight_ds=null,e.dg_boxflight={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:200,columns:e.dg_boxflight_columns,onContentReady:function(t){e.dg_boxflight_instance||(e.dg_boxflight_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_boxflight_selected=i||null},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_boxflight_ds"}},e.popup_crew_visible=!1,e.popup_crew_title="Crew",e.popup_crew={shading:!0,width:1100,height:600,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_crew_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.getReporting(e.flight.ID)},onHiding:function(){e.dg_crew_ds=[],e.popup_crew_visible=!1},bindingOptions:{visible:"popup_crew_visible",title:"popup_crew_title"}},e.sms=null,e.txt_sms={height:530,bindingOptions:{value:"sms"}},e.popup_sms_visible=!1,e.popup_sms_title="Notification",e.popup_sms={shading:!0,width:600,height:650,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Send",icon:"fas fa-bell",validationGroup:"fbacredirect",bindingOptions:{disabled:"IsApproved"},onClick:function(t){var i=[];$.each(e.dg_crew_ds,function(e,t){t.Mobile&&i.push(t.Mobile)});var n=i.join(","),a=e.sms;d.sms(a,n).then(function(e){General.ShowNotify("The message sent successfully.","success")},function(t){e.loadingVisible=!1,General.ShowNotify2(t.message,"error",5e3)})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_sms_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.sms=null,e.popup_sms_visible=!1},bindingOptions:{visible:"popup_sms_visible",title:"popup_sms_title"}},e.scroll_jl_height=200,e.scroll_jl={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_jl_height"}},e.popup_jl_visible=!1,e.popup_jl_title="Journey Log",e.popup_jl={shading:!0,width:1150,height:function(){return 1*$(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Update",icon:"save",bindingOptions:{disabled:"IsApproved"},onClick:function(e){p($("#jl"))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Print",icon:"print",bindingOptions:{disabled:"IsApproved"},onClick:function(e){p($("#jl"))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_jl_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(t){e.scroll_jl_height=$(window).height()-10-110},onShown:function(e){},onHiding:function(){e.popup_jl_visible=!1},bindingOptions:{visible:"popup_jl_visible",title:"popup_jl_title","toolbarItems[0].visible":"IsEditable"}},e.cl={},e.scroll_cl_height=200,e.scroll_cl={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_cl_height"}},e.popup_cl_visible=!1,e.popup_cl_title="Crew List",e.popup_cl={shading:!0,width:820,height:function(){return 1*$(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Print",icon:"print",bindingOptions:{disabled:"IsApproved"},onClick:function(e){p($("#cl"))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_cl_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(t){e.scroll_cl_height=$(window).height()-10-110},onShown:function(e){},onHiding:function(){e.popup_cl_visible=!1},bindingOptions:{visible:"popup_cl_visible",title:"popup_cl_title","toolbarItems[0].visible":"IsEditable"}},e.popup_gd_visible=!1,e.popup_gd_title="GD",e.popup_gd={shading:!0,width:1100,height:650,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_gd_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){$("#Spreadsheet").ejSpreadsheet({importSettings:{importMapper:window.baseurl+"api/Spreadsheet/Import"}})},onHiding:function(){e.popup_gd_visible=!1},bindingOptions:{visible:"popup_gd_visible",title:"popup_gd_title"}},e.scrollGrid=function(t){var i=e.dg_flights_instance.getView("rowsView")._scrollable,n=e.dg_flights_instance.getRowIndexByKey(t),a=e.dg_flights_instance.getRowElement(n);i.scrollToElement(a)},e.scrollGantt=function(t){var i=new Date(t.STD),n=new Date(e.datefrom),a=Flight.subtractDatesHours(i,n)*$(".e-schedule-day-headercell").width()-50;$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(a)},e.scrollGanttX=function(e){$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(e)},e.scrollGanttNow=function(){var t=new Date(Date.now()),i=new Date(t),n=new Date(e.datefrom),a=Flight.subtractDatesHours(i,n)*$(".e-schedule-day-headercell").width()-50;$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(a)},e.dg_flights_selected=null,e.dg_flights_columns=[{dataField:"delay1",caption:"",width:50,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="lightgray";t.data.FlightStatusID>1&&(i=t.data.delay>0||t.data.delayLanding>0?"#e51400":"#60a917"),$("<div>").append('<i class="fas fa-clock" style="color:'+i+';font-size:16px"></i>').appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"FlightStatusID",caption:"",width:50,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i=Flight.getStatus(t.value),n=i.bgcolor,a=t.data.FlightStatus;switch(a="",t.value){case 1:$("<div>").append('<i class="fas fa-calendar-day" style="color:lightgray;font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 14:$("<div>").append('<i class="far fa-square" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 2:$("<div>").append('<i class="fas fa-plane-departure" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 3:$("<div>").append('<i class="fas fa-plane-arrival" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 4:$("<div>").append('<i class="fas fa-ban" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 15:$("<div>").append('<i class="fas fa-square" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 17:$("<div>").append('<i class="fas fa-random" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 7:$("<div>").append('<i class="fas fa-level-down-alt" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e)}},fixed:!0,fixedPosition:"left"},{dataField:"ID",caption:"ID",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90,fixed:!0,fixedPosition:"left"},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:110,fixed:!0,fixedPosition:"left"},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{caption:"Airports",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90}]},{caption:"Departure",columns:[{dataField:"STD",caption:"Scheduled Dep.",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:170,alignment:"center",format:"yyyy-MMM-dd, HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Arrival",columns:[{dataField:"STA",caption:"Scheduled Arr.",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Pax",columns:[{dataField:"PaxAdult",caption:"Adult",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxChild",caption:"Child",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxInfant",caption:"Infant",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"TotalPax",caption:"Total",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center",name:"totalpax"},{dataField:"TotalSeat",caption:"Seats",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxOver",caption:"Over",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Cargo",columns:[{dataField:"CargoUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"CargoWeight",caption:"Weight",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"cargoweight"},{dataField:"CargoCount",caption:"Count",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Baggage",columns:[{dataField:"CargoUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"BaggageWeight",caption:"Weight",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"baggageweight"},{dataField:"BaggageCount",caption:"Count",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Fuel",columns:[{dataField:"FuelUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"FuelDeparture",caption:"Dep.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FuelArrival",caption:"Arr.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"}]},{caption:"Delays",fixed:!0,fixedPosition:"right",columns:[{dataField:"delay",caption:"Dep.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"delay"},{dataField:"delayLanding",caption:"Arr.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"delayLanding"}]}],e.dg_flights_height=$(window).height()-139-50,e.dg_flights_instance=null,e.dg_flights_ds=null,e.dg_flights={searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,scrolling:{mode:"infinite",showScrollbar:"always"},paging:{pageSize:100},columns:e.dg_flights_columns,onContentReady:function(t){e.dg_flights_instance||(e.dg_flights_instance=t.component)},onSelectionChanged:function(t){if(!e.doGridSelectedChanged){e.doGridSelectedChanged=!0;var i=t.component.getView("rowsView")._scrollable,n=t.component.element().find("tr.dx-selection");return void i.scrollToElement(n)}var a=t.selectedRowsData[0];if(a){e.dg_flights_selected=a,e.addSelectedFlight2(a);var o=$("#resourceGanttba").data("ejGantt"),l=o._getRecordByTaskId(a.ID.toString());o._$ganttchartHelper.ejGanttChart("selectTaskbar",l),e.scrollGantt(a)}else e.dg_flights_selected=null},summary:{totalItems:[{name:"delay",showInColumn:"delay",displayFormat:"{0}",summaryType:"custom"},{name:"delayLanding",showInColumn:"delayLanding",displayFormat:"{0}",summaryType:"custom"},{name:"totalpax",showInColumn:"totalpax",displayFormat:"{0}",summaryType:"custom"},{name:"cargoweight",showInColumn:"cargoweight",displayFormat:"{0}",summaryType:"custom"},{name:"baggageweight",showInColumn:"baggageweight",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"delay"===e.name&&("start"===e.summaryProcess&&(e.delay=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.delay+=e.value.delay)),"finalize"===e.summaryProcess&&(e.totalValue=e.delay)),"delayLanding"===e.name&&("start"===e.summaryProcess&&(e.delayLanding=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.delayLanding+=e.value.delayLanding)),"finalize"===e.summaryProcess&&(e.totalValue=e.delayLanding)),"totalpax"===e.name&&("start"===e.summaryProcess&&(e.totalpax=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.totalpax+=e.value.TotalPax)),"finalize"===e.summaryProcess&&(e.totalValue=e.totalpax)),"cargoweight"===e.name&&("start"===e.summaryProcess&&(e.cargoweight=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.cargoweight+=e.value.CargoWeight)),"finalize"===e.summaryProcess&&(e.totalValue=e.cargoweight)),"baggageweight"===e.name&&("start"===e.summaryProcess&&(e.baggageweight=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.baggageweight+=e.value.BaggageWeight)),"finalize"===e.summaryProcess&&(e.totalValue=e.baggageweight))}},bindingOptions:{dataSource:"dg_flights_ds",visible:"gridview",height:"dg_flights_height"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.scroll=0,e.bind=function(){var t="odata/flightplans/customer/"+Config.CustomerId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Id",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},r.isAuthorized()?n.page_title="> Flights":r.redirectToLogin(),e.hideButtons=function(){e.IsDepartureDisabled=!0,e.IsArrivalDisabled=!0},e.hideButtons2=function(){e.IsDepartureDisabled=!0,e.IsArrivalDisabled=!0},e.showButtons=function(t){e.IsDepartureDisabled=!1,e.IsArrivalDisabled=!1},e.showButtons2=function(t){e.IsDepartureDisabled=!1,e.IsArrivalDisabled=!1},e.weatherUpdateTime=null,e.weatherUpdateTimePassed=0,e.AirportWeatherVisible=!1,e.AirportWeather={currently:{},hourly:{}},e.FromWeather={currently:{}},e.FromWeatherVisible=!0,e.ToWeather={currently:{}},e.ToWeatherVisible=!0,e.getIcon=function(e){return e?e.currently.icon+" wicon":""},e.getIcon2=function(e){return e+" wicon"},e.prepareWeather=function(e){var t=90+Number(e.currently.windBearing);if(e.latitude=Number(e.latitude).toFixed(4),e.longitude=Number(e.longitude).toFixed(4),e.currently.windDeg="rotate("+t+"deg)",e.currently.windPoint="Winds from the "+Weather.getCompassPoint(Number(e.currently.windBearing)),e.currently.humidity=(100*Number(e.currently.humidity)).toFixed(1),e.currently.cloudCover=(100*Number(e.currently.cloudCover)).toFixed(1),e.currently.visibility=(1e3*Number(e.currently.visibility)).toFixed(0),e.hourly){e.hourly.h1={},e.hourly.h2={},e.hourly.h3={},e.hourly.h4={};for(var i=1;i<=4;i++){var n=e.hourly.data[i],a=null;switch(i){case 1:a=e.hourly.h1;break;case 2:a=e.hourly.h2;break;case 3:a=e.hourly.h3;break;case 4:a=e.hourly.h4}a.time=formatHourAMPM(new Date(1e3*n.time)),a.icon=n.icon,a.summary=n.summary,a.temperature=n.temperature,a.windtotal=n.windSpeed+" "+Weather.getCompassPoint(Number(n.windBearing)),a.visibility=1e3*Number(n.visibility),a.cloudCover=(100*Number(n.cloudCover)).toFixed(1)}}},e.setWeather=function(){if(e.flight){e.ToWeatherVisible=!1,e.FromWeatherVisible=!1;new Date(e.flight.STD).toUTCDateTimeDigits(),new Date(e.flight.STA).toUTCDateTimeDigits();o.getFlight(e.flight.ID,-1).then(function(t){e.FromWeather=t,e.prepareWeather(e.FromWeather),e.FromWeatherVisible=!0,o.getFlight(e.flight.ID,-2).then(function(t){e.ToWeather=t,e.prepareWeather(e.ToWeather),e.ToWeatherVisible=!0},function(e){General.ShowNotify(e.message,"error")})},function(e){General.ShowNotify(e.message,"error")})}},e.selectedFlights=[],e.clearSelectedFlights=function(){e.selectedFlights=[],e.hideButtons()},e.doGridSelectedChanged=!0,e.addSelectedFlight=function(t){e.removeUpdatedFlights(t),e.hideButtons(),Enumerable.From(e.selectedFlights).Where("$.taskId=="+t.taskId).FirstOrDefault()?(e.selectedFlights=[],e.$apply(function(){e.popup_inf_visible=!1})):(e.selectedFlights=[],e.selectedFlights.push(t),e.flight=t,e.showButtons(t),e.popup_inf_visible&&e.setWeather(),e.doGridSelectedChanged=!1,e.dg_flights_instance.selectRows([t],!1),e.showLog(!0))},e.addSelectedFlight2=function(t){e.removeUpdatedFlights(t),e.hideButtons2(),Enumerable.From(e.selectedFlights).Where("$.taskId=="+t.taskId).FirstOrDefault()?(e.selectedFlights=[],e.popup_inf_visible=!1):(e.selectedFlights=[],e.selectedFlights.push(t),e.flight=t,e.showButtons2(t),e.popup_inf_visible&&e.setWeather())},e.selectedResource=null,e.setSelectedResource=function(t){var i=t.index;e.selectedResource&&e.setSelectedResource.index==i?(e.selectedResource=null,$("#resourceGanttba").data("ejGantt").clearSelection(i),alert("x")):e.selectedResource={index:t.index,item:t.item}},e.ganttCreated=!1;e.renderTopTimeHeader=function(){var e=$(".e-schedule-week-headercell-content");$.each(e,function(e,t){var i=$(t),n=i.html().split("(")[0],a=Number(n.split("-")[2]),o=n.split("-"),l=o[1],r=o[0],d=new Date(a+"/"+l+"/"+r);persianDate.toLocale("en");var s=n+" ("+new persianDate(d).format("DD/MM/YYYY")+")";i.html(s)})},e.renderTimeHeader=function(){var t=$(".e-schedule-day-headercell-content");$.each(t,function(t,i){var n=$(i),a=n.html(),o=Number(n.html());n.find("span").length>0&&(a=$(n.find("span")[1]).html(),o=Number(a));var l=0;e.IsUTC,l=getUTCHour(o);var r="<span style='font-size:10px;display:block;color:gray;text-align:left;padding-left:2px'>"+l+"</span><span style='font-size:13px;display:block;position:relative;top:-5px'>"+a+"</span>";n.html(r)})},console.log("detector"),console.log(n.detector.tablet()),console.log(n.detector.mobile()),e.timeCellWidth=0,e.selectedDate=null,e.scaleFactor=.24,n.detector.tablet()&&(e.scaleFactor=e.scaleFactor*($(window).width()>960?1.4:2)),e.createGantt=function(t){new MobileDetect(window.navigator.userAgent).mobile();var i=(new Date(e.datefrom).yyyymmddtimenow(!1),"#taskbarTemplateLightNewCeo"),a=110,o=57,l=$(window).width();l<=1024&&(i="#taskbarTemplateLightNewCeoNarrow",o=43),l>1380?(e.scaleFactor=.24,a=110):l>640&&l<=1380?(e.scaleFactor=.4,a=110):l<=360?(e.scaleFactor=1,a=70):l>360&&l<=640&&(e.scaleFactor=.65,a=70),t=$(window).width()*e.scaleFactor;var r=$(window).width()/1536,d=$("#resourceGanttba").data("ejGantt");d&&d.destroy(),e.StartNowLineTimerFirst=!0;var s=$(window).height(),c=65;s<640?c=60:s>=640&&s<768&&(c=60);var g=$(window).height()-139-50+50-38;g-=60,n.detector.tablet()&&(g-=60,$(window).height()<1280&&(g+=30)),g=$(window).height()-n.headerHeight-50-36-c-8,g+="px";var u=General.getDayFirstHour(new Date(e.selectedDate)),p=new Date(u).addDays(1),h=(new Date(u).addDays(-1),General.getDayLastHour(new Date(e.selectedDate))),f=Enumerable.From(e.dataSource).Where(function(e){var t=new Date(e.STD),i=new Date(e.STA);return t>=u&&t<=h||i>=u&&i<=h}).ToArray(),m=Enumerable.From(f).Where(function(e){var t=new Date(e.STA),i=new Date(e.STA),n=new Date(e.STA);return e.Landing&&(n=new Date(e.Landing)),e.ChocksIn&&(i=new Date(e.ChocksIn)),t>h||i>h||n>h}).ToArray(),w=!1,_=1e6;m&&m.length>0&&(h=General.getDayLastHour(new Date(p)),w=!0,_=400*r,console.log(m)),n.detector.mobile()&&(w=!0);var y=Enumerable.From(f).Where("$.LinkedFlight").FirstOrDefault();$("#resourceGanttba").ejGantt({scheduleStartDate:u,scheduleEndDate:h,taskbarBackground:"red",selectionMode:ej.Gantt.SelectionMode.Cell,selectionType:ej.Gantt.SelectionType.Single,taskbarClick:function(t){e.addSelectedFlight(t.data.item),$("#resourceGanttba").data("ejGantt").clearSelection()},dataSource:f,allowColumnResize:!0,isResponsive:!0,taskIdMapping:"taskId",taskNameMapping:"taskName",fromLocationMapping:"from",startDateMapping:"startDate",endDateMapping:"endDate",progressMapping:"progress",durationMapping:"duration",groupNameMapping:"Title",groupIdMapping:"groupId",groupCollection:e.resourceGroups,resources:e.resources,resourceIdMapping:"resourceId",resourceNameMapping:"resourceName",resourceInfoMapping:"resourceId",notesMapping:"notes",rightTaskLabelMapping:"taskName",baselineStartDateMapping:"BaselineStartDate",baselineEndDateMapping:"BaselineEndDate",highlightWeekEnds:!0,includeWeekend:!1,rowHeight:o,taskbarHeight:o,predecessorMapping:"predecessor",allowGanttChartEditing:!1,allowDragAndDrop:!0,editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,editMode:"normal"},splitterSettings:{position:a},toolbarSettings:{showToolbar:!1,toolbarItems:[ej.Gantt.ToolbarItems.Add,ej.Gantt.ToolbarItems.Delete,ej.Gantt.ToolbarItems.Update,ej.Gantt.ToolbarItems.Cancel,ej.Gantt.ToolbarItems.ExpandAll,ej.Gantt.ToolbarItems.CollapseAll,ej.Gantt.ToolbarItems.NextTimeSpan,ej.Gantt.ToolbarItems.PrevTimeSpan]},enableContextMenu:!1,load:function(){e.ganttCreated=!0,this.getColumns()[0].width=a;y&&(e.linkedTimerDone=!1,e.StartLinkedTimer())},create:function(t){try{if($("#ejTreeGridresourceGanttbae-gridcontent").height($("#ejTreeGridresourceGanttbae-gridcontent").height()-20),n.detector.mobile()){var i=new Date,a=i.getHours(),o=$(".e-schedule-day-headercell-content").width();$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(o*a)}else $(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(_);w||$(".e-scrollbar.e-js.e-widget.e-hscrollbar").remove(),e.renderTopTimeHeader(),e.renderTimeHeader(),$(".e-ganttviewerbodyContianer-stripLines").css("z-index",0),e.timeCellWidth=$(".e-schedule-day-headercell-content").width();var l=new Date,r=new Date(u),d=new Date(h);l.getTime()>=r.getTime()&&l.getTime()<=d.getTime()?(e.autoUpdate=!0,e.StartNowLineTimer(1)):e.autoUpdate=!1}catch(e){alert(e)}},cellSelecting:function(e){e&&"resourceTask"!=e.data.eResourceTaskType&&(e.cancel=!0)},cellSelected:function(t){$(".e-gantt-taskbarSelection").removeClass("e-gantt-taskbarSelection"),e.setSelectedResource(t.data)},actionBegin:function(e){e.requestType&&"beginedit"==e.requestType&&(e.cancel=!0)},actionComplete:function(t){"save"==t.requestType&&(e.doActionCompleteSave?setTimeout(function(){$("#resourceGanttba").data("ejGantt")._$ganttchartHelper.ejGanttChart("selectTaskbar",t.modifiedRecord)},100):e.doActionCompleteSave=!0),console.log(t)},workingTimeScale:"TimeScale24Hours",durationUnit:ej.Gantt.DurationUnit.Hour,scheduleHeaderSettings:{scheduleHeaderType:ej.Gantt.ScheduleHeaderType.Day,dayHeaderFormat:"dd-MMM-yyyy",minutesPerInterval:ej.Gantt.minutesPerInterval.Auto,timescaleStartDateMode:ej.Gantt.TimescaleRoundMode.Auto,timescaleUnitSize:t+"%"},taskbarTemplate:i,leftTaskLabelTemplate:"#leftlableTemplate",viewType:ej.Gantt.ViewType.ResourceView,sizeSettings:{height:g},groupSettings:{},showStackedHeader:!1,taskSchedulingMode:ej.Gantt.TaskSchedulingMode.Manual,enableTaskbarTooltip:!1})},e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.linkedTimer=null,e.linkedTimerDone=!1,e.StartLinkedTimer=function(){e.linkedTimer=setTimeout(function(){if(e.linkedTimerDone)e.StopLinkedTimer();else{var t=$(".linked-flight");t.length>0&&(t.each(function(){var e=$(this).data("linked");if(e){var t=$(this).closest(".e-childContainer"),i=$(".task-"+e).closest(".e-childContainer");if(i.length>0){var n=i.position().left;t.css({left:n+10})}}$(this).show()}),e.linkedTimerDone=!0),e.StartLinkedTimer()}},50)},e.StopLinkedTimer=function(){e.linkedTimer&&clearTimeout(e.linkedTimer)},e.wtimer=null,e.StartWTimer=function(){e.wtimer=setTimeout(function(){var t=Number(subtractDates(new Date(Date.now()),e.weatherUpdateTime)).toFixed(0)
;e.$apply(function(){e.weatherUpdateTimePassed=t}),e.StartWTimer()},1e4)},e.StopWTimer=function(){e.wtimer&&clearTimeout(e.wtimer)},e.getAirportWeather=function(){e.weatherUpdateTimePassed=0,e.StopWTimer(),e.AirportWeatherVisible=!1,o.getCurrentHourly(e.airportEntity.Latitude,e.airportEntity.Longitude).then(function(t){e.weatherUpdateTime=new Date(Date.now()),e.AirportWeather=t,e.prepareWeather(e.AirportWeather),e.StartWTimer(),e.AirportWeatherVisible=!0},function(e){General.ShowNotify(e.message,"error")})},e.updateWeather=function(){e.getAirportWeather()},e.delayCodes=null,e.$on("$viewContentLoaded",function(){e.scroll2_height=$(window).height()-266.5+87,$(".ceoflightboard").fadeIn(400,function(){e.airport?(e.loadingVisible=!0,a.getAirportByIATA(e.airport).then(function(t){e.airportEntity=t,e.airportEntity.Latitude2=Number(e.airportEntity.Latitude).toFixed(3),e.airportEntity.Longitude2=Number(e.airportEntity.Longitude).toFixed(3),e.airportEntity.LtLg="("+e.airportEntity.Latitude2+", "+e.airportEntity.Longitude2+")",e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):e.airportEntity=null,e.loadingVisible=!0,a.getDelayCodes().then(function(t){e.loadingVisible=!1,$.each(t,function(e,t){t.Title2=t.Code+" "+t.Title}),e.delayCodes=t,setTimeout(function(){e.StopUTimer(),e.BeginSearch()},1e3)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})})}),e.$on("$destroy",function(t){e.StopUTimer(),e.StopNowLineTimer()}),n.$broadcast("FlightBoardLoaded",null),angular.element(c).bind("resize",function(){e.createGantt(),console.log("Resized your browser")})}]),app.controller("delayCodesController",["$scope","$location","$routeParams","$rootScope","airportService","flightService","authService","$route",function(e,t,i,n,a,o,l,r){e.prms=i.prms,e.IsDispatch=r.current.isDispatch,e.IsBase=!e.IsDispatch,e.entity={Id:null,Title:null,Code:null,DelayCategoryId:null,Remark:null,AirlineId:10},e.clearEntity=function(){e.entity.Id=null,e.entity.Title=null,e.entity.Code=null,e.entity.DelayCategoryId=null,e.entity.Remark=null,e.entity.AirlineId=10},e.bind=function(t){e.entity.Id=t.Id,e.entity.Title=t.Title,e.entity.Code=t.Code,e.entity.DelayCategoryId=t.DelayCategoryId,e.entity.Remark=t.Remark,e.entity.AirlineId=10},e.sb_category={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceDelayCategory(),onSelectionChanged:function(e){},searchExpr:["Title"],displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.DelayCategoryId"}},e.txt_code={hoverStateEnabled:!1,bindingOptions:{value:"entity.Code"}},e.txt_title={hoverStateEnabled:!1,bindingOptions:{value:"entity.Title"}},e.txt_remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.Remark"}},e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,o.deleteDelayCode(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bindDelays()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(t){e.isNew=!0,e.clearEntity(),e.popup_add_visible=!0}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;e.isNew=!1,e.entity.Id=i.Id,e.entity.Title=i.Title,e.entity.Code=i.Code,e.entity.DelayCategoryId=i.DelayCategoryId,e.entity.Remark=i.Remark,e.entity.AirlineId=10,e.popup_add_visible=!0},bindingOptions:{visible:"IsBase"}},e.btn_flights={text:"Flights",type:"default",icon:"rowfield",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.navigateairport(i.IATA)},bindingOptions:{visible:"IsDispatch"}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;e.InitAddAirport(i)}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.doRefresh=!0,e.bindDelays()}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.bindDelays=function(){e.doRefresh&&(e.dg_ds=null,e.loadingVisible=!0,o.getDelayCodes().then(function(t){e.loadingVisible=!1,$.each(t,function(e,t){t.Title2=t.Code+" "+t.Title}),e.dg_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.pop_width=500,e.pop_height=370,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Save",icon:"check",validationGroup:"dcadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=n.getWindowSize();i.width<=600&&(e.pop_width=i.width,e.pop_height=i.height)},onShown:function(e){},onHiding:function(){e.clearEntity(),e.bindDelays(),e.popup_add_visible=!1},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.isNew&&(e.entity.Id=-1),e.loadingVisible=!0,console.log(e.entity),o.saveDelayCode(e.entity).then(function(t){e.clearEntity(),e.doRefresh=!0,General.ShowNotify(Config.Text_SavedOk,"success"),n.$broadcast("onRouteSaved",t),e.loadingVisible=!1,e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.filters=[],e.dg_columns=[{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:180},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},onCellPrepared:function(e){"data"==e.rowType&&"FromAirportIATA"===e.column.dataField&&e.cellElement.css("background","palegreen"),"data"==e.rowType&&"ToAirportIATA"===e.column.dataField&&e.cellElement.css("background","lightpink"),"data"==e.rowType&&"FlightH"===e.column.dataField&&e.cellElement.css("background","papayawhip"),"data"==e.rowType&&"FlightM"===e.column.dataField&&e.cellElement.css("background","papayawhip")},bindingOptions:{dataSource:"dg_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},l.isAuthorized()?(n.page_title="> Delay Codes",$(".delaycodes").fadeIn()):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bindRoutes()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onRouteSaved",function(t,i){e.doRefresh=!0}),e.$on("onRouteHide",function(t,i){alert(e.doRefresh),e.bindRoutes()}),n.$broadcast("AirportLoaded",null)}]),app.controller("dailyRoster2Controller",["$scope","$location","$routeParams","$rootScope","flightService","weatherService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d,s){function c(e){var t=e.html(),i=$("<iframe />");i[0].name="frame1",i.css({position:"absolute",top:"-1000000px"}),$("body").append(i);var n=i[0].contentWindow?i[0].contentWindow:i[0].contentDocument.document?i[0].contentDocument.document:i[0].contentDocument;n.document.open(),n.document.write("<html><head><title></title>"),n.document.write("</head><body>"),n.document.write('<link href="content/css/bootstrap.css" rel="stylesheet" />'),n.document.write('<link href="content/css/main.css" rel="stylesheet" />'),n.document.write(t),n.document.write("</body></html>"),n.document.close(),setTimeout(function(){window.frames.frame1.focus(),window.frames.frame1.print(),i.remove()},500)}e.prms=i.prms,e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,airportService.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(e){var t={Id:null};n.$broadcast("InitAddPerson",t)}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitAddPerson",i)}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;e.InitAddAirport(i)}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,validationGroup:"frssearch",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.dg_ds=null,e.$broadcast("getFilterQuery",null)}},e.IsRemarkVisible=!1,e.IsISCCMVisible=!1,e.IsSCCM1Visible=!1,e.IsSCCM2Visible=!1,e.IsFA1Visible=!1,e.IsFA2Visible=!1,e.IsFA3Visible=!1,e.IsCAOBS1Visible=!1,e.IsCACheck1Visible=!1,e.IsIPVisible=!1,e.IsCPTVisible=!1,e.IsFOVisible=!1,e.IsSafetyVisible=!1,e.IsOBSP1Visible=!1,e.IsOBSP2Visible=!1,e.cabinSpan=8,e.cockpitSpan=6,e.buildTable=function(){e.cabinSpan=8,e.cockpitSpan=6,e.IsISCCMVisible||e.cabinSpan--,e.IsSCCM1Visible||e.cabinSpan--,e.IsSCCM2Visible||e.cabinSpan--,e.IsFA1Visible||e.cabinSpan--,e.IsFA2Visible||e.cabinSpan--,e.IsFA3Visible||e.cabinSpan--,e.IsCAOBS1Visible||e.cabinSpan--,e.IsCACheck1Visible||e.cabinSpan--,e.IsIPVisible||e.cockpitSpan--,e.IsCPTVisible||e.cockpitSpan--,e.IsFOVisible||e.cockpitSpan--,e.IsSafetyVisible||e.cockpitSpan--,e.IsOBSP1Visible||e.cockpitSpan--,e.IsOBSP2Visible||e.cockpitSpan--,$("#tb-container").empty();var t='<table style="width:100%;margin-left:5px;margin-top:20px;" class="jl-table"><thead><tr style="background-color:rgba(255,230,153,1) !important;">  <th rowspan="2">Flight No</th>  <th rowspan="2">Route</th>  <th colspan="2">Local</th>  <th rowspan="2">Reg</th>'+(e.cockpitSpan>0?' <th colspan="'+e.cockpitSpan+'">Cockpit</th>':"")+(e.cabinSpan>0?'<th colspan="'+e.cabinSpan+'">Cabin</th>':"")+'</tr><tr style="background-color:rgba(255,230,153,1) !important;">    <th>Dep.</th>    <th>Arr.</th>'+(e.IsIPVisible?"    <th  >IP</th>":"")+(e.IsCPTVisible?"    <th  >CPT</th>":"")+(e.IsFOVisible?"    <th  >FO</th>":"")+(e.IsSafetyVisible?"    <th  >Safety</th>":"")+(e.IsOBSP1Visible?"    <th  >OBS-P1</th>":"")+(e.IsOBSP2Visible?"    <th  >OBS-P2</th>":"")+(e.IsISCCMVisible?'    <th  class="col-isccm">ISCCM</th>':"")+(e.IsSCCM1Visible?"    <th>SCCM1</th>":"")+(e.IsSCCM2Visible?'    <th   class="col-sccm2">SCCM2</th>':"")+(e.IsFA1Visible?'    <th   class="col-sccm2">FA</th>':"")+(e.IsFA2Visible?'    <th   class="col-sccm2">FA</th>':"")+(e.IsFA3Visible?'    <th   class="col-sccm2">FA</th>':"")+(e.IsCAOBS1Visible?'    <th   class="col-sccm2">OBS</th>':"")+(e.IsCACheck1Visible?'    <th   class="col-sccm2">Check</th>':"")+"</tr></thead><tbody>";$.each(e.rows,function(i,n){var a="";n.DH&&(a=" (DH)");var o=n.DH?' style="background-color:#ffccff" class="td-dh"':"";t+="<tr><td"+o+">"+n.FlightNumber+"</td><td"+o+">"+n.Route+"</td><td"+o+">"+n.DepartureLocal2+"</td><td"+o+">"+n.ArrivalLocal2+"</td><td"+o+">"+n.Register+"</td>"+(e.IsIPVisible?"<td"+o+">"+(n.IP?n.IP+a:"")+"</td>":"")+(e.IsCPTVisible?"<td"+o+">"+(n.CPT?n.CPT+a:"")+"</td>":"")+(e.IsFOVisible?"<td"+o+">"+(n.FO?n.FO+a:"")+"</td>":"")+(e.IsSafetyVisible?"<td"+o+">"+(n.Safety?n.Safety+a:"")+"</td>":"")+(e.IsOBSP1Visible?"<td"+o+">"+(n.OBSP1?n.OBSP1+a:"")+"</td>":"")+(e.IsOBSP2Visible?"<td"+o+">"+(n.OBSP2?n.OBSP2+a:"")+"</td>":"")+(e.IsISCCMVisible?"<td"+o+">"+(n.ISCCM?n.ISCCM+a:"")+"</td>":"")+(e.IsSCCM1Visible?"<td"+o+">"+(n.Purser?n.Purser+a:"")+"</td>":"")+(e.IsSCCM2Visible?"<td"+o+">"+(n.Purser2?n.Purser2+a:"")+"</td>":"")+(e.IsFA1Visible?"<td"+o+">"+(n.FA1?n.FA1+a:"")+"</td>":"")+(e.IsFA2Visible?"<td"+o+">"+(n.FA2?n.FA2+a:"")+"</td>":"")+(e.IsFA3Visible?"<td"+o+">"+(n.FA3?n.FA3+a:"")+"</td>":"")+(e.IsCAOBS1Visible?"<td"+o+">"+(n.CAOBS1?n.CAOBS1+a:"")+"</td>":"")+(e.IsCACheck1Visible?"<td"+o+">"+(n.CACheck1?n.CACheck1+a:"")+"</td>":"")+"</tr>"}),t+="</tbody></table>",$("#tb-container").html(t)},e.rows=[],e.pday="",e.pgdate="",e.pdate="",e.btn_print={text:"Print",type:"default",icon:"print",width:130,onClick:function(t){e.dg_instance.getDataSource()&&(moment(e.dt_from).format("YYYY-MM-DDTHH:mm:ss"),e.pday=moment(e.dt_from).format("dddd"),e.pgdate=moment(e.dt_from).format("YYYY-MMM-DD"),persianDate.toLocale("en"),e.pdate=new persianDate(e.dt_from).format("DD-MM-YYYY"),e.IsISCCMVisible=!1,e.IsSCCM1Visible=!1,e.IsSCCM2Visible=!1,e.IsFA1Visible=!1,e.IsFA2Visible=!1,e.IsFA3Visible=!1,e.IsCAOBS1Visible=!1,e.IsCACheck1Visible=!1,e.IsIPVisible=!1,e.IsCPTVisible=!1,e.IsFOVisible=!1,e.IsSafetyVisible=!1,e.IsOBSP1Visible=!1,e.IsOBSP2Visible=!1,e.rows=Enumerable.From(e.dg_instance.getDataSource()._items).ToArray(),$.each(e.rows,function(t,i){i.DepartureLocal2=moment(new Date(i.DepartureLocal)).format("HH:mm"),i.ArrivalLocal2=moment(new Date(i.ArrivalLocal)).format("HH:mm"),i.STD2=moment(new Date(i.STD)).format("HH:mm"),i.STA2=moment(new Date(i.STA)).format("HH:mm"),i.IP&&(e.IsIPVisible=!0),i.CPT&&(e.IsCPTVisible=!0),i.FO&&(e.IsFOVisible=!0),i.Safety&&(e.IsSafetyVisible=!0),i.OBSP1&&(e.IsOBSP1Visible=!0),i.OBSP2&&(e.IsOBSP1Visible=!0),i.ISCCM&&(e.IsISCCMVisible=!0),i.Purser&&(e.IsSCCM1Visible=!0),i.Purser2&&(e.IsSCCM2Visible=!0),i.FA1&&(e.IsFA1Visible=!0),i.FA2&&(e.IsFA2Visible=!0),i.FA3&&(e.IsFA3Visible=!0),i.CACheck1&&(e.IsCACheck1Visible=!0),i.CAOBS1&&(e.IsCAOBS1Visible=!0)}));e.popup_sec_visible=!0}},e.selected_employee_id=null,e.btn_flight={text:"Flights",type:"default",icon:"airplane",width:120,bindingOptions:{},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.selected_employee_id=e.dg_selected.Id,e.fillPerson(e.dg_selected),e.doSearch=!1,e.popup_flight_visible=!0}},e.btn_person={text:"Details",type:"default",icon:"card",width:120,bindingOptions:{},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitViewPerson",i)}},e.btn_flight_total={text:"Flights(Total)",type:"default",icon:"datafield",width:180,bindingOptions:{},onClick:function(t){e.popup_flight_total_visible=!0}},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dt_from=new Date,e.dt_to=(new Date).addDays(0),e.date_from={type:"date",placeholder:"From",width:"100%",bindingOptions:{value:"dt_from"}},e.date_to={type:"date",placeholder:"To",width:"100%",bindingOptions:{value:"dt_to"}},e.filters=[],e.dg_columns=[{dataField:"DH",caption:"DH",allowResizing:!0,dataType:"boolean",allowEditing:!1,alignment:"center",width:50},{dataField:"STDDay",caption:"Date",allowResizing:!0,dataType:"datetime",allowEditing:!1,alignment:"center",sortIndex:0,sortOrder:"asc",format:"yyyy-MM-dd",width:110},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:75},{caption:"Route",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:65},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:65}]},{caption:"Local",columns:[{dataField:"DepartureLocal",caption:"Dep.",allowResizing:!0,dataType:"datetime",allowEditing:!1,alignment:"center",format:"HH:mm",width:75},{dataField:"ArrivalLocal",caption:"Arr.",allowResizing:!0,dataType:"datetime",allowEditing:!1,alignment:"center",format:"HH:mm",width:75}]},{dataField:"Register",caption:"Reg",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,sortIndex:1,sortOrder:"asc",width:85},{caption:"Cockpit",columns:[{dataField:"IP",caption:"IP",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,minWidth:50},{dataField:"CPT",caption:"CPT",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"FO",caption:"FO",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"Safety",caption:"Safety",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,minWidth:50},{dataField:"OBSP1",caption:"OBS-P1",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,minWidth:50},{dataField:"OBSP2",caption:"OBS-P2",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,minWidth:50}]},{caption:"Cabin",columns:[{dataField:"ISCCM",caption:"ISCCM",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,minWidth:50},{dataField:"Purser",caption:"SCCM1",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"Purser2",caption:"SCCM2",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,minWidth:50},{dataField:"FA1",caption:"FA",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"FA2",caption:"FA",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"FA3",caption:"FA",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,minWidth:50},{dataField:"CAOBS1",caption:"OBS",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,minWidth:50},{dataField:"CACheck1",caption:"Check",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,minWidth:50}]}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",wordWrapEnabled:!0,allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!0,height:$(window).height()-135,editing:{allowUpdating:!0,mode:"cell"},columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},onRowPrepared:function(e){e.data&&e.data.DH&&e.rowElement.css("background","#ffccff")},export:{enabled:!0,fileName:"FlightReport-Security",allowExportSelectedData:!1,excelWrapTextEnabled:!0},bindingOptions:{dataSource:"dg_ds"}},e.scroll_sec_height=200,e.scroll_sec={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_sec_height"}},e.popup_sec_visible=!1,e.popup_sec_title="Security Report",e.popup_sec={shading:!0,width:1150,height:function(){return 1*$(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Print",icon:"print",bindingOptions:{disabled:"IsApproved"},onClick:function(t){e.IsRemarkVisible?$(".col-remark").removeClass("noprint"):$(".col-remark").addClass("noprint"),e.IsISCCMVisible?$(".col-isccm").removeClass("noprint"):$(".col-isccm").addClass("noprint"),e.IsSCCM2Visible?$(".col-sccm2").removeClass("noprint"):$(".col-sccm2").addClass("noprint"),c($("#sec"))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_sec_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(t){e.scroll_sec_height=$(window).height()-10-110},onShown:function(t){e.buildTable()},onHiding:function(){e.popup_sec_visible=!1},bindingOptions:{visible:"popup_sec_visible",title:"popup_sec_title"}},e.dg_flight_columns=[{dataField:"Date",caption:"Date",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"yyyy-MMM-dd"},{dataField:"FlightNumber",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!1,fixedPosition:"left"},{dataField:"Position",caption:"Position",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{caption:"Route",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70}]},{caption:"Departure",columns:[{dataField:"STD",caption:"STD",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"}]},{caption:"Arrival",columns:[{dataField:"STA",caption:"STA",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"}]},{caption:"Times",fixed:!0,fixedPosition:"right",columns:[{dataField:"FlightTime2",caption:"Flight Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"BlockTime",caption:"Block Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100}]}],e.dg_flight_selected=null,e.dg_flight_instance=null,e.dg_flight_ds=null,e.dg_flight={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-235,columns:e.dg_flight_columns,onContentReady:function(t){e.dg_flight_instance||(e.dg_flight_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_flight_selected=i||null},summary:{totalItems:[{name:"FlightTimeTotal",showInColumn:"FlightTime2",displayFormat:"{0}",summaryType:"custom"},{name:"BlockTimeTotal",showInColumn:"BlockTime",displayFormat:"{0}",summaryType:"custom"},{name:"DutyTotal",showInColumn:"Duty",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"FlightTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.FlightH+e.value.FlightM,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"BlockTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.ActualFlightHOffBlock+e.value.ActualFlightMOffBlock,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"DutyTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.Duty,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_flight_ds"}},e.dg_flight_total_columns=[{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",width:150,allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"PID",caption:"PID",allowResizing:!0,alignment:"center",dataType:"string",width:150,allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"FirstName",caption:"First Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!1,fixedPosition:"left"},{dataField:"LastName",caption:"Last Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"FlightsCount",caption:"Legs",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightTime2",caption:"Flight Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"BlockTime",caption:"Block Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"Duty2",caption:"Duty",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100}],e.dg_flight_total_selected=null,e.dg_flight_total_instance=null,e.dg_flight_total_ds=null,e.dg_flight_total={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_flight_total_columns,onContentReady:function(t){e.dg_flight_total_instance||(e.dg_flight_total_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_flight_total_selected=i||null},summary:{totalItems:[{name:"FlightTimeTotal",showInColumn:"FlightTime2",displayFormat:"{0}",summaryType:"custom"},{name:"BlockTimeTotal",showInColumn:"BlockTime",displayFormat:"{0}",summaryType:"custom"},{name:"DutyTotal",showInColumn:"Duty",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"FlightTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.FlightH+e.value.FlightM,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"BlockTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.BlockH+e.value.BlockM,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"DutyTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.Duty,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_flight_total_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.jgroup="Cockpit",e.sb_group={showClearButton:!1,searchEnabled:!0,dataSource:["Cockpit","Cabin"],bindingOptions:{value:"jgroup"}},e.bind=function(){var t=moment(e.dt_from).format("YYYY-MM-DDTHH:mm:ss"),i=moment(e.dt_from).format("YYYY-MM-DDTHH:mm:ss");e.loadingVisible=!0,a.getSecurityRoster(i,t).then(function(n){a.getSecurityRosterDH(i,t).then(function(t){e.loadingVisible=!1;var i=[];$.each(n,function(e,t){t.DH=!1,t.Remark="",t.Route=t.FromAirportIATA+"-"+t.ToAirportIATA;new Date(t.STDDay);i.push(t)}),$.each(t,function(e,t){t.DH=!0,t.Remark="",t.Route=t.FromAirportIATA+"-"+t.ToAirportIATA;new Date(t.STDDay);i.push(t)}),e.dg_ds=i},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e._bind=function(){var t=moment(e.dt_to).format("YYYY-MM-DDTHH:mm:ss"),i=moment(e.dt_from).format("YYYY-MM-DDTHH:mm:ss"),a="odata/flight/report/security?dt="+t+"&df="+i;e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+a,key:"ID",version:4,onLoaded:function(e){$.each(e,function(e,t){t.Airline="FlyPersia";var i=new Date(t.STDDay);persianDate.toLocale("en"),t.STDDay=new persianDate(i).format("DD-MM-YYYY")}),n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}}}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.getCrewFlights=function(t,i,n){var o=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0,a.getCrewFlights(t,i,n).then(function(t){console.log(t),e.loadingVisible=!1,$.each(t,function(e,t){t.STA=new Date(t.STA).addMinutes(o),t.STD=new Date(t.STD).addMinutes(o),t.ChocksIn&&(t.ChocksIn=new Date(t.ChocksIn).addMinutes(o)),t.ChocksOut&&(t.ChocksOut=new Date(t.ChocksOut).addMinutes(o)),t.Takeoff&&(t.Takeoff=new Date(t.Takeoff).addMinutes(o)),t.Landing&&(t.Landing=new Date(t.Landing).addMinutes(o)),t.DurationH=Math.floor(t.FlightTime/60),t.DurationM=t.FlightTime%60;var i=60*t.FlightH+t.FlightM;t.FlightTime2=pad(Math.floor(i/60)).toString()+":"+pad(i%60).toString();var n=60*t.ActualFlightHOffBlock+t.ActualFlightMOffBlock;t.BlockTime=pad(Math.floor(n/60)).toString()+":"+pad(n%60).toString(),t.Duty2=pad(Math.floor(t.Duty/60)).toString()+":"+pad(t.Duty%60).toString()}),e.dg_flight_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrewFlightsTotal=function(t,i){e.loadingVisible=!0,a.getCrewFlightsTotal(t,i).then(function(t){e.loadingVisible=!1,$.each(t,function(e,t){t.DurationH=Math.floor(t.FlightTime/60),t.DurationM=t.FlightTime%60;var i=60*t.FlightH+t.FlightM;t.FlightTime2=pad(Math.floor(i/60)).toString()+":"+pad(i%60).toString(),t.Duty2=pad(Math.floor(t.Duty/60)).toString()+":"+pad(t.Duty%60).toString();var n=60*t.BlockH+t.BlockM
;t.BlockTime=pad(Math.floor(n/60)).toString()+":"+pad(n%60).toString()}),e.dg_flight_total_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.popup_flight_df=null,e.popup_flight_df_instance=null,e.popup_flight_dt=null,e.popup_flight_dt_instance=null,e.popup_flight_visible=!1,e.popup_flight_title="Flights",e.popup_flight_total_df=null,e.popup_flight_total_dt=null,e.popup_flight_total_visible=!1,e.popup_flight_total_title="Flights (Total)",e.doSearch=!1,r.isAuthorized()?(n.page_title="> Daily Roster",$(".dailyroster2").fadeIn()):r.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onPersonSaved",function(t,i){e.doRefresh=!0}),e.$on("onPersonHide",function(t,i){e.bind()}),n.$broadcast("PersonLoaded",null)}]),app.controller("courseSelectController",["$scope","$location","authService","$routeParams","$rootScope",function(e,t,i,n,a){e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_columns=[{dataField:"No",caption:"No",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:100},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"DateStart",caption:"DateStart",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"DateEnd",caption:"DateEnd",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"Organization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Instructor",caption:"Instructor",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"multiple"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData;e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.dg_height=100,e.pop_width=800,e.pop_height=500,e.popup_add_visible=!1,e.popup_add_title="Courses",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Ok",icon:"check",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=a.getWindowSize();i.width<=800&&(e.pop_width=i.width,e.pop_height=i.height),e.dg_height=e.pop_height-100},onShown:function(t){e.bind()},onHiding:function(){e.popup_add_visible=!1},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){if(!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");a.$broadcast("onCourseSelectHide",e.dg_selected),e.popup_add_visible=!1},e.bind=function(){e.dg_ds?e.dg_instance.clearSelection():e.dg_ds={store:{type:"odata",url:a.serviceUrl+"odata/courses/"+Config.CustomerId,key:"Id",version:4}}},e.$on("InitCourseSelect",function(t,i){e.popup_add_visible=!0})}]),app.controller("fuelReportController",["$scope","$location","$routeParams","$rootScope","flightService","weatherService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d,s){e.prms=i.prms,e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,airportService.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(e){var t={Id:null};n.$broadcast("InitAddPerson",t)}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitAddPerson",i)}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;e.InitAddAirport(i)}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.dg_ds=null,e.$broadcast("getFilterQuery",null)}},e.selected_employee_id=null,e.btn_flight={text:"Flights",type:"default",icon:"airplane",width:120,bindingOptions:{},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.selected_employee_id=e.dg_selected.Id,e.fillPerson(e.dg_selected),e.doSearch=!1,e.popup_flight_visible=!0}},e.btn_person={text:"Details",type:"default",icon:"card",width:120,bindingOptions:{},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitViewPerson",i)}},e.btn_flight_total={text:"Flights(Total)",type:"default",icon:"datafield",width:180,bindingOptions:{},onClick:function(t){e.popup_flight_total_visible=!0}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dt_from=new Date,e.dt_to=new Date,e.date_from={type:"date",placeholder:"From",width:"100%",bindingOptions:{value:"dt_from"}},e.date_to={type:"date",placeholder:"To",width:"100%",bindingOptions:{value:"dt_to"}},e.filters=[],e.dg_columnsX=[{caption:"Flight",fixed:!0,fixedPosition:"left",columns:[{dataField:"AircraftType",caption:"AC Type",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130,fixed:!1,fixedPosition:"left"},{dataField:"Register",caption:"Reg.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:130,fixed:!1,fixedPosition:"left"},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STDDay",caption:"Date",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:100,format:"MM-dd-yyyy",sortIndex:0,sortOrder:"asc"},{dataField:"FlightNumber",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70,fixed:!1,fixedPosition:"left"}]},{dataField:"Captain",caption:"Captain",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:110,fixed:!1,fixedPosition:"left"},{caption:"Fuel",fixed:!1,fixedPosition:"right",columns:[{dataField:"Remaining",caption:"Remaining",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90},{dataField:"UpLift",caption:"UpLift",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:110},{dataField:"Taxi",caption:"Taxi",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:80},{dataField:"UsedFuel",caption:"Used",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:110},{dataField:"FPFuel",caption:"SITA",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:80},{dataField:"AVGFuelBurned",caption:"Avg. Type",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90},{dataField:"AVGFuelBurnedReg",caption:"Avg. Reg.",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90},{dataField:"FPVar",caption:"SITA Var.",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90,customizeText:function(e){return e.value?e.value+" %":"0"}},{dataField:"AvgVar",caption:"Type Var.",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90,customizeText:function(e){return e.value?e.value+" %":"0"}},{dataField:"AvgVarReg",caption:"Reg. Var.",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90,customizeText:function(e){return e.value?e.value+" %":"0"}}]},{caption:"Flight",columns:[{dataField:"STDLocal",caption:"STD",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm",sortIndex:1,sortOrder:"asc"},{dataField:"STALocal",caption:"STA",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"DepartureLocal",caption:"B/L OFF",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"ArrivalLocal",caption:"B/L ON",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"DurationActualStr",caption:"B/L Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!1,fixedPosition:"left"},{dataField:"FlightActualStr",caption:"F/L Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!1,fixedPosition:"left"},{dataField:"TotalPax",caption:"PAX",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:100},{dataField:"TotalCargoWeight",caption:"Cargo",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:100}]}],e.dg_columns2=[{caption:"Base",columns:[{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:80,fixed:!1,fixedPosition:"left"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:180,fixed:!1,fixedPosition:"left"},{dataField:"PID",caption:"PID",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!1,fixedPosition:"left"}]},{caption:"Current Day",alignment:"center",columns:[{dataField:"Day1_Flight",caption:"Flight",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Day1_Duty",caption:"Duty",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95,sortOrder:"desc",sortIndex:0}]},{caption:"Past 7 Days",alignment:"center",columns:[{dataField:"Day7_Flight",caption:"Flight",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Day7_Duty",caption:"Duty",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95,sortOrder:"desc",sortIndex:1}]},{caption:"Past 14 Days",alignment:"center",columns:[{dataField:"Day14_Flight",caption:"Flight",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Day14_Duty",caption:"Duty",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95,sortOrder:"desc",sortIndex:2}]},{caption:"Past 28 Days",alignment:"center",columns:[{dataField:"Day28_Flight",caption:"Flight",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Day28_Duty",caption:"Duty",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95,sortOrder:"desc",sortIndex:3}]},{caption:"Past Year",alignment:"center",columns:[{dataField:"Year_Flight",caption:"Flight",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Year_Duty",caption:"Duty",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:95,sortOrder:"desc",sortIndex:4}]},{caption:"Alerts",columns:[{dataField:"",caption:"MEDICAL",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsMedicalExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"LPR",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsLPRExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsLPRExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"SKILL",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsProficiencyExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsProficiencyExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"CMC",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsCMCExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"CCRM",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsCCRMExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"AVSEC",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsAvSecExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"SEPT",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsSEPTExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"SEPTP",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsSEPTPExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"DG",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsDGExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"SMS",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsSMSExpired&&(i="red",n="ion-md-alert"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'></i>").appendTo(e)}},{dataField:"",caption:"FIRSTAID",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsFirstAidExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsFirstAidExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"COLD W.",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsColdWeatherExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsColdWeatherExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"HOT W.",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsHotWeatherExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsHotWeatherExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}},{dataField:"",caption:"UPSET",width:85,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="green",n="ion-md-checkmark-circle";1==t.data.IsUpsetRecoveryTrainingExpired&&(i="red",n="ion-md-alert");var a="";-1==t.data.IsUpsetRecoveryTrainingExpired&&(i="gray",n="",a="<span style='font-size:16px'>N/A</span>"),$("<div>").append("<i style='font-size:22px;color:"+i+"!important' class='icon "+n+"'>"+a+"</i>").appendTo(e)}}]}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_columnsX,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},summary:{totalItems:[{column:"UsedFuel",showInColumn:"UsedFuel",customizeText:function(e){return(e.value/1e3).toFixed(3).toString()+" K"},summaryType:"sum"},{column:"UpLift",showInColumn:"UpLift",customizeText:function(e){return(e.value/1e3).toFixed(3).toString()+" K"},summaryType:"sum"},{column:"UsedFuel",showInColumn:"UsedFuel",customizeText:function(e){return"Avg: "+(e.value/1e3).toFixed(3).toString()+" K"},summaryType:"avg"},{column:"UpLift",showInColumn:"UpLift",customizeText:function(e){return"Avg: "+(e.value/1e3).toFixed(3).toString()+" K"},summaryType:"avg"}]},onCellPrepared:function(e){"data"===e.rowType&&"UsedFuel"==e.column.dataField&&e.data.UsedFuel>e.data.AVGFuelBurnedReg&&e.cellElement.css("backgroundColor","#ffcccc"),"data"===e.rowType&&"AvgVar"==e.column.dataField&&e.data.AvgVar>0?e.cellElement.css("backgroundColor","#ffcccc"):"data"===e.rowType&&"AvgVar"==e.column.dataField&&e.cellElement.css("backgroundColor","#ccffdd"),"data"===e.rowType&&"AvgVarReg"==e.column.dataField&&e.data.AvgVarReg>0?e.cellElement.css("backgroundColor","#ffcccc"):"data"===e.rowType&&"AvgVarReg"==e.column.dataField&&e.cellElement.css("backgroundColor","#ccffdd"),"data"===e.rowType&&"FPVar"==e.column.dataField&&e.data.FPVar>0?e.cellElement.css("backgroundColor","#ffcccc"):"data"===e.rowType&&"FPVar"==e.column.dataField&&e.cellElement.css("backgroundColor","#ccffdd")},export:{enabled:!0,fileName:"Fuel_Report",allowExportSelectedData:!1},bindingOptions:{dataSource:"dg_ds"}},e.person={FirstName:null,LastName:null,PID:null,JobGroup:null,Mobile:null},e.fillPerson=function(t){e.person.FirstName=t.FirstName,e.person.LastName=t.LastName,e.person.PID=t.PID,e.person.JobGroup=t.JobGroup,e.person.Mobile=t.Mobile},e.clearPerson=function(t){e.person.FirstName=null,e.person.LastName=null,e.person.PID=null,e.person.JobGroup=null,e.person.Mobile=null},e.txt_FirstName={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"person.FirstName"}},e.txt_LastName={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"person.LastName"}},e.txt_PID={readOnly:!0,hoverStateEnabled:!1,rtlEnabled:!1,bindingOptions:{value:"person.PID"}},e.txt_group={readOnly:!0,hoverStateEnabled:!1,rtlEnabled:!1,bindingOptions:{value:"person.JobGroup"}},e.txt_Mobile={readOnly:!0,hoverStateEnabled:!1,mask:"AB00-0000000",maskRules:{A:/[0]/,B:/[9]/},maskChar:"_",maskInvalidMessage:"Wrong value",bindingOptions:{value:"person.Mobile"}},e.dg_flight_columns=[{dataField:"Date",caption:"Date",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"yyyy-MMM-dd"},{dataField:"FlightNumber",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!1,fixedPosition:"left"},{dataField:"Position",caption:"Position",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{caption:"Route",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70}]},{caption:"Departure",columns:[{dataField:"STD",caption:"STD",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"}]},{caption:"Arrival",columns:[{dataField:"STA",caption:"STA",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"}]},{caption:"Times",fixed:!0,fixedPosition:"right",columns:[{dataField:"FlightTime2",caption:"Flight Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"BlockTime",caption:"Block Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"Duty2",caption:"Duty",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100}]}],e.dg_flight_selected=null,e.dg_flight_instance=null,e.dg_flight_ds=null,e.dg_flight={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-235,columns:e.dg_flight_columns,onContentReady:function(t){e.dg_flight_instance||(e.dg_flight_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_flight_selected=i||null},summary:{totalItems:[{name:"FlightTimeTotal",showInColumn:"FlightTime2",displayFormat:"{0}",summaryType:"custom"},{name:"BlockTimeTotal",showInColumn:"BlockTime",displayFormat:"{0}",summaryType:"custom"},{name:"DutyTotal",showInColumn:"Duty",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"FlightTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.FlightH+e.value.FlightM,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"BlockTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.ActualFlightHOffBlock+e.value.ActualFlightMOffBlock,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"DutyTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.Duty,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_flight_ds"}},e.dg_flight_total_columns=[{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",width:150,allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"PID",caption:"PID",allowResizing:!0,alignment:"center",dataType:"string",width:150,allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"FirstName",caption:"First Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!1,fixedPosition:"left"},{dataField:"LastName",caption:"Last Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"FlightsCount",caption:"Legs",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightTime2",caption:"Flight Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"BlockTime",caption:"Block Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"Duty2",caption:"Duty",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100}],e.dg_flight_total_selected=null,e.dg_flight_total_instance=null,e.dg_flight_total_ds=null,e.dg_flight_total={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_flight_total_columns,onContentReady:function(t){e.dg_flight_total_instance||(e.dg_flight_total_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_flight_total_selected=i||null},summary:{totalItems:[{name:"FlightTimeTotal",showInColumn:"FlightTime2",displayFormat:"{0}",summaryType:"custom"},{name:"BlockTimeTotal",showInColumn:"BlockTime",displayFormat:"{0}",summaryType:"custom"},{name:"DutyTotal",showInColumn:"Duty",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"FlightTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.FlightH+e.value.FlightM,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"BlockTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.BlockH+e.value.BlockM,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"DutyTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.Duty,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_flight_total_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["FlightId",">",0]]),t},e.btn_persiandate={type:"default",icon:"event",width:35,bindingOptions:{},onClick:function(t){e.popup_date_visible=!0}},e.popup_date_visible=!1,e.popup_date_title="Date Picker";var c=null,g=null;e.popup_date={title:"Shamsi Date Picker",shading:!0,height:200,width:300,fullScreen:!1,showTitle:!0,dragEnabled:!0,visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(e){},onShown:function(t){c=$(".date1").pDatepicker({format:"l",autoClose:!0,calendar:{persian:{locale:"en"}},onSelect:function(t){e.$apply(function(){e.dt_from=new Date(t)})}}),c.setDate(new Date(e.dt_from.getTime())),g=$(".date2").pDatepicker({format:"l",autoClose:!0,calendar:{persian:{locale:"en"}},onSelect:function(t){e.$apply(function(){e.dt_to=new Date(t)})}}),g.setDate(new Date(e.dt_to.getTime()))},onHiding:function(){c.destroy(),g.destroy(),e.popup_date_visible=!1},showCloseButton:!0,bindingOptions:{visible:"popup_date_visible"}},e.bind=function(){var t=e.dt_to?new Date(e.dt_to):new Date(2200,4,19,0,0,0),i=e.dt_from?new Date(e.dt_from):new Date(1900,4,19,0,0,0),a=moment(i).format("YYYY-MM-DDTHH:mm:ss"),o=moment(t).format("YYYY-MM-DDTHH:mm:ss"),l=((new Date).getTimezoneOffset(),"odata/fuel/report/?dt="+o+"&df="+a);e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+l,version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}}}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.getCrewFlights=function(t,i,n){var o=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0,a.getCrewFlights(t,i,n).then(function(t){e.loadingVisible=!1,$.each(t,function(e,t){t.STA=new Date(t.STA).addMinutes(o),t.STD=new Date(t.STD).addMinutes(o),t.ChocksIn&&(t.ChocksIn=new Date(t.ChocksIn).addMinutes(o)),t.ChocksOut&&(t.ChocksOut=new Date(t.ChocksOut).addMinutes(o)),t.Takeoff&&(t.Takeoff=new Date(t.Takeoff).addMinutes(o)),t.Landing&&(t.Landing=new Date(t.Landing).addMinutes(o)),t.DurationH=Math.floor(t.FlightTime/60),t.DurationM=t.FlightTime%60;var i=60*t.FlightH+t.FlightM;t.FlightTime2=pad(Math.floor(i/60)).toString()+":"+pad(i%60).toString();var n=60*t.ActualFlightHOffBlock+t.ActualFlightMOffBlock;t.BlockTime=pad(Math.floor(n/60)).toString()+":"+pad(n%60).toString(),t.Duty2=pad(Math.floor(t.Duty/60)).toString()+":"+pad(t.Duty%60).toString()}),e.dg_flight_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrewFlightsTotal=function(t,i){e.loadingVisible=!0,a.getCrewFlightsTotal(t,i).then(function(t){e.loadingVisible=!1,$.each(t,function(e,t){t.DurationH=Math.floor(t.FlightTime/60),t.DurationM=t.FlightTime%60;var i=60*t.FlightH+t.FlightM;t.FlightTime2=pad(Math.floor(i/60)).toString()+":"+pad(i%60).toString(),t.Duty2=pad(Math.floor(t.Duty/60)).toString()+":"+pad(t.Duty%60).toString();var n=60*t.BlockH+t.BlockM;t.BlockTime=pad(Math.floor(n/60)).toString()+":"+pad(n%60).toString()}),e.dg_flight_total_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.popup_flight_df=null,e.popup_flight_df_instance=null,e.popup_flight_dt=null,e.popup_flight_dt_instance=null,e.popup_flight_visible=!1,e.popup_flight_title="Flights",e.popup_flight={shading:!0,width:1100,height:650,fullScreen:!0,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxDateBox",location:"before",options:{onContentReady:function(t){e.popup_flight_df_instance||(e.popup_flight_df_instance=t.component)},width:150,placeholder:"From",onValueChanged:function(t){e.popup_flight_df=t.value}},toolbar:"bottom"},{widget:"dxDateBox",location:"before",options:{onContentReady:function(t){e.popup_flight_dt_instance||(e.popup_flight_dt_instance=t.component)},width:150,placeholder:"To",onValueChanged:function(t){e.popup_flight_dt=t.value}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"success",text:"Search",icon:"search",onClick:function(t){
var i=e.popup_flight_dt?e.popup_flight_dt:new Date(2200,4,19,0,0,0),n=e.popup_flight_df?e.popup_flight_df:new Date(1900,4,19,0,0,0);e.getCrewFlights(e.selected_employee_id,n,i)}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_flight_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){if($(".dx-toolbar-items-container").addClass("dx-border"),e.popup_flight_dt_instance&&e.popup_flight_total_dt&&e.popup_flight_dt_instance.option("value",e.popup_flight_total_dt),e.popup_flight_df_instance&&e.popup_flight_total_df&&e.popup_flight_df_instance.option("value",e.popup_flight_total_df),e.doSearch){var i=e.popup_flight_dt?e.popup_flight_dt:new Date(2200,4,19,0,0,0),n=e.popup_flight_df?e.popup_flight_df:new Date(1900,4,19,0,0,0);e.getCrewFlights(e.selected_employee_id,n,i)}},onHiding:function(){e.dg_crew_flight_ds=[],e.clearPerson(),e.popup_flight_visible=!1},bindingOptions:{visible:"popup_flight_visible",title:"popup_flight_title"}},e.popup_flight_total_df=null,e.popup_flight_total_dt=null,e.popup_flight_total_visible=!1,e.popup_flight_total_title="Flights (Total)",e.doSearch=!1,e.popup_flight_total={shading:!0,width:1100,height:650,fullScreen:!0,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxDateBox",location:"before",options:{width:150,placeholder:"From",onValueChanged:function(t){e.popup_flight_total_df=t.value}},toolbar:"bottom"},{widget:"dxDateBox",location:"before",options:{width:150,placeholder:"To",onValueChanged:function(t){e.popup_flight_total_dt=t.value}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"success",text:"Search",icon:"search",onClick:function(t){var i=e.popup_flight_total_dt?e.popup_flight_total_dt:new Date(2200,4,19,0,0,0),n=e.popup_flight_total_df?e.popup_flight_total_df:new Date(1900,4,19,0,0,0);e.getCrewFlightsTotal(n,i)}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Details",icon:"airplane",onClick:function(t){if(e.dg_flight_total_selected=n.getSelectedRow(e.dg_flight_total_instance),!e.dg_flight_total_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.selected_employee_id=e.dg_flight_total_selected.Id,e.fillPerson(e.dg_flight_total_selected),e.doSearch=!0,e.popup_flight_visible=!0}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_flight_total_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){$(".dx-toolbar-items-container").addClass("dx-border")},onHiding:function(){e.dg_crew_flight_total_ds=[],e.popup_flight_total_dt=null,e.popup_flight_total_df=null,e.popup_flight_total_visible=!1},bindingOptions:{visible:"popup_flight_total_visible",title:"popup_flight_total_title"}},r.isAuthorized()?(n.page_title="> Fuel",$(".fuelreport").fadeIn()):r.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onPersonSaved",function(t,i){e.doRefresh=!0}),e.$on("onPersonHide",function(t,i){e.bind()}),n.$broadcast("PersonLoaded",null)}]),app.controller("changeFlightRegisterController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){e.prms=i.prms,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,validationGroup:"changeregister",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.bind()}},e.btn_deselectall={text:"",type:"default",icon:"far fa-square",width:40,onClick:function(t){e.dg_flight_instance.deselectAll()}},e.btn_selectall={text:"",type:"default",icon:"far fa-check-square",width:40,onClick:function(t){e.dg_flight_instance.selectAll()}},e.btn_register={text:"Change Register",type:"default",icon:"fas fa-plane",width:200,onClick:function(t){var i=n.getSelectedRows(e.dg_flight_instance);if(!i||0==i.length)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.current_actype=e.dg_register_selected.AircraftType,e.current_register=e.dg_register_selected.Register,e.popup_register_visible=!0}},e.bind=function(){var t=new Date(e.from).toDateTimeDigits(),i=new Date(e.to).toDateTimeDigits(),n={};e.dg_register_selected&&(n.RegisterID=e.dg_register_selected.RegisterID,n.TypeId=e.dg_register_selected.TypeId),e.loadingVisible=!0,a.getFlightsGrouped(Config.CustomerId,t,i).then(function(t){e.loadingVisible=!1;var i=new DevExpress.data.DataSource({store:{type:"array",key:["TypeId","RegisterID"],data:t}});if(e.dg_register_instance.option("dataSource",i),n.RegisterID){var a=[];a.push(n),e.dg_register_instance.selectRows(a,!1)}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.bindFlights=function(t){var i=new Date(e.from).toDateTimeDigits(),n=new Date(e.to).toDateTimeDigits();e.loadingVisible=!0,a.getFlightsByRegister(Config.CustomerId,-1,t,i,n).then(function(t){e.loadingVisible=!1,$.each(t,function(e,t){t.STD=new Date(t.STD+".000Z"),t.STA=new Date(t.STA+".000Z")}),e.dg_flight_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.current_actype=null,e.current_register=null,e.txt_actype={readOnly:!0,bindingOptions:{value:"current_actype"}},e.txt_register={readOnly:!0,bindingOptions:{value:"current_register"}},e.new_register=null,e.ds_msn=[],e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(e){e.selectedItem},bindingOptions:{value:"new_register",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.reason=null,e.sb_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1153),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"reason"}},e.from=null,e.date_from={type:"date",width:"100%",bindingOptions:{value:"from"}},e.to=null,e.date_to={type:"date",width:"100%",bindingOptions:{value:"to"}},e.dg_register_selected=null,e.dg_register_columns=[{dataField:"AircraftType",caption:"AC Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,groupIndex:0,sortIndex:0,sortOrder:"asc"},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,sortIndex:1,sortOrder:"asc"}],e.dg_register_height=100,e.dg_register_instance=null,e.dg_register_ds=null,e.dg_register={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_register_columns,onContentReady:function(t){e.dg_register_instance||(e.dg_register_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_register_selected=i,e.bindFlights(i.RegisterID)):(e.dg_register_selected=null,e.dg_flight_ds=null)},height:"100%",bindingOptions:{}},e.dg_flight_selected=null,e.dg_flight_columns=[{caption:"Flights",columns:[{dataField:"ID",caption:"ID",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left"},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:180},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:170,alignment:"center",format:"yyyy-MM-dd HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MM-dd HH:mm"},{dataField:"FlightH",caption:"Hour(s)",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightM",caption:"Minute(s)",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300}]}],e.dg_flight_height=100,e.dg_flight_instance=null,e.dg_flight_ds=null,e.dg_flight={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:50},showBorders:!0,selection:{mode:"multiple"},columnAutoWidth:!1,columns:e.dg_flight_columns,onContentReady:function(t){e.dg_flight_instance||(e.dg_flight_instance=t.component)},onSelectionChanged:function(e){e.selectedRowsData[0]},summary:{totalItems:[{column:"ID",summaryType:"count"}]},height:"100%",bindingOptions:{dataSource:"dg_flight_ds"}},e.popup_register_visible=!1,e.popup_register_title="Set Register",e.popup_register={fullScreen:!1,showTitle:!0,height:450,width:450,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"changeregisterset",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i=n.getSelectedRows(e.dg_flight_instance),o=Enumerable.From(i).Select("$.ID").ToArray(),l={NewRegisterId:e.new_register,UserId:n.userId,ReasonId:e.reason,Remark:null,Flights:o,From:new Date(e.from).toUTCDateTimeDigits(),To:new Date(e.to).toUTCDateTimeDigits()};e.loadingVisible=!0,a.saveFlightRegisterChange(l).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.bind(),e.popup_register_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_register_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!0,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.ds_msn=[],e.loadingVisible=!0,o.getAvailableMSNsByType(Config.CustomerId,-1).then(function(t){e.loadingVisible=!1,e.ds_msn=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},onHiding:function(){e.popup_register_visible=!1},bindingOptions:{visible:"popup_register_visible",title:"popup_register_title"}},l.isAuthorized()?(n.page_title="> Change Registers",$(".changeregister").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("flightBoardController",["$scope","$location","$routeParams","$rootScope","flightService","weatherService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d,s){function c(e){var t=e.html(),i=$("<iframe />");i[0].name="frame1",i.css({position:"absolute",top:"-1000000px"}),$("body").append(i);var n=i[0].contentWindow?i[0].contentWindow:i[0].contentDocument.document?i[0].contentDocument.document:i[0].contentDocument;n.document.open(),n.document.write("<html><head><title></title>"),n.document.write("</head><body>"),n.document.write('<link href="content/css/bootstrap.css" rel="stylesheet" />'),n.document.write('<link href="content/css/main.css" rel="stylesheet" />'),n.document.write(t),n.document.write("</body></html>"),n.document.close(),setTimeout(function(){window.frames.frame1.focus(),window.frames.frame1.print(),i.remove()},500)}function g(e){var t=new Date;t.setHours(e,0,0,0),t=t.addMinutes(330);var i=t.getHours(),n=t.getMinutes();return(i>9?"":"0")+i+":"+(n>9?"":"0")+n}e.prms=i.prms,r.setModule(3),n.setTheme(),console.log("Updtae delay remark theme 3"),e.IsPlanning=n.HasMenuAccess("flight_planning",3),e.IsJLAccess=n.HasMenuAccess("flight_board_jl",3),e.airport=i.airport,e.airportEntity=null,e.filterVisible=!1,e.IsDispatch=s.current.isDispatch,e.IsDepartureVisible=!0,e.IsArrivalVisible=!0,e.IsDepartureDisabled=!0,e.IsArrivalDisabled=!0,e.IsAdmin=!0,e.IsEditable=n.IsFlightBoardEditable(),e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").hide()):(e.filterVisible=!0,$(".filter").show())}},e.flight=null,e.takeOffVisible=!1,e.offBlockVisible=!1,e.onBlockVisible=!1,e.landingVisible=!1,e.btn_takeoff={text:"Take Off",type:"default",icon:"fas fa-plane-departure",width:"150",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.takeOffReadOnly=!1,e.flight=e.selectedFlights[0],e.flightTakeOff=e.flight.ChocksOut,(new Date).getDatePart()==new Date(e.flight.STD).getDatePart()&&(e.flightTakeOff=new Date),e.popup_takeoff_visible=!0}},e.btn_information={text:"Information",type:"default",icon:"fas fa-info-circle",width:"100%",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.popup_inf_visible=!0}},e.record=null,e.btn_dep={text:"Dep",type:"default",icon:"fas fa-plane-departure",width:"100%",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.calculateTotalPax(),e.popup_flight_visible=!0}},e.showLog=function(t){if(!e.IsSelectionMode){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.flight.FuelUnitID||(e.flight.FuelUnitID=115),e.flight.CargoUnitID||(e.flight.CargoUnitID=111),e.flight.STA2=new Date(e.flight.STA),e.flight.STD2=new Date(e.flight.STD),e.calculateTotalPax(),e.flight.Defuel||(e.flight.Defuel=230),-1!=n.roles.indexOf("nopax")&&(e.flight.PaxAdult=null,e.flight.PaxChild=null,e.flight.PaxInfant=null,e.flight.TotalPax=null,e.loadPax=null),t?e.$apply(function(){e.doUTC?e.timeBaseReadOnly=!0:e.timeBaseReadOnly=!1,e.popup_log_visible=!0}):(e.doUTC?e.timeBaseReadOnly=!0:e.timeBaseReadOnly=!1,e.popup_log_visible=!0)}},e.btn_log={text:"Log",type:"default",icon:"fas fa-plane-departure",width:"100%",bindingOptions:{},onClick:function(t){e.showLog()}},e.btn_arr={text:"Arrival",type:"default",icon:"fas fa-plane-arrival",width:"100%",bindingOptions:{disabled:"IsArrivalDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.popup_arr_visible=!0}},e.btn_offblock={text:"Off Block",type:"default",icon:"far fa-square",width:"150",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.flightOffBlock=new Date(e.flight.baseStartDate),(new Date).getDatePart()==new Date(e.flight.STD).getDatePart()&&(e.flightOffBlock=new Date),e.popup_offblock_visible=!0}},e.btn_onblock={text:"On Block",type:"default",icon:"fas fa-square",width:"150",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.flightOnBlock=new Date(e.flight.Landing),(new Date).getDatePart()==new Date(e.flight.STD).getDatePart()&&(e.flightOnBlock=new Date),e.popup_onblock_visible=!0}},e.btn_landing={text:"Landing",type:"default",icon:"fas fa-plane-arrival",width:"150",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.takeOffReadOnly=!0,e.flightTakeOff=e.flight.Takeoff,e.flightLanding=e.flight.baseEndDate,(new Date).getDatePart()==new Date(e.flight.STA).getDatePart()&&(e.flightLanding=new Date),e.popup_landing_visible=!0}},e.btn_crew={text:"Crew",type:"default",icon:"fas fa-user-circle",width:"100%",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.popup_crew_visible=!0}},e.linked_flight={},e.linkEntity={},e.time_ir_std_date=null,e.time_ir_std_time=null,e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.moment2=function(e){return e?moment(e).format("MM-DD-YYYY HH:mm"):""},e.setArrival=function(){if(e.doIrRoute)if(e.linkEntity&&null!=e.time_ir_std_date&&null!=e.time_ir_std_time&&null!=e.linkEntity.FlightH&&null!=e.linkEntity.FlightM){var t=new Date(e.time_ir_std_date).getDatePartArray(),i=new Date(e.time_ir_std_time).getTimePartArray(),n=new Date(t[0],t[1],t[2],i[0],i[1],0,0),a=new Date(n.addHours(e.linkEntity.FlightH).addMinutes(e.linkEntity.FlightM));e.time_ir_sta_date=General.getDayFirstHour(new Date(a)),e.time_ir_sta_time=new Date(a)}else e.time_ir_sta_date=null,e.time_ir_sta_time=null},e.text_ir_flightnumber={bindingOptions:{value:"linkEntity.FlightNumber"}},e.text_ir_flighth={min:0,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"linkEntity.FlightH"}},e.text_ir_flightm={min:0,max:59,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"linkEntity.FlightM"}},e.txt_ir_LinkedRemark={bindingOptions:{value:"linkEntity.LinkedRemark"}},e.useCrew=!0,e.chk_ir_crew={text:"Use Crew",bindingOptions:{value:"useCrew"}},e.time_ir_start={type:"date",width:"100%",interval:15,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"time_ir_std_date"}},e.time_ir_start_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"time_ir_std_time"}},e.time_ir_end={type:"date",width:"100%",interval:15,readOnly:!0,onValueChanged:function(e){},bindingOptions:{value:"time_ir_sta_date"}},e.time_ir_end_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,readOnly:!0,onValueChanged:function(e){},bindingOptions:{value:"time_ir_sta_time"}},e.sb_ir_fromairport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceAirport(),onSelectionChanged:function(t){e.getIrRoute()},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"linkEntity.FromAirportId"}},e.sb_ir_toairport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceAirport(),onSelectionChanged:function(t){e.getIrRoute()},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"linkEntity.ToAirportId"}},e.sb_ir_flighttype={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"linkEntity.FlightTypeID"}},e.getRealMSNs=function(e){return new DevExpress.data.DataSource({store:new DevExpress.data.ODataStore({url:n.serviceUrl+"odata/aircrafts/customer/"+e,version:4}),sort:["AircraftType","Register"]})},e.getSbTemplateAircraft=function(e){return"<div><div class='tmpl-col-left'>"+e.Register+"</div><div class='tmpl-col-right'>"+e.AircraftType+"</div></div>"},e.sb_ir_msn={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(t){return e.getSbTemplateAircraft(t)},searchExpr:["Register","MSN"],dataSource:e.getRealMSNs(Config.CustomerId),displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(e){},bindingOptions:{value:"linkEntity.RegisterID"}},e.getIrRoute=function(){e.doIrRoute&&e.linkEntity&&e.linkEntity.FromAirportId&&e.linkEntity.ToAirportId&&(e.loadingVisible=!0,a.getRoute(e.linkEntity.FromAirportId,e.linkEntity.ToAirportId).then(function(t){t&&(e.linkEntity.FlightH=t.FlightH,e.linkEntity.FlightM=t.FlightM),e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},e.btn_link={text:"Link",type:"default",icon:"fas fa-link",width:120,onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.doIrRoute=!0,e.linkEntity={ID:-1,CustomerId:Config.CustomerId},e.linkEntity.LinkedFlight=e.flight.ID,e.flight.RedirectReasonId&&(e.linkEntity.ToAirportId=e.flight.OToAirportId,e.linkEntity.ToAirportIATA=e.flight.OToAirportIATA,e.linkEntity.FlightNumber=null,e.linkEntity.FlightPlanId=null,e.linkEntity.FromAirportId=e.flight.ToAirport,e.linkEntity.FromAirportIATA=e.flight.ToAirportIATA,e.time_ir_std_date=General.getDayFirstHour(new Date(e.flight.STD)),e.time_ir_std_time=null,e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.linkEntity.FlightTypeID=null,e.linkEntity.RegisterID=e.flight.RegisterID),e.popup_link_visible=!0}},e.btn_free={text:"N/S Flight",type:"default",icon:"airplane",width:150,onClick:function(t){e.doIrRoute=!0,e.linkEntity={ID:-1,CustomerId:Config.CustomerId};var i=General.getDayFirstHour(new Date(e.selectedDate));e.time_ir_std_date=new Date(i),e.popup_free_visible=!0}},e.btn_roster={text:"Roster",type:"default",icon:"",width:120,onClick:function(t){e.popup_roster_visible=!0}},e.before_refreshed_flight=null,e.undoRefresh=function(){e.flight.FlightStatusID=e.before_refreshed_flight.FlightStatusID,e.flight.DepartureRemark=e.before_refreshed_flight.DepartureRemark,e.flight.CancelReasonId=e.before_refreshed_flight.CancelReasonId,e.flight.CancelRemark=e.before_refreshed_flight.CancelRemark,e.flight.CancelDate=e.before_refreshed_flight.CancelDate,e.flight.RedirectReasonId=e.before_refreshed_flight.RedirectReasonId,e.flight.RedirectRemark=e.before_refreshed_flight.RedirectRemark,e.flight.RedirectDate=e.before_refreshed_flight.RedirectDate,e.flight.RampReasonId=e.before_refreshed_flight.RampReasonId,e.flight.RampRemark=e.before_refreshed_flight.RampRemark,e.flight.RampDate=e.before_refreshed_flight.RampDate,e.flight.ToAirport=e.before_refreshed_flight.ToAirport,e.flight.ToAirportIATA=e.before_refreshed_flight.ToAirportIATA,e.flight.OToAirportId=e.before_refreshed_flight.OToAirportId,e.flight.OToAirportIATA=e.before_refreshed_flight.OToAirportIATA,e.flight.FPFlightHH=e.before_refreshed_flight.FPFlightHH,e.flight.FPFlightMM=e.before_refreshed_flight.FPFlightMM,e.flight.FPFuel=e.before_refreshed_flight.FPFuel,e.flight.Defuel=e.before_refreshed_flight.Defuel,e.flight.TotalDelayHH=e.before_refreshed_flight.TotalDelayHH,e.flight.TotalDelayMM=e.before_refreshed_flight.TotalDelayMM,e.flight.TotalDelayTotalMM=e.before_refreshed_flight.TotalDelayTotalMM,e.flight.PaxAdult=e.before_refreshed_flight.PaxAdult,e.flight.PaxChild=e.before_refreshed_flight.PaxChild,e.flight.PaxInfant=e.before_refreshed_flight.PaxInfant,e.flight.BaggageCount=e.before_refreshed_flight.BaggageCount,e.flight.BaggageWeight=e.before_refreshed_flight.BaggageWeight,e.flight.CargoWeight=e.before_refreshed_flight.CargoWeight,e.flight.CargoCount=e.before_refreshed_flight.CargoCount,e.flight.FuelDeparture=e.before_refreshed_flight.FuelDeparture,e.flight.FuelArrival=e.before_refreshed_flight.FuelArrival,e.flight.ChocksOut=e.before_refreshed_flight.ChocksOut,e.flight.Takeoff=e.before_refreshed_flight.Takeoff,e.flight.Landing=e.before_refreshed_flight.Landing,e.flight.ChocksIn=e.before_refreshed_flight.ChocksIn,e.flightOffBlock2=e.flight.ChocksOut,e.flightOffBlock2||(e.flightOffBlock2=e.flight.STD),e.flightTakeOff2=e.flight.Takeoff,e.flightTakeOff2||(e.flightTakeOff2=e.flight.STD),e.flightOnBlock2=e.flight.ChocksIn,e.flightOnBlock2||(e.flightOnBlock2=e.flight.STA),e.flightLanding2=e.flight.Landing,e.flightLanding2||(e.flightLanding2=e.flight.STA)},e.btn_refresh={text:"Refresh",type:"danger",width:120,onClick:function(t){e.before_refreshed_flight=JSON.parse(JSON.stringify(e.flight)),e.flight.FlightStatusID=1,e.flight.DepartureRemark=null,e.time_status_value=null,e.flight.CancelReasonId=null,e.flight.CancelRemark=null,e.flight.CancelDate=null,e.flight.RedirectReasonId=null,e.flight.RedirectRemark=null,e.flight.RedirectDate=null,e.flight.RampReasonId=null,e.flight.RampRemark=null,e.flight.RampDate=null,e.flight.OToAirportId&&(e.flight.ToAirport=e.flight.OToAirportId,e.flight.ToAirportIATA=e.flight.OToAirportIATA),e.flight.FPFlightHH=null,e.flight.FPFlightMM=null,e.flight.FPFuel=null,e.flight.Defuel=null,e.flight.TotalDelayHH=null,e.flight.TotalDelayMM=null,e.flight.TotalDelayTotalMM=0,e.flight.PaxAdult=null,e.flight.PaxChild=null,e.flight.PaxInfant=null,e.flight.BaggageCount=null,e.flight.BaggageWeight=null,e.flight.CargoWeight=null,e.flight.CargoCount=null,e.flight.FuelDeparture=null,e.flight.FuelArrival=null,e.dg_delay_ds=[],e.flight.ChocksOut=null,e.flight.Takeoff=null,e.flight.Landing=null,e.flight.ChocksIn=null,e.flight.UsedFuel=null,e.flight.JLBLHH=null,e.flight.JLBLMM=null,e.flight.PFLR=null,e.flight.NightTime=null,e.flightOffBlock2=e.flight.ChocksOut,e.flightOffBlock2||(e.flightOffBlock2=e.flight.STD),e.flightTakeOff2=e.flight.Takeoff,e.flightTakeOff2||(e.flightTakeOff2=e.flight.STD),e.flightOnBlock2=e.flight.ChocksIn,e.flightOnBlock2||(e.flightOnBlock2=e.flight.STA),e.flightLanding2=e.flight.Landing,e.flightLanding2||(e.flightLanding2=e.flight.STA)}},e.jl={},e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.flight.ID};e.loadingVisible=!0,a.deleteFlight(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.BeginSearch()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_print={text:"Print",type:"default",icon:"print",width:110,onClick:function(t){console.log(e.multiSelectedFlights)}},e.btn_pax={text:"Pax",type:"default",icon:"fas fa-user-tag",width:"100%",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.depReadOnly=!1,e.paxSaved=!1,e.flight=e.selectedFlights[0],e.calculateTotalPax(),e.popup_pax_visible=!0}},e.btn_cargo={text:"Cargo",type:"default",icon:"fas fa-boxes",width:"100%",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.depReadOnly=!1,e.flight=e.selectedFlights[0],e.cargoSaved=!1,e.popup_cargo_visible=!0}},e.fuelDepSaved=!1,e.fuelArrSaved=!1,e.$dgrow=null,e.btn_fueldep={text:"Fuel(D)",type:"default",icon:"fas fa-burn",width:"100%",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.depReadOnly=!1,e.flight=e.selectedFlights[0],e.fuelDepSaved=!1,e.$dgrow=$("#dg_flights").find(".dx-row.dx-selection"),e.popup_fueldep_visible=!0}},e.fuelArrSaved=!1,e.btn_fuelarr={text:"Fuel(A)",type:"default",icon:"fas fa-burn",width:"100%",bindingOptions:{disabled:"IsArrivalDisabled"},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.fuelArrSaved=!1,e.popup_fuelarr_visible=!0}},e.IsCancelVisible=!1,e.btn_cancel={text:"Cancel",type:"danger",icon:"fas fa-ban",width:"150",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.entity_cancel.CancelDate=new Date(Date.now()),e.popup_cancel_visible=!0}},e.IsRedirectVisible=!1,e.btn_redirect={text:"Redirect",type:"danger",icon:"fas fa-random",width:"150",bindingOptions:{},onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");e.flight=e.selectedFlights[0],e.entity_redirect.RedirectDate=new Date(Date.now()),e.popup_redirect_visible=!0}},e.getGantt=function(){return $("#resourceGanttba").data("ejGantt")},e.ganttData=null,e.resourceGroups=[],e.resources=[],e.dataSource=[],e.totalFlights="-",e.totalDelays="-",e.departedFlights="-",e.arrivedFlights="-",e.canceledFlights="-",e.departedPax="-",e.arrivedPax="-",e.calculateSummary=function(){e.totalFlights=e.dataSource.length,e.departedFlights=Enumerable.From(e.dataSource).Where("$.Takeoff").ToArray().length,e.arrivedFlights=Enumerable.From(e.dataSource).Where("$.Landing").ToArray().length,e.canceledFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==4").ToArray().length,e.redirectedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==17").ToArray().length,e.divertedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID== 7").ToArray().length,e.totalDelays=Enumerable.From(e.dataSource).Where("$.ChocksOut").Select("$.delay").Sum(),e.departedPax=Enumerable.From(e.dataSource).Where("$.Takeoff").Select("$.TotalPax").Sum(),e.arrivedPax=Enumerable.From(e.dataSource).Where("$.Landing").Select("$.TotalPax").Sum(),e.airportEntity&&(e.totalFlights=e.dataSource.length,e.departedFlights=Enumerable.From(e.dataSource).Where("$.Takeoff && $.FromAirport=="+e.airportEntity.Id).ToArray().length,e.arrivedFlights=Enumerable.From(e.dataSource).Where("$.Landing && $.ToAirport=="+e.airportEntity.Id).ToArray().length,e.canceledFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==4").ToArray().length,e.redirectedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==17").ToArray().length,e.divertedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID== 7").ToArray().length,e.totalDelays=Enumerable.From(e.dataSource).Where("$.FromAirport=="+e.airportEntity.Id+" && $.ChocksOut").Select("$.delay").Sum(),e.departedPax=Enumerable.From(e.dataSource).Where("$.Takeoff && $.FromAirport=="+e.airportEntity.Id).Select("$.TotalPax").Sum(),e.arrivedPax=Enumerable.From(e.dataSource).Where("$.Landing && $.ToAirport=="+e.airportEntity.Id).Select("$.TotalPax").Sum())},e.gaugeOptions={valueIndicator:{indentFromCenter:50,spindleSize:0,type:"rangeBar"},subvalueIndicator:{type:"textcloud",text:{customizeText:function(e){return e.valueText}}},scale:{startValue:0,endValue:150,tickInterval:10,label:{useRangeColors:!0}},rangeContainer:{palette:"pastel",ranges:[{startValue:0,endValue:150}]},title:{text:"Departed",font:{size:14},verticalAlignment:"bottom"},size:{width:200,height:200},value:90,subvalues:[90]};var u=-1*(new Date).getTimezoneOffset();new Date(e.datefrom)<new Date(2020,2,21,0,0,0,0)&&(u+=60),e.convertUTCEnabled=!0,e.footerfilter=!1,e.searched=!1,e.baseSum=null,e.doUTC=!1,e.doUtcEnabled=!1,e.check_utc={width:"100%",text:"UTC",onValueChanged:function(t){e.doUtcEnabled&&(e.StopUTimer(),e.activatedStbys=null,e.BeginSearch())},bindingOptions:{value:"doUTC"}},e.sms_delay=!1,e.check_sms_delay={width:"100%",text:"Delay",bindingOptions:{
value:"sms_delay"}},e.sms_cancel=!1,e.check_sms_cancel={width:"100%",text:"Cancel",bindingOptions:{value:"sms_cancel"}},e.bindFlights=function(t){e.doUtcEnabled=!0;if(t)try{$(".e-ganttviewerbodyContianer").data("ejScroller").scrollLeft()}catch(e){alert(e)}var i={Status:e.filterStatus,Types:e.filterType,Registers:e.filterAircraft,From:e.filterFrom,To:e.filterTo};e.hideButtons2(),e.selectedFlights=[],e.dg_flights_instance.deselectAll(),e.selectedTabDateIndex=-1,e.loadingVisible=!0;var n=new Date(e.dateEnd).toUTCDateTimeDigits();a.getFlightsGantt2(Config.CustomerId,new Date(e.datefrom).toUTCDateTimeDigits(),n,u,-1,e.doUTC?1:0,i).then(function(t){try{e.tabsdatefirst=!0,e.tabs_date=[];var i,n=new Date(e._datefrom);for(i=1;i<=e.days_count;i++){var o=moment(n).format("ddd DD-MMM-YYYY");e.tabs_date.push({text:o,id:i,date:moment(n).format("YYYY/MM/DD")}),n=n.addDays(1)}if(e.tabsdatevisible=!0,e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,e.baseSum=e.ganttData.baseSummary,e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource(t.flights),Flight.activeDatasource=e.dataSource,e.dg_flights_ds=e.dataSource,e.calculateSummary(),e.selectedTabDateIndex=0,!e.activatedStbys){e.activatedStbys=[];var l=new Date(e.tabs_date[0].date),r=moment(l).format("YYYY-MM-DDTHH:mm:ss"),d=new Date(e.tabs_date[e.tabs_date.length-1].date),s=moment(d).format("YYYY-MM-DDTHH:mm:ss");a.getActivatedStbys(r,s).then(function(t){console.log("getActivatedStbys"),console.log(t),$.each(t,function(t,i){i.PositionId=e.getDefaultPositionId(i.JobGroup),e.activatedStbys.push(i)})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}catch(e){alert(e)}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.baseDate=null,e.search=function(){e.updatedFlightsCount=0,e.updatedFlights=[],e.bindFlights(!1)},e.fillFlight=function(e,t){e.FlightPlanId=t.FlightPlanId,e.BaggageCount=t.BaggageCount,e.CargoUnitID=t.CargoUnitID,e.CargoUnit=t.CargoUnit,e.CargoWeight=t.CargoWeight,e.PaxChild=t.PaxChild,e.PaxInfant=t.PaxInfant,e.PaxAdult=t.PaxAdult,e.FuelArrival=t.FuelArrival,e.FuelDeparture=t.FuelDeparture,e.FuelActual=t.FuelActual,e.FuelPlanned=t.FuelPlanned,e.GWLand=t.GWLand,e.GWTO=t.GWTO,e.BlockM=t.BlockM,e.BlockH=t.BlockH,e.FlightH=t.FlightH,e.FlightM=t.FlightM,e.ChocksIn=t.ChocksIn,e.Landing=t.Landing,e.Takeoff=t.Takeoff,e.ChocksOut=t.ChocksOut,e.STD=t.STD,e.STA=t.STA,e.FlightStatusID=t.FlightStatusID,e.RegisterID=t.RegisterID,e.FlightTypeID=t.FlightTypeID,e.TypeId=t.TypeId,e.AirlineOperatorsID=t.AirlineOperatorsID,e.FlightNumber=t.FlightNumber,e.FromAirport=t.FromAirport,e.ToAirport=t.ToAirport,e.STAPlanned=t.STAPlanned,e.STDPlanned=t.STDPlanned,e.FlightHPlanned=t.FlightHPlanned,e.FlightMPlanned=t.FlightMPlanned,e.FlightPlan=t.FlightPlan,e.CustomerId=t.CustomerId,e.IsActive=t.IsActive,e.DateActive=t.DateActive,e.FromAirportName=t.FromAirportName,e.FromAirportIATA=t.FromAirportIATA,e.FromAirportCityId=t.FromAirportCityId,e.ToAirportName=t.ToAirportName,e.ToAirportIATA=t.ToAirportIATA,e.ToAirportCityId=t.ToAirportCityId,e.FromAirportCity=t.FromAirportCity,e.ToAirportCity=t.ToAirportCity,e.AircraftType=t.AircraftType,e.Register=t.Register,e.MSN=t.MSN,e.FlightStatus=t.FlightStatus,e.FlightStatusBgColor=t.FlightStatusBgColor,e.FlightStatusColor=t.FlightStatusColor,e.FlightStatusClass=t.FlightStatusClass,e.from=t.from,e.to=t.to,e.notes=t.notes,e.status=t.status,e.progress=t.progress,e.taskName=t.taskName,e.startDate=t.startDate,e.duration=t.duration,e.taskId=t.taskId,e.FlightGroupID=t.FlightGroupID,e.PlanId=t.PlanId,e.ManufacturerId=t.ManufacturerId,e.Manufacturer=t.Manufacturer,e.ToCountry=t.ToCountry,e.ToSortName=t.ToSortName,e.ToCity=t.ToCity,e.FromSortName=t.FromSortName,e.FromContry=t.FromContry,e.FromCity=t.FromCity,e.FromLatitude=t.FromLatitude,e.FromLongitude=t.FromLongitude,e.ToLatitude=t.ToLatitude,e.ToLongitude=t.ToLongitude,e.CargoCount=t.CargoCount,e.BaggageWeight=t.BaggageWeight,e.FuelUnitID=t.FuelUnitID,e.ArrivalRemark=t.ArrivalRemark,e.DepartureRemark=t.DepartureRemark,e.TotalSeat=t.TotalSeat,e.EstimatedDelay=t.EstimatedDelay,e.PaxOver=t.PaxOver,e.TotalPax=t.TotalPax,e.NightTime=t.NightTime,e.FuelUnit=t.FuelUnit,e.DateStatus=t.DateStatus,e.UsedFuel=t.UsedFuel,e.JLBLHH=t.JLBLHH,e.JLBLMM=t.JLBLMM,e.PFLR=t.PFLR},e.doActionCompleteSave=!0,e.updatedFlightsCount=0,e.updatedFlights=[],e.addUpdatedFlights=function(t){e.updatedFlights=Enumerable.From(e.updatedFlights).Where("$.ID!="+t.ID).ToArray();var i={ID:t.ID,FlightNumber:t.FlightNumber,ToAirportIATA:t.ToAirportIATA,FromAirportIATA:t.FromAirportIATA,FlightStatus:t.FlightStatus,DateStatus:t.DateStatus};e.updatedFlights.push(i),e.updatedFlightsCount=e.updatedFlights.length},e.removeUpdatedFlights=function(t){e.updatedFlights=Enumerable.From(e.updatedFlights).Where("$.ID!="+t.ID).ToArray(),e.updatedFlightsCount=e.updatedFlights.length},e.showUpdatedFlights=function(){e.popup_upd_visible=!0},e.utimer=null,e.StartUTimer=function(){e.utimer=setTimeout(function(){var t={from:new Date(e.datefrom).toUTCString(),to:new Date(e.dateto).toUTCString(),baseDate:e.baseDate,airport:e.airportEntity?e.airportEntity.Id:-1,customer:Config.CustomerId,tzoffset:-1*(new Date).getTimezoneOffset(),userid:n.userId?n.userId:-1};a.getUpdatedFlights(t).then(function(t){e.baseDate=new Date(Date.now()).toUTCString();var i=$("#resourceGanttba").data("ejGantt");if($.each(t.flights,function(t,n){var a=Enumerable.From(e.dataSource).Where("$.ID=="+n.ID).FirstOrDefault();a&&(e.doActionCompleteSave=!1,e.fillFlight(a,n),Flight.processDataOffBlock(a),e.addUpdatedFlights(a),i.reRenderChart(),e.flight&&$(".task-"+e.flight.ID).parent().addClass("e-gantt-taskbarSelection"),e.calculateSummary())}),-1!=t.summary&&(e.baseSum=t.summary),t&&t.flights&&t.flights.length>0){var n=t.flights[0];moment(n.DateStatus).format("MMMM Do YYYY, h:mm:ss a"),n.FromAirportIATA,n.ToAirportIATA,n.FlightNumber,n.FlightStatus}},function(e){}),e.StartUTimer(),console.log(StartUTimer+"    "+new Date)},3e4)},e.StopUTimer=function(){e.utimer&&clearTimeout(e.utimer)},e.nowlinetimer=null,e.nowlinelastdate=new Date,e.IsUTC=!1,e.modifyLinkedFlights=function(){var e=$(".linked-flight");e.length>0&&e.each(function(){var e=$(this).data("linked");if(e){var t=$(this).closest(".e-childContainer"),i=$(".task-"+e).closest(".e-childContainer");if(i.length>0){var n=i.position().left;t.css({left:n+10})}}$(this).show()})},e.StartNowLineTimerFirst=!0,e.StartNowLineTimerFirstTime=null,e.nowlineInitLeft=null;var p=-1*(new Date).getTimezoneOffset(),h=function(e){var t=new Date,i=t.getUTCMonth()+1,n=t.getUTCDate(),a=t.getUTCHours(),o=t.getUTCMinutes(),l=t.getUTCSeconds();return t.getUTCFullYear()+"/"+(i>9?"":"0")+i+"/"+(n>9?"":"0")+n+" "+(a>9?"":"0")+a+":"+(o>9?"":"0")+o+":"+(l>9?"":"0")+l};e.StartNowLineTimer=function(t){e.nowlinetimer=setTimeout(function(){if(e.StartNowLineTimerFirst){e.StartNowLineTimerFirst=!1,e.StartNowLineTimerFirstTime=(new Date).getTime(),e.doUTC&&(e.StartNowLineTimerFirstTime=(new Date).addMinutes(-1*p).getTime());var t=new Date,i=new Date(t).yyyymmddtimenow(e.IsUTC);e.doUTC&&(t=t.addMinutes(-1*p),i=h());$("#resourceGanttba").data("ejGantt").setModel2({stripLines:[{day:i,lineWidth:"2",lineColor:"#ff0066",lineStyle:"solid"}]},null,function(){}),$("#stripline0").height($("#ganttviewerbodyContianerejGanttChartresourceGanttba").height())}else if($("#stripline0").height($("#ganttviewerbodyContianerejGanttChartresourceGanttba").height()),e.nowlineInitLeft||(e.nowlineInitLeft=$("#stripline0").position().left),e.nowlineInitLeft){var n=(new Date).getTime();e.doUTC&&(n=(new Date).addMinutes(-1*p).getTime());var a=(n-e.StartNowLineTimerFirstTime)/1e3;e.StartNowLineTimerFirstTime=n;var o=e.timeCellWidth*a*1/3600;e.nowlineInitLeft=Number(e.nowlineInitLeft+o),$("#stripline0").css({left:e.nowlineInitLeft})}e.nowlinelastdate=new Date,e.doUTC&&(e.nowlinelastdate=(new Date).addMinutes(-1*p));var l=$("#stripline0"),r="<div style='font-size:11px;font-weight:bold;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow()+"</div><div style='font-size:11px;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow(!0)+"</div>";if(e.doUTC)var r="<div style='font-size:11px;font-weight:bold;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow()+"</div><div style='font-size:11px;padding-left:2px;'>"+e.nowlinelastdate.addMinutes(p).hhmmnow()+"</div>";e.IsUTC&&(r="<div style='font-size:11px;font-weight:bold;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow()+"</div><div style='font-size:11px;padding-left:2px;'>"+e.nowlinelastdate.hhmmnow(!0)+"</div>"),l.html(r),e.renderTopTimeHeader(),e.renderTimeHeader(),e.StartNowLineTimer(10)},1e3*t)},e.StopNowLineTimer=function(){e.nowlinetimer&&clearTimeout(e.nowlinetimer)},e.selectedTabDateIndex=-1,e.tabsdatefirst=!0,e.$watch("selectedTabDateIndex",function(t){-1!=e.selectedTabDateIndex&&(e.selectedTab=e.tabs_date[t],e.selectedDate=new Date(e.selectedTab.date),e.StopNowLineTimer(),e.createGantt(),e.footerfilter=!0,e.searched=!0,e.autoUpdate&&e.StartUTimer())}),e.tabs_date=[],e.tabs_date_options={scrollByContent:!0,showNavButtons:!0,elementAttr:{class:"tabsdate"},onItemClick:function(e){},onItemRendered:function(t){e.selectedTabDateIndex=-1,e.selectedTabDateIndex=0},bindingOptions:{visible:"tabsdatevisible",dataSource:{dataPath:"tabs_date",deep:!0},selectedIndex:"selectedTabDateIndex"}},e.autoUpdate=!0,e.check_autoupdate={width:"100%",text:"Auto Update",onValueChanged:function(t){t.value?e.StartUTimer():e.StopUTimer()},bindingOptions:{value:"autoUpdate"}},e.IsSelectionMode=!1,e.multiSelectedFlights=[],e.check_multiselect={width:"100%",text:"Multi Select",onValueChanged:function(t){t.value?$(document).on("click",".bati",function(){var t=$(this).data("id"),i=($("#task-"+t).parent(),$(".task-"+t)),n=Enumerable.From(e.dataSource).Where("$.Id=="+t).FirstOrDefault();i.hasClass("thick-border")?(e.multiSelectedFlights=Enumerable.From(e.multiSelectedFlights).Where("$.Id!="+t).ToArray(),i.removeClass("thick-border")):(e.multiSelectedFlights.push(n),i.addClass("thick-border"))}):(e.multiSelectedFlights=[],$(".bati").removeClass("thick-border").off("click"))},bindingOptions:{value:"IsSelectionMode"}},e.checkConflict=function(e){var t=!1;return $.each(e,function(i,n){n.Route=n.FromAirportIATA+"-"+n.ToAirportIATA,Enumerable.From(e).Where(function(e){return e.ID!=n.ID&&(new Date(e.STD)>=new Date(n.STD)&&new Date(e.STD)<=new Date(n.STA)||new Date(e.STA)>=new Date(n.STD)&&new Date(e.STA)<=new Date(n.STA))}).FirstOrDefault()&&(t=!0)}),t},e.checkContinuity=function(e){var t=!1,i=Enumerable.From(e).OrderBy(function(e){return new Date(e.STD)}).ToArray();return $.each(i,function(e,n){e>0&&e<i.length-1&&n.ToAirport!=i[e+1].FromAirport&&(t=!0)}),t},e.STBYFDPStat={},e.getDaySTBYs=function(t,i){var n=e.multiSelectedFlights[0].FromAirport,o=Number(moment(new Date(e.multiSelectedFlights[0].STD)).format("HHmm")),l=moment(e.selectedDate).format("YYYY-MM-DDTHH:mm:ss");e.loadingVisible=!0,a.rosterSTBYs({},l,l,n,o).then(function(t){e.loadingVisible=!1,console.log(t),i&&i(t)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.col_stby_class1="col-lg-4 col-md-9 col-sm-9 col-xs-9 col1 fc11",e.col_stby_class2="col-lg-4 col-md-9 col-sm-9 col-xs-9 col1 fc11",e.btn_stby={text:"StandBy",type:"default",icon:"",width:120,onClick:function(t){var i=e.multiSelectedFlights;if(i&&0!=i.length){e.col_stby_class1="col-lg-4 col-md-9 col-sm-9 col-xs-9 col1 fc11",e.col_stby_class2="col-lg-4 col-md-9 col-sm-9 col-xs-9 col1 fc11",e.multiSelectedFlights=Enumerable.From(e.multiSelectedFlights).OrderBy(function(e){return new Date(e.STD)}).ToArray();var n=e.checkConflict(e.multiSelectedFlights),o=e.checkContinuity(e.multiSelectedFlights);if(n||o)return;var l=Enumerable.From(e.multiSelectedFlights).Select("$.ID").ToArray();e.STBYFDPStat={},e.loadingVisible=!0,a.getFDPStats(l.join("_")).then(function(t){e.loadingVisible=!1,e.STBYFDPStat=t,t.DurationStr=pad(Math.floor(t.Duration/60)).toString()+":"+pad(Math.round(t.Duration%60)).toString(),t.FlightStr=pad(Math.floor(t.Flight/60)).toString()+":"+pad(Math.round(t.Flight%60)).toString(),t.DutyStr=pad(Math.floor(t.Duty/60)).toString()+":"+pad(Math.round(t.Duty%60)).toString(),t.ExtendedStr=pad(Math.floor(t.Extended/60)).toString()+":"+pad(Math.round(t.Extended%60)).toString(),t.MaxFDPExtendedStr=pad(Math.floor(t.MaxFDPExtended/60)).toString()+":"+pad(Math.round(t.MaxFDPExtended%60)).toString(),t.MaxFDPStr=pad(Math.floor(t.MaxFDP/60)).toString()+":"+pad(Math.round(t.MaxFDP%60)).toString(),t.RestTo=moment(new Date(t.RestTo)).format("YY-MM-DD HH:mm"),e.dg3_ds=[],e.dg3_ds.push({Title:"Extended",Value:t.ExtendedStr}),e.dg3_ds.push({Title:"Max Ext. FDP",Value:t.MaxFDPExtendedStr}),e.dg3_ds.push({Title:"FDP",Value:t.DurationStr}),e.dg3_ds.push({Title:"Duty",Value:t.DutyStr}),e.dg3_ds.push({Title:"Flight",Value:t.FlightStr}),e.dg3_ds.push({Title:"Rest Until",Value:t.RestTo}),console.log(e.STBYFDPStat),e.getDaySTBYs(e.multiSelectedFlights[0],function(t){e.crew_stby_ds=t,e.fillStbyDs(),e.popup_stby_visible=!0})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else e.col_stby_class1="hidden",e.col_stby_class2="col1 fc11",e.popup_stby_visible=!0}},e.btn_update={text:"",type:"success",icon:"pulldown",width:"40",bindingOptions:{disabled:"autoUpdate"},onClick:function(t){var i={from:new Date(e.datefrom).toUTCString(),to:new Date(e.dateto).toUTCString(),baseDate:e.baseDate,airport:e.airportEntity?e.airportEntity.Id:-1,customer:Config.CustomerId,tzoffset:-1*(new Date).getTimezoneOffset(),userid:n.userId?n.userId:-1};e.loadingVisible=!0,a.getUpdatedFlights(i).then(function(t){e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString();var i=$("#resourceGanttba").data("ejGantt");$.each(t.flights,function(t,n){var a=Enumerable.From(e.dataSource).Where("$.ID=="+n.ID).FirstOrDefault();a&&(e.doActionCompleteSave=!1,e.fillFlight(a,n),Flight.processDataOffBlock(a),e.addUpdatedFlights(a),i.updateRecordByTaskId(a),e.calculateSummary())})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e._flightno="",e.text_flightno={bindingOptions:{value:"_flightno"}},e.btn_goflight={text:"",type:"success",icon:"arrowright",width:"35",bindingOptions:{},onClick:function(t){if(e._flightno){var i=Enumerable.From(e.dataSource).Where("$.FlightNumber.toLowerCase()=='"+e._flightno.toLowerCase()+"'").FirstOrDefault();if(!i)return void General.ShowNotify("Flight not found","error");e.scrollGantt(i)}}},e.ganttview=!0,e.gridview=!0,e.btn_swap={text:"",type:"default",icon:"fas fa-exchange-alt",width:"40",bindingOptions:{},onClick:function(t){e.createGantt()}},e.btn_plan_new={type:"default",icon:"plus",width:"40",onClick:function(t){e.doGetPlanItems=!0,e.doRefresh=!1,e.planEntity.Id=-1,e.tempData=null,e.IsNew=!0,e.addMode=!0,e.popup_plan_add_visible=!0},bindingOptions:{visible:"IsPlanning"}},e.btn_plan_delete={type:"danger",icon:"clear",width:"40",onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");var i=e.selectedFlights[0];General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var n={Id:i.FlightPlanId};e.loadingVisible=!0,a.deletePlanItem(n).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.BeginSearch()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})},bindingOptions:{visible:"IsPlanning"}},e.selectedPlanItemId=null,e.selectedPlanItem=null,e.doIrRoute=!1,e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");if(e.flight=e.selectedFlights[0],e.flight.FlightPlanId){e.selectedPlanItemId=e.flight.FlightPlanId;var i=-1*(new Date).getTimezoneOffset(),n=e.selectedFlights[0];return e.loadingVisible=!0,void a.getFlightPlanItem(n.FlightPlanId,i).then(function(t){e.loadingVisible=!1,e.IsNew=!1,e.tempData=t,console.log("flightService.getFlightPlanItem"),console.log(t),e.doRefresh=!1,e.doGetPlanItems=!1,e.popup_planitem_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}e.linkEntity={ID:e.flight.ID,CustomerId:Config.CustomerId},e.doIrRoute=!1,e.linkEntity.RegisterID=e.flight.RegisterID,e.linkEntity.FlightNumber=e.flight.FlightNumber,e.linkEntity.FromAirportId=e.flight.FromAirport,e.linkEntity.ToAirportId=e.flight.ToAirport,e.linkEntity.FlightH=e.flight.FlightH,e.linkEntity.FlightM=e.flight.FlightM,e.linkEntity.FlightTypeID=e.flight.FlightTypeID,e.time_ir_std_date=new Date(e.flight.STD),e.time_ir_std_time=new Date(e.flight.STD),e.time_ir_sta_date=new Date(e.flight.STD),e.time_ir_sta_time=new Date(e.flight.STA),e.doIrRoute=!0,e.popup_free_visible=!0}},e.btn_plan_edit={type:"default",icon:"edit",width:40,onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");var i=-1*(new Date).getTimezoneOffset(),n=e.selectedFlights[0];console.log("plan    %%%%%%%%%%%%%%%%%%%%%%%%%%%55"),console.log(n),e.plan_dg2_keys=[],e.loadingVisible=!0,a.getFlightPlanItem(n.FlightPlanId,i).then(function(t){e.loadingVisible=!1,e.IsNew=!1,e.tempData=t,e.doRefresh=!1,e.doGetPlanItems=!0,e.popup_plan_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.btn_interval={type:"default",icon:"event",width:40,onClick:function(t){if(!e.selectedFlights||0==e.selectedFlights.length)return void General.ShowNotify(Config.Text_NoFlightSelected,"error");var i=((new Date).getTimezoneOffset(),e.selectedFlights[0]);a.getFlightPlanView(i.PlanId).then(function(t){e.entityInterval.FlightPlanId=t.plan.Id,e.entityInterval.DateFrom=t.plan.DateFrom,e.entityInterval.DateTo=t.plan.DateTo,e.entityInterval.Interval=t.plan.Interval,e.entityInterval.BaseIATA=t.plan.BaseIATA,e.entityInterval.Register=t.plan.VirtualRegister,e.entityInterval.Months=[],e.entityInterval.Days=[],100==e.entityInterval.Interval||(e.popup_interval_visible=!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.popup_plan_add_visible=!1,e.popup_plan_add_title="New",e.popup_plan_add={width:1200,height:530,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplan2",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.planEntity.DateFrom=new Date(e.planEntity.iDateFrom).ToUTC(),e.planEntity.DateTo=new Date(e.planEntity.iDateTo).ToUTC(),e.planEntity.STD=new Date(e.planEntity.STD).toUTCString(),e.planEntity.STA=new Date(e.planEntity.STA).toUTCString(),100!=e.planEntity.Interval&&(e.planEntity.Months=[],e.planEntity.Days=[]),e.loadingVisible=!0,a.savePlanItem(e.planEntity).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.refreshPlanEntity(),e.IsNew?(e.isBaseDisabled=!0,e.planEntity.STD=new Date(e.planEntity.STA).addMinutes(60),e.start=e.planEntity.STD,e.planEntity.STA=null,e.planEntity.FromAirport=e.planEntity.ToAirport,e.planEntity.ToAirport=null,t.STD=new Date(t.STD).addMinutes(u),t.STA=new Date(t.STA).addMinutes(u),e.plan_dg2_ds.push(t),e.plan_dg2_instance.refresh()):e.popup_plan_add_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.tempData&&e.bindPlanEntity(e.tempData),e.plan_dg2_instance.refresh()},onHidden:function(){e.clearPlanEntity(),e.plan_dg2_ds=[],e.plan_dg2_keys=[],e.plan_dg2_instance.refresh(),e.popup_plan_add_visible=!1,e.doRefresh&&e.BeginSearch()},bindingOptions:{visible:"popup_plan_add_visible",title:"popup_plan_add_title"}},e.popup_plan_add.toolbarItems[1].options.onClick=function(t){e.popup_plan_add_visible=!1},e.popup_planitem_visible=!1,e.popup_planitem_title="Flight",e.popup_planitem={width:650,height:400,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"planitemflight",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.planEntity.DateFrom=new Date(e.planEntity.iDateFrom).ToUTC(),e.planEntity.DateTo=new Date(e.planEntity.iDateTo).ToUTC(),e.planEntity.STD=new Date(e.planEntity.STD).toUTCString(),e.planEntity.STA=new Date(e.planEntity.STA).toUTCString(),100!=e.planEntity.Interval&&(e.planEntity.Months=[],e.planEntity.Days=[]),e.planEntity.FlightId=e.flight.ID,e.loadingVisible=!0,a.updatePlanItemFlight(e.planEntity).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.refreshPlanEntity(),e.isBaseDisabled=!0,e.planEntity.STD=new Date(e.planEntity.STA).addMinutes(60),e.start=e.planEntity.STD,e.planEntity.STA=null,e.planEntity.FromAirport=e.planEntity.ToAirport,e.planEntity.ToAirport=null,t.STD=new Date(t.STD).addMinutes(u),t.STA=new Date(t.STA).addMinutes(u),e.popup_planitem_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.tempData&&e.bindPlanEntity2(e.tempData)},onHidden:function(){e.clearPlanEntity(),e.popup_planitem_visible=!1,e.doRefresh&&e.BeginSearch()},bindingOptions:{visible:"popup_planitem_visible",title:"popup_planitem_title"}},e.popup_planitem.toolbarItems[1].options.onClick=function(t){e.popup_planitem_visible=!1},e.popup_interval_visible=!1,e.popup_interval_title="Interval",e.popup_interval={width:600,height:460,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplaninterval2",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={Id:e.entityInterval.FlightPlanId,DateFrom:new Date(e.entityInterval.DateFrom).ToUTC(),DateTo:new Date(e.entityInterval.DateTo).ToUTC(),Interval:e.entityInterval.Interval,Months:e.entityInterval.Months,Days:e.entityInterval.Days,DateFirst:new Date(e.entityInterval.DateFrom).ToUTC()};e.loadingVisible=!0,a.savePlanInterval(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.clearEntityInterval(),e.popup_interval_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_interval_visible=!1,e.doRefresh&&e.BeginSearch()},bindingOptions:{visible:"popup_interval_visible",title:"popup_interval_title"}},e.popup_interval.toolbarItems[1].options.onClick=function(t){e.popup_interval_visible=!1},e.text_base={readOnly:!0,bindingOptions:{value:"entityInterval.BaseIATA"}},e.text_msn={readOnly:!0,bindingOptions:{value:"entityInterval.Register"}},e.date_from2={type:"date",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entityInterval.DateFrom"}},e.date_to2={type:"date",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entityInterval.DateTo"}},e.intervalTypes=[{Id:1,Title:"Daily"}],e.sb_interval2={showClearButton:!0,width:"100%",searchEnabled:!1,displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){e.customDisabled=t.selectedItem&&100!=t.selectedItem.Id},bindingOptions:{value:"entityInterval.Interval",dataSource:"intervalTypes"}},e.customDisabled=!0,e.tag_months_instance=null,e.tag_months={dataSource:General.MonthDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_months_instance||(e.tag_months_instance=t.component)},onSelectionChanged:function(e){},bindingOptions:{disabled:"customDisabled",value:"entityInterval.Months"}},e.tag_days_instance=null,e.tag_days={dataSource:General.WeekDayDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_days_instance||(e.tag_days_instance=t.component)},onSelectionChanged:function(e){},bindingOptions:{disabled:"customDisabled",value:"entityInterval.Days"}},e.entityInterval={FlightPlanId:null,DateFrom:null,DateTo:null,Interval:null,BaseIATA:null,Register:null,Months:[],Days:[]},e.clearEntityInterval=function(){e.entityInterval.FlightPlanId=null,e.entityInterval.DateFrom=null,e.entityInterval.DateTo=null,e.entityInterval.Interval=null,e.entityInterval.BaseIATA=null,e.entityInterval.Register=null,e.entityInterval.Months=[],e.entityInterval.Days=[]},e.planEntity={Id:null,Title:null,DateFrom:null,DateTo:null,DateFirst:null,DateLast:null,BaseId:null,iDateFrom:new Date,iDateTo:new Date,CustomerId:Config.CustomerId,IsActive:!1,DateActive:null,Interval:1,TypeId:null,RegisterID:null,FlightTypeID:null,FromAirport:null,ToAirport:null,STA:null,STD:null,FlightH:null,FlightM:null,FlightNumber:null,RouteId:null,FlightPlanId:-1,Months:[],Days:[]},e.refreshPlanEntity=function(){e.planEntity.Id=-1,e.planEntity.DateFirst=null,e.planEntity.DateLast=null,e.planEntity.CustomerId=Config.CustomerId,e.planEntity.IsActive=!1,e.planEntity.DateActive=null,e.planEntity.Interval=101,e.planEntity.FlightH=null,e.planEntity.FlightM=null,e.planEntity.FlightNumber=null,e.planEntity.RouteId=null},e.clearPlanEntity=function(){e.planEntity.Id=null,e.planEntity.BaseId=null,e.planEntity.Title=null,e.planEntity.DateFrom=null,e.planEntity.DateTo=null,e.planEntity.DateFirst=null,e.planEntity.DateLast=null,e.planEntity.iDateFrom=new Date,e.planEntity.iDateTo=new Date,e.planEntity.CustomerId=Config.CustomerId,e.planEntity.IsActive=!1,e.planEntity.DateActive=null,e.planEntity.Interval=101,e.planEntity.TypeId=null,e.planEntity.RegisterID=null,e.planEntity.FlightTypeID=null,e.planEntity.FromAirport=null,e.planEntity.ToAirport=null,e.planEntity.STA=null,e.planEntity.STD=null,e.planEntity.FlightH=null,e.planEntity.FlightM=null,e.planEntity.FlightNumber=null,e.planEntity.RouteId=null,e.planEntity.Months=[],e.planEntity.Days=[],e.data=[]},e.DotBlockToBlock=!0,e.bindPlanEntity=function(t){e.DotBlockToBlock=!1,e.planEntity.Id=t.Id,e.planEntity.BaseId=t.BaseId,e.planEntity.Title=t.Title,e.planEntity.DateFrom=t.DateFrom,e.planEntity.DateTo=t.DateTo,e.planEntity.DateFirst=t.DateFirst,e.planEntity.DateLast=t.DateLast,e.planEntity.iDateFrom=t.DateFrom,e.planEntity.iDateTo=t.DateTo,e.planEntity.CustomerId=t.CustomerId,e.planEntity.IsActive=t.IsActive,e.planEntity.DateActive=t.DateActive,e.planEntity.Interval=t.Interval,e.planEntity.Months=t.Months,e.planEntity.Days=t.Days,e.planEntity.FlightPlanId=t.FlightPlanId,e.planEntity.TypeId=t.TypeId,e.planEntity.RegisterID=t.RegisterID,e.planEntity.FlightTypeID=t.FlightTypeID,e.planEntity.AirlineOperatorsID=t.AirlineOperatorsID,e.planEntity.FlightNumber=t.FlightNumber,e.planEntity.FromAirport=t.FromAirport,e.planEntity.ToAirport=t.ToAirport,e.planEntity.STA=t.STA,e.planEntity.STD=t.STD,e.planEntity.FlightH=t.FlightH,e.planEntity.FlightM=t.FlightM,e.planEntity.FlightStatus=t.FlightStatus,e.start=new Date(e.planEntity.STD),e.tempToAirport=e.planEntity.ToAirport},e.bindPlanEntity2=function(t){e.DotBlockToBlock=!1,e.planEntity.Id=t.Id,e.planEntity.BaseId=t.BaseId,e.planEntity.Title=t.Title,e.planEntity.DateFrom=t.DateFrom,e.planEntity.DateTo=t.DateTo,e.planEntity.DateFirst=t.DateFirst,e.planEntity.DateLast=t.DateLast,e.planEntity.iDateFrom=t.DateFrom,e.planEntity.iDateTo=t.DateTo,e.planEntity.CustomerId=t.CustomerId,e.planEntity.IsActive=t.IsActive,e.planEntity.DateActive=t.DateActive,e.planEntity.Interval=t.Interval,e.planEntity.Months=t.Months,e.planEntity.Days=t.Days,e.planEntity.FlightPlanId=t.FlightPlanId,e.planEntity.TypeId=t.TypeId,e.planEntity.RegisterID=t.RegisterID,e.planEntity.FlightTypeID=t.FlightTypeID,e.planEntity.AirlineOperatorsID=t.AirlineOperatorsID,e.planEntity.FlightNumber=e.flight.FlightNumber,e.planEntity.FromAirport=e.flight.FromAirport,e.planEntity.ToAirport=e.flight.ToAirport,e.planEntity.STA=e.flight.STA,e.planEntity.STD=e.flight.STD,e.planEntity.FlightH=e.flight.FlightH,e.planEntity.FlightM=e.flight.FlightM,e.planEntity.FlightStatus=t.FlightStatus,e.start2=new Date(e.planEntity.STD),e.tempToAirport=e.planEntity.ToAirport},e.plan_dg2_selected=null,e.plan_dg2_columns=[{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300}],e.plan_dg2_height=400,e.plan_dg2_instance=null,e.plan_dg2_ds=[],e.plan_dg2_keys=[],e.plan_dg2={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},keyExpr:"Id",noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.plan_dg2_columns,onContentReady:function(t){e.plan_dg2_instance||(e.plan_dg2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.plan_dg2_selected=i||null},onCellPrepared:function(e){},bindingOptions:{dataSource:"plan_dg2_ds",height:"plan_dg2_height",selectedRowKeys:"plan_dg2_keys"}},e.plan_date_from={type:"date",width:"100%",onValueChanged:function(t){e.planEntity.iDateTo=t.value},bindingOptions:{value:"planEntity.iDateFrom"}},e.selectedType=null,e.ds_msn=[],e.msn_readOnly=!0,e.sb_type={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(e){return n.getSbTemplateAircraft(e)},searchExpr:["Type","Manufacturer"],dataSource:n.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",onSelectionChanged:function(t){e.ds_msn=[],e.msn_readOnly=!0,t&&t.selectedItem?(e.planEntity.AircraftType=t.selectedItem.Type,l.getVirtualMSNsByType(Config.CustomerId,t.selectedItem.Id).then(function(t){e.msn_readOnly=!1,e.ds_msn=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):(e.msn_readOnly=!0,e.ds_msn=[],e.planEntity.AircraftType=null)},bindingOptions:{value:"planEntity.TypeId",selectedItem:"selectedType"}},e.unknown_readOnly=!1,e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(t){if(t.selectedItem){e.planEntity.Register=t.selectedItem.Register;var i=-1*(new Date).getTimezoneOffset(),n={CustomerId:Config.CustomerId,Date:new Date(e.planEntity.iDateFrom).ToUTC(),RegisterId:t.selectedItem.ID,Offset:i};e.loadingVisible=!0,
a.getPlanLastItem(n).then(function(t){e.loadingVisible=!1,t&&-1!=t.Id?(e.isBaseDisabled=!0,e.planEntity.BaseId=t.BaseId,e.IsNew&&(e.planEntity.FromAirport=t.ToAirport,e.planEntity.ToAirport=null,e.planEntity.STD=new Date(t.STA),e.start=new Date(e.planEntity.STD)),e.doGetPlanItems&&a.getPlanItems(n).then(function(t){if(e.plan_dg2_ds=t,e.selectedFlights&&e.selectedFlights.length>0){var i=e.selectedFlights[0];e.plan_dg2_keys.push(i.FlightPlanId)}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):e.isBaseDisabled=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else e.planEntity.Register=null,e.planEntity.BaseId=null,e.isBaseDisabled=!0},bindingOptions:{value:"planEntity.RegisterID",disabled:"msn_readOnly",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.isBaseDisabled=!0,e.sb_Base={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){e.isBaseDisabled||(e.planEntity.FromAirport=t.selectedItem.Id)},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"planEntity.BaseId",disabled:"isBaseDisabled"}},e.tempToAirport=null,e.selectedFromAirport=null,e.selectedToAirport=null,e.sb_FromAirport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){if(e.planEntity.ToAirport=null,!t.selectedItem)return e.ds_toairport=[],void(e.planEntity.FromAirportIATA=null);e.planEntity.FromAirportIATA=t.selectedItem.IATA,e.loadingVisible=!0,a.getRouteDestination(Config.AirlineId,t.selectedItem.Id).then(function(t){e.loadingVisible=!1,e.ds_toairport=t,e.tempToAirport&&(e.planEntity.ToAirport=e.tempToAirport,e.tempToAirport=null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"planEntity.FromAirport",selectedItem:"selectedFromAirport"}},e.ds_toairport=[],e.sb_ToAirport={showClearButton:!0,searchEnabled:!0,itemTemplate:function(e){return n.getSbTemplateRouteTo(e)},onSelectionChanged:function(t){t.selectedItem?(e.planEntity.RouteId=t.selectedItem.Id,e.DotBlockToBlock?(e.planEntity.FlightH=t.selectedItem.FlightH,e.planEntity.FlightM=t.selectedItem.FlightM):e.DotBlockToBlock=!0,e.planEntity.ToAirportIATA=t.selectedItem.ToAirportIATA):(e.planEntity.RouteId=null,e.planEntity.FlightH=null,e.planEntity.FlightM=null,e.planEntity.ToAirportIATA=null),e.setArrivalPlan()},searchExpr:["ToAirportIATA","ToCity"],displayExpr:"ToAirportIATA",valueExpr:"ToAirportId",bindingOptions:{value:"planEntity.ToAirport",selectedItem:"selectedRoute",dataSource:"ds_toairport"}},e.selectedRoute=null,e.setArrivalPlan=function(){if(null!=e.planEntity.STD&&null!=e.planEntity.FlightH&&null!=e.planEntity.FlightM){var t=new Date(e.planEntity.STD);e.planEntity.STA=new Date(t.addHours(e.planEntity.FlightH).addMinutes(e.planEntity.FlightM))}else e.planEntity.STA=null},e.start=null,e.time_start={type:"time",width:"100%",interval:15,onValueChanged:function(t){if(t.value){var i=new Date(t.value),n=i.getHours(),a=i.getMinutes(),o=n+":"+a+":00",l=new Date(e.planEntity.iDateFrom).getDatePartSlash()+" "+o,r=new Date(l);e.planEntity.STD=r}else e.planEntity.STD=null;e.setArrivalPlan()},bindingOptions:{value:"start"}},e.time_end={readOnly:!0,type:"time",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"planEntity.STA"}},e.setArrivalPlan2=function(){if(null!=e.planEntity.STD&&null!=e.planEntity.FlightH&&null!=e.planEntity.FlightM){var t=new Date(e.planEntity.STD);e.planEntity.STA=new Date(t.addHours(e.planEntity.FlightH).addMinutes(e.planEntity.FlightM))}else e.planEntity.STA=null},e.start2=null,e.time_start2={type:"time",width:"100%",interval:15,onValueChanged:function(t){if(t.value){var i=new Date(t.value),n=i.getHours(),a=i.getMinutes(),o=n+":"+a+":00",l=new Date(e.planEntity.STD).getDatePartSlash()+" "+o,r=new Date(l);e.planEntity.STD=r}else e.planEntity.STD=null;e.setArrivalPlan2()},bindingOptions:{value:"start2"}},e.time_end2={readOnly:!0,type:"time",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"planEntity.STA"}},e.text_flighth={min:0,onValueChanged:function(t){e.setArrivalPlan()},bindingOptions:{value:"planEntity.FlightH"}},e.text_flightm={min:0,max:59,onValueChanged:function(t){e.setArrivalPlan()},bindingOptions:{value:"planEntity.FlightM"}},e.text_flightnumber={bindingOptions:{value:"planEntity.FlightNumber"}},e.plan_sb_flighttype={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"planEntity.FlightTypeID"}},e.dateEnd=null,e.tabsdatevisible=!1,e.BeginSearch=function(){e.datefrom=General.getDayFirstHour(new Date(e._datefrom)),e.dateEnd=General.getDayLastHour(new Date(new Date(e._datefrom).addDays(e.days_count-1))),e.dateto=General.getDayLastHour(new Date(e._datefrom)),e.StopNowLineTimer(),e.search()},e.btn_search={text:"Search",type:"success",icon:"search",width:120,validationGroup:"flightboarddate",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.StopUTimer(),e.activatedStbys=null,e.BeginSearch()}},e.jlShow=!1,e.btn_fill={text:"Fill",type:"success",width:100,bindingOptions:{},onClick:function(t){var i=[];if(e.leg1Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg1Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg2Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg2Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg3Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg3Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg4Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg4Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg5Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg5Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg6Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg6Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg7Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg7Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg8Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg8Text+'"').FirstOrDefault();i.push(n.ID)}var o=i.join("_");e.loadingVisible=!0,a.getJLDataLegs(o).then(function(t){if(e.loadingVisible=!1,t){e.jl.MaxFDP=t.max,e.jl.AcType=e.flight.AircraftType,e.jl.Reg=e.flight.Register,e.jl.Date=moment(new Date(e.flight.Date)).format("MM-DD-YYYY"),e.jl.STD=moment(new Date(e.flight.STD)).format("HH:mm"),e.jl.formNo="FPI-OPS-01",e.jl.tel="+982148063000",e.jl.email="OpsEng@Caspian.aero",e.jl.sectors=[];for(var i=0;i<6;i++){var n=i+1,a={sector:n};if(t.flights.length>=n){var o=t.flights[i];a.from=o.FromAirportIATA,a.to=o.ToAirportIATA,a.no=o.FlightNumber,a.mm=moment(new Date(o.STD)).format("MM"),a.dd=moment(new Date(o.STD)).format("DD")}e.jl.sectors.push(a)}var l=Enumerable.From(t.crew).Where('$.JobGroupCode.startsWith("00101")').OrderBy("$.IsPositioning").ThenBy("$.GroupOrder").ThenBy("$.Name").ToArray(),r=Enumerable.From(t.crew).Where('$.JobGroupCode.startsWith("00102")').OrderBy("$.IsPositioning").ThenBy("$.GroupOrder").ThenBy("$.Name").ToArray();e.jl.cockpit=[],e.jl.cabin=[];var d=r.length;l.length>d&&(d=l.length),8>d&&(d=8),e.jl.crews=[];for(var i=0;i<d;i++){var s={};r.length>i&&(s=r[i]);var c={};l.length>i&&(c=l[i]),"Captain"==c.Position&&(c.Position="CPT"),"TRE"!=c.JobGroup&&"TRI"!=c.JobGroup&&"LTC"!=c.JobGroup||(c.Position="IP"),c.IsPositioning&&(c.Position="DH"),s.Position&&"Purser"==s.Position&&(s.Position="SCCM"),s.Position&&"FA"==s.Position&&(s.Position="CCM"),"ISCCM"==s.JobGroup&&(s.Position="ISCCM"),s.IsPositioning&&(s.Position="DH"),e.jl.crews.push({cabin:s,cockpit:c})}e.jl.rvsm1=[],e.jl.rvsm1.push({leg:1}),e.jl.rvsm1.push({leg:2}),e.jl.rvsm1.push({leg:3}),e.jl.rvsm2=[],e.jl.rvsm2.push({leg:4}),e.jl.rvsm2.push({leg:5}),e.jl.rvsm2.push({leg:6}),e.jlShow=!0}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.clShow=!1,e.btn_fill2={text:"Fill",type:"success",width:100,bindingOptions:{},onClick:function(t){var i=[];if(e.leg1Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg1Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg2Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg2Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg3Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg3Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg4Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg4Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg5Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg5Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg6Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg6Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg7Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg7Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg8Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg8Text+'"').FirstOrDefault();i.push(n.ID)}var o=i.join("_");e.loadingVisible=!0,a.getCLDataLegs(o).then(function(t){if(e.loadingVisible=!1,t){var i=-1*(new Date).getTimezoneOffset();e.cl.actype=t.actype,e.cl.regs=t.regs;var n=new Date(t.std).addMinutes(i),a=new Date(t.sta).addMinutes(i);if(persianDate.toLocale("en"),e.cl.std_date=moment(new Date(n)).format("DD-MMM-YYYY"),e.cl.std_persian=new persianDate(n).format("DD-MM-YYYY"),e.cl.std_time=moment(new Date(n)).format("HH:mm"),e.cl.sta_date=moment(new Date(a)).format("DD-MMM-YYYY"),e.cl.sta_persian=new persianDate(a).format("DD-MM-YYYY"),e.cl.sta_time=moment(new Date(a)).format("HH:mm"),e.cl.route=t.route,e.cl.no=t.no,e.cl.formNo="",e.cl.tel="+982148063000",e.cl.email="OpsEng@Caspian.aero",e.cl.crews=Enumerable.From(t.crew).OrderBy("$.IsPositioning").ThenBy("$.GroupOrder").ThenBy("$.Name").ToArray(),$.each(e.cl.crews,function(e,t){"Captain"==t.Position&&(t.Position="CPT"),"Purser"==t.Position&&(t.Position="SCCM"),"FA"==t.Position&&(t.Position="CCM"),"ISCCM"==t.JobGroup&&(t.Position="ISCCM"),"TRE"!=t.JobGroup&&"TRI"!=t.JobGroup&&"LTC"!=t.JobGroup||(t.Position="IP"),t.IsPositioning&&(t.Position="DH")}),e.cl.crews.length<18)for(var o=e.cl.crews.length;o<18;o++)e.cl.crews.push({Position:" ",Name:" "});e.clShow=!0}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.datefrom=General.getDayFirstHour(new Date(2019,5,6,0,0,0)),e.dateto=General.getDayLastHour(new Date(2019,5,6,0,0,0)),e._datefrom=new Date,e.date_from={type:"date",placeholder:"From",width:"100%",displayFormat:"yyyy-MM-dd",bindingOptions:{value:"_datefrom"}},e.days_count=2,e.num_days={min:1,showSpinButtons:!1,bindingOptions:{value:"days_count"}},e.btn_test={text:"test",type:"success",icon:"search",width:"100%",bindingOptions:{},onClick:function(e){$("#task-4908")}},e.date_to={type:"datetime",displayFormat:"yyyy-MM-dd HH:mm",width:"100%",interval:15,onValueChanged:function(e){if(e.value){new Date(e.value)}},bindingOptions:{value:"dateto"}},e.filterStatus=null,e.tag_status={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["title"],dataSource:Flight.filteredStatusDataSource,displayExpr:"title",valueExpr:"id",bindingOptions:{value:"filterStatus"}},e.filterType=null,e.tag_types={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsAcTypes(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterType"}},e.filterAircraft=null,e.tag_aircrafts={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsRegisters(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterAircraft"}},e.filterFrom=null,e.tag_from={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsFrom(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterFrom"}},e.filterTo=null,e.tag_to={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsTo(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterTo"}},e.checkOnBlock=!0,e.check_onblock={width:"100%",text:"On Block",bindingOptions:{value:"checkOnBlock"}},e.checkOffBlock=!0,e.check_offblock={width:"100%",text:"Off Block",bindingOptions:{value:"checkOffBlock"}},e.checkTakeOff=!0,e.check_takeoff={width:"100%",text:"Departued",bindingOptions:{value:"checkTakeOff"}},e.checkLanding=!0,e.check_landing={width:"100%",text:"Arrived",bindingOptions:{value:"checkLanding"}},e.checkScheduled=!0,e.check_scheduled={width:"100%",text:"Scheduled",bindingOptions:{value:"checkScheduled"}},e.applyNextFlight=!1,e.check_applynext={width:"100%",text:"Apply delay to next flights",bindingOptions:{value:"applyNextFlight"}},e.flightTakeOff=null,e.takeOffReadOnly=!1,e.time_takeoff={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightTakeOff",min:"flight.ChocksOut",readOnly:"takeOffReadOnly"}},e.calculateTotalDelay=function(){if(!e.flightOffBlock2)return e.flight.TotalDelayHH=null,e.flight.TotalDelayMM=null,void(e.flight.TotalDelayTotalMM=0);var t=new Date(e.flight.STD),i=new Date(e.flightOffBlock2);if(t>i)return e.flight.TotalDelayHH=0,e.flight.TotalDelayMM=0,void(e.flight.TotalDelayTotalMM=0);var n=subtractDates(t,i),a=Math.floor(n/60),o=n%60;e.flight.TotalDelayHH=a,e.flight.TotalDelayMM=o,e.flight.TotalDelayTotalMM=n,n&&n>0?$(".tdelay").addClass("pink"):$(".tdelay").removeClass("pink")},e.flightTakeOff2=null,e.time_takeoff2={type:"date",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightTakeOff2",readOnly:"IsTakeOffReadOnly",disabled:"IsTakeOffReadOnly"}},e.time_takeoff2_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(e){},bindingOptions:{value:"flightTakeOff2",readOnly:"IsTakeOffReadOnly",disabled:"IsTakeOffReadOnly"}},e.flightOffBlock=null,e.time_offblock={type:"datetime",width:"100%",interval:5,bindingOptions:{value:"flightOffBlock",min:"flight.baseStartDate"}},e.depReadOnly=!0,e.flightOffBlock2=null,e.time_offblock2={type:"date",width:"100%",onValueChanged:function(t){e.calculateTotalDelay()},interval:5,bindingOptions:{value:"flightOffBlock2",readOnly:"IsOffBlockReadOnly",disabled:"IsOffBlockReadOnly"}},e.time_offblock2_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(t){e.calculateTotalDelay()},bindingOptions:{value:"flightOffBlock2",readOnly:"IsOffBlockReadOnly",disabled:"IsOffBlockReadOnly"}},e.flightOnBlock=null,e.time_onblock={type:"datetime",width:"100%",interval:5,bindingOptions:{value:"flightOnBlock"}},e.flightOnBlock2=null,e.time_onblock2={type:"date",width:"100%",interval:5,bindingOptions:{value:"flightOnBlock2",readOnly:"IsOnBlockReadOnly",disabled:"IsOnBlockReadOnly"}},e.time_onblock2_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(e){},bindingOptions:{value:"flightOnBlock2",readOnly:"IsOnBlockReadOnly",disabled:"IsOnBlockReadOnly"}},e.flightLanding=null,e.landingReadOnly=!1,e.time_landing={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightLanding",min:"flight.STA",readOnly:"landingReadOnly"}},e.flightLanding2=null,e.time_landing2={type:"date",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightLanding2",readOnly:"IsLandingReadOnly",disabled:"IsLandingReadOnly"}},e.time_landing2_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(e){},bindingOptions:{value:"flightLanding2",readOnly:"IsLandingReadOnly",disabled:"IsLandingReadOnly"}},e.time_std={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.STD"}},e.time_sta={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.STA"}},e.time_baseStart={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.baseStartDate"}},e.time_baseEnd={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.baseEndDate"}},e.time_chocksout={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.ChocksOut"}},e.time_chocksin={type:"time",width:"100%",readOnly:!0,bindingOptions:{value:"flight.ChocksIn"}},e.time_landed={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.Landing"}},e.remark_dep={bindingOptions:{value:"flight.DepartureRemark",readOnly:"depReadOnly"}},e.remark_arr={bindingOptions:{value:"flight.ArrivalRemark"}},e.fuel_dep={min:0,bindingOptions:{value:"flight.FuelDeparture",readOnly:"depReadOnly"}},e.fuel_fp={min:0,bindingOptions:{value:"flight.FPFuel",readOnly:"depReadOnly"}},e.fuel_defuel={min:0,bindingOptions:{value:"flight.Defuel",readOnly:"depReadOnly"}},e.fuel_arr={min:0,bindingOptions:{value:"flight.FuelArrival"}},e.paxTotal=0,e.paxOver=0,e.calculateTotalPax=function(){e.paxTotal=0;var t=0;if(e.flight.PaxAdult&&(t+=e.flight.PaxAdult),e.flight.PaxChild&&(t+=e.flight.PaxChild),e.flight.TotalSeat&&t>e.flight.TotalSeat?e.flight.PaxOver=t-e.flight.TotalSeat:e.flight.PaxOver=0,e.flight.TotalPax=t,e.flight.TotalSeat){var i=round2(100*t/(1*e.flight.TotalSeat),2);e.loadPax=i+" %"}},e.total_seats={readOnly:!0,bindingOptions:{value:"flight.TotalSeat"}},e.total_pax={readOnly:!0,bindingOptions:{value:"flight.TotalPax"}},e.txt_wdh={readOnly:!1,bindingOptions:{value:"flight.NightTime"}},e.loadPax=null,e.load_pax={readOnly:!0,bindingOptions:{value:"loadPax"}},e.pax_adult={readOnly:!1,min:0,showSpinButtons:!0,onValueChanged:function(t){e.calculateTotalPax()},bindingOptions:{value:"flight.PaxAdult",readOnly:"depReadOnly"}},e.pax_child={readOnly:!1,showSpinButtons:!0,min:0,onValueChanged:function(t){e.calculateTotalPax()},bindingOptions:{value:"flight.PaxChild",readOnly:"depReadOnly"}},e.pax_infant={readOnly:!1,showSpinButtons:!0,min:0,onValueChanged:function(t){e.calculateTotalPax()},bindingOptions:{value:"flight.PaxInfant",readOnly:"depReadOnly"}},e.pax_over={readOnly:!1,min:0,bindingOptions:{readOnly:"depReadOnly",value:"flight.PaxOver"}},e.cargo_piece={readOnly:!1,min:0,bindingOptions:{value:"flight.CargoCount",readOnly:"depReadOnly"}},e.cargo_weight={readOnly:!1,min:0,bindingOptions:{value:"flight.CargoWeight",readOnly:"depReadOnly"}},e.cargo_excess={readOnly:!1,min:0,bindingOptions:{readOnly:"depReadOnly"}},e.bag_piece={readOnly:!1,min:0,bindingOptions:{value:"flight.BaggageCount",readOnly:"depReadOnly"}},e.bag_weight={readOnly:!1,min:0,bindingOptions:{value:"flight.BaggageWeight",readOnly:"depReadOnly"}},e.bag_excess={readOnly:!1,min:0,bindingOptions:{readOnly:"depReadOnly"}},e.convertToUTC=function(){if(!e.convertUTCEnabled)return void(e.convertUTCEnabled=!0);var t=-1*(new Date).getTimezoneOffset();t*=-1,e.flight.STA2=new Date(e.flight.STA).addMinutes(t),e.flight.STD2=new Date(e.flight.STD).addMinutes(t),e.flightOffBlock2=new Date(e.flightOffBlock2).addMinutes(t),e.flightTakeOff2=new Date(e.flightTakeOff2).addMinutes(t),e.flightLanding2=new Date(e.flightLanding2).addMinutes(t),e.flightOnBlock2=new Date(e.flightOnBlock2).addMinutes(t),e.time_status_value=new Date(e.time_status_value).addMinutes(t)},e.convertToLCL=function(){if(!e.convertUTCEnabled)return void(e.convertUTCEnabled=!0);var t=-1*(new Date).getTimezoneOffset();e.flight.STA2=new Date(e.flight.STA).addMinutes(t),e.flight.STD2=new Date(e.flight.STD).addMinutes(t),e.flightOffBlock2=new Date(e.flightOffBlock2).addMinutes(t),e.flightTakeOff2=new Date(e.flightTakeOff2).addMinutes(t),e.flightLanding2=new Date(e.flightLanding2).addMinutes(t),e.flightOnBlock2=new Date(e.flightOnBlock2).addMinutes(t),e.time_status_value=new Date(e.time_status_value).addMinutes(t)},e.otimes=null,e.timeBase="LCB",e.timeBaseReadOnly=!1,e.sb_timebase={showClearButton:!0,searchEnabled:!0,dataSource:["UTC","LCL","LCB"],onValueChanged:function(t){"UTC"!=t.value||"LCL"!=t.previousValue&&"LCB"!=t.previousValue?"LCL"!=t.value&&"LCB"!=t.value||"UTC"!=t.previousValue||e.convertToLCL():e.convertToUTC()},bindingOptions:{value:"timeBase",readOnly:"timeBaseReadOnly"}};e.remark_status_height=80,e.remark_status={bindingOptions:{value:"flight.DepartureRemark",height:"remark_status_height"}},e.isTimeStatusVisible=!1,e.time_status_value=null,e.time_status={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"time_status_value"}},e.time_redirect_value=null,e.time_redirect={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"time_redirect_value"}},e.remark_redirect={bindingOptions:{value:"flight.RedirectRemark",height:"82"}},e.time_ramp_value=null,e.time_ramp={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"time_ramp_value"}},e.remark_ramp={bindingOptions:{value:"flight.RampRemark",height:"82"}},e.delayCodeId=21,e.delayCode={Id:21,HH:null,MM:null,Code:null,Title:null,Remark:null,Total:null},e.clearDelayCode=function(){e.delayCode.HH=null,e.delayCode.MM=null,e.delayCode.Remark=null,e.delayCode.Total=null,e.delayCodeId=null},e.delayCodeCounter=-1,e.fillDelayCode=function(t){e.delayCodeCounter=e.delayCodeCounter-1,e.delayCode.Id=e.delayCodeCounter,e.delayCode.DelayCodeId=t.Id,e.delayCode.Code=t.Code,e.delayCode.Title=t.Title},e.txt_delay_remark={width:"98%",bindingOptions:{value:"delayCode.Remark"}},e.num_delayhh={max:99,min:0,width:40,showSpinButtons:!0,bindingOptions:{value:"delayCode.HH"}},e.num_delaymm={max:59,min:0,width:45,showSpinButtons:!0,bindingOptions:{value:"delayCode.MM"}},e._delayItem=null,e.$watch("_delayItem",function(t){try{e._delayItem?e.delayCode.Remark=e._delayItem.Remark:e.delayCode.Remark=""}catch(e){}}),e.sb_delay={showClearButton:!1,searchEnabled:!0,onSelectionChanged:function(t){t&&t.selectedItem?e.fillDelayCode(t.selectedItem):e.clearDelayCode()},displayExpr:"Title2",valueExpr:"Id",bindingOptions:{value:"delayCodeId",dataSource:"delayCodes",selectedItem:"_delayItem"}},e.btn_add_delay={text:"",type:"default",icon:"plus",width:"20",validationGroup:"movdelay",bindingOptions:{},onClick:function(t){if(e.delayCode.HH||(e.delayCode.HH=0),e.delayCode.MM||(e.delayCode.MM=0),0==e.delayCode.HH&&0==e.delayCode.MM)return void General.ShowNotify("Amount is not valid","error");var i=JSON.parse(JSON.stringify(e.delayCode));i.Amount=pad(e.delayCode.HH)+":"+pad(e.delayCode.MM),i.Total=60*e.delayCode.HH+e.delayCode.MM,e.dg_delay_ds.push(i),e.clearDelayCode()}},e.btn_showcodes={text:"",type:"success",icon:"search",width:"20",bindingOptions:{},onClick:function(t){e.popup_codes_visible=!0}},e.btn_remove_delay={text:"",type:"danger",icon:"close",width:"20",bindingOptions:{},onClick:function(t){if(e.dg_delay_selected=n.getSelectedRow(e.dg_delay_instance),!e.dg_delay_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");console.log(e.dg_delay_ds),console.log(e.dg_delay_selected.Id);var i=Enumerable.From(e.dg_delay_ds).Where("$.Id!="+e.dg_delay_selected.Id).ToArray();e.dg_delay_ds=i}},e.IsOffBlockReadOnly=!1,e.IsTakeOffReadOnly=!1,e.IsLandingReadOnly=!1,e.IsOnBlockReadOnly=!1,e.isRedirectReasonVisible=!0,e.isRampReasonVisible=!0,e.sb_status={showClearButton:!1,searchEnabled:!0,dataSource:Enumerable.From(Flight.statusDataSource).Where("$.selectable").ToArray(),onSelectionChanged:function(t){t&&t.selectedItem&&(t.selectedItem.bgcolor,t.selectedItem.color),e.remark_status_height=54,e.isTimeStatusVisible=!1,e.isCancelReasonVisible=!1,4==t.selectedItem.id&&(e.isCancelReasonVisible=!0,e.remark_status_height=54,e.isTimeStatusVisible=!0,e.time_status_value=e.flight.CancelDate?new Date(e.flight.CancelDate):null),9==t.selectedItem.id&&(e.remark_status_height=54,e.isTimeStatusVisible=!0,e.time_status_value=e.flight.RampDate?new Date(e.flight.RampDate):null),17==t.selectedItem.id&&(e.remark_status_height=30)},displayExpr:"title",valueExpr:"id",bindingOptions:{value:"flight.FlightStatusID"}},e.dsFlightType=[{Id:109,Title:"Schedule",ParentId:108,IsSystem:1,OrderIndex:1,Parent:"Flight Types"},{Id:1112,Title:"Charter",ParentId:108,IsSystem:1,OrderIndex:4,Parent:"Flight Typest"},{Id:1113,Title:"Free Flight",ParentId:108,IsSystem:1,OrderIndex:5,Parent:"Flight Types"},{Id:1114,Title:"Position",ParentId:108,IsSystem:1,OrderIndex:6,Parent:"Flight Types"}],e.sb_flighttype={readOnly:!0,showClearButton:!0,searchEnabled:!0,displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.FlightTypeID",dataSource:"dsFlightType"}},e.dsMassUnit=[{Id:111,Title:"Kgs",ParentId:110,IsSystem:1,OrderIndex:1,Parent:"Mass Unit"},{Id:112,Title:"Lbs",ParentId:110,IsSystem:1,OrderIndex:2,Parent:"Mass Unit"}],e.dsVolumeUnit=[{Id:114,Title:"Ltr",ParentId:113,IsSystem:1,OrderIndex:1,Parent:"Volume Unit"},{Id:115,Title:"Kgs",ParentId:113,IsSystem:1,OrderIndex:2,Parent:"Volume Unit"},{Id:5002,Title:"Lbs",ParentId:113,IsSystem:1,OrderIndex:3,Parent:"Volume Unit"}],e.sb_massunit={showClearButton:!0,searchEnabled:!0,displayExpr:"Title",valueExpr:"Id",bindingOptions:{dataSource:"dsMassUnit",value:"flight.CargoUnitID",readOnly:"depReadOnly"}},e.sb_volumeunit={showClearButton:!0,searchEnabled:!1,displayExpr:"Title",valueExpr:"Id",bindingOptions:{dataSource:"dsVolumeUnit",value:"flight.FuelUnitID",text:"flight.FuelUnit",readOnly:"depReadOnly"}},e.sb_volumeunit2={showClearButton:!0,searchEnabled:!0,displayExpr:"Title",valueExpr:"Id",readOnly:!0,bindingOptions:{dataSource:"dsVolumeUnit",value:"flight.FuelUnitID"}},e.entity_cancel={UserId:null,FlightId:null,CancelReasonId:null,CancelRemark:null,CancelDate:null},e.cleat_entity_cancel=function(){e.entity_cancel.UserId=null,e.entity_cancel.FlightId=null,e.entity_cancel.CancelReasonId=null,e.entity_cancel.CancelRemark=null,e.entity_cancel.CancelDate=null},e.entity_redirect={UserId:null,FlightId:null,RedirectReasonId:null,RedirectRemark:null,RedirectDate:null,AirportId:null,STA:null,OAirportIATA:null,AirportIATA:null,Airport:null},e.clear_entity_redirect=function(){e.entity_redirect.UserId=null,e.entity_redirect.FlightId=null,e.entity_redirect.RedirectReasonId=null,e.entity_redirect.RedirectRemark=null,e.entity_redirect.RedirectDate=null,e.entity_redirect.AirportId=null,e.entity_redirect.Airport=null,e.entity_redirect.STA=null},e.isCancelReasonVisible=!1,e.sb_cancel_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1136),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.CancelReasonId"}},e.sb_redirect_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1147),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.RedirectReasonId"}},e.sb_ramp_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1136),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.RampReasonId"}},e.num_fphh={max:99,min:0,width:50,showSpinButtons:!0,bindingOptions:{value:"flight.FPFlightHH"}},e.num_fpmm={max:59,min:0,width:50,showSpinButtons:!0,bindingOptions:{value:"flight.FPFlightMM"}},e.num_blhh={max:99,min:0,width:50,showSpinButtons:!0,bindingOptions:{value:"flight.JLBLHH"}},e.num_blmm={max:59,min:0,width:50,showSpinButtons:!0,bindingOptions:{value:"flight.JLBLMM"}},e.fuel_used={min:0,bindingOptions:{value:"flight.UsedFuel"}},e.sb_pflr={showClearButton:!0,searchEnabled:!1,dataSource:[{Id:0,Title:"Left"},{Id:1,Title:"Right"}],displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.PFLR"}},e.num_totaldelayhh={max:99,min:0,width:45,showSpinButtons:!1,readOnly:!0,bindingOptions:{value:"flight.TotalDelayHH"}},e.num_totaldelayhhmm={max:59,min:0,width:45,showSpinButtons:!1,readOnly:!0,bindingOptions:{value:"flight.TotalDelayMM"}},e._time_redirect={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entity_redirect.RedirectDate"}},e.txt_cancel_remark={bindingOptions:{value:"entity_cancel.CancelRemark"}},e.txt_redirect_remark={bindingOptions:{value:"entity_redirect.RedirectRemark"}},e.txt_charterer={readOnly:!0,bindingOptions:{}},e.time_redirect_sta={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"entity_redirect.STA",min:"flight.Takeoff"}},e.sb_redirect_airport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceAirport(),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(e){},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity_redirect.AirportId",selectedItem:"entity_redirect.Airport"}},e.moment=function(e){return moment(e).format("MMMM Do YYYY")},e.momenttime=function(e){return e?moment(e).format("HH:mm"):"--"},e.setStatus=function(t,i){var n=Enumerable.From(Flight.statusDataSource).Where("$.id=="+i).FirstOrDefault();t.status=i,e.flight.FlightStatusID=i,t.FlightStatus=n.title},e.getStatusClass=function(e){return"col-lg-2 col-md-3 col-sm-3 col-xs-3 font-inherit "+Enumerable.From(Flight.statusDataSource).Where("$.id=="+e.status).FirstOrDefault().class},e.popup_inf_visible=!1,e.popup_inf_title="Flight Information",e.popup_inf={elementAttr:{class:"popup_inf"},shading:!1,position:{my:"left",at:"left",of:window,offset:"5 0"},width:450,height:function(){return.95*$(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){$(e.titleElement).css("background-color","#f2552c")},onShowing:function(t){e.setWeather()},onShown:function(e){},onHiding:function(){e.popup_inf_visible=!1},bindingOptions:{visible:"popup_inf_visible",title:"popup_inf_title"}},e.popup_inf.toolbarItems[0].options.onClick=function(t){e.popup_inf_visible=!1},e.scroll_1={scrollByContent:!0,scrollByThumb:!0,height:571},e.scroll2_height=300,e.scroll_2={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll2_height"}},e.scroll_dep={scrollByContent:!0,scrollByThumb:!0,height:497},e.scroll_arr={scrollByContent:!0,scrollByThumb:!0,height:497};var f=[{text:"Main",id:"departure",visible:!0},{text:"Delays",id:"delays",visible:!0}],m=[{text:"Main",id:"arrival",visible:!0},{text:"Departure",id:"depparr",visible:!0}];e.tabs=f,e.selectedTabIndex=-1,e.$watch("selectedTabIndex",function(t){try{e.selectedTab=f[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_instance.repaint()}catch(e){}}),e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex"}},e.tabs2=m,e.selectedTabIndex2=-1,e.$watch("selectedTabIndex2",function(t){try{e.selectedTab2=m[t],$(".tab").hide(),$("."+e.selectedTab2.id).fadeIn(100,function(){}),e.dg2_instance.repaint()}catch(e){}}),e.tabs2_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs2",deep:!0},selectedIndex:"selectedTabIndex2"}},e.popup_arr_visible=!1,e.popup_arr_title="Arrival",e.popup_arr={elementAttr:{class:"popup_arr"},shading:!0,width:1200,height:647,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacarr",bindingOptions:{disabled:"IsApproved"},visible:!1,onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightLanding2)<new Date(e.flight.STA))return void General.ShowNotify(Config.Text_Landing,"error");if(e.flightOnBlock2&&new Date(e.flightOnBlock2)<new Date(e.flightLanding2))return void General.ShowNotify(Config.Text_OnBlock,"error");var i={StatusLog:[]},o=$("#resourceGanttba").data("ejGantt");e.flight.Landing=e.flightLanding2,i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:3,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.flightOnBlock2?(e.flight.ChocksIn=e.flightOnBlock2,
Flight.calculateDelayLandingOnBlock(e.flight),e.setStatus(e.flight,15)):e.setStatus(e.flight,3),e.fillDto(i),e.fillArrival(i),e.loadingVisible=!0,a.saveFlightArr(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),o.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_arr_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.flightOnBlock2=e.flight.ChocksIn,e.flightLanding2=e.flight.Landing,e.flightOffBlock2=e.flight.ChocksOut,e.flightTakeOff2=e.flight.Takeoff,e.depReadOnly=!0,e.selectedTabIndex2=0,e.setWeather()},onShown:function(t){e.flight.delays?e.dg2_ds=e.flight.delays:(e.loadingVisible=!0,a.getFlightDelayCodes(e.flight.ID).then(function(t){e.loadingVisible=!1,e.flight.delays=t,e.dg2_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},onHiding:function(){e.selectedTabIndex2=-1,e.popup_arr_visible=!1},bindingOptions:{visible:"popup_arr_visible",title:"popup_arr_title"}},e.popup_arr.toolbarItems[1].options.onClick=function(t){e.popup_arr_visible=!1},e.popup_fueldep_visible=!1,e.popup_fueldep_title="Departure Fuel",e.fuelDepInit={},e.popup_fueldep={elementAttr:{class:"popup_fueldep"},shading:!0,width:400,height:200,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacfueldep",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={ID:e.flight.ID,FuelDeparture:e.flight.FuelDeparture,FuelUnitID:e.flight.FuelUnitID};e.loadingVisible=!0,a.saveFlightFuelDeparture(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.fuelDepSaved=!0,e.loadingVisible=!1,e.popup_fueldep_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.fuelDepInit.FuelUnitID=e.flight.FuelUnitID,e.fuelDepInit.FuelDeparture=e.flight.FuelDeparture},onShown:function(e){},onHiding:function(){e.fuelDepSaved||(e.flight.FuelDeparture=e.fuelDepInit.FuelDeparture,e.flight.FuelUnitID=e.fuelDepInit.FuelUnitID),e.popup_fueldep_visible=!1},bindingOptions:{visible:"popup_fueldep_visible",title:"popup_fueldep_title"}},e.popup_fueldep.toolbarItems[1].options.onClick=function(t){e.popup_fueldep_visible=!1},e.popup_fuelarr_visible=!1,e.popup_fuelarr_title="Arrival Fuel",e.fuelArrInit={},e.popup_fuelarr={elementAttr:{class:"popup_fuelarr"},shading:!0,width:400,height:200,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacfuelarr",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={ID:e.flight.ID,FuelArrival:e.flight.FuelArrival};e.loadingVisible=!0,a.saveFlightFuelArrival(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.fuelArrSaved=!0,e.loadingVisible=!1,e.popup_fuelarr_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.fuelArrInit.FuelArrival=e.flight.FuelArrival},onShown:function(e){},onHiding:function(){e.fuelArrSaved||(e.flight.FuelArrival=e.fuelArrInit.FuelArrival),e.popup_fuelarr_visible=!1},bindingOptions:{visible:"popup_fuelarr_visible",title:"popup_fuelarr_title"}},e.popup_fuelarr.toolbarItems[1].options.onClick=function(t){e.popup_fuelarr_visible=!1},e.popup_pax_visible=!1,e.popup_pax_title="Pax",e.paxSaved=!1,e.paxInit={},e.popup_pax={elementAttr:{class:"popup_pax"},shading:!0,width:400,height:290,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacpax",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={ID:e.flight.ID,PaxAdult:e.flight.PaxAdult,PaxChild:e.flight.PaxChild,PaxInfant:e.flight.PaxInfant};e.loadingVisible=!0,a.saveFlightPax(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.paxSaved=!0,e.loadingVisible=!1,e.popup_pax_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.paxInit.PaxAdult=e.flight.PaxAdult,e.paxInit.PaxChild=e.flight.PaxChild,e.paxInit.PaxInfant=e.flight.PaxInfant},onShown:function(e){},onHiding:function(){e.paxSaved||(e.flight.PaxAdult=e.paxInit.PaxAdult,e.flight.PaxChild=e.paxInit.PaxChild,e.flight.PaxInfant=e.paxInit.PaxInfant,e.calculateTotalPax()),e.popup_pax_visible=!1},bindingOptions:{visible:"popup_pax_visible",title:"popup_pax_title"}},e.popup_pax.toolbarItems[1].options.onClick=function(t){e.popup_pax_visible=!1},e.popup_link_visible=!1,e.popup_link_title="Linked Flight",e.popup_link={elementAttr:{class:"popup_link"},shading:!0,height:490,width:700,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fblink",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i=new Date(e.time_ir_std_date).getDatePartArray(),n=new Date(e.time_ir_std_time).getTimePartArray(),o=new Date(i[0],i[1],i[2],n[0],n[1],0,0),l=new Date(e.time_ir_sta_date).getDatePartArray(),r=new Date(e.time_ir_sta_time).getTimePartArray(),d=new Date(l[0],l[1],l[2],r[0],r[1],0,0),s=JSON.parse(JSON.stringify(e.linkEntity));s.FlightStatusID=1,s.STD=new Date(o).toUTCString(),s.STA=new Date(d).toUTCString(),s.LinkedReason=1133,e.loadingVisible=!0,a.saveFlight(s).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.popup_link_visible=!1,e.BeginSearch()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(e){},onShown:function(e){},onHiding:function(){e.linkEntity.ToAirportId=null,e.linkEntity.FromAirportId=null,e.time_ir_std_date=null,e.time_ir_std_time=null,e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.linkEntity=null,e.popup_link_visible=!1},bindingOptions:{visible:"popup_link_visible",title:"popup_link_title"}},e.popup_link.toolbarItems[1].options.onClick=function(t){e.popup_link_visible=!1},e.popup_free_visible=!1,e.popup_free_title="Nonscheduled Flight",e.freeSaved=!1,e.popup_free={elementAttr:{class:"popup_free"},shading:!0,height:350,width:750,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fblink",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i=new Date(e.time_ir_std_date).getDatePartArray(),n=new Date(e.time_ir_std_time).getTimePartArray(),o=new Date(i[0],i[1],i[2],n[0],n[1],0,0),l=new Date(e.time_ir_sta_date).getDatePartArray(),r=new Date(e.time_ir_sta_time).getTimePartArray(),d=new Date(l[0],l[1],l[2],r[0],r[1],0,0),s=JSON.parse(JSON.stringify(e.linkEntity));s.FlightStatusID=1,s.STD=new Date(o).toUTCString(),s.STA=new Date(d).toUTCString(),e.loadingVisible=!0,a.saveFlight(s).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.linkEntity.FlightNumber=null,e.linkEntity.FromAirportId=e.linkEntity.ToAirportId,e.linkEntity.ToAirportId=null,e.linkEntity.FlightH=null,e.linkEntity.FlightM=null,e.time_ir_std_date=General.getDayFirstHour(new Date(e.time_ir_sta_date)),e.time_ir_std_time=new Date(e.time_ir_sta_time).addMinutes(60),e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.loadingVisible=!1,e.freeSaved=!0,-1!=e.linkEntity.ID&&(e.popup_free_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(e){},onShown:function(e){},onHiding:function(){e.freeSaved&&e.BeginSearch(),e.freeSaved=!1,e.linkEntity.ToAirportId=null,e.linkEntity.FromAirportId=null,e.time_ir_std_date=null,e.time_ir_std_time=null,e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.linkEntity=null,e.popup_free_visible=!1},bindingOptions:{visible:"popup_free_visible",title:"popup_free_title"}},e.popup_free.toolbarItems[1].options.onClick=function(t){e.popup_free_visible=!1},e.rosterSelectedFlights=[],e.rosterFlightClick=function(t){var i="rf-"+t.CrewId+"-"+t.FlightId,n=$("#"+i);n.hasClass("rfgray")?(n.removeClass("rfgray"),e.rosterSelectedFlights=Enumerable.From(e.rosterSelectedFlights).Where(function(e){return e.CrewId+"-"+e.FlightId!=t.CrewId+"-"+t.FlightId}).ToArray()):(n.addClass("rfgray"),e.rosterSelectedFlights.push(JSON.parse(JSON.stringify(t))))},e.rosterOff=function(t){var i=Enumerable.From(e.rosterSelectedFlights).Where("$.CrewId=="+t.CrewId).ToArray();if(i&&0!=i.length){var n=[],o=[];$.each(i,function(e,t){n.push(t.FDPId),o.push(t.FDPItemId)});var l=n.join("*"),r=o.join("*"),d={fdps:l,items:r};e.loadingVisible=!0,a.fdpsOff(d).then(function(i){e.loadingVisible=!1,e.rosterSelectedFlights=Enumerable.From(e.rosterSelectedFlights).Where(function(e){return-1==o.indexOf(e.FDPItemId)}).ToArray();var n=Enumerable.From(e.dg_roster_ds).Where("$.CrewId=="+t.CrewId).FirstOrDefault();n.flights=Enumerable.From(n.flights).Where(function(e){return-1==o.indexOf(e.FDPItemId)}).ToArray(),e.dg_roster_instance.refresh()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.rosterReplace=function(e){},e.rosterRefuse=function(e){},e.selectCode=function(t){var t=Enumerable.From(e.delayCodes).Where("$.Id=="+t.Id).FirstOrDefault();e.delayCodeId=t.Id,e.popup_codes_visible=!1},e.dg_roster_columns=[{dataField:"JobGroup",caption:"Rank",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"ScheduleName",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"CrewId",caption:"Flights",alignment:"left",allowFiltering:!1,allowSorting:!1,cellTemplate:"rosterFlightTemplate"},{dataField:"CrewId",caption:"",alignment:"center",allowFiltering:!1,allowSorting:!1,cellTemplate:"rosterOffTemplate",width:300}],e.dg_roster_selected=null,e.dg_roster_instance=null,e.dg_roster_ds=null,e.dg_roster={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-150,columns:e.dg_roster_columns,onContentReady:function(t){e.dg_roster_instance||(e.dg_roster_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_roster_selected=i||null},bindingOptions:{dataSource:"dg_roster_ds"}},e.dg_codes_columns=[{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:100},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Id",caption:"",alignment:"center",allowFiltering:!1,allowSorting:!1,cellTemplate:"codeSelectTemplate",width:100}],e.dg_codes_selected=null,e.dg_codes_instance=null,e.dg_codes_ds=null,e.dg_codes={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:670,columns:e.dg_codes_columns,onContentReady:function(t){e.dg_codes_instance||(e.dg_codes_instance=t.component)},onSelectionChanged:function(e){e.selectedRowsData[0]},bindingOptions:{dataSource:"delayCodes"}},e.formatTime=function(e){return moment(e).format("HHmm")},e.bindRoster=function(){var t=new Date(e.selectedDate),i=moment(t).format("YYYY-MM-DDTHH:mm:ss");e.loadingVisible=!0,a.getCrewsFlights(i).then(function(t){e.loadingVisible=!1,e.dg_roster_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.popup_roster_visible=!1,e.popup_roster_title="Roster",e.popup_roster={elementAttr:{class:"popup_roster"},shading:!0,height:800,width:1300,fullScreen:!0,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",onClick:function(e){}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_roster_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(e){},onShown:function(t){e.bindRoster()},onHiding:function(){e.popup_roster_visible=!1},bindingOptions:{visible:"popup_roster_visible",title:"popup_roster_title"}},e.popup_codes_visible=!1,e.popup_codes_title="Delay Codes",e.popup_codes={elementAttr:{class:"popup_codes"},shading:!0,height:800,width:1300,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_codes_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(e){},onShown:function(t){e.bindRoster()},onHiding:function(){e.popup_codes_visible=!1},bindingOptions:{visible:"popup_codes_visible",title:"popup_codes_title"}},e.dg_msf_columns=[{dataField:"FlightNumber",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:65,fixed:!1,fixedPosition:"left"},{dataField:"Route",caption:"Route",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"STD",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:78,format:"HH:mm",sortIndex:1,sortOrder:"asc"},{dataField:"STA",caption:"STA",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:78,format:"HH:mm"},{dataField:"Register",caption:"Reg.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",sortIndex:2,sortOrder:"asc"}],e.dg_msf_selected=null,e.dg_msf_instance=null,e.dg_msf={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:322,columns:e.dg_msf_columns,onContentReady:function(t){e.dg_msf_instance||(e.dg_msf_instance=t.component)},onRowPrepared:function(e){},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_msf_selected=i||null},bindingOptions:{dataSource:"multiSelectedFlights"}},e.dg_columns3=[{dataField:"Title",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:140,fixed:!1,fixedPosition:"left"},{dataField:"Value",caption:"Route",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1}],e.dg3_selected=null,e.dg3_instance=null,e.dg3_ds=null,e.dg3={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:300,columns:e.dg_columns3,onContentReady:function(t){e.dg3_instance||(e.dg3_instance=t.component)},onRowPrepared:function(e){},showColumnHeaders:!1,onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?e.dg32_selected=i:e.dg3_selected=null},onCellPrepared:function(t){"data"===t.rowType&&"Title"==t.column.dataField&&t.cellElement.css("backgroundColor","lightgray"),"data"===t.rowType&&"Value"==t.column.dataField&&"FDP"==t.data.Title&&e.STBYFDPStat.IsOver&&t.cellElement.css("backgroundColor","#ffcccc")},bindingOptions:{dataSource:"dg3_ds"}},e.dg_crew_stby_columns=[{dataField:"JobGroup",caption:"RNK",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:85},{dataField:"ScheduleName",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"LastLocation",caption:"Apt",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"Id",caption:"",width:90,allowFiltering:!1,allowSorting:!1,cellTemplate:"activeSTBYTemplate"}],e.dg_crew_stby_selected=null,e.dg_crew_stby_instance=null,e.dg_crew_stby_ds=null,e.fillStbyDs=function(){var t=Enumerable.From(e.activatedStbys).Select("$.CrewId").ToArray();e.dg_crew_stby_ds=Enumerable.From(e.crew_stby_ds).Where(function(e){return-1==t.indexOf(e.CrewId)}).ToArray()},e.crew_stby_ds=null,e.dg_crew_stby={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:655,columns:e.dg_crew_stby_columns,onContentReady:function(t){e.dg_crew_stby_instance||(e.dg_crew_stby_instance=t.component)},onRowPrepared:function(e){},onSelectionChanged:function(e){e.selectedRowsData[0]},bindingOptions:{dataSource:"dg_crew_stby_ds"}},e.getDefaultPositionId=function(e){switch(e){case"IP":case"IP1":case"IP2":return 12e3;case"P1":case"P12":case"P13":case"P14":case"P15":case"P11":return 1160;case"P2":case"P21":case"P22":case"P23":case"P24":case"P25":return 1161;case"Safety":case"Safety1":case"Safety2":return 1162;case"ISCCM":case"ISCCM1":return 10002;case"SCCM":case"SCCM1":case"SCCM2":case"SCCM3":case"SCCM4":case"SCCM5":return 1157;case"CCM":case"CCM1":case"CCM2":case"CCM3":case"CCM4":case"CCM5":return 1158;case"OBS":case"OBS1":case"OBS2":return 1153;case"CHECK":case"CHECK1":case"CHECK2":return 1154;default:return e}},e.activatedStbys=null,e.removeActivatedStby=function(t){var i={fdpId:t.fdpId};e.loadingVisible=!0,a.deleteActivateStby(i).then(function(i){e.loadingVisible=!1,e.activatedStbys=Enumerable.From(e.activatedStbys).Where("$.fdpId!="+t.fdpId).ToArray(),e.fillStbyDs()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.activeStby=function(t){var i=t.data,n=Enumerable.From(e.multiSelectedFlights).OrderBy(function(e){return new Date(e.STD)}).ToArray(),o=Enumerable.From(n).Select("$.ID").ToArray(),l=o.join("*");e.loadingVisible=!0,a.checkStbyActivation(e.STBYFDPStat.Extended>0?1:0,i.FDPId,n[0].ID,e.STBYFDPStat.Duty,e.STBYFDPStat.MaxFDPExtended).then(function(t){if(e.loadingVisible=!1,console.log("STBY STAT"),console.log(t),t.maxFDPError)return void General.ShowNotify("ERROR MAX FDP DUE TO STBY REDUCTION","error");if(t.durationError)return void General.ShowNotify("ERROR TOTAL DURATION 18 HOURS","error");var o={crewId:i.CrewId,stbyId:i.FDPId,fids:l,rank:e.getDefaultPositionId(i.JobGroup)};e.loadingVisible=!0,a.activateStby(o).then(function(t){e.loadingVisible=!1;var a=t.Id,o={flights:[],fdpId:a};o.CrewId=i.CrewId,o.Name=i.Name,o.ScheduleName=i.ScheduleName,o.Position=i.JobGroup,o.PositionId=e.getDefaultPositionId(i.JobGroup),$.each(n,function(e,t){o.flights.push(JSON.parse(JSON.stringify(t)))}),e.activatedStbys.push(o),e.fillStbyDs()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.popup_stby_visible=!1,e.popup_stby_title="StandBy / Reserve",e.popup_stby={elementAttr:{class:"popup_stby"},shading:!0,width:1300,height:800,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",onClick:function(e){}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_stby_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(e){},onShown:function(t){e.dg_msf_instance.refresh()},onHiding:function(){e.popup_stby_visible=!1},bindingOptions:{visible:"popup_stby_visible",title:"popup_stby_title"}},e.popup_cargo_visible=!1,e.popup_cargo_title="Cargo/Baggage",e.cargoSaved=!1,e.cargoInit={},e.popup_cargo={elementAttr:{class:"popup_cargo"},shading:!0,width:400,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaccargo",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i={ID:e.flight.ID,CargoUnitID:e.flight.CargoUnitID,CargoWeight:e.flight.CargoWeight,CargoCount:e.flight.CargoCount,BaggageWeight:e.flight.BaggageWeight,BaggageCount:e.flight.BaggageCount};e.loadingVisible=!0,a.saveFlightCargo(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.cargoSaved=!0,e.loadingVisible=!1,e.popup_cargo_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.cargoInit.CargoUnitID=e.flight.CargoUnitID,e.cargoInit.CargoWeight=e.flight.CargoWeight,e.cargoInit.CargoCount=e.flight.CargoCount,e.cargoInit.BaggageWeight=e.flight.BaggageWeight,e.cargoInit.BaggageCount=e.flight.BaggageCount},onShown:function(e){},onHiding:function(){e.cargoSaved||(e.flight.CargoUnitID=e.cargoInit.CargoUnitID,e.flight.CargoWeight=e.cargoInit.CargoWeight,e.flight.CargoCount=e.cargoInit.CargoCount,e.flight.BaggageWeight=e.cargoInit.BaggageWeight,e.flight.BaggageCount=e.cargoInit.BaggageCount),e.popup_cargo_visible=!1},bindingOptions:{visible:"popup_cargo_visible",title:"popup_cargo_title"}},e.popup_cargo.toolbarItems[1].options.onClick=function(t){e.popup_cargo_visible=!1},e.fillDto=function(t){t.ID=e.flight.ID,t.UserId=n.userId,t.FlightStatusID=e.flight.FlightStatusID,t.Delays=[];var i=Enumerable.From(e.dg_delay_ds).ToArray();$.each(i,function(i,a){97==a.Id&&(e.flight.notes=97),t.Delays.push({FlightId:e.flight.ID,DelayCodeId:a.DelayCodeId,HH:a.HH,MM:a.MM,Remark:a.Remark,UserId:n.userId})})},e.fillLog=function(t){e.flight.ChocksOut&&(t.ChocksOut=new Date(e.flight.ChocksOut).toUTCString()),e.flight.Takeoff&&(t.Takeoff=new Date(e.flight.Takeoff).toUTCString()),t.DepartureRemark=e.flight.DepartureRemark,t.GWTO=e.flight.GWTO,t.FuelDeparture=e.flight.FuelDeparture,t.PaxAdult=e.flight.PaxAdult,t.PaxInfant=e.flight.PaxInfant,t.PaxChild=e.flight.PaxChild,t.CargoWeight=e.flight.CargoWeight,t.CargoUnitID=e.flight.CargoUnitID,t.BaggageCount=e.flight.BaggageCount,t.CargoCount=e.flight.CargoCount,t.BaggageWeight=e.flight.BaggageWeight,t.FuelUnitID=e.flight.FuelUnitID,t.FPFlightHH=e.flight.FPFlightHH,t.FPFlightMM=e.flight.FPFlightMM,t.FPFuel=e.flight.FPFuel,t.Defuel=e.flight.Defuel,t.UsedFuel=e.flight.UsedFuel,t.JLBLHH=e.flight.JLBLHH,t.JLBLMM=e.flight.JLBLMM,t.PFLR=e.flight.PFLR,e.flight.Landing&&(t.Landing=new Date(e.flight.Landing).toUTCString()),e.flight.ChocksIn&&(t.ChocksIn=new Date(e.flight.ChocksIn).toUTCString()),t.BlockH=e.flight.BlockH,t.BlockM=e.flight.BlockM,t.GWLand=e.flight.GWLand,t.FuelArrival=e.flight.FuelArrival,t.ArrivalRemark=e.flight.ArrivalRemark,9==e.flight.FlightStatusID&&(e.flight.RampDate=new Date(e.time_status_value).toUTCString(),t.RampDate=new Date(e.time_status_value).toUTCString(),t.RampReasonId=e.flight.RampReasonId),e.flight.RedirectReasonId&&(e.flight.RedirectDate=new Date(e.time_redirect_value).toUTCString(),t.RedirectDate=new Date(e.time_redirect_value).toUTCString(),e.flight.ToAirportId=e.entity_redirect.Airport.Id,e.flight.ToAirport=e.entity_redirect.Airport.Id,t.ToAirportId=e.entity_redirect.Airport.Id,e.flight.OToAirportIATA||(e.flight.OToAirportIATA=e.flight.ToAirportIATA),e.flight.ToAirportIATA=e.entity_redirect.Airport.IATA,t.RedirectReasonId=e.flight.RedirectReasonId,t.RedirectRemark=e.flight.RedirectRemark),4==e.flight.FlightStatusID&&(e.flight.CancelDate=new Date(e.time_status_value).toUTCString(),t.CancelDate=new Date(e.time_status_value).toUTCString(),t.CancelReasonId=e.flight.CancelReasonId),t.EstimatedDelays=[];var i=Enumerable.From(e.dataSource).Where("$.EstimatedDelayChanged && $.EstimatedDelayChanged==true && $.EstimatedDelay>0 && $.status==1 && $.startDate.getDatePart()=="+e.flight.startDate.getDatePart()+" && $.startDate.getTime() > "+e.flight.startDate.getTime()+"  && $.RegisterID=="+e.flight.RegisterID).OrderBy("$.startDate").ToArray();$.each(i,function(e,i){t.EstimatedDelays.push({FlightId:i.ID,Delay:Math.floor(i.EstimatedDelay)})})},e.fillDeparture=function(t){t.ChocksOut=new Date(e.flight.ChocksOut).toUTCString(),e.flight.Takeoff&&(t.Takeoff=new Date(e.flight.Takeoff).toUTCString()),t.DepartureRemark=e.flight.DepartureRemark,t.GWTO=e.flight.GWTO,t.FuelDeparture=e.flight.FuelDeparture,t.PaxAdult=e.flight.PaxAdult,t.PaxInfant=e.flight.PaxInfant,t.PaxChild=e.flight.PaxChild,t.CargoWeight=e.flight.CargoWeight,t.CargoUnitID=e.flight.CargoUnitID,t.BaggageCount=e.flight.BaggageCount,t.CargoCount=e.flight.CargoCount,t.BaggageWeight=e.flight.BaggageWeight,t.FuelUnitID=e.flight.FuelUnitID,t.EstimatedDelays=[];var i=Enumerable.From(e.dataSource).Where("$.EstimatedDelayChanged && $.EstimatedDelayChanged==true && $.EstimatedDelay>0 && $.status==1 && $.startDate.getDatePart()=="+e.flight.startDate.getDatePart()+" && $.startDate.getTime() > "+e.flight.startDate.getTime()+"  && $.RegisterID=="+e.flight.RegisterID).OrderBy("$.startDate").ToArray();$.each(i,function(e,i){t.EstimatedDelays.push({FlightId:i.ID,Delay:Math.floor(i.EstimatedDelay)})})},e.fillArrival=function(t){t.Landing=new Date(e.flight.Landing).toUTCString(),e.flight.ChocksIn&&(t.ChocksIn=new Date(e.flight.ChocksIn).toUTCString()),t.BlockH=e.flight.BlockH,t.BlockM=e.flight.BlockM,t.GWLand=e.flight.GWLand,t.FuelArrival=e.flight.FuelArrival,t.ArrivalRemark=e.flight.ArrivalRemark},e.popup_flight_visible=!1,e.popup_flight_title="Departure",e.popup_flight={elementAttr:{class:"popup_flight"},shading:!0,width:1200,height:647,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacflight",bindingOptions:{disabled:"IsApproved"},visible:!0,onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightOffBlock2)<new Date(e.flight.STD))return void General.ShowNotify(Config.Text_OffBlock,"error");if(e.flightTakeOff2&&new Date(e.flightTakeOff2)<new Date(e.flightOffBlock2))return void General.ShowNotify(Config.Text_TakeOff,"error");var i={StatusLog:[]},o=$("#resourceGanttba").data("ejGantt"),l=!e.flight.ChocksOut&&e.flightOffBlock2||new Date(e.flight.ChocksOut).getTime()!=new Date(e.flightOffBlock2).getTime();e.flight.ChocksOut=e.flightOffBlock2,Flight.calculateDelayOffBlock(e.flight),l&&e.applyNextFlight&&Flight.calculateNextTaskDelayOffBlock(e.flight,e.dataSource,o),i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:14,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.flightTakeOff2?(e.flight.Takeoff=e.flightTakeOff2,4!=e.flight.FlightStatusID&&e.setStatus(e.flight,2),i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:2,Date:new Date(Date.now()).toUTCString(),UserId:n.userId})):4!=e.flight.FlightStatusID&&e.setStatus(e.flight,14),e.fillDto(i),e.fillDeparture(i),e.loadingVisible=!0,a.saveFlightDep(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),o.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_flight_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.flight.ChocksOut?e.flightOffBlock2=e.flight.ChocksOut:e.flightOffBlock2=Flight.getEstimatedOffBlock(e.flight),e.flightTakeOff2=e.flight.Takeoff,e.depReadOnly=!1,e.selectedTabIndex=0,e.setWeather()},onShown:function(t){e.flight.delays?e.dg_ds=e.flight.delays:(e.loadingVisible=!0,a.getFlightDelayCodes(e.flight.ID).then(function(t){e.loadingVisible=!1,e.flight.delays=t,e.dg_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},onHiding:function(){e.selectedTabIndex=-1,e.popup_flight_visible=!1},bindingOptions:{visible:"popup_flight_visible",title:"popup_flight_title"}},e.popup_flight.toolbarItems[1].options.onClick=function(t){e.popup_flight_visible=!1},e.popup_log_visible=!1,e.popup_log_title="Log",e.popup_log={elementAttr:{class:"popup_log"},shading:!0,width:1520,height:687,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",text:"Journey Log",icon:"",onClick:function(t){e.line=[],e.jlShow=!1,e.leg1Text="",e.leg1Visible=!1,e.leg1Value=!1,e.leg2Text="",e.leg2Visible=!1,e.leg2Value=!1,e.leg3Text="",e.leg3Visible=!1,e.leg3Value=!1,e.leg4Text="",e.leg4Visible=!1,e.leg4Value=!1,e.leg5Text="",e.leg5Visible=!1,e.leg5Value=!1,e.leg6Text="",e.leg6Visible=!1,e.leg6Value=!1,e.leg7Text="",e.leg7Visible=!1,e.leg7Value=!1,e.leg8Text="",e.leg8Visible=!1,e.leg8Value=!1,e.loadingVisible=!0,a.getFlightsLine(e.flight.ID).then(function(t){e.loadingVisible=!1,$.each(t,function(t,i){switch(e.line.push(i),t){case 0:e.leg1Text=i.FlightNumber,e.leg1Visible=!0,e.leg1Value=!0;break;case 1:e.leg2Text=i.FlightNumber,e.leg2Visible=!0,e.leg2Value=!0;break;case 2:e.leg3Text=i.FlightNumber,e.leg3Visible=!0,e.leg3Value=!0;break;case 3:e.leg4Text=i.FlightNumber,e.leg4Visible=!0,e.leg4Value=!0;break;case 4:e.leg5Text=i.FlightNumber,e.leg5Visible=!0,e.leg5Value=!0;break;case 5:
e.leg6Text=i.FlightNumber,e.leg6Visible=!0,e.leg6Value=!0;break;case 6:e.leg7Text=i.FlightNumber,e.leg7Visible=!0,e.leg7Value=!0;break;case 7:e.leg8Text=i.FlightNumber,e.leg8Visible=!0,e.leg8Value=!0}e.popup_jl_visible=!0})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Crew List",icon:"",onClick:function(t){e.line=[],e.clShow=!1,e.leg1Text="",e.leg1Visible=!1,e.leg1Value=!1,e.leg2Text="",e.leg2Visible=!1,e.leg2Value=!1,e.leg3Text="",e.leg3Visible=!1,e.leg3Value=!1,e.leg4Text="",e.leg4Visible=!1,e.leg4Value=!1,e.leg5Text="",e.leg5Visible=!1,e.leg5Value=!1,e.leg6Text="",e.leg6Visible=!1,e.leg6Value=!1,e.leg7Text="",e.leg7Visible=!1,e.leg7Value=!1,e.leg8Text="",e.leg8Visible=!1,e.leg8Value=!1,e.loadingVisible=!0,a.getFlightsLine(e.flight.ID).then(function(t){e.loadingVisible=!1,$.each(t,function(t,i){switch(e.line.push(i),t){case 0:e.leg1Text=i.FlightNumber,e.leg1Visible=!0,e.leg1Value=!0;break;case 1:e.leg2Text=i.FlightNumber,e.leg2Visible=!0,e.leg2Value=!0;break;case 2:e.leg3Text=i.FlightNumber,e.leg3Visible=!0,e.leg3Value=!0;break;case 3:e.leg4Text=i.FlightNumber,e.leg4Visible=!0,e.leg4Value=!0;break;case 4:e.leg5Text=i.FlightNumber,e.leg5Visible=!0,e.leg5Value=!0;break;case 5:e.leg6Text=i.FlightNumber,e.leg6Visible=!0,e.leg6Value=!0;break;case 6:e.leg7Text=i.FlightNumber,e.leg7Visible=!0,e.leg7Value=!0;break;case 7:e.leg8Text=i.FlightNumber,e.leg8Visible=!0,e.leg8Value=!0}e.popup_cl_visible=!0})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Reporting Time",icon:"clock",bindingOptions:{disabled:"IsApproved"},visible:!0,onClick:function(t){e.popup_crew_visible=!0}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaclog",bindingOptions:{disabled:"IsApproved"},visible:!0,onClick:function(t){if(!e.flightOffBlock2&&(2==e.flight.FlightStatusID||3==e.flight.FlightStatusID||7==e.flight.FlightStatusID||9==e.flight.FlightStatusID||14==e.flight.FlightStatusID||15==e.flight.FlightStatusID||17==e.flight.FlightStatusID))return void General.ShowNotify(Config.Text_OffBlock,"error");if(!e.flightTakeOff2&&(2==e.flight.FlightStatusID||3==e.flight.FlightStatusID||7==e.flight.FlightStatusID||15==e.flight.FlightStatusID||17==e.flight.FlightStatusID))return void General.ShowNotify(Config.Text_TakeOff,"error");if(!e.flightLanding2&&(3==e.flight.FlightStatusID||15==e.flight.FlightStatusID))return void General.ShowNotify(Config.Text_Landing,"error");if(!e.flightOnBlock2&&15==e.flight.FlightStatusID)return void General.ShowNotify(Config.Text_OnBlock,"error");if(!e.flightOffBlock2&&(e.flightTakeOff2||e.flightLanding2||e.flightOnBlock2))return void General.ShowNotify(Config.Text_OffBlock,"error");if(!e.flightTakeOff2&&(e.flightLanding2||e.flightOnBlock2))return void General.ShowNotify(Config.Text_TakeOff,"error");if(!e.flightLanding2&&e.flightOnBlock2)return void General.ShowNotify(Config.Text_Landing,"error");if(e.flightTakeOff2&&new Date(e.flightTakeOff2)<new Date(e.flightOffBlock2))return void General.ShowNotify(Config.Text_TakeOff,"error");if(e.flightLanding2&&new Date(e.flightLanding2)<new Date(e.flightTakeOff2))return void General.ShowNotify(Config.Text_Landing,"error");if(e.flightOnBlock2&&new Date(e.flightOnBlock2)<new Date(e.flightLanding2))return void General.ShowNotify(Config.Text_OnBlock,"error");if(4==e.flight.FlightStatusID&&!e.flight.CancelReasonId)return void General.ShowNotify(Config.Text_CancelReason,"error");var i=0;e.dg_delay_ds||(e.dg_delay_ds=[]),i=Enumerable.From(e.dg_delay_ds).Select("$.Total").Sum(),e.flight.TotalDelayTotalMM||(e.flight.TotalDelayTotalMM=0),e.flight.TotalDelayTotalMM>5&&e.dg_delay_ds.length,e.dg_delay_ds&&(e.flight.TotalDelayTotalMM||(e.flight.TotalDelayTotalMM=0),i=Enumerable.From(e.dg_delay_ds).Select("$.Total").Sum(),5!=e.flight.FlightStatusID&&i>5&&i!=e.flight.TotalDelayTotalMM&&e.flightOffBlock2);var n={StatusLog:[]},o=$("#resourceGanttba").data("ejGantt");if(e.flight.ChocksOut=e.flightOffBlock2?e.flightOffBlock2:null,e.flight.Takeoff=e.flightTakeOff2?e.flightTakeOff2:null,e.flight.Landing=e.flightLanding2?e.flightLanding2:null,e.flight.ChocksIn=e.flightOnBlock2?e.flightOnBlock2:null,"UTC"==e.timeBase){var l=-1*(new Date).getTimezoneOffset();e.flight.ChocksOut=new Date(e.flight.ChocksOut).addMinutes(l),e.flight.Takeoff=new Date(e.flight.Takeoff).addMinutes(l),e.flight.Landing=new Date(e.flight.Landing).addMinutes(l),e.flight.ChocksIn=new Date(e.flight.ChocksIn).addMinutes(l),e.time_redirect_value&&(e.time_redirect_value=new Date(e.time_redirect_value).addMinutes(l)),e.time_ramp_value&&(e.time_ramp_value=new Date(e.time_ramp_value).addMinutes(l))}e.flight.ChocksIn&&Flight.calculateDelayLandingOnBlock(e.flight),e.flight.ChocksOut&&Flight.XcalculateDelayOffBlock(e.flight),e.flight.ChocksIn&&Flight.XcalculateDelayLandingOnBlock(e.flight),e.flight.EstimatedDelay=i,e.setStatus(e.flight,e.flight.FlightStatusID),e.fillDto(n),e.fillLog(n),n.NightTime=e.flight.NightTime,n.SendDelaySMS=e.sms_delay?1:0,n.SendCancelSMS=e.sms_cancel?1:0,e.loadingVisible=!0,a.saveFlightLog(n).then(function(t){if("UTC"==e.timeBase&&e.doUTC){var n=-1*(new Date).getTimezoneOffset();e.flight.ChocksOut=new Date(e.flight.ChocksOut).addMinutes(-n),e.flight.Takeoff=new Date(e.flight.Takeoff).addMinutes(-n),e.flight.Landing=new Date(e.flight.Landing).addMinutes(-n),e.flight.ChocksIn=new Date(e.flight.ChocksIn).addMinutes(-n),e.time_redirect_value&&(e.time_redirect_value=new Date(e.time_redirect_value).addMinutes(-n)),e.time_ramp_value&&(e.time_ramp_value=new Date(e.time_ramp_value).addMinutes(-n)),e.flight.ChocksIn&&Flight.calculateDelayLandingOnBlock(e.flight),e.flight.ChocksOut&&Flight.XcalculateDelayOffBlock(e.flight),e.flight.ChocksIn&&Flight.XcalculateDelayLandingOnBlock(e.flight),e.flight.EstimatedDelay=i}o.reRenderChart(),$(".task-"+e.flight.ID).parent().addClass("e-gantt-taskbarSelection"),e.loadingVisible=!1,e.sms_delay=!1,e.sms_cancel=!1,e.popup_log_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_log_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){console.log("Updtae delay remark log showing"),e.flight.ChocksOut&&(e.flightOffBlock2=e.flight.ChocksOut),e.flightOffBlock2||(e.flightOffBlock2=e.flight.STD),e.flightTakeOff2=e.flight.Takeoff,e.flightTakeOff2||(e.flightTakeOff2=e.flight.STD),e.flightOnBlock2=e.flight.ChocksIn,e.flightOnBlock2||(e.flightOnBlock2=e.flight.STA),e.flightLanding2=e.flight.Landing,e.flightLanding2||(e.flightLanding2=e.flight.STA),4==e.flight.FlightStatusID?e.time_status_value=new Date(e.flight.CancelDate):9==e.flight.FlightStatusID&&(e.time_status_value=new Date(e.flight.RampDate)),e.flight.RedirectReasonId&&(e.time_redirect_value=new Date(e.flight.RedirectDate),e.entity_redirect.AirportId=e.flight.ToAirport),e.depReadOnly=!1},onShown:function(t){e.loadingVisible=!0,a.getFlightDelays(e.flight.ID).then(function(t){e.loadingVisible=!1,console.log(t),$.each(t,function(t,i){var n={Id:i.ID,DelayCodeId:i.DelayCodeId,HH:i.DelayHH?i.DelayHH:0,MM:i.DelayMM?i.DelayMM:0,Code:i.Code,Title:i.Title,Remark:i.Remark,Total:null};n.Total=60*n.HH+n.MM,n.Amount=pad(n.HH.toString())+":"+pad(n.MM.toString()),e.dg_delay_ds.push(n)}),e.convertUTCEnabled=!1,e.doUTC?e.timeBase="UTC":e.timeBase="LCB",e.getCrewAbs(e.flight.ID)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},onHiding:function(){e.before_refreshed_flight&&(e.undoRefresh(),e.before_refreshed_flight=null),e.dg_delay_ds=[],e.flightTakeOff2=null,e.flightOnBlock2=null,e.flightOffBlock2=null,e.flightLanding2=null,e.time_status_value=null,e.entity_redirect.ToAirportId=null,e.popup_log_visible=!1},bindingOptions:{visible:"popup_log_visible",title:"popup_log_title","toolbarItems[0].visible":"IsJLAccess","toolbarItems[1].visible":"IsJLAccess","toolbarItems[2].visiblestart":"IsEditable","toolbarItems[3].visible":"IsEditable"}},e.popup_takeoff_visible=!1,e.popup_takeoff_title="Take Off",e.popup_takeoff={width:400,height:400,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbactakeoff",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightTakeOff)<new Date(e.flight.ChocksOut))return void General.ShowNotify(Config.Text_TakeOff,"error");var i=$("#resourceGanttba").data("ejGantt");e.flight.Takeoff=e.flightTakeOff,e.setStatus(e.flight,2);var o={Takeoff:new Date(e.flight.Takeoff).toUTCString(),StatusLog:[],EstimatedDelays:[]};o.ID=e.flight.ID,o.UserId=n.userId,o.FlightStatusID=e.flight.FlightStatusID,o.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:2,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.loadingVisible=!0,a.saveFlightTakeOff(o).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_takeoff_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_takeoff_visible=!1},bindingOptions:{visible:"popup_takeoff_visible",title:"popup_takeoff_title"}},e.popup_takeoff.toolbarItems[1].options.onClick=function(t){e.popup_takeoff_visible=!1},e.dg_selected=null,e.dg_columns=[{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Selected",caption:"",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!0,width:90,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!0,fixedPosition:"left"},{dataField:"MM",caption:"Minute(s)",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!0,width:90},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_height=100,e.dg_instance=null,e.dg_ds=null,e.dg={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},onEditingStart:function(e){"MM"!=e.column.dataField||e.key.Selected||(e.cancel=!0)},onRowUpdating:function(e){e.newData.hasOwnProperty("Selected")&&(e.newData.Selected||(e.newData.HH=null,e.newData.MM=null))},onRowUpdated:function(e){},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},height:497,summary:{totalItems:[{column:"MM",summaryType:"sum"}]},bindingOptions:{dataSource:"dg_ds"}},e.dg2_selected=null,e.dg2_columns=[{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Selected",caption:"",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!0,width:90,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!0,fixedPosition:"left"},{dataField:"MM",caption:"Minute(s)",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!0,width:90},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg2_height=100,e.dg2_instance=null,e.dg2_ds=null,e.dg2={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},onEditingStart:function(e){"MM"!=e.column.dataField||e.key.Selected||(e.cancel=!0)},onRowUpdating:function(e){e.newData.hasOwnProperty("Selected")&&(e.newData.Selected||(e.newData.HH=null,e.newData.MM=null))},onRowUpdated:function(e){},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg2_columns,onContentReady:function(t){e.dg2_instance||(e.dg2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg2_selected=i||null},height:330,summary:{totalItems:[{column:"MM",summaryType:"sum"}]},bindingOptions:{dataSource:"dg2_ds"}},e.dg_crew_abs_columns=[{caption:"Crew",columns:[{dataField:"IsPositioning",caption:"DH",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:60},{dataField:"Position",caption:"Pos.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90,fixed:!0,fixedPosition:"left"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}]}],e.dg_crew_abs_selected=null,e.dg_crew_abs_instance=null,e.dg_crew_abs_ds=null,e.dg_crew_abs={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:274,columns:e.dg_crew_abs_columns,onContentReady:function(t){e.dg_crew_abs_instance||(e.dg_crew_abs_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew_abs_selected=i||null},onRowPrepared:function(e){e.data&&e.data.IsPositioning&&e.rowElement.css("background","#ffccff")},bindingOptions:{dataSource:"dg_crew_abs_ds"}},e.dg_crew_abs2_columns=[{caption:"Crew",columns:[{dataField:"Position",caption:"Pos.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"left"},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90,fixed:!0,fixedPosition:"left"},{dataField:"ScName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"left"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}]}],e.dg_crew_abs2_selected=null,e.dg_crew_abs2_instance=null,e.dg_crew_abs2_ds=null,e.dg_crew_abs2={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:200,columns:e.dg_crew_abs2_columns,onContentReady:function(t){e.dg_crew_abs2_instance||(e.dg_crew_abs2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?e.dg_crew_abs_selected=i:e.dg_crew_abs2_selected=null},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_crew_abs2_ds"}},e.dg_delay_selected=null,e.dg_delay_columns=[{caption:"Delay",columns:[{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",width:70,dataType:"string",allowEditing:!1},{dataField:"Remark",caption:"Remark",allowResizing:!0,dataType:"string",allowEditing:!1},{dataField:"Amount",caption:"Amount",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!0,width:80}]}],e.dg_delay_height=100,e.dg_delay_instance=null,e.dg_delay_ds=[],e.dg_delay={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_delay_columns,onContentReady:function(t){e.dg_delay_instance||(e.dg_delay_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_delay_selected=i||null},height:210,summary:{totalItems:[{name:"TotalDelay",showInColumn:"Amount",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"TotalDelay"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.Total,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_delay_ds"}},e.dg_upd_selected=null,e.dg_upd_columns=[{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"DateStatus",caption:"Date",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,format:"yyyy-MMM-dd, HH:mm",sortIndex:0,sortOrder:"asc"}],e.dg_upd_height=100,e.dg_upd_instance=null,e.dg_upd={editing:{allowUpdating:!1,mode:"cell"},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_upd_columns,onContentReady:function(t){e.dg_upd_instance||(e.dg_upd_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_upd_selected=i||null},height:"100%",bindingOptions:{dataSource:"updatedFlights"}},e.popup_upd_visible=!1,e.popup_upd_title="Updated Flights",e.popup_upd={elementAttr:{class:"popup_upd"},shading:!1,position:{my:"left",at:"left",of:window,offset:"5 5"},width:500,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Flight",icon:"arrowright",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(e.dg_upd_selected){var i=Enumerable.From(e.dataSource).Where("$.ID=="+e.dg_upd_selected.ID).FirstOrDefault();i&&(e.scrollGantt(i),e.scrollGrid(i))}}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){$(e.titleElement).css("background-color","#8BC34A")},onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_upd_visible=!1},bindingOptions:{visible:"popup_upd_visible",title:"popup_upd_title"}},e.popup_upd.toolbarItems[1].options.onClick=function(t){e.popup_upd_visible=!1},e.popup_offblock_visible=!1,e.popup_offblock_title="Off Block",e.popup_offblock={shading:!0,width:380,height:"380",fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacoffblock",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightOffBlock)<new Date(e.flight.STD))return void General.ShowNotify(Config.Text_OffBlock,"error");var i=$("#resourceGanttba").data("ejGantt"),o=!e.flight.ChocksOut&&e.flightOffBlock||new Date(e.flight.ChocksOut).getTime()!=new Date(e.flightOffBlock).getTime();e.flight.ChocksOut=e.flightOffBlock,Flight.calculateDelayOffBlock(e.flight),o&&e.applyNextFlight&&Flight.calculateNextTaskDelayOffBlock(e.flight,e.dataSource,i),e.setStatus(e.flight,14);var l={ChocksOut:new Date(e.flight.ChocksOut).toUTCString(),StatusLog:[],EstimatedDelays:[]};l.ID=e.flight.ID,l.UserId=n.userId,l.FlightStatusID=e.flight.FlightStatusID,l.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:14,Date:new Date(Date.now()).toUTCString(),UserId:n.userId});var r=Enumerable.From(e.dataSource).Where("$.EstimatedDelayChanged && $.EstimatedDelayChanged==true && $.EstimatedDelay>0 && $.status==1 && $.startDate.getDatePart()=="+e.flight.startDate.getDatePart()+" && $.startDate.getTime() > "+e.flight.startDate.getTime()+"  && $.RegisterID=="+e.flight.RegisterID).OrderBy("$.startDate").ToArray();$.each(r,function(e,t){l.EstimatedDelays.push({FlightId:t.ID,Delay:Math.floor(t.EstimatedDelay)})}),e.loadingVisible=!0,a.saveFlightOffBlock(l).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_offblock_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_offblock_visible=!1},bindingOptions:{visible:"popup_offblock_visible",title:"popup_offblock_title"}},e.popup_offblock.toolbarItems[1].options.onClick=function(t){e.popup_offblock_visible=!1},e.popup_landing_visible=!1,e.popup_landing_title="Take Off",e.popup_landing={width:400,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaclanding",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(new Date(e.flightLanding)<new Date(e.flight.STA))return void General.ShowNotify(Config.Text_Landing,"error");var i=$("#resourceGanttba").data("ejGantt");17!=e.flight.status?e.setStatus(e.flight,3):e.setStatus(e.flight,7),e.flight.Landing=e.flightLanding;var o={StatusLog:[]};o.ID=e.flight.ID,o.UserId=n.userId,o.Landing=new Date(e.flight.Landing).toUTCString(),o.FlightStatusID=e.flight.FlightStatusID,o.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:3,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.loadingVisible=!0,a.saveFlightLanding(o).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_landing_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_landing_visible=!1},bindingOptions:{visible:"popup_landing_visible",title:"popup_landing_title"}},e.popup_landing.toolbarItems[1].options.onClick=function(t){e.popup_landing_visible=!1},e.popup_onblock_visible=!1,e.popup_onblock_title="Off Block",e.popup_onblock={width:400,height:270,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaconblock",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(e.flightOnBlock&&new Date(e.flightOnBlock)<new Date(e.flight.Landing))return void General.ShowNotify(Config.Text_OnBlock,"error");var i={StatusLog:[]};$("#resourceGanttba").data("ejGantt");17!=e.flight.status&&7!=e.flight.status?e.setStatus(e.flight,15):e.setStatus(e.flight,7),e.flight.ChocksIn=e.flightOnBlock,i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:15,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),i.ID=e.flight.ID,i.UserId=n.userId,i.ChocksIn=new Date(e.flight.ChocksIn).toUTCString(),i.FlightStatusID=e.flight.FlightStatusID,e.loadingVisible=!0,a.saveFlightOnBlock(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.popup_onblock_visible=!1,e.bindFlights(!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_onblock_visible=!1},bindingOptions:{visible:"popup_onblock_visible",title:"popup_onblock_title"}},e.popup_onblock.toolbarItems[1].options.onClick=function(t){e.popup_onblock_visible=!1},e.popup_cancel_visible=!1,e.popup_cancel_title="Cancel",e.popup_cancel={shading:!0,width:360,height:"380",fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaccancel",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.entity_cancel.Date=new Date(Date.now()).toUTCString(),e.entity_cancel.CancelDate=new Date(e.entity_cancel.CancelDate).toUTCString(),e.entity_cancel.UserId=n.userId,e.entity_cancel.FlightId=e.flight.ID;var i=$("#resourceGanttba").data("ejGantt");return e.setStatus(e.flight,4),e.loadingVisible=!0,void a.saveFlightCancel(e.entity_cancel).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_cancel_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")});var i}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.cleat_entity_cancel(),e.popup_cancel_visible=!1},bindingOptions:{visible:"popup_cancel_visible",title:"popup_cancel_title"}},e.popup_cancel.toolbarItems[1].options.onClick=function(t){e.popup_cancel_visible=!1},e.popup_redirect_visible=!1,e.popup_redirect_title="Redirect",e.popup_redirect={shading:!0,width:360,height:"490",fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacredirect",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.entity_redirect.Date=new Date(Date.now()).toUTCString(),e.entity_redirect.RedirectDate=new Date(e.entity_redirect.RedirectDate).toUTCString(),e.entity_redirect.UserId=n.userId,e.entity_redirect.FlightId=e.flight.ID,e.entity_redirect.STA=new Date(e.entity_redirect.STA).toUTCString(),e.entity_redirect.OAirportIATA=e.flight.ToAirportIATA,e.entity_redirect.Airport=null;$("#resourceGanttba").data("ejGantt");e.setStatus(e.flight,17),e.loadingVisible=!0,a.saveFlightRedirect(e.entity_redirect).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.showButtons2(e.flight),e.updatedFlightsCount=0,e.updatedFlights=[],e.bindFlights(!1),e.popup_redirect_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.clear_entity_redirect(),e.popup_redirect_visible=!1},bindingOptions:{visible:"popup_redirect_visible",title:"popup_redirect_title"}},e.popup_redirect.toolbarItems[1].options.onClick=function(t){e.popup_redirect_visible=!1},e.getReporting=function(t){e.loadingVisible=!0,a.getReporting(t).then(function(t){e.loadingVisible=!1;var i=Enumerable.From(t).OrderBy("$.GroupOrder").ThenBy("$.Name").ToArray();e.dg_crew_ds=i},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrew=function(t){e.loadingVisible=!0,a.getFlightCrew2(t).then(function(t){if(e.loadingVisible=!1,$.each(t,function(e,t){t.ReportingTime=new Date(t.ReportingTime).addMinutes(u)}),e.dg_boxflight_ds&&e.dg_boxflight_ds.length>0){new Date(e.dg_boxflight_ds[0].STD).addHours(-1)}e.dg_crew_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrewAbs=function(t){var i=0;new Date(e.flight.Date)<new Date(2020,6,1,0,0,0,0)&&(i=1),e.loadingVisible=!0,a.getFlightCrews(t,i).then(function(t){e.loadingVisible=!1,e.dg_crew_abs_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrewAbs2=function(t){e.loadingVisible=!0,a.getFlightCrew2(t).then(function(t){e.loadingVisible=!1,e.dg_crew_abs2_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getBoxFlights=function(t,i){var n=-1*(new Date).getTimezoneOffset();a.getBoxFlights(t).then(function(t){$.each(t,function(e,t){t.STA=new Date(t.STA).addMinutes(n),t.STD=new Date(t.STD).addMinutes(n),t.ChocksIn&&(t.ChocksIn=new Date(t.ChocksIn).addMinutes(n)),t.ChocksOut&&(t.ChocksOut=new Date(t.ChocksOut).addMinutes(n)),t.Takeoff&&(t.Takeoff=new Date(t.Takeoff).addMinutes(n)),t.Landing&&(t.Landing=new Date(t.Landing).addMinutes(n))}),e.dg_boxflight_ds=t,i&&i()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.dg_crew_columns=[{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"RP",caption:"Reporting Time",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!0,width:200}],e.dg_crew_selected=null,e.dg_crew_instance=null,e.dg_crew_ds=null,e.dg_crew={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",editing:{mode:"cell",allowUpdating:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-300,columns:e.dg_crew_columns,onContentReady:function(t){e.dg_crew_instance||(e.dg_crew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew_selected=i||null},onRowPrepared:function(e){},onRowUpdated:function(t){
var i=new Date(t.data.RP).toUTCString(),n=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0;var o={CrewId:t.key.CrewId,FDPId:t.key.FDPId,Date:i,Offset:n};a.saveReportingTime(o).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success")},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},bindingOptions:{dataSource:"dg_crew_ds"}},e.dg_boxflight_columns=[{caption:"Flights",columns:[{dataField:"FlightNumber",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"FlightH",caption:"HH",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60},{dataField:"FlightM",caption:"MM",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:150,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:150,format:"HH:mm"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]}],e.dg_boxflight_selected=null,e.dg_boxflight_instance=null,e.dg_boxflight_ds=null,e.dg_boxflight={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:200,columns:e.dg_boxflight_columns,onContentReady:function(t){e.dg_boxflight_instance||(e.dg_boxflight_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_boxflight_selected=i||null},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_boxflight_ds"}},e.popup_crew_visible=!1,e.popup_crew_title="Crew",e.popup_crew={shading:!0,width:1100,height:600,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_crew_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.getReporting(e.flight.ID)},onHiding:function(){e.dg_crew_ds=[],e.popup_crew_visible=!1},bindingOptions:{visible:"popup_crew_visible",title:"popup_crew_title"}},e.sms=null,e.txt_sms={height:530,bindingOptions:{value:"sms"}},e.popup_sms_visible=!1,e.popup_sms_title="Notification",e.popup_sms={shading:!0,width:600,height:650,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Send",icon:"fas fa-bell",validationGroup:"fbacredirect",bindingOptions:{disabled:"IsApproved"},onClick:function(t){var i=[];$.each(e.dg_crew_ds,function(e,t){t.Mobile&&i.push(t.Mobile)});var n=i.join(","),a=e.sms;d.sms(a,n).then(function(e){General.ShowNotify("The message sent successfully.","success")},function(t){e.loadingVisible=!1,General.ShowNotify2(t.message,"error",5e3)})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_sms_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.sms=null,e.popup_sms_visible=!1},bindingOptions:{visible:"popup_sms_visible",title:"popup_sms_title"}},e.leg1Text="",e.leg1Value=!1,e.leg1Visible=!1,e.leg2Text="",e.leg2Value=!1,e.leg2Visible=!1,e.leg3Text="",e.leg3Value=!1,e.leg3Visible=!1,e.leg4Text="",e.leg4Value=!1,e.leg4Visible=!1,e.leg5Text="",e.leg5Value=!1,e.leg5Visible=!1;e.leg6Text="",e.leg6Value=!1,e.leg6Visible=!1,e.leg7Text="",e.leg7Value=!1,e.leg7Visible=!1,e.leg8Text="",e.leg8Value=!1,e.leg8Visible=!1,e.ch_leg1={bindingOptions:{text:"leg1Text",value:"leg1Value",visible:"leg1Visible"}},e.ch_leg2={bindingOptions:{text:"leg2Text",value:"leg2Value",visible:"leg2Visible"}},e.ch_leg3={bindingOptions:{text:"leg3Text",value:"leg3Value",visible:"leg3Visible"}},e.ch_leg4={bindingOptions:{text:"leg4Text",value:"leg4Value",visible:"leg4Visible"}},e.ch_leg5={bindingOptions:{text:"leg5Text",value:"leg5Value",visible:"leg5Visible"}},e.ch_leg6={bindingOptions:{text:"leg6Text",value:"leg6Value",visible:"leg6Visible"}},e.ch_leg7={bindingOptions:{text:"leg7Text",value:"leg7Value",visible:"leg7Visible"}},e.ch_leg8={bindingOptions:{text:"leg8Text",value:"leg8Value",visible:"leg8Visible"}},e.scroll_jl_height=200,e.scroll_jl={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_jl_height"}},e.popup_jl_visible=!1,e.popup_jl_title="Journey Log",e.popup_jl={shading:!0,width:1150,height:function(){return 1*$(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Update",icon:"save",bindingOptions:{disabled:"IsApproved"},onClick:function(e){c($("#jl"))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Print",icon:"print",bindingOptions:{disabled:"IsApproved"},onClick:function(e){c($("#jl"))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_jl_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(t){e.scroll_jl_height=$(window).height()-10-110},onShown:function(e){},onHiding:function(){e.popup_jl_visible=!1},bindingOptions:{visible:"popup_jl_visible",title:"popup_jl_title","toolbarItems[0].visible":"IsEditable"}},e.cl={},e.scroll_cl_height=200,e.scroll_cl={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_cl_height"}},e.popup_cl_visible=!1,e.popup_cl_title="Crew List",e.popup_cl={shading:!0,width:820,height:function(){return 1*$(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Print",icon:"print",bindingOptions:{disabled:"IsApproved"},onClick:function(e){c($("#cl"))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_cl_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(t){e.scroll_cl_height=$(window).height()-10-110},onShown:function(e){},onHiding:function(){e.popup_cl_visible=!1},bindingOptions:{visible:"popup_cl_visible",title:"popup_cl_title","toolbarItems[0].visible":"IsEditable"}},e.popup_gd_visible=!1,e.popup_gd_title="GD",e.popup_gd={shading:!0,width:1100,height:650,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_gd_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){$("#Spreadsheet").ejSpreadsheet({importSettings:{importMapper:window.baseurl+"api/Spreadsheet/Import"}})},onHiding:function(){e.popup_gd_visible=!1},bindingOptions:{visible:"popup_gd_visible",title:"popup_gd_title"}},e.scrollGrid=function(t){var i=e.dg_flights_instance.getView("rowsView")._scrollable,n=e.dg_flights_instance.getRowIndexByKey(t),a=e.dg_flights_instance.getRowElement(n);i.scrollToElement(a)},e.scrollGantt=function(t){var i=new Date(t.STD),n=new Date(e.datefrom),a=Flight.subtractDatesHours(i,n)*$(".e-schedule-day-headercell").width()-50;$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(a)},e.scrollGanttX=function(e){$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(e)},e.scrollGanttNow=function(){var t=new Date(Date.now()),i=new Date(t),n=new Date(e.datefrom),a=Flight.subtractDatesHours(i,n)*$(".e-schedule-day-headercell").width()-50;$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(a)},e.dg_flights_selected=null,e.dg_flights_columns=[{dataField:"delay1",caption:"",width:50,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="lightgray";t.data.FlightStatusID>1&&(i=t.data.delay>0||t.data.delayLanding>0?"#e51400":"#60a917"),$("<div>").append('<i class="fas fa-clock" style="color:'+i+';font-size:16px"></i>').appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"FlightStatusID",caption:"",width:50,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i=Flight.getStatus(t.value),n=i.bgcolor,a=t.data.FlightStatus;switch(a="",t.value){case 1:$("<div>").append('<i class="fas fa-calendar-day" style="color:lightgray;font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 14:$("<div>").append('<i class="far fa-square" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 2:$("<div>").append('<i class="fas fa-plane-departure" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 3:$("<div>").append('<i class="fas fa-plane-arrival" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 4:$("<div>").append('<i class="fas fa-ban" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 15:$("<div>").append('<i class="fas fa-square" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 17:$("<div>").append('<i class="fas fa-random" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e);break;case 7:$("<div>").append('<i class="fas fa-level-down-alt" style="color:'+n+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px">'+a+"</span>").appendTo(e)}},fixed:!0,fixedPosition:"left"},{dataField:"ID",caption:"ID",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90,fixed:!0,fixedPosition:"left"},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:110,fixed:!0,fixedPosition:"left"},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{caption:"Airports",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90}]},{caption:"Departure",columns:[{dataField:"STD",caption:"Scheduled Dep.",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:170,alignment:"center",format:"yyyy-MMM-dd, HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Arrival",columns:[{dataField:"STA",caption:"Scheduled Arr.",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Pax",columns:[{dataField:"PaxAdult",caption:"Adult",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxChild",caption:"Child",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxInfant",caption:"Infant",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"TotalPax",caption:"Total",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center",name:"totalpax"},{dataField:"TotalSeat",caption:"Seats",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxOver",caption:"Over",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Cargo",columns:[{dataField:"CargoUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"CargoWeight",caption:"Weight",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"cargoweight"},{dataField:"CargoCount",caption:"Count",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Baggage",columns:[{dataField:"CargoUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"BaggageWeight",caption:"Weight",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"baggageweight"},{dataField:"BaggageCount",caption:"Count",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Fuel",columns:[{dataField:"FuelUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"FuelDeparture",caption:"Dep.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FuelArrival",caption:"Arr.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"}]},{caption:"Delays",fixed:!0,fixedPosition:"right",columns:[{dataField:"delay",caption:"Dep.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"delay"},{dataField:"delayLanding",caption:"Arr.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"delayLanding"}]}],e.dg_flights_height=$(window).height()-139-50,e.dg_flights_instance=null,e.dg_flights_ds=null,e.dg_flights={searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,scrolling:{mode:"infinite",showScrollbar:"always"},paging:{pageSize:100},columns:e.dg_flights_columns,onContentReady:function(t){e.dg_flights_instance||(e.dg_flights_instance=t.component)},onSelectionChanged:function(t){if(!e.doGridSelectedChanged){e.doGridSelectedChanged=!0;var i=t.component.getView("rowsView")._scrollable,n=t.component.element().find("tr.dx-selection");return void i.scrollToElement(n)}var a=t.selectedRowsData[0];if(a){e.dg_flights_selected=a,e.addSelectedFlight2(a);var o=$("#resourceGanttba").data("ejGantt"),l=o._getRecordByTaskId(a.ID.toString());o._$ganttchartHelper.ejGanttChart("selectTaskbar",l),e.scrollGantt(a)}else e.dg_flights_selected=null},summary:{totalItems:[{name:"delay",showInColumn:"delay",displayFormat:"{0}",summaryType:"custom"},{name:"delayLanding",showInColumn:"delayLanding",displayFormat:"{0}",summaryType:"custom"},{name:"totalpax",showInColumn:"totalpax",displayFormat:"{0}",summaryType:"custom"},{name:"cargoweight",showInColumn:"cargoweight",displayFormat:"{0}",summaryType:"custom"},{name:"baggageweight",showInColumn:"baggageweight",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"delay"===e.name&&("start"===e.summaryProcess&&(e.delay=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.delay+=e.value.delay)),"finalize"===e.summaryProcess&&(e.totalValue=e.delay)),"delayLanding"===e.name&&("start"===e.summaryProcess&&(e.delayLanding=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.delayLanding+=e.value.delayLanding)),"finalize"===e.summaryProcess&&(e.totalValue=e.delayLanding)),"totalpax"===e.name&&("start"===e.summaryProcess&&(e.totalpax=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.totalpax+=e.value.TotalPax)),"finalize"===e.summaryProcess&&(e.totalValue=e.totalpax)),"cargoweight"===e.name&&("start"===e.summaryProcess&&(e.cargoweight=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.cargoweight+=e.value.CargoWeight)),"finalize"===e.summaryProcess&&(e.totalValue=e.cargoweight)),"baggageweight"===e.name&&("start"===e.summaryProcess&&(e.baggageweight=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.baggageweight+=e.value.BaggageWeight)),"finalize"===e.summaryProcess&&(e.totalValue=e.baggageweight))}},bindingOptions:{dataSource:"dg_flights_ds",visible:"gridview",height:"dg_flights_height"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.scroll=0,e.bind=function(){var t="odata/flightplans/customer/"+Config.CustomerId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Id",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},r.isAuthorized()?n.page_title="> Flights":r.redirectToLogin(),e.hideButtons=function(){e.IsDepartureDisabled=!0,e.IsArrivalDisabled=!0},e.hideButtons2=function(){e.IsDepartureDisabled=!0,e.IsArrivalDisabled=!0},e.showButtons=function(t){e.IsDepartureDisabled=!1,e.IsArrivalDisabled=!1},e.showButtons2=function(t){e.IsDepartureDisabled=!1,e.IsArrivalDisabled=!1},e.weatherUpdateTime=null,e.weatherUpdateTimePassed=0,e.AirportWeatherVisible=!1,e.AirportWeather={currently:{},hourly:{}},e.FromWeather={currently:{}},e.FromWeatherVisible=!0,e.ToWeather={currently:{}},e.ToWeatherVisible=!0,e.getIcon=function(e){return e?e.currently.icon+" wicon":""},e.getIcon2=function(e){return e+" wicon"},e.prepareWeather=function(e){var t=90+Number(e.currently.windBearing);if(e.latitude=Number(e.latitude).toFixed(4),e.longitude=Number(e.longitude).toFixed(4),e.currently.windDeg="rotate("+t+"deg)",e.currently.windPoint="Winds from the "+Weather.getCompassPoint(Number(e.currently.windBearing)),e.currently.humidity=(100*Number(e.currently.humidity)).toFixed(1),e.currently.cloudCover=(100*Number(e.currently.cloudCover)).toFixed(1),e.currently.visibility=(1e3*Number(e.currently.visibility)).toFixed(0),e.hourly){e.hourly.h1={},e.hourly.h2={},e.hourly.h3={},e.hourly.h4={};for(var i=1;i<=4;i++){var n=e.hourly.data[i],a=null;switch(i){case 1:a=e.hourly.h1;break;case 2:a=e.hourly.h2;break;case 3:a=e.hourly.h3;break;case 4:a=e.hourly.h4}a.time=formatHourAMPM(new Date(1e3*n.time)),a.icon=n.icon,a.summary=n.summary,a.temperature=n.temperature,a.windtotal=n.windSpeed+" "+Weather.getCompassPoint(Number(n.windBearing)),a.visibility=1e3*Number(n.visibility),a.cloudCover=(100*Number(n.cloudCover)).toFixed(1)}}},e.setWeather=function(){if(e.flight){e.ToWeatherVisible=!1,e.FromWeatherVisible=!1;new Date(e.flight.STD).toUTCDateTimeDigits(),new Date(e.flight.STA).toUTCDateTimeDigits();o.getFlight(e.flight.ID,-1).then(function(t){e.FromWeather=t,e.prepareWeather(e.FromWeather),e.FromWeatherVisible=!0,o.getFlight(e.flight.ID,-2).then(function(t){e.ToWeather=t,e.prepareWeather(e.ToWeather),e.ToWeatherVisible=!0},function(e){General.ShowNotify(e.message,"error")})},function(e){General.ShowNotify(e.message,"error")})}},e.selectedFlights=[],e.clearSelectedFlights=function(){e.selectedFlights=[],e.hideButtons()},e.doGridSelectedChanged=!0,e.addSelectedFlight=function(t){e.removeUpdatedFlights(t),e.hideButtons(),Enumerable.From(e.selectedFlights).Where("$.taskId=="+t.taskId).FirstOrDefault()?(e.selectedFlights=[],e.$apply(function(){e.popup_inf_visible=!1})):(e.selectedFlights=[],e.selectedFlights.push(t),e.flight=t,e.showButtons(t),e.popup_inf_visible&&e.setWeather(),e.doGridSelectedChanged=!1,e.dg_flights_instance.selectRows([t],!1),e.showLog(!0))},e.addSelectedFlight2=function(t){e.removeUpdatedFlights(t),e.hideButtons2(),Enumerable.From(e.selectedFlights).Where("$.taskId=="+t.taskId).FirstOrDefault()?(e.selectedFlights=[],e.popup_inf_visible=!1):(e.selectedFlights=[],e.selectedFlights.push(t),e.flight=t,e.showButtons2(t),e.popup_inf_visible&&e.setWeather())},e.selectedResource=null,e.setSelectedResource=function(t){var i=t.index;e.selectedResource&&e.setSelectedResource.index==i?(e.selectedResource=null,$("#resourceGanttba").data("ejGantt").clearSelection(i),alert("x")):e.selectedResource={index:t.index,item:t.item}},e.ganttCreated=!1,e.renderTopTimeHeader=function(){var e=$(".e-schedule-week-headercell-content");$.each(e,function(e,t){var i=$(t),n=i.html().split("(")[0],a=Number(n.split("-")[2]),o=n.split("-"),l=o[1],r=o[0],d=new Date(a+"/"+l+"/"+r);persianDate.toLocale("en");var s=n+" ("+new persianDate(d).format("DD/MM/YYYY")+")";i.html(s)})},e.renderTimeHeader=function(){var t=$(".e-schedule-day-headercell-content"),i=t.width();$.each(t,function(t,n){var a=$(n),o=a.html(),l=Number(a.html());a.find("span").length>0&&(o=$(a.find("span")[1]).html(),l=Number(o));var r=2;e.doUTC&&(r=i-30);var d=0;d=e.doUTC?g(l):getUTCHour(l);var s="<span style='font-size:10px;display:block;color:gray;text-align:left;padding-left:"+r+"px'>"+d+"</span><span style='font-size:13px;display:block;position:relative;top:-5px'>"+o+"</span>";a.html(s)})},e.timeCellWidth=0,e.selectedDate=null,e.createGantt=function(t){new Date(e.datefrom).yyyymmddtimenow(!1);t||(t=.24*$(window).width());var i=$(window).width()/1536,n=$("#resourceGanttba").data("ejGantt");n&&n.destroy(),e.StartNowLineTimerFirst=!0,e.nowlineInitLeft=null;var a=$(window).height()-139-50+50-38;a+="px";var o=General.getDayFirstHour(new Date(e.selectedDate)),l=new Date(o).addDays(1),r=(new Date(o).addDays(-1),General.getDayLastHour(new Date(e.selectedDate))),d=Enumerable.From(e.dataSource).Where(function(e){var t=new Date(e.STD),i=new Date(e.STA);return t>=o&&t<=r||i>=o&&i<=r}).ToArray(),s=Enumerable.From(d).Where(function(e){var t=new Date(e.STA),i=new Date(e.STA),n=new Date(e.STA);return e.Landing&&(n=new Date(e.Landing)),e.ChocksIn&&(i=new Date(e.ChocksIn)),t>r||i>r||n>r}).ToArray(),c=1e6;s&&s.length>0&&(r=General.getDayLastHour(new Date(l)),!0,c=400*i),e.doUTC&&(c=0);var g=Enumerable.From(d).Where("$.LinkedFlight").FirstOrDefault();$("#resourceGanttba").ejGantt({scheduleStartDate:o,scheduleEndDate:r,taskbarBackground:"red",selectionMode:ej.Gantt.SelectionMode.Cell,selectionType:ej.Gantt.SelectionType.Single,taskbarClick:function(t){e.addSelectedFlight(t.data.item),$("#resourceGanttba").data("ejGantt").clearSelection()},dataSource:d,allowColumnResize:!0,isResponsive:!0,taskIdMapping:"taskId",taskNameMapping:"taskName",fromLocationMapping:"from",startDateMapping:"startDate",endDateMapping:"endDate",progressMapping:"progress",durationMapping:"duration",groupNameMapping:"Title",groupIdMapping:"groupId",groupCollection:e.resourceGroups,resources:e.resources,resourceIdMapping:"resourceId",resourceNameMapping:"resourceName",resourceInfoMapping:"resourceId",notesMapping:"notes",rightTaskLabelMapping:"taskName",baselineStartDateMapping:"BaselineStartDate",baselineEndDateMapping:"BaselineEndDate",highlightWeekEnds:!0,includeWeekend:!1,rowHeight:45,taskbarHeight:45,predecessorMapping:"predecessor",allowGanttChartEditing:!1,allowDragAndDrop:!0,editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,editMode:"normal"},splitterSettings:{position:110},toolbarSettings:{showToolbar:!1,toolbarItems:[ej.Gantt.ToolbarItems.Add,ej.Gantt.ToolbarItems.Delete,ej.Gantt.ToolbarItems.Update,ej.Gantt.ToolbarItems.Cancel,ej.Gantt.ToolbarItems.ExpandAll,ej.Gantt.ToolbarItems.CollapseAll,ej.Gantt.ToolbarItems.NextTimeSpan,ej.Gantt.ToolbarItems.PrevTimeSpan]},enableContextMenu:!1,load:function(){e.ganttCreated=!0,this.getColumns()[0].width=110;g&&(e.linkedTimerDone=!1)},create:function(t){try{$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(c),e.renderTopTimeHeader(),e.renderTimeHeader(),$(".e-ganttviewerbodyContianer-stripLines").css("z-index",0),e.timeCellWidth=$(".e-schedule-day-headercell-content").width();var i=new Date,n=new Date(o),a=new Date(r);i.getTime()>=n.getTime()&&i.getTime()<=a.getTime()?(e.autoUpdate=!0,e.StartNowLineTimer(1)):e.autoUpdate=!1}catch(e){alert("x"),alert(e)}},cellSelecting:function(e){e&&"resourceTask"!=e.data.eResourceTaskType&&(e.cancel=!0)},cellSelected:function(t){$(".e-gantt-taskbarSelection").removeClass("e-gantt-taskbarSelection"),e.setSelectedResource(t.data)},actionBegin:function(e){e.requestType&&"beginedit"==e.requestType&&(e.cancel=!0)},actionComplete:function(t){"save"==t.requestType&&(e.doActionCompleteSave?setTimeout(function(){$("#resourceGanttba").data("ejGantt")._$ganttchartHelper.ejGanttChart("selectTaskbar",t.modifiedRecord)},100):e.doActionCompleteSave=!0)},workingTimeScale:"TimeScale24Hours",durationUnit:ej.Gantt.DurationUnit.Hour,scheduleHeaderSettings:{scheduleHeaderType:ej.Gantt.ScheduleHeaderType.Day,dayHeaderFormat:"dd-MMM-yyyy",minutesPerInterval:ej.Gantt.minutesPerInterval.Auto,timescaleStartDateMode:ej.Gantt.TimescaleRoundMode.Auto,timescaleUnitSize:t+"%"},taskbarTemplate:"#taskbarTemplateLightNew",leftTaskLabelTemplate:"#leftlableTemplate",viewType:ej.Gantt.ViewType.ResourceView,sizeSettings:{height:a},groupSettings:{},showStackedHeader:!1,taskSchedulingMode:ej.Gantt.TaskSchedulingMode.Manual,enableTaskbarTooltip:!1})},e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.linkedTimer=null,e.linkedTimerDone=!1,e.StartLinkedTimer=function(){e.linkedTimer=setTimeout(function(){if(e.linkedTimerDone)e.StopLinkedTimer();else{var t=$(".linked-flight");t.length>0&&(t.each(function(){var e=$(this).data("linked");if(e){var t=$(this).closest(".e-childContainer"),i=$(".task-"+e).closest(".e-childContainer");if(i.length>0){var n=i.position().left;t.css({left:n+10})}}$(this).show()}),e.linkedTimerDone=!0),e.StartLinkedTimer()}},50)},e.StopLinkedTimer=function(){e.linkedTimer&&clearTimeout(e.linkedTimer)},e.wtimer=null,e.StartWTimer=function(){e.wtimer=setTimeout(function(){var t=Number(subtractDates(new Date(Date.now()),e.weatherUpdateTime)).toFixed(0);e.$apply(function(){e.weatherUpdateTimePassed=t}),e.StartWTimer()},1e4)},e.StopWTimer=function(){e.wtimer&&clearTimeout(e.wtimer)},e.getAirportWeather=function(){e.weatherUpdateTimePassed=0,e.StopWTimer(),e.AirportWeatherVisible=!1,o.getCurrentHourly(e.airportEntity.Latitude,e.airportEntity.Longitude).then(function(t){e.weatherUpdateTime=new Date(Date.now()),e.AirportWeather=t,e.prepareWeather(e.AirportWeather),e.StartWTimer(),e.AirportWeatherVisible=!0},function(e){General.ShowNotify(e.message,"error")})},e.updateWeather=function(){e.getAirportWeather()},e.delayCodes=null,e.$on("$viewContentLoaded",function(){e.scroll2_height=$(window).height()-266.5+87,$(".flightboard").fadeIn(400,function(){e.airport?(e.loadingVisible=!0,a.getAirportByIATA(e.airport).then(function(t){e.airportEntity=t,e.airportEntity.Latitude2=Number(e.airportEntity.Latitude).toFixed(3),e.airportEntity.Longitude2=Number(e.airportEntity.Longitude).toFixed(3),e.airportEntity.LtLg="("+e.airportEntity.Latitude2+", "+e.airportEntity.Longitude2+")",e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):e.airportEntity=null,e.loadingVisible=!0,a.getDelayCodes().then(function(t){e.loadingVisible=!1,$.each(t,function(e,t){t.Title2=t.Code+" "+t.Remark}),e.delayCodes=t,setTimeout(function(){e.StopUTimer(),e.BeginSearch()},500)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})})}),e.$on("$destroy",function(t){e.StopUTimer(),e.StopNowLineTimer()}),n.$broadcast("FlightBoardLoaded",null)}]),app.controller("crewassignController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d){try{l.isAuthorized()?n.page_title="> Crew":l.redirectToLogin(),e.prms=i.prms,e.IsCockpit=d.current.isCockpit?1:0,e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.selectedTabDateIndex=-1,e.tabsdatefirst=!0,e.$watch("selectedTabDateIndex",function(t){try{if(-1==e.selectedTabDateIndex)return;e.selectedTab=e.tabs_date[t],e.selectedDate=new Date(e.selectedTab.date),e.createGantt()}catch(e){alert("e1"),alert(e)}}),e.tabs_date=[],e.tabsdatevisible=!1,e.tabs_date_options={scrollByContent:!0,showNavButtons:!0,elementAttr:{class:"tabsdate"},onItemClick:function(e){},onItemRendered:function(t){e.selectedTabDateIndex=-1,e.selectedTabDateIndex=0},bindingOptions:{visible:"tabsdatevisible",dataSource:{dataPath:"tabs_date",deep:!0},selectedIndex:"selectedTabDateIndex"}},e.btn_search={type:"success",icon:"search",width:40,validationGroup:"assigncrewdate",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.fdpCrews=[],e.dg_calcrew_ds=null,e.dg_box_ds=null,e.assignedCrewDs=null,e.dg_calfdp_ds=null,e.cal_crew_ds=null,e.BeginSearch()}},e._datefrom=new Date,e.date_from={type:"date",placeholder:"From",width:"100%",displayFormat:"yyyy-MM-dd",bindingOptions:{value:"_datefrom"}},e.days_count=14,e.num_days={min:1,showSpinButtons:!1,bindingOptions:{value:"days_count"}},e.datefrom=null,e.dateEnd=null,e.dateto=null,e.BeginSearch=function(){e.cal_crew_current=General.getDayFirstHour(new Date(e._datefrom)),e.datefrom=General.getDayFirstHour(new Date(e._datefrom)),e.dateEnd=General.getDayLastHour(new Date(new Date(e._datefrom).addDays(e.days_count-1))),e.dateto=General.getDayLastHour(new Date(e._datefrom)),e.search()},e.search=function(){e.bindFlights(!1)},Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.baseDate=null,e.ganttData=null,e.resourceGroups=[],e.resources=[],e.dataSource=[],e.bindFlights=function(t){e.selectedTabDateIndex=-1;var i=-1*(new Date).getTimezoneOffset(),n=new Date(e._datefrom),o=new Date(n.addDays(e.days_count-1));e.plansDto={CustomerId:1,Date:n.ToUTC(),DateTo:o.ToUTC(),Offset:i,Design:!1,PlanId:-1},e.loadingVisible=!0,
a.getPlanItemsGanttCrewTest(e.plansDto).then(function(t){e.loadingVisible=!1,e.btn_crew_disabled=!1,e.tabsdatefirst=!0,e.tabs_date=[];var i;for(i=1;i<=e.days_count;i++){var a=moment(n).format("ddd DD-MMM-YYYY");e.tabs_date.push({text:a,id:i,date:moment(n).format("YYYY/MM/DD")}),n=n.addDays(1)}e.tabsdatevisible=!0,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource2(t.flights),Flight.activeDatasource=e.dataSource,e.selectedTabDateIndex=0})},e.rebind=function(){var t=-1*(new Date).getTimezoneOffset(),i=new Date(e._datefrom),n=new Date(i.addDays(e.days_count-1));e.plansDto={CustomerId:1,Date:i.ToUTC(),DateTo:n.ToUTC(),Offset:t,Design:!1,PlanId:-1},e.loadingVisible=!0,a.getPlanItemsGanttCrewTest(e.plansDto).then(function(t){e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource2(t.flights),Flight.activeDatasource=e.dataSource,e.createGantt(),e.selectedBox=null,e.selectedBoxId=null,e.selectedIds=[],e.selectedItems=[]})},e.bindPosFlights=function(t){var i=new Date(General.getDayFirstHour(new Date(e.selectedDate))),n=new Date(General.getDayLastHour(new Date(e.selectedDate))),o=-1*(new Date).getTimezoneOffset(),l=new Date(e._datefrom);new Date(l.addDays(e.days_count-1));e.plansDto={CustomerId:1,Date:new Date(i.ToUTC()),DateTo:new Date(n.ToUTC()),Offset:o},e.loadingVisible=!0,a.getFlights(e.plansDto).then(function(i){e.loadingVisible=!1,t(i)})},e.bindFlightCrews=function(t,i){e.loadingVisible=!0,a.getFlightCrews(t).then(function(t){e.loadingVisible=!1,i(t)})},e.bindFlightFDPs=function(e,t){a.getFlightFDPs(e).then(function(e){t(e)})},e.addSelectedFlight=function(e){},e.timeCellWidth=0,e.selectedDate=null,e.createGantt=function(t){new Date(e.datefrom).yyyymmddtimenow(!1);t||(t=.24*$(window).width());var i=$("#resourceGanttba").data("ejGantt");i&&i.destroy(),e.StartNowLineTimerFirst=!0;var n=$(window).height()-139-50+50-38;n+="px";var a=new Date(e.selectedDate).addDays(1),o=General.getDayFirstHour(new Date(e.selectedDate)),l=General.getDayLastHour(a),r=Enumerable.From(e.resources).Where(function(e){var t=new Date(e.DutyStartLocal),i=new Date(e.DutyEndLocal);return t>=o&&t<=l||i>=o&&i<=l}).ToArray();console.log("groups"),console.log(e.resourceGroups),console.log(r);var d=Enumerable.From(e.dataSource).Where(function(e){var t=new Date(e.DutyStartLocal),i=new Date(e.DutyEndLocal);return t>=o&&t<=l||i>=o&&i<=l}).ToArray();console.log("_data"),console.log(d),$("#resourceGanttba").ejGantt({scheduleStartDate:o,scheduleEndDate:l,taskbarBackground:"red",selectionMode:ej.Gantt.SelectionMode.Cell,selectionType:ej.Gantt.SelectionType.Single,taskbarClick:function(t){e.addSelectedFlight(t.data.item),$("#resourceGanttba").data("ejGantt").clearSelection()},dataSource:d,allowColumnResize:!0,isResponsive:!0,taskIdMapping:"taskId",taskNameMapping:"taskName",fromLocationMapping:"from",startDateMapping:"startDate",endDateMapping:"endDate",progressMapping:"progress",durationMapping:"duration",groupNameMapping:"Title",groupIdMapping:"groupId",groupCollection:e.resourceGroups,resources:r,resourceIdMapping:"resourceId",resourceNameMapping:"resourceName",resourceInfoMapping:"resourceId",notesMapping:"notes",rightTaskLabelMapping:"taskName",baselineStartDateMapping:"BaselineStartDate",baselineEndDateMapping:"BaselineEndDate",highlightWeekEnds:!0,includeWeekend:!1,rowHeight:50,taskbarHeight:30,predecessorMapping:"predecessor",allowGanttChartEditing:!1,allowDragAndDrop:!0,editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,editMode:"normal"},splitterSettings:{position:140},toolbarSettings:{showToolbar:!1,toolbarItems:[ej.Gantt.ToolbarItems.Add,ej.Gantt.ToolbarItems.Delete,ej.Gantt.ToolbarItems.Update,ej.Gantt.ToolbarItems.Cancel,ej.Gantt.ToolbarItems.ExpandAll,ej.Gantt.ToolbarItems.CollapseAll,ej.Gantt.ToolbarItems.NextTimeSpan,ej.Gantt.ToolbarItems.PrevTimeSpan]},load:function(){e.ganttCreated=!0,this.getColumns()[0].width=140},create:function(t){try{$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(1e6),e.renderTopTimeHeader(),e.renderTimeHeader(),$(".e-ganttviewerbodyContianer-stripLines").css("z-index",0),e.timeCellWidth=$(".e-schedule-day-headercell-content").width();var i=new Date,n=new Date(o),a=new Date(l);i.getTime()>=n.getTime()&&(i.getTime(),a.getTime())}catch(e){alert(e)}},cellSelecting:function(e){e&&"resourceTask"!=e.data.eResourceTaskType&&(e.cancel=!0)},cellSelected:function(t){$(".e-gantt-taskbarSelection").removeClass("e-gantt-taskbarSelection"),e.setSelectedResource(t.data)},actionBegin:function(e){e.requestType&&"beginedit"==e.requestType&&(e.cancel=!0)},actionComplete:function(t){"save"==t.requestType&&(e.doActionCompleteSave?setTimeout(function(){$("#resourceGanttba").data("ejGantt")._$ganttchartHelper.ejGanttChart("selectTaskbar",t.modifiedRecord)},100):e.doActionCompleteSave=!0)},workingTimeScale:"TimeScale24Hours",durationUnit:ej.Gantt.DurationUnit.Hour,scheduleHeaderSettings:{scheduleHeaderType:ej.Gantt.ScheduleHeaderType.Day,dayHeaderFormat:"dd-MM-yyyy",minutesPerInterval:ej.Gantt.minutesPerInterval.Auto,timescaleStartDateMode:ej.Gantt.TimescaleRoundMode.Auto,timescaleUnitSize:t+"%"},taskbarTemplate:"#taskbarTemplateBoxNew",leftTaskLabelTemplate:"#leftlableTemplate",viewType:ej.Gantt.ViewType.ResourceView,sizeSettings:{height:n},groupSettings:{},showStackedHeader:!1,taskSchedulingMode:ej.Gantt.TaskSchedulingMode.Manual,enableTaskbarTooltip:!1,enableContextMenu:!0,contextMenuItems:[],contextMenuClick:function(e){},contextMenuOpen:function(t){if("resourceChildTask"!=t.item.eResourceTaskType)return void(t.cancel=!0);var i=-1,n=$(t.targetElement.target);if(n.hasClass("div-flight"))i=n.data("flightid");else{i=n.closest(".div-flight").data("flightid")}if(!t.item.item.IsBox)return void(t.cancel=!0);t.contextMenuItems=i?[{headerText:"Flight Crews",menuId:"flightcrews",eventHandler:function(t){e.$apply(function(){e.popup_fc_visible=!0})}}]:[{headerText:"Information",menuId:"information",eventHandler:function(e){}}]}})},e.ganttCreated=!1,e.renderTopTimeHeader=function(){var e=$(".e-schedule-week-headercell-content");$.each(e,function(e,t){var i=$(t),n=i.html().split("(")[0],a=Number(n.split("-")[2]),o=n.split("-"),l=o[1],r=o[0],d=new Date(a+"/"+l+"/"+r),s=n+" ("+new persianDate(d).format("DD/MM/YYYY")+")";i.html(s)})},e.renderTimeHeader=function(){var t=$(".e-schedule-day-headercell-content");$.each(t,function(t,i){var n=$(i),a=n.html(),o=Number(n.html());n.find("span").length>0&&(a=$(n.find("span")[1]).html(),o=Number(a));var l=0;e.IsUTC,l=getUTCHour(o);var r="<span style='font-size:10px;display:block;color:gray;text-align:left;padding-left:2px'>"+l+"</span><span style='font-size:13px;display:block;position:relative;top:-5px'>"+a+"</span>";n.html(r)})},e.selectedIds=[],e.selectedItems=[],e.selectedBox=null,e.selectedBoxId=null,e.selectedBoxChanged=function(){if(e.selectedBox){var t=[];$.each(e.selectedBox.BoxItems,function(i,n){0==i&&(e.SourceLocation=n.FromAirportIATA),t.push(n.FlightNumber+" ("+n.FromAirportIATA+"-"+n.ToAirportIATA+")")})}},e.selectedIdsChanged=function(){e.$apply(function(){e.selectedBox=null,e.selectedBoxId=null,e.AssignedCrew="Assigned Crew",e.dg_crew_ds=[],e.dg_sum_ds=[]})},e.$watch("selectedBox",function(){try{e.selectedBoxChanged()}catch(e){alert("e2"),alert(e)}}),e.btn_box={type:"default",icon:"plus",width:40,onClick:function(t){if(!(e.selectedIds.length<1)){if(e.selectedIds.length>10)return void General.ShowNotify("Invalid sector counts","error");var i=(Enumerable.From(e.selectedItems).Select("$.CalendarId").Distinct().ToArray(),{ids:e.selectedIds,cid:e.selectedItems[0].CalendarId});i.cid||(i.cid=-1),e.loadingVisible=!0,a.boxItems(i).then(function(t){e.loadingVisible=!1,e.rebind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}},e.btn_unbox={type:"danger",icon:"close",width:40,onClick:function(t){if(e.selectedBox){var i={id:e.selectedBox.BoxId};e.loadingVisible=!0,a.unboxItems(i).then(function(t){e.loadingVisible=!1,e.rebind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}},e.btn_crew_disabled=!0,e.btn_crew={text:"Assign Crew",type:"default",icon:"group",width:160,bindingOptions:{disabled:"btn_crew_disabled"},onClick:function(t){e.popup_crew_visible=!0}},e.btn_cal={text:"Calendar",type:"default",icon:"event",width:140,onClick:function(t){e.popup_cal_visible=!0}},e.btn_details={text:"Details",type:"default",icon:"event",width:120,onClick:function(t){if(!e.selectedBox)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.popup_fdp_details_visible=!0}},e.btn_pos={text:"Positioning",type:"default",icon:"map",width:160,onClick:function(t){e.popup_pos_visible=!0}},e.btn_fc={text:"Flight Crews",type:"default",icon:"airplane",width:170,onClick:function(t){e.popup_fc_visible=!0}},e.crewGroup=e.IsCockpit?"Cockpit":"Cabin",e.sb_cabin={showClearButton:!1,searchEnabled:!1,height:35,disabled:!0,dataSource:["Cockpit","Cabin"],onValueChanged:function(t){if(!t.value)return void(e.dg_crew_ds=null);e.dg_box_keys&&e.dg_box_keys.length>0&&e.bindValidCrew(e.dg_box_selected.BoxId,1,"Cockpit"==t.value?1:0)},bindingOptions:{value:"crewGroup"}},e.dg_crew_columns=[{dataField:"ScheduleName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120},{dataField:"Id",caption:"",width:70,allowFiltering:!1,allowSorting:!1,cellTemplate:"addCrewTemplate"}],e.dg_crew_selected=null,e.dg_crew_instance=null,e.dg_crew_ds=null,e.dg_crew={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-200-160},columns:e.dg_crew_columns,onContentReady:function(t){e.dg_crew_instance||(e.dg_crew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew_selected=i||null},onRowPrepared:function(e){e.data&&-1!=e.data.StandById&&e.rowElement.css("background","#ffff80")},bindingOptions:{dataSource:"dg_crew_ds"}},e.dg_fcrew_columns=[{caption:"Crew",columns:[{dataField:"IsPositioning",caption:"DH",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:60},{dataField:"Position",caption:"Position",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FDPTitle",caption:"FDP",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:250},{dataField:"Sex",caption:"Gender",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120}]}],e.dg_fcrew_selected=null,e.dg_fcrew_instance=null,e.dg_fcrew_ds=null,e.dg_fcrew={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-370},columns:e.dg_fcrew_columns,onContentReady:function(t){e.dg_fcrew_instance||(e.dg_fcrew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_fcrew_selected=i||null},onRowPrepared:function(e){e.data&&e.data.IsPositioning&&e.rowElement.css("background","#ffccff")},bindingOptions:{dataSource:"dg_fcrew_ds"}},e.dg_ffdp_columns=[{caption:"FDPs",columns:[{dataField:"FDPTitle",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"DutyStartLocal",caption:"Start",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170},{dataField:"DutyEndLocal",caption:"End",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170}]}],e.dg_ffdp_selected=null,e.dg_ffdp_instance=null,e.dg_ffdp_ds=null,e.dg_ffdp={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return 250},columns:e.dg_ffdp_columns,onContentReady:function(t){e.dg_ffdp_instance||(e.dg_ffdp_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_ffdp_selected=i||null},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_ffdp_ds"}},e.dg_box_columns=[{dataField:"Flights",caption:"Flights",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_box_selected=null,e.dg_box_instance=null,e.dg_box_ds=null,e.dg_box_keys=null,e.dg_box={keyExpr:"BoxId",wordWrapEnabled:!0,headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-115},columns:e.dg_box_columns,onContentReady:function(t){e.dg_box_instance||(e.dg_box_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_box_selected=i,e.bindAssignedCrew(i),e.dg_crew_ds=null,e.bindValidCrew(i.BoxId,1,e.IsCockpit?1:0)):(e.dg_box_selected=null,e.assignedCrewDs=null)},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_box_ds",selectedRowKeys:"dg_box_keys"}},e.dg_calcrew_columns=[{dataField:"ScheduleName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120},{dataField:"GroupOrder",caption:"O",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120,visible:!1}],e.dg_calcrew_selected=null,e.dg_calcrew_instance=null,e.dg_calcrew_ds=null,e.dg_calcrew={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-114},columns:e.dg_calcrew_columns,onContentReady:function(t){e.dg_calcrew_instance||(e.dg_calcrew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_calcrew_selected=i,e.cal_change()):e.dg_calcrew_selected=null},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_calcrew_ds"}},e.dg_calfdp_columns=[{dataField:"DutyStart",caption:"Date",allowResizing:!0,alignment:"left",dataType:"date",allowEditing:!1,width:110},{dataField:"FDPTitle",caption:"Duty",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FDPRemark",caption:"Duration",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:110},{dataField:"Id",caption:"",width:65,allowFiltering:!1,allowSorting:!1,cellTemplate:"addFDPTemplate"}],e.dg_calfdp_selected=null,e.dg_calfdp_instance=null,e.dg_calfdp_ds=null,e.dg_calfdp={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-114},columns:e.dg_calfdp_columns,onContentReady:function(t){e.dg_calfdp_instance||(e.dg_calfdp_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_calfdp_selected=i,e.cal_change()):e.dg_calfdp_selected=null},onRowPrepared:function(e){e.data&&-1!=e.data.StandById&&e.rowElement.css("background","#ffff80")},bindingOptions:{dataSource:"dg_calfdp_ds"}},e.cal_crew_current=new Date,e.$watch("cal_crew_current",function(t,i,n){try{e.cal_change()}catch(e){alert("e3"),alert(e)}}),e.assign1168=function(t){e.event_status=1168,e.FromDateEvent=new Date(e.contextMenuCellData.startDate).setHours(0,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addMinutes(720),e.popup_event_title="StandBy AM",e.popup_event_visible=!0},e.assign1167=function(t){e.event_status=1167,e.FromDateEvent=new Date(e.contextMenuCellData.startDate).setHours(12,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addMinutes(720),e.popup_event_title="StandBy PM",e.popup_event_visible=!0},e.assign5000=function(t){e.event_status=5e3,e.FromDateEvent=new Date(e.contextMenuCellData.startDate).setHours(8,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addMinutes(240),e.popup_event_title="Training",e.popup_event_visible=!0},e.assign5001=function(t){e.event_status=5001,e.FromDateEvent=new Date(e.contextMenuCellData.startDate).setHours(8,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addMinutes(540),e.popup_event_title="Office",e.popup_event_visible=!0},e.assign10000=function(t){e.event_status=1e4,e.FromDateEvent=new Date(e.contextMenuCellData.startDate).setHours(20,0,0,0),e.ToDateEvent=new Date(e.FromDateEvent).addHours(36),e.popup_event_title="Day Off",e.popup_event_visible=!0},e.cellContextMenuItems=[{text:"Assign Day Off",onItemClick:e.assign10000,template:"<table><tr><td style='vertical-align:middle;'><div class='duty-10000' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Day Off</td></tr></table>"},{text:"Assign Stan By AM",onItemClick:e.assign1168,template:"<table><tr><td style='vertical-align:middle;'><div class='duty-1168' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Stand By AM</td></tr></table>"},{text:"Assign Stan By PM",onItemClick:e.assign1167,template:"<table><tr><td style='vertical-align:middle;'><div class='duty-1167' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Stand By PM</td></tr></table>"},{text:"Assign Office",onItemClick:e.assign5001,template:"<table><tr><td style='vertical-align:middle;'><div class='duty-5001' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Office</td></tr></table>"},{text:"Assign Training",onItemClick:e.assign5000,template:"<table><tr><td style='vertical-align:middle;'><div class='duty-5000' style='width:15px;height:15px;border-radius:50%;'></div></td><td style='vertical-align:top;padding-left:5px;'>Assign Training</td></tr></table>"}],e.cellContextMenuOptions={target:".dx-scheduler-date-table-cell",dataSource:e.cellContextMenuItems,width:200,onShowing:function(t){e.dg_calcrew_selected||(t.cancel=!0);var i=new Date(e.contextMenuCellData.startDate),n=new Date(e.dg_calcrew_selected.DateInactiveBegin),a=new Date(e.dg_calcrew_selected.DateInactiveEnd);i>=n&&i<=a&&(t.cancel=!0)},onItemClick:function(t){e.dg_calcrew_selected&&t.itemData.onItemClick(t.itemData)}},e.cal_crew_ds=null,e.cal_crew_instance=null,e.cal_crew={editing:{allowAdding:!1,allowDeleting:!1,allowDragging:!1,allowResizing:!1,allowUpdating:!1},textExpr:"Flights",startDateExpr:"DutyStartLocal",endDateExpr:"DutyEndLocal",views:["month","day"],currentView:"month",startDayHour:0,appointmentTemplate:"appointmentTemplate",appointmentTooltipTemplate:"tooltip-template",dataCellTemplate:"dataCellTemplate",height:function(){return $(window).height()-115-31},onContentReady:function(t){e.cal_crew_instance||(e.cal_crew_instance=t.component)},optionChanged:function(e){},onAppointmentClick:function(e){if($(e.event.target).hasClass("cellposition"))return void(e.cancel=!0)},onAppointmentDblClick:function(e){e.cancel=!0},onCellContextMenu:function(t){e.contextMenuCellData=t.cellData},bindingOptions:{currentDate:"cal_crew_current",dataSource:"cal_crew_ds"}},e.getDutyClass=function(e){switch(e.DutyType){case 1165:return"duty-1165";default:return"duty-"+e.DutyType}},e.getCaption=function(e){switch(e.DutyType){case 5e3:return"TRN";case 5001:return"OFC";case 1167:return"PM";case 1168:return"AM";case 1e4:return"OFF";default:return"DTY"}},e.getDataCellTemplateClass=function(t){if(!e.dg_calcrew_selected)return"";var i=new Date(t.startDate),n=new Date(e.dg_calcrew_selected.DateInactiveBegin),a=new Date(e.dg_calcrew_selected.DateInactiveEnd);return i>=n&&i<=a?"inactive-cell":""},e.getPosition=function(e){switch(e){case"Captain":return"CPT";case"Purser":return"PU";case"Purser2":return"PU2";case"Purser3":return"PU3";case"SCCM(i)":case"ISCCM":return"SCI";default:return e}},e.cellPositionClicked=function(e){},e.bindValidCrew=function(t,i,n){e.loadingVisible=!0,a.getValidCrew(t,i,n).then(function(t){e.loadingVisible=!1,e.dg_crew_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.bindValidPosCrew=function(t,i,n){e.loadingVisible=!0,a.getValidCrew(t,i,n).then(function(t){e.loadingVisible=!1,e.dg_pos_crew_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.bindValidFDP=function(t,i,n){e.loadingVisible=!0,a.getValidFDP(t,i,n).then(function(t){e.loadingVisible=!1,e.dg_calfdp_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.popup_crew_visible=!1,e.popup_crew={width:function(){return 850},height:function(){return $(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",text:"Profile",icon:"card",onClick:function(e){}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_crew_visible=!1}},toolbar:"bottom"}],position:"right",visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.crewGroup=e.IsCockpit?"Cockpit":"Cabin";var i=Enumerable.From(e.dataSource).Where("$.IsBox").OrderBy("$.STD").ToArray();e.dg_box_ds=i,e.dg_box_keys=[],e.dg_box_keys.push(e.selectedBox.BoxId)},onHiding:function(){e.crewGroup=null,e.assignedCrewDs=null,e.dg_crew_ds=null,e.dg_box_instance.clearSelection(),e.createGantt(),e.popup_crew_visible=!1},bindingOptions:{visible:"popup_crew_visible"}},e.dg_details_columns=[{dataField:"ScheduleName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Id",caption:"Flights",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,cellTemplate:"detailTemplate"}],e.dg_details_selected=null,e.dg_details_instance=null,e.dg_details_ds=null,e.dg_details={onCellClick:function(e){},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"none"},height:"480",columns:e.dg_details_columns,onContentReady:function(t){e.dg_details_instance||(e.dg_details_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_details_selected=i||null},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_details_ds"}},e.dg_pos_crew_columns=[{dataField:"ScheduleName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120},{dataField:"Id",caption:"",width:70,allowFiltering:!1,allowSorting:!1,cellTemplate:"addPosCrewTemplate"}],e.dg_pos_crew_selected=null,e.dg_pos_crew_instance=null,e.dg_pos_crew_ds=null,e.dg_pos_crew={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:function(){return $(window).height()-330},columns:e.dg_pos_crew_columns,onContentReady:function(t){e.dg_pos_crew_instance||(e.dg_pos_crew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_pos_crew_selected=i||null},onRowPrepared:function(e){e.data&&-1!=e.data.StandById&&e.rowElement.css("background","#ffff80")},bindingOptions:{dataSource:"dg_pos_crew_ds"}},e.dg_pos_flights_columns=[{caption:"Positioning Flights",columns:[{dataField:"taskName",caption:"Flight",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Register",caption:"Reg.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"DepartureLocal",caption:"Departure",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170},{dataField:"ArrivalLocal",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170}]}],e.dg_pos_flights_selected=null,e.dg_pos_flights_instance=null,e.dg_pos_flights_ds=null,e.dg_pos_flights={onCellClick:function(e){},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"multiple"},height:function(){return $(window).height()-400},columns:e.dg_pos_flights_columns,onContentReady:function(t){e.dg_pos_flights_instance||(e.dg_pos_flights_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData;e.dg_pos_flights_selected=i;var n=Enumerable.From(i).Select("$.ID").ToArray();e.dg_main_flights_ds=Enumerable.From(e.posFlights).Where(function(e){var t=e.ID;return-1==n.indexOf(t)}).ToArray()},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_pos_flights_ds"}},e.dg_main_flights_columns=[{caption:"Main Flights",columns:[{dataField:"taskName",caption:"Flight",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Register",caption:"Reg.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"DepartureLocal",caption:"Departure",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170},{dataField:"ArrivalLocal",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170}]}],e.dg_main_flights_selected=null,e.dg_main_flights_instance=null,e.dg_main_flights_ds=null,e.dg_main_flights={onCellClick:function(e){},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"multiple"},height:function(){return 270},columns:e.dg_main_flights_columns,onContentReady:function(t){e.dg_main_flights_instance||(e.dg_main_flights_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData;e.dg_main_flights_selected=i;var n=Enumerable.From(i).Select("$.ID").ToArray();e.dg_pos_flights_ds=Enumerable.From(e.posFlights).Where(function(e){var t=e.ID;return-1==n.indexOf(t)}).ToArray()},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_main_flights_ds"}},e.dg_fc_columns=[{caption:"Flights",columns:[{dataField:"MatchingListErrors",caption:"ML",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:35,cellTemplate:function(e,t){t.value>0&&$("<div>").append('<i class="fas fa-puzzle-piece" style="font-size:13px;position: relative;left:0px;top:-1px;color:red"></i>').appendTo(e)}},{dataField:"MaleFemalError",caption:"MF",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:37,cellTemplate:function(e,t){t.value>0&&$("<div>").append('<i class="fas fa-restroom" style="font-size:13px;position: relative;left:-2px;top:-1px;color:red"></i>').appendTo(e)}},{dataField:"taskName",caption:"Flight",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Register",caption:"Reg.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"DepartureLocal",caption:"Departure",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170},{dataField:"ArrivalLocal",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170}]}],e.dg_fc_selected=null,e.dg_fc_instance=null,e.dg_fc_ds=null,e.dg_fc={onCellClick:function(e){},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},height:function(){return $(window).height()-115},columns:e.dg_fc_columns,onContentReady:function(t){e.dg_fc_instance||(e.dg_fc_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_fc_selected=i,e.bindFlightCrews(i.ID,function(t){e.dg_fcrew_ds=t,e.bindFlightFDPs(i.ID,function(t){e.dg_ffdp_ds=t})})):(e.dg_fc_selected=null,e.dg_fcrew_ds=null,e.dg_ffdp_ds=null)},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_fc_ds"}},e.on_visible=!1,e.off_visible=!1,e.getTileFlightClass=function(e){var t="tile-flight off";return e.IsOff||(t="tile-flight on"),1==e.selected&&(t+=" selected"),t},e.selectedTileFlight=null,e.tileFlightClicked=function(t){var i=e.dg_details_ds;$.each(i,function(e,i){$.each(i.Items,function(e,i){i.Id!=t.Id&&(i.selected=!1)})}),t.selected=!t.selected,e.on_visible=!1,e.off_visible=!1,t.selected&&!t.IsCanceled&&(e.on_visible=t.IsOff,e.off_visible=!t.IsOff,e.selectedTileFlight=t)},e.popup_fdp_details_visible=!1,e.popup_fdp_details={width:function(){return 1100},height:function(){return 600},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",text:"Notify",onClick:function(t){e.loadingVisible=!0,a.notifyFDPCrew(e.selectedBoxId).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success")},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"On",icon:"airplane",onClick:function(t){e.selectedTileFlight.IsOff=null,e.on_visible=e.selectedTileFlight.IsOff,e.off_visible=!e.selectedTileFlight.IsOff}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Off",icon:"airplane",onClick:function(t){e.selectedTileFlight.IsOff=!0,e.on_visible=e.selectedTileFlight.IsOff,e.off_visible=!e.selectedTileFlight.IsOff}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"save",onClick:function(t){var i=[];$.each(e.dg_details_ds,function(e,t){var n=Enumerable.From(t.Items).Where("$.IsOff!=$._IsOff").ToArray();if(n.length>0){var a={};a.FDPId=t.Id;var o=[];$.each(n,function(e,t){var i=!!t.IsOff,n={FDPItem:t.Id,Off:i};o.push(n)}),a.Items=o,i.push(a)}}),
i.length>0&&(e.loadingVisible=!0,a.offFlights(i,function(){e.loadingVisible=!1,e.popup_fdp_details_visible=!1}))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_fdp_details_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.loadingVisible=!0,a.getFDPChildren(e.selectedBoxId).then(function(t){e.loadingVisible=!1,$.each(t.children,function(e,t){$.each(t.Items,function(e,t){t.selected=!1,t._IsOff=t.IsOff})}),e.dg_details_ds=t.children},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},onHiding:function(){e.popup_fdp_details_visible=!1},bindingOptions:{visible:"popup_fdp_details_visible","toolbarItems[1].visible":"on_visible","toolbarItems[2].visible":"off_visible"}},e.popup_pos_visible=!1,e.posFDP=null,e.posFDPSaved=!1,e.popup_pos={width:function(){return $(window).width()},height:function(){return $(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",text:"Create FDP",icon:"airplane",onClick:function(t){var i=[],n=[];$.each(e.dg_pos_flights_selected,function(e,t){i.push(t.ID),n.push(t.ID)}),$.each(e.dg_main_flights_selected,function(e,t){i.push(t.ID)});var o={ids:i,cid:-1,posIds:n};e.loadingVisible=!0,a.createFDP(o).then(function(t){e.loadingVisible=!1,e.posFDP=t,e.posFDPSaved=!1,e.dg_pos_crew_ds=null,e.bindValidPosCrew(e.posFDP.Id,1,e.IsCockpit?1:0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"save",onClick:function(t){if(e.assignedPosCrewDs&&e.assignedPosCrewDs.length>0){var i=[];$.each(e.assignedPosCrewDs,function(e,t){var n={fdp:t.fdpId,crew:t.CrewId,position:t.PositionId,stby:t.StandById};i.push(n)}),e.loadingVisible=!0,a.saveAssignFDPToCrews(i).then(function(t){e.loadingVisible=!1,e.crewFDPs=[],e.posFDPSaved=!0,e.popup_pos_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_pos_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.bindPosFlights(function(t){e.posFlights=t;var i=Enumerable.From(t).ToArray(),n=Enumerable.From(t).ToArray();e.dg_pos_flights_ds=i,e.dg_main_flights_ds=n})},onHiding:function(){if(!e.posFDPSaved&&e.posFDP){var t={id:e.posFDP.Id};a.unboxItems(t).then(function(t){e.posFDP=null,e.posFDPSaved=!1,e.dg_pos_flights_ds=null,e.dg_main_flights_ds=null,e.dg_main_flights_selected=null,e.dg_pos_flights_selected=null,e.popup_pos_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else e.posFDP=null,e.posFDPSaved=!1,e.dg_pos_flights_ds=null,e.dg_main_flights_ds=null,e.dg_main_flights_selected=null,e.dg_pos_flights_selected=null,e.rebind(),e.popup_pos_visible=!1},bindingOptions:{visible:"popup_pos_visible"}},e.popup_fc_visible=!1,e.popup_fc={width:function(){return $(window).width()},height:function(){return $(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_fc_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.bindPosFlights(function(t){e.dg_fc_ds=t})},onHiding:function(){e.dg_fc_ds=[],e.popup_fc_visible=!1},bindingOptions:{visible:"popup_fc_visible"}},e.popup_cal_visible=!1,e.btn_crewlist_visible=!1,e.btn_duties_visible=!0;e.popup_cal={width:function(){return 1400},height:function(){return $(window).height()},fullScreen:!0,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"FDPs",icon:"airplane",onClick:function(t){e.btn_duties_visible=!1,e.btn_crewlist_visible=!0,e.dg_calfdp_ds=null,$(".dgcalcrew").fadeOut("200",function(){$(".dgcalfdp").fadeIn("200",function(){var t=new Date(e.cal_crew_current).getDatePartArray();if(e.dg_calcrew_selected){var i=e.dg_calcrew_selected.Id;e.bindValidFDP(i,t[0],t[1]+1)}})})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Crew List",icon:"group",onClick:function(t){e.btn_crewlist_visible=!1,e.btn_duties_visible=!0,$(".dgcalfdp").fadeOut("200",function(){$(".dgcalcrew").fadeIn("200",function(){})})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_cal_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.bind_calcrew(),e.cal_change()},onHiding:function(){e.btn_crewlist_visible=!1,e.btn_duties_visible=!0,$(".dgcalfdp").hide(),$(".dgcalcrew").show(),e.cal_crew_ds=[],e.cal_crew_instance&&e.cal_crew_instance.repaint(),e.rebind(),e.popup_cal_visible=!1},bindingOptions:{visible:"popup_cal_visible","toolbarItems[0].visible":"btn_duties_visible","toolbarItems[1].visible":"btn_crewlist_visible"}},e.FromDateEvent=null,e.ToDateEvent=null,e.date_from_event={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"FromDateEvent"}},e.date_to_event={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"ToDateEvent"}},e.event_status=null,e.popup_event_visible=!1,e.popup_event_title="",e.popup_event={width:300,height:260,position:"left top",fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Ok",icon:"check",validationGroup:"eventadd2",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");var i=e.dg_calcrew_selected.Id;1e4==e.event_status&&(e.loadingVisible=!0,a.IsRERRPValid(i,new Date(e.FromDateEvent),new Date(e.ToDateEvent)).then(function(t){if(e.loadingVisible=!1,t)General.ShowNotify(t,"error");else{var n={DateStart:new Date(e.FromDateEvent),DateEnd:new Date(e.ToDateEvent),CityId:-1,CrewId:i,DutyType:e.event_status};e.loadingVisible=!0,a.saveDuty(n).then(function(t){e.loadingVisible=!1,e.fdpCrews=[];var i=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();$.each(i,function(e,t){t.Synced=!1}),e.cal_crew_ds.push(t),e.cal_crew_instance.repaint(),e.popup_event_visible=!1,e.btn_crewlist_visible&&e.refreshValidFDP()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})),1167!=e.event_status&&1168!=e.event_status&&5e3!=e.event_status&&5001!=e.event_status||(e.loadingVisible=!0,a.IsEventValid(i,new Date(e.FromDateEvent),new Date(e.ToDateEvent),e.event_status).then(function(t){if(e.loadingVisible=!1,t)General.ShowNotify(t,"error");else{var n={DateStart:new Date(e.FromDateEvent),DateEnd:new Date(e.ToDateEvent),CityId:-1,CrewId:i,DutyType:e.event_status};e.loadingVisible=!0,a.saveDuty(n).then(function(t){e.loadingVisible=!1,e.fdpCrews=[];var i=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();$.each(i,function(e,t){t.Synced=!1}),e.cal_crew_ds.push(t),e.cal_crew_instance.repaint(),e.popup_event_visible=!1,e.btn_crewlist_visible&&e.refreshValidFDP()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.ToDateEvent=null,e.FromDateEvent=null,e.event_status=null},bindingOptions:{visible:"popup_event_visible",title:"popup_event_title"}},e.popup_event.toolbarItems[1].options.onClick=function(t){e.popup_event_visible=!1},e.crewFDPs=[],e.cal_change=function(){if(e.cal_crew_current&&e.dg_calcrew_selected){var t=new Date(e.cal_crew_current).getDatePartArray(),i=e.dg_calcrew_selected.Id;e.getCrewFDPs(t[0],t[1]+1,i,function(t){e.cal_crew_ds=t})}},e.getCrewFDPs=function(t,i,n,o){if(n){var l=Enumerable.From(e.crewFDPs).Where("$.CrewId=="+n+" && $.DateStartYear=="+t+" && $.DateStartMonth=="+i).FirstOrDefault();l?o(l.FDPs):(e.loadingVisible=!0,a.getCrewFDPByYearMonth(n,t,i).then(function(a){e.loadingVisible=!1;var l={CrewId:n,DateStartYear:t,DateStartMonth:i,FDPs:a};e.crewFDPs.push(l),o(a)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))}else o(null)},e.fdpCrews=[],e.bindAssignedCrew=function(t){var i=t.BoxId;if(!t.HasCrew)return void(e.assignedCrewDs=null);if(t.Synced){var n=Enumerable.From(e.fdpCrews).Where("$.Id=="+i).FirstOrDefault();return void(e.assignedCrewDs=Enumerable.From(n.crew).ToArray())}a.getFDPAssignedCrew(i).then(function(n){if(t.Synced=!0,n&&n.length>0){var a={Id:i,crew:[]};e.fdpCrews.push(a),$.each(n,function(e,t){t.fdpId=a.Id,a.crew.push(t)}),e.assignedCrewDs=Enumerable.From(a.crew).ToArray()}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.assignedCrewDs=[],e.assignedPosCrewDs=[],e.positions=[{title:"P1",ds:["Captain","FO","OBSP1"]},{title:"P2",ds:["FO","SO","OBSP2"]},{title:"TRI",ds:["Captain","TRI","FO","SO","TO"]},{title:"TRE",ds:["Captain","TRE","FO","SO","TO"]},{title:"LTC",ds:["Captain","TRI","TRE","FO","SO","TO"]},{title:"CCM",ds:["FA","OBS","Check"]},{title:"SCCM",ds:["Purser","Purser2","Purser3","OBS","Check"]},{title:"SCCM(i)",ds:["SCCM(i)","Purser","Purser2","Purser3"]},{title:"ISCCM",ds:["ISCCM","Purser","Purser2","Purser3"]}],e.positionIds=[{id:1160,title:"Captain"},{id:1161,title:"FO"},{id:1162,title:"SO"},{id:1163,title:"OBSP1"},{id:1164,title:"OBSP2"},{id:1205,title:"TRI"},{id:1206,title:"TRE"},{id:1153,title:"OBS"},{id:1154,title:"Check"},{id:1158,title:"FA"},{id:1157,title:"Purser"},{id:1156,title:"Purser2"},{id:1155,title:"Purser3"},{id:10002,title:"ISCCM"}],e.IsCockpitCrew=function(e){return"Purser"!=e.Position&&"Purser2"!=e.Position&&"Purser3"!=e.Position&&"FA"!=e.Position&&"OBS"!=e.Position&&"Check"!=e.Position&&"SCCM(i)"!=e.Position&&"ISCCM"!=e.Position},e.IsCrewTileEditable=function(t){return e.IsCockpitCrew(t)==!!e.IsCockpit},e.setDefaultPosition=function(t){var i=Enumerable.From(e.positions).Where('$.title=="'+t.JobGroup+'"').FirstOrDefault(),n=i.ds[0],a=Enumerable.From(e.positionIds).Where('$.title=="'+n+'"').FirstOrDefault().id;t.Position=n,t.PositionId=a},e.getDefaultPosition=function(t){var i=Enumerable.From(e.positions).Where('$.title=="'+t+'"').FirstOrDefault(),n=i.ds[0];return Enumerable.From(e.positionIds).Where('$.title=="'+n+'"').FirstOrDefault().id},e.addFDP=function(t){var i=t.data.Id,n=Enumerable.From(e.dg_calfdp_ds).Where("$.Id=="+i).FirstOrDefault(),o=e.dg_calcrew_selected.Id,l=e.getDefaultPosition(e.dg_calcrew_selected.JobGroup),r={fdp:n.Id,crew:o,position:l,stby:n.StandById};e.loadingVisible=!0,a.saveAssignFDPToCrew2(r).then(function(t){e.loadingVisible=!1,e.fdpCrews=[];var i=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();$.each(i,function(e,t){t.Synced=!1}),e.cal_crew_ds.push(t),e.cal_crew_instance.repaint(),e.dg_calfdp_ds=null;var n=new Date(e.cal_crew_current).getDatePartArray();e.bindValidFDP(o,n[0],n[1]+1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.addCrew=function(t){var i=t.data.Id,n=Enumerable.From(e.fdpCrews).Where("$.Id=="+e.dg_box_selected.BoxId).FirstOrDefault();n||(n={Id:e.dg_box_selected.BoxId,crew:[]},e.fdpCrews.push(n));var o=Enumerable.From(e.dg_crew_ds).Where("$.Id=="+i).FirstOrDefault(),l=JSON.parse(JSON.stringify(o));l.CrewId=i,e.setDefaultPosition(l),l.fdpId=n.Id;var r={fdp:n.Id,crew:i,position:l.PositionId,stby:l.StandById};e.loadingVisible=!0,a.saveAssignFDPToCrew(r).then(function(t){var a=t.fdp;e.loadingVisible=!1,e.crewFDPs=[],l.Id=a.Id,n.crew.push(l),e.dg_crew_ds=Enumerable.From(e.dg_crew_ds).Where("$.Id!="+i).ToArray(),e.dg_crew_instance.refresh(),e.assignedCrewDs=Enumerable.From(n.crew).ToArray(),e.dg_box_selected.HasCrew=!0;var o=Enumerable.From(e.assignedCrewDs).Where("$.SexId==31").Count(),r=Enumerable.From(e.assignedCrewDs).Where("$.SexId==30").Count();e.dg_box_selected.MaleFemalError=0==r||0==o?1:0,e.dg_box_selected.MatchingListError=t.matchingError,$.each(e.dg_box_selected.BoxItems,function(t,i){i.MaleFemalError=e.dg_box_selected.MaleFemalError,i.MatchingListError=e.dg_box_selected.MatchingListError})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.posFDPCrews=[],e.addPosCrew=function(t){var i=t.data.Id,n=Enumerable.From(e.posFDPCrews).Where("$.Id=="+e.posFDP.Id).FirstOrDefault();n||(n={Id:e.posFDP.Id,crew:[]},e.posFDPCrews.push(n));var a=Enumerable.From(e.dg_pos_crew_ds).Where("$.Id=="+i).FirstOrDefault(),o=JSON.parse(JSON.stringify(a));o.CrewId=i,e.setDefaultPosition(o),o.fdpId=n.Id,o.Id=n.crew.length+1,n.crew.push(o),e.dg_pos_crew_ds=Enumerable.From(e.dg_pos_crew_ds).Where("$.Id!="+i).ToArray(),e.dg_pos_crew_instance.refresh(),console.log("assigned crew"),console.log(o),e.assignedPosCrewDs=Enumerable.From(n.crew).ToArray()},e.removeAssignedCrew=function(t,i,n){var o={fdp:t};e.loadingVisible=!0,a.saveDeleteFDP(o).then(function(t){e.loadingVisible=!1,e.crewFDPs=[];var a=Enumerable.From(e.fdpCrews).Where("$.Id=="+i).FirstOrDefault(),o=Enumerable.From(a.crew).Where("$.CrewId=="+n).FirstOrDefault(),l=JSON.parse(JSON.stringify(o));e.dg_crew_ds.push(l),e.dg_crew_instance.refresh(),a.crew=Enumerable.From(a.crew).Where("$.CrewId!="+n).ToArray(),e.assignedCrewDs=Enumerable.From(a.crew).ToArray(),e.dg_box_selected.HasCrew=e.assignedCrewDs.length>0;var r=Enumerable.From(e.assignedCrewDs).Where("$.SexId==31").Count(),d=Enumerable.From(e.assignedCrewDs).Where("$.SexId==30").Count();e.dg_box_selected.MaleFemalError=0==d||0==r?1:0,e.dg_box_selected.MatchingListError=t.matchingError,$.each(e.dg_box_selected.BoxItems,function(t,i){i.MaleFemalError=e.dg_box_selected.MaleFemalError,i.MatchingListError=e.dg_box_selected.MatchingListError})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.removeAssignedPosCrew=function(t,i,n){var a=Enumerable.From(e.posFDPCrews).Where("$.Id=="+i).FirstOrDefault(),o=Enumerable.From(a.crew).Where("$.CrewId=="+n).FirstOrDefault(),l=JSON.parse(JSON.stringify(o));e.dg_pos_crew_ds.push(l),e.dg_pos_crew_instance.refresh(),a.crew=Enumerable.From(a.crew).Where("$.CrewId!="+n).ToArray(),e.assignedPosCrewDs=Enumerable.From(a.crew).ToArray()},e.removeAssignedFDP=function(t){var i={fdp:t.Id};e.loadingVisible=!0,a.saveDeleteFDP(i).then(function(i){e.loadingVisible=!1,e.fdpCrews=[];var n=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();$.each(n,function(e,t){t.Synced=!1}),e.cal_crew_instance.deleteAppointment(t),e.cal_crew_instance.hideAppointmentTooltip(),e.btn_crewlist_visible&&e.refreshValidFDP()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.nextPosition=function(t,i,n){var o=Enumerable.From(e.fdpCrews).Where("$.Id=="+i).FirstOrDefault(),l=Enumerable.From(o.crew).Where("$.CrewId=="+n).FirstOrDefault(),r=l.Position,d=Enumerable.From(e.positions).Where('$.title=="'+l.JobGroup+'"').FirstOrDefault().ds,s=d.indexOf(r);s>=d.length-1?s=0:s++,l.Position=d[s];var c=Enumerable.From(e.positionIds).Where('$.title=="'+l.Position+'"').FirstOrDefault().id;if(l.PositionId=c,e.crewFDPs=[],r!=l.position){var g={fdp:t,position:c};e.loadingVisible=!0,a.saveUpdateFDPPosition(g).then(function(t){e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.prePosition=function(t,i,n){var o=Enumerable.From(e.fdpCrews).Where("$.Id=="+i).FirstOrDefault(),l=Enumerable.From(o.crew).Where("$.CrewId=="+n).FirstOrDefault(),r=l.Position,d=Enumerable.From(e.positions).Where('$.title=="'+l.JobGroup+'"').FirstOrDefault().ds,s=d.indexOf(r);s<=0?s=d.length-1:s--,l.Position=d[s];var c=Enumerable.From(e.positionIds).Where('$.title=="'+l.Position+'"').FirstOrDefault().id;if(l.PositionId=c,e.crewFDPs=[],r!=l.position){var g={fdp:t,position:c};e.loadingVisible=!0,a.saveUpdateFDPPosition(g).then(function(t){e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.nextPosPosition=function(t,i,n){var a=Enumerable.From(e.posFDPCrews).Where("$.Id=="+i).FirstOrDefault(),o=Enumerable.From(a.crew).Where("$.CrewId=="+n).FirstOrDefault(),l=o.Position,r=Enumerable.From(e.positions).Where('$.title=="'+o.JobGroup+'"').FirstOrDefault().ds,d=r.indexOf(l);d>=r.length-1?d=0:d++,o.Position=r[d];var s=Enumerable.From(e.positionIds).Where('$.title=="'+o.Position+'"').FirstOrDefault().id;o.PositionId=s},e.prePosPosition=function(t,i,n){var a=Enumerable.From(e.posFDPCrews).Where("$.Id=="+i).FirstOrDefault(),o=Enumerable.From(a.crew).Where("$.CrewId=="+n).FirstOrDefault(),l=o.Position,r=Enumerable.From(e.positions).Where('$.title=="'+o.JobGroup+'"').FirstOrDefault().ds,d=r.indexOf(l);d<=0?d=r.length-1:d--,o.Position=r[d];var s=Enumerable.From(e.positionIds).Where('$.title=="'+o.Position+'"').FirstOrDefault().id;o.PositionId=s},e.refreshValidFDP=function(){var t=e.dg_calcrew_selected.Id;e.dg_calfdp_ds=null;var i=new Date(e.cal_crew_current).getDatePartArray();e.bindValidFDP(t,i[0],i[1]+1)},e.nextCrew=function(){var t=e.dg_calcrew_instance.getSelectedRowKeys(),i=e.dg_calcrew_instance.getRowIndexByKey(t[0]);if(i++,e.dg_calcrew_instance.getKeyByRowIndex(i)){var n=[];n.push(i),e.dg_calcrew_instance.selectRowsByIndexes(n).done(function(t){e.btn_crewlist_visible&&e.refreshValidFDP()})}},e.preCrew=function(){var t=e.dg_calcrew_instance.getSelectedRowKeys(),i=e.dg_calcrew_instance.getRowIndexByKey(t[0]);if(i--,e.dg_calcrew_instance.getKeyByRowIndex(i)){var n=[];n.push(i),e.dg_calcrew_instance.selectRowsByIndexes(n).done(function(t){e.btn_crewlist_visible&&e.refreshValidFDP()})}},e.nextPosition2=function(t){var i=t.Position,n=Enumerable.From(e.positions).Where('$.title=="'+e.dg_calcrew_selected.JobGroup+'"').FirstOrDefault().ds,o=n.indexOf(i);o>=n.length-1?o=0:o++,t.Position=n[o];var l=Enumerable.From(e.positionIds).Where('$.title=="'+t.Position+'"').FirstOrDefault().id;t.PositionId=l,e.fdpCrews=[];var r=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();if($.each(r,function(e,t){t.Synced=!1}),i!=t.position){var d={fdp:t.Id,position:l};e.loadingVisible=!0,a.saveUpdateFDPPosition(d).then(function(t){e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.prePosition2=function(t){var i=t.Position,n=Enumerable.From(e.positions).Where('$.title=="'+e.dg_calcrew_selected.JobGroup+'"').FirstOrDefault().ds,o=n.indexOf(i);o<=0?o=n.length-1:o--,t.Position=n[o];var l=Enumerable.From(e.positionIds).Where('$.title=="'+t.Position+'"').FirstOrDefault().id;t.PositionId=l,e.fdpCrews=[];var r=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();if($.each(r,function(e,t){t.Synced=!1}),i!=t.position){var d={fdp:t.Id,position:l};e.loadingVisible=!0,a.saveUpdateFDPPosition(d).then(function(t){e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.bind_calcrew=function(){var t=e.IsCockpit?"cockpit":"cabin",i="odata/crew/valid/"+t+"/ordered/group/"+Config.CustomerId;e.dg_calcrew_ds||(e.dg_calcrew_ds={store:{type:"odata",url:n.serviceUrl+i,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(e){}},sort:[{getter:"GroupOrder",desc:!1},{getter:"JobGroup",desc:!1},{getter:"ScheduleName",desc:!1}]})},e.$on("$viewContentLoaded",function(){$(".crewassign").fadeIn(400,function(){}),$(document).on("click","._addCrew",function(t){t.preventDefault();var i=$(this).data("id"),n=Enumerable.From(e.fdpCrews).Where("$.Id=="+e.dg_box_selected.BoxId).FirstOrDefault();n||(n={Id:e.dg_box_selected.BoxId,crew:[]},e.fdpCrews.push(n));var o=Enumerable.From(e.dg_crew_ds).Where("$.Id=="+i).FirstOrDefault(),l=JSON.parse(JSON.stringify(o));l.CrewId=i,e.setDefaultPosition(l),l.fdpId=n.Id;var r={fdp:n.Id,crew:i,position:l.PositionId};e.loadingVisible=!0,a.saveAssignFDPToCrew(r).then(function(t){e.loadingVisible=!1,e.crewFDPs=[],l.Id=t.Id,n.crew.push(l),e.dg_crew_ds=Enumerable.From(e.dg_crew_ds).Where("$.Id!="+i).ToArray(),e.dg_crew_instance.refresh(),e.assignedCrewDs=Enumerable.From(n.crew).ToArray(),e.dg_box_selected.HasCrew=!0;Enumerable.From(e.assignedCrewDs).Where("$.SexId==31").Count(),Enumerable.From(e.assignedCrewDs).Where("$.SexId==30").Count();e.dg_box_selected.MaleFemalError=1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}),$(document).on("click","._addFDP",function(t){t.preventDefault();var i=$(this).data("id"),n=Enumerable.From(e.dg_calfdp_ds).Where("$.Id=="+i).FirstOrDefault(),o=e.dg_calcrew_selected.Id,l=e.getDefaultPosition(e.dg_calcrew_selected.JobGroup),r={fdp:n.Id,crew:o,position:l};e.loadingVisible=!0,a.saveAssignFDPToCrew2(r).then(function(t){e.loadingVisible=!1,e.fdpCrews=[];var i=Enumerable.From(e.dataSource).Where("$.IsBox").ToArray();$.each(i,function(e,t){t.Synced=!1}),e.cal_crew_ds.push(t),e.cal_crew_instance.repaint(),e.dg_calfdp_ds=null;var n=new Date(e.cal_crew_current).getDatePartArray();e.bindValidFDP(o,n[0],n[1]+1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}),$(document).on("click",".xati",function(){var t=$(this).data("id"),i=$("#task-"+t).parent(),n=Enumerable.From(e.dataSource).Where("$.Id=="+t).FirstOrDefault(),a=n.IsBox;n.BoxId;a?e.$apply(function(){e.selectedBox=n,e.selectedBoxId=n.BoxId}):(i.hasClass("flight-item-selected")?(e.selectedIds=Enumerable.From(e.selectedIds).Where("$!="+t).ToArray(),e.selectedItems=Enumerable.From(e.selectedItems).Where("$.Id!="+t).ToArray()):(e.selectedIds.push(t),e.selectedItems.push(n)),$("#task-"+t).parent().toggleClass("nobox").toggleClass("flight-item-selected"),e.selectedIdsChanged())})}),n.$broadcast("FlightLoaded",null)}catch(e){alert(e)}}]),app.controller("flightDesignGridController",["$scope","$location","flightService","aircraftService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o,l){e.taskIndex=1e6,e.Day0="01/31/2019",e.Day1="02/01/2019",e.Day2="02/02/2019 23:59:00.000",e.entity={Id:-1,FlightPlanId:null,TypeId:null,RegisterID:null,FlightTypeID:null,AirlineOperatorsID:null,FlightNumber:null,FromAirport:null,ToAirport:null,STA:null,STD:null,FlightH:null,FlightM:null,Unknown:null,FlightPlan:null,CustomerId:null,IsActive:null,DateActive:null,DateFrom:null,DateTo:null,Customer:null,FromAirportName:null,FromAirportIATA:null,from:null,FromAirportCityId:null,ToAirportName:null,ToAirportIATA:null,to:null,ToAirportCityId:null,notes:null,status:null,progress:null,duration:null,startDate:null,taskName:null,FromAirportCity:null,ToAirportCity:null,MSN:null,Register:null,AircraftType:null,FlightStatus:null,RouteId:null},e.clearEntity=function(){e.entity.Id=null,e.entity.taskID=null,e.entity.TypeId=null,e.entity.RegisterID=null,e.entity.FlightTypeID=null,e.entity.FlightNumber=null,e.entity.FromAirport=null,e.entity.ToAirport=null,e.entity.Unknown=null,e.entity.FlightPlan=null,e.entity.CustomerId=null,e.entity.IsActive=null,e.entity.DateActive=null,e.entity.DateFrom=null,e.entity.DateTo=null,e.entity.Customer=null,e.entity.FromAirportName=null,e.entity.FromAirportIATA=null,e.entity.from=null,e.entity.FromAirportCityId=null,e.entity.ToAirportName=null,e.entity.ToAirportIATA=null,e.entity.to=null,e.entity.ToAirportCityId=null,e.entity.notes=null,e.entity.status=null,e.entity.progress=null,e.entity.duration=null,e.entity.startDate=null,e.entity.taskName=null,e.entity.FromAirportCity=null,e.entity.ToAirportCity=null,e.entity.MSN=null,e.entity.Register=null,e.entity.AircraftType=null,e.entity.FlightStatus=null,e.entity.STD=null,e.entity.STA=null,e.entity.FlightH=null,e.entity.FlightM=null,e.start=null,e.entity.RouteId=null},e.refreshEntity=function(){e.entity.Id=null,e.entity.taskID=null,e.entity.FlightNumber=null,e.entity.FromAirport=e.entity.ToAirport,e.entity.ToAirport=null,e.entity.STD=e.entity.STA,e.start=e.entity.STD,e.entity.STA=null,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.Unknown=null,e.entity.FlightPlan=null,e.entity.CustomerId=null,e.entity.IsActive=null,e.entity.DateActive=null,e.entity.DateFrom=null,e.entity.DateTo=null,e.entity.Customer=null,e.entity.FromAirportName=null,e.entity.FromAirportIATA=null,e.entity.from=null,e.entity.FromAirportCityId=null,e.entity.ToAirportName=null,e.entity.ToAirportIATA=null,e.entity.to=null,e.entity.ToAirportCityId=null,e.entity.notes=null,e.entity.status=null,e.entity.progress=null,e.entity.duration=null,e.entity.startDate=null,e.entity.taskName=null,e.entity.FromAirportCity=null,e.entity.ToAirportCity=null,e.entity.MSN=null,e.entity.FlightStatus=null,e.entity.RouteId=null},e.selectedFlight=null,e.tempToAirport=null,e.InitUpdate=function(){var t=Enumerable.From(vmins.datasource()).Where("$.taskId=="+e.selectedFlight.taskId).FirstOrDefault();t&&(e.entity.Id=t.Id,e.entity.FlightNumber=t.FlightNumber,e.entity.FlightTypeID=t.FlightTypeID,e.entity.FromAirport=t.FromAirport,e.entity.ToAirport=t.ToAirport,e.tempToAirport=t.ToAirport,alert(e.tempToAirport=t.ToAirport),e.entity.TypeId=t.TypeId,e.entity.RegisterID=t.RegisterID,e.start=new Date(t.STD),e.entity.FlightH=t.FlightH,e.entity.FlightM=t.FlightM,e.entity.STA=new Date(t.STA),e.entity.STD=new Date(t.STD),e.IsNew=!1,e.popup_item_title="Update",e.popup_item_visible=!0,e.entity.status=t.status,e.entity.initStatus=t.initStatus,e.entity.isnew=!1)},e.setArrival=function(){if(null!=e.entity.STD&&null!=e.entity.FlightH&&null!=e.entity.FlightM){var t=new Date(e.entity.STD);e.entity.STA=new Date(t.addHours(e.entity.FlightH).addMinutes(e.entity.FlightM))}else e.entity.STA=null},e.selectedType=null,e.sb_type={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(e){return l.getSbTemplateAircraft(e)},searchExpr:["Type","Manufacturer"],dataSource:l.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",onSelectionChanged:function(t){e.ds_msn=[],e.msn_readOnly=!0,t&&t.selectedItem?(e.entity.AircraftType=t.selectedItem.Type,n.getVirtualMSNsByType(Config.CustomerId,t.selectedItem.Id).then(function(t){e.msn_readOnly=!1,e.ds_msn=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):(e.msn_readOnly=!0,e.ds_msn=[],e.entity.AircraftType=null)},bindingOptions:{value:"entity.TypeId",selectedItem:"selectedType"}},e.ds_msn=[],e.msn_readOnly=!0,e.unknown_readOnly=!1,e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(t){if(t.selectedItem){if(e.entity.Register=t.selectedItem.Register,e.IsNew){var i=Flight.getLastFlight(e.dg_ds,t.selectedItem.ID);i&&(e.entity.FromAirport=i.ToAirport,e.entity.ToAirport=null,e.entity.STD=new Date(i.STA),e.start=new Date(e.entity.STD))}}else e.entity.Register=null},bindingOptions:{value:"entity.RegisterID",disabled:"msn_readOnly",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.getAverageRouteTime=function(){1==e.IsNew&&e.entity.FromAirport&&e.entity.ToAirport&&(e.loadingVisible=!0,i.getAverageRouteTime(e.entity.FromAirport,e.entity.ToAirport).then(function(t){e.loadingVisible=!1,e.entity.FlightH=t.FlightH,e.entity.FlightM=t.FlightM,e.setArrival()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},e.sb_flighttype={showClearButton:!0,searchEnabled:!0,dataSource:l.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.FlightTypeID"}},e.selectedFromAirport=null,e.selectedToAirport=null,e.sb_FromAirport={showClearButton:!0,searchEnabled:!0,dataSource:l.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return l.getSbTemplateAirport(e)},onSelectionChanged:function(t){if(e.entity.ToAirport=null,!t.selectedItem)return e.ds_toairport=[],void(e.entity.FromAirportIATA=null);e.entity.FromAirportIATA=t.selectedItem.IATA,e.loadingVisible=!0,i.getRouteDestination(Config.AirlineId,t.selectedItem.Id).then(function(t){e.loadingVisible=!1,e.ds_toairport=t,e.tempToAirport&&(e.entity.ToAirport=e.tempToAirport,e.tempToAirport=null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.FromAirport",selectedItem:"selectedFromAirport"}},e.ds_toairport=[],e.sb_ToAirport={showClearButton:!0,searchEnabled:!0,itemTemplate:function(e){return l.getSbTemplateRouteTo(e)},onSelectionChanged:function(t){t.selectedItem?(e.entity.RouteId=t.selectedItem.Id,e.entity.FlightH=t.selectedItem.FlightH,e.entity.FlightM=t.selectedItem.FlightM,e.entity.ToAirportIATA=t.selectedItem.ToAirportIATA):(e.entity.RouteId=null,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.ToAirportIATA=null),e.setArrival()},searchExpr:["ToAirportIATA","ToCity"],displayExpr:"ToAirportIATA",valueExpr:"ToAirportId",bindingOptions:{value:"entity.ToAirport",selectedItem:"selectedRoute",dataSource:"ds_toairport"}},e.selectedRoute=null,e.sb_route={showClearButton:!0,searchEnabled:!0,dataSource:l.getDatasourceRoutes(Config.AirlineId),itemTemplate:function(e){return l.getSbTemplateRoute(e)},onSelectionChanged:function(t){t.selectedItem?(e.entity.FromAirport=t.selectedItem.FromAirportId,e.entity.ToAirport=t.selectedItem.ToAirportId,e.entity.FlightH=t.selectedItem.FlightH,e.entity.FlightM=t.selectedItem.FlightM):(e.entity.FromAirport=null,e.entity.ToAirport=null,e.entity.FlightH=null,e.entity.FlightM=null),e.setArrival()},searchExpr:["FromAirportIATA","FromCity"],displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.RouteId",selectedItem:"selectedRoute"}},e.start=null,e.time_start={type:"time",width:"100%",interval:15,onValueChanged:function(t){if(t.value){var i=new Date(t.value),n=i.getHours(),a=i.getMinutes(),o=n+":"+a+":00",l=e.Day1+" "+o,r=new Date(l);e.entity.STD=r}else e.entity.STD=null;e.setArrival()},bindingOptions:{value:"start"}},e.time_end={readOnly:!0,type:"time",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entity.STA"}},e.text_flighth={min:0,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.FlightH"}},e.text_flightm={min:0,max:59,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.FlightM"}},e.text_unknown={bindingOptions:{value:"entity.Unknown",disabled:"unknown_readOnly"}},e.text_flightnumber={bindingOptions:{value:"entity.FlightNumber"}},e.scroll_height=200,e.dg_height=200,e.dg_height2=200,e.scroll_main={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.deleted=[],e.pop_width=900,e.pop_height=600,e.popup_add_visible=!1,e.popup_add_title="New",e.apply=!1,e.gaps="Gaps: 0",e.overlaps="Overlaps: 0",e.gapoverlaps="Gap & Overlaps: 0",e.gapsn=0,e.overlapsn=0,e.gapoverlapsn=0,e.popup_add={fullScreen:!0,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"default",text:"",width:40,icon:"plus",onClick:function(t){e.IsNew=!0,e.popup_item_visible=!0,e.popup_item_title="Add"}}},{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"default",text:"",width:40,icon:"edit",onClick:function(t){if(e.dg_selected=l.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.copy(e.dg_selected,e.entity),e.start=new Date(e.entity.STD),e.tempToAirport=e.entity.ToAirport,e.IsNew=!1,e.popup_item_title="Update",e.popup_item_visible=!0}}},{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"danger",text:"",width:40,icon:"remove",onClick:function(t){if(e.dg_selected=l.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected.RegisterID;e.deleted.push(e.dg_selected.Id);var n=Enumerable.From(e.dg_ds).Where("$.Id!="+e.dg_selected.Id).ToArray();console.log(e.dg_ds.length),e.dg_ds=n,Flight.findGapsgrid(e.dg_ds),
Flight.findOverlapsgrid(e.dg_ds,i),e.dg_instance.refresh(),e.getErrors()}}},{widget:"dxTextBox",location:"after",options:{width:70,readOnly:!0,bindingOptions:{value:"gaps"}},toolbar:"bottom"},{widget:"dxTextBox",location:"after",options:{width:100,readOnly:!0,bindingOptions:{value:"overlaps"}},toolbar:"bottom"},{widget:"dxTextBox",location:"after",options:{width:130,readOnly:!0,bindingOptions:{value:"gapoverlaps"}},toolbar:"bottom"},{widget:"dxCheckBox",location:"after",options:{visible:!1,width:100,text:"Apply",onValueChanged:function(t){e.apply=t.value}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",onClick:function(t){if(1==e.apply&&(e.gapsn>0||e.overlapsn>0))return void General.ShowNotify(Config.Text_GanttErrors,"error");var n=Enumerable.From(e.dg_ds).ToArray(),a=[];$.each(n,function(t,i){a.push({Id:i.Id,FlightPlanId:e.planId,TypeId:i.TypeId,RegisterID:i.RegisterID,FlightTypeID:i.FlightTypeID,AirlineOperatorsID:i.AirlineOperatorsID,FlightNumber:i.FlightNumber,FromAirport:i.FromAirport,ToAirport:i.ToAirport,STD:new Date(i.STD).toUTCString(),STA:new Date(i.STA).toUTCString(),FlightH:i.FlightH,FlightM:i.FlightM,StatusId:i.status})});var o={};o.Plan=e.plan,o.Items=a,o.Deleted=e.deleted,o.Apply=e.apply,console.log(o),e.loadingVisible=!0,i.savePlanItems(o).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success");var i=Enumerable.From(e.dg_ds).ToArray();$.each(i,function(e,i){if(i.Id>=1e6){var n=Enumerable.From(t).Where("$.InitId=="+i.Id).FirstOrDefault();i.Id=n.Id}}),e.dg_ds=i,e.loadingVisible=!1,l.$broadcast("onFlightPlanItemsSaved",null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_add_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.bind(e.planId)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,l.$broadcast("onFlightDesignHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title","toolbarItems[0].visible":"IsEditView","toolbarItems[1].visible":"IsEditView","toolbarItems[2].visible":"IsEditView","toolbarItems[3].visible":"IsEditView","toolbarItems[4].visible":"IsEditView","toolbarItems[5].visible":"IsEditView","toolbarItems[6].visible":"IsEditView","toolbarItems[7].visible":"IsEditView"}},e.detailType="gantt",e.copy=function(e,t){t.Id=e.Id,t.taskID=e.taskID,t.FlightPlanId=e.FlightPlanId,t.TypeId=e.TypeId,t.RegisterID=e.RegisterID,t.FlightTypeID=e.FlightTypeID,t.AirlineOperatorsID=e.AirlineOperatorsID,t.FlightNumber=e.FlightNumber,t.FromAirport=e.FromAirport,t.ToAirport=e.ToAirport,t.STA=e.STA,t.STD=e.STD,t.FlightH=e.FlightH,t.FlightM=e.FlightM,t.Unknown=e.Unknown,t.FlightPlan=e.FlightPlan,t.CustomerId=e.CustomerId,t.IsActive=e.IsActive,t.DateActive=e.DateActive,t.DateFrom=e.DateFrom,t.DateTo=e.DateTo,t.Customer=e.Customer,t.FromAirportName=e.FromAirportName,t.FromAirportIATA=e.FromAirportIATA,t.from=e.from,t.FromAirportCityId=e.FromAirportCityId,t.ToAirportName=e.ToAirportName,t.ToAirportIATA=e.ToAirportIATA,t.to=e.to,t.ToAirportCityId=e.ToAirportCityId,t.notes=e.notes,t.status=e.status,t.progress=e.progress,t.duration=e.duration,t.startDate=e.startDate,t.taskName=e.taskName,t.FromAirportCity=e.FromAirportCity,t.ToAirportCity=e.ToAirportCity,t.MSN=e.MSN,t.Register=e.Register,t.AircraftType=e.AircraftType,t.FlightStatus=e.FlightStatus,t.isnew=e.isnew},e.IsNew=!0,e.tempFlight=null,e.addFlight=function(t){1==e.IsNew?(t.taskId=e.taskIndex,t.Id=t.taskId,e.taskIndex=e.taskIndex+1):t.taskId=t.Id,e.IsNew?(t.isnew=!0,t.status=1,t.initStatus=[1]):t.isnew;var i=$("#resourceGantt").data("ejGantt");e.tempFlight=null;var n=JSON.parse(JSON.stringify(t));if(n.startDate=new Date(t.startDate),n.endDate=new Date(t.endDate),Flight.processData(n),e.IsNew)console.log("add"),console.log(vmins.datasource().length),i.addRecord(n,0),vmins.datasource().push(n),console.log(vmins.datasource().length),Flight.findGaps(vmins.datasource(),vmins.resources()),Flight.findOverlaps(vmins.datasource(),t.RegisterID),e.refreshEntity();else{var a=Enumerable.From(vmins.datasource()).Where("$.taskId=="+t.taskId).FirstOrDefault();e.copy(n,a),i.updateRecordByTaskId(n),Flight.findGaps(vmins.datasource(),vmins.resources()),Flight.findOverlaps(vmins.datasource(),t.RegisterID),e.popup_item_visible=!1}e.getErrors(),i.reRenderChart()},e.popup_item_visible=!1,e.popup_item_title="Add",e.popup_item={fullScreen:!1,showTitle:!0,height:480,width:600,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplanitemgrid",onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");if(!e.entity.RegisterID&&!e.entity.Unknown)return void General.ShowNotify(Config.Text_FillRequired,"error");if(0==e.entity.FlightH&&0==e.entity.FlightM)return void General.ShowNotify(Config.Text_FillRequired,"error");if(e.IsNew){var i={};e.copy(e.entity,i),i.Id=e.taskIndex,e.taskIndex=e.taskIndex+1,i.isnew=!0,i.status=1,i.initStatus=[1],i.FlightStatus=Flight.getStatus(i.status).title,e.dg_ds.push(i),e.refreshEntity()}else e.copy(e.entity,e.dg_selected),e.dg_selected.isnew;Flight.findGapsgrid(e.dg_ds),Flight.findOverlapsgrid(e.dg_ds,e.entity.RegisterID),e.dg_instance.refresh(),e.getErrors(),e.IsNew||(e.popup_item_visible=!1)}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_item_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!0,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.clearEntity(),e.popup_expose_visible=!1},bindingOptions:{visible:"popup_item_visible",title:"popup_item_title"}},e.applied=!1,e.aircraftTypes=null,e.msns=null,e.getErrors=function(){e.gapsn=Enumerable.From(e.dg_ds).Where("$.status==11").ToArray().length,e.gaps="Gaps: "+e.gapsn,e.overlapsn=Enumerable.From(e.dg_ds).Where("$.status==10").ToArray().length,e.overlaps="Overlaps: "+e.overlapsn,e.gapoverlapsn=Enumerable.From(e.dg_ds).Where("$.status==16").ToArray().length,e.gapoverlaps="Gap & Overlaps: "+e.gapoverlapsn},e.bind=function(t){var n=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0,i.getFlightPlanItems(t,n).then(function(t){e.loadingVisible=!1,$.each(t,function(t,i){i.STA=new Date(i.STA).addMinutes(e.offset),i.STD=new Date(i.STD).addMinutes(e.offset),i.initStatus=[1],1!=i.status&&i.initStatus.push(i.status)}),e.dg_ds=t,e.getErrors()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.offset=-1*(new Date).getTimezoneOffset(),e.dg_selected=null,e.dg_columns=[{visible:e.IsEditView,dataField:"status",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){12==t.value&&$("<div>").append("<i style='font-size:22px;color:#2196F3' class='icon ion-md-add-circle'></i>").appendTo(e),13==t.value&&$("<div>").append("<i style='font-size:22px;color:#4CAF50' class='icon ion-md-create'></i>").appendTo(e),10==t.value&&$("<div>").append("<i style='font-size:22px;color:#f44336' class='icon ion-md-shuffle'></i>").appendTo(e),11==t.value&&$("<div>").append("<i style='font-size:22px;color:#ff5722' class='icon ion-md-code-working'></i>").appendTo(e),16==t.value&&$("<div>").append("<i style='font-size:22px;color:#f44336' class='icon ion-md-shuffle'></i><i style='font-size:22px;color:#ff5722' class='icon ion-md-code-working'></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:180},{dataField:"AircraftType",caption:"AC Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,groupIndex:0},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,groupIndex:1},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:150,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:150,format:"HH:mm"},{dataField:"FlightH",caption:"Hour(s)",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightM",caption:"Minute(s)",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FlightStatus",caption:"Status",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"right"}],e.dg_height=100,e.dg_instance=null,e.dg_ds=null,e.dg={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},height:"100%",bindingOptions:{dataSource:"dg_ds"}},e.tempData=null,e.plan=null,e.planId=null,e.$on("InitFlightDesignGrid",function(t,i){e.plan=i,e.planId=i.Id,e.entity.FlightPlanId=e.planId,e.taskIndex=1e6,e.tempData=null,e.popup_add_title="Plan Items",e.popup_add_visible=!0}),e.IsReadonly=!1,e.IsEditView=!0,e.$on("InitFlightDesignGridView",function(t,i){e.IsReadonly=!0,e.IsEditView=!1,e.plan=i,e.planId=i.Id,e.entity.FlightPlanId=e.planId,e.taskIndex=1e6,e.tempData=null,e.popup_add_title="Plan Items",e.dg_columns[0].visible=!1,e.dg_columns[e.dg_columns.length-1].visible=!1,e.popup_add_visible=!0})}]),app.controller("flightReportSecurityController",["$scope","$location","$routeParams","$rootScope","flightService","weatherService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,r,d,s){function c(e){var t=e.html(),i=$("<iframe />");i[0].name="frame1",i.css({position:"absolute",top:"-1000000px"}),$("body").append(i);var n=i[0].contentWindow?i[0].contentWindow:i[0].contentDocument.document?i[0].contentDocument.document:i[0].contentDocument;n.document.open(),n.document.write("<html><head><title></title>"),n.document.write("</head><body>"),n.document.write('<link href="content/css/bootstrap.css" rel="stylesheet" />'),n.document.write('<link href="content/css/main.css" rel="stylesheet" />'),n.document.write(t),n.document.write("</body></html>"),n.document.close(),setTimeout(function(){window.frames.frame1.focus(),window.frames.frame1.print(),i.remove()},500)}e.prms=i.prms,e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,airportService.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(e){var t={Id:null};n.$broadcast("InitAddPerson",t)}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitAddPerson",i)}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;e.InitAddAirport(i)}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,validationGroup:"frssearch",bindingOptions:{},onClick:function(t){if(!t.validationGroup.validate().isValid)return void General.ShowNotify(Config.Text_FillRequired,"error");e.dg_ds=null,e.$broadcast("getFilterQuery",null)}},e.IsRemarkVisible=!1,e.IsISCCMVisible=!1,e.IsSCCM2Visible=!1,e.IsIPVisible=!1,e.cabinSpan=3,e.cockpitSpan=2,e.buildTable=function(){e.cabinSpan=3,e.cockpitSpan=2,e.IsISCCMVisible||e.cabinSpan--,e.IsIPVisible||e.cockpitSpan--,$("#tb-container").empty();var t='<table style="width:100%;margin-left:5px;margin-top:20px;" class="jl-table"><thead><tr style="background-color:rgba(255,230,153,1) !important;"><th rowspan="2">Airline</th><th rowspan="2">Date</th>  <th rowspan="2">Flight No</th>  <th colspan="2">Route</th>  <th colspan="2">Local</th> <th colspan="2">UTC</th>  <th colspan="2">Aircraft</th> <th colspan="'+e.cockpitSpan+'">Cockpit</th><th colspan="'+e.cabinSpan+'">Cabin</th>'+(e.IsRemarkVisible?' <th   rowspan="2" class="col-remark">Remark</th>':"")+'</tr><tr style="background-color:rgba(255,230,153,1) !important;">    <th>From</th>    <th>To</th>    <th>Dep.</th>    <th>Arr.</th>    <th>Dep.</th>    <th>Arr.</th>    <th>Type</th>    <th>Reg</th>'+(e.IsIPVisible?"    <th  >IP</th>":"")+"    <th>CPT</th>"+(e.IsISCCMVisible?'    <th  class="col-isccm">ISCCM</th>':"")+'    <th>SCCM1</th>    <th   class="col-sccm2">SCCM2</th></tr></thead><tbody>';$.each(e.rows,function(i,n){t+="<tr><td>"+n.Airline+"</td><td>"+n.STDDay+"</td><td>"+n.FlightNumber+"</td><td>"+n.FromAirportIATA+"</td><td>"+n.ToAirportIATA+"</td><td>"+n.DepartureLocal2+"</td><td>"+n.ArrivalLocal2+"</td><td>"+n.STD2+"</td><td>"+n.STA2+"</td><td>"+n.AircraftType+"</td><td>"+n.Register+"</td>"+(e.IsIPVisible?"<td >"+(n.IP?n.IP:"")+"</td>":"")+"<td>"+(n.CPT?n.CPT:"")+"</td>"+(e.IsISCCMVisible?'<td  class="col-isccm">'+(n.ISCCM?n.ISCCM:"")+"</td>":"")+"<td>"+(n.Purser?n.Purser:"")+'</td><td  class="col-sccm2">'+(n.Purser2?n.Purser2:"")+"</td>"+(e.IsRemarkVisible?'<td  class="col-remark">'+(n.Remark?n.Remark:"")+"</td>":"")+"</tr>"}),t+="</tbody></table>",$("#tb-container").html(t)},e.rows=[],e.btn_print={text:"Print",type:"default",icon:"print",width:130,onClick:function(t){if(e.dg_instance.getDataSource()){e.rows=Enumerable.From(e.dg_instance.getDataSource()._items).ToArray(),$.each(e.rows,function(e,t){t.DepartureLocal2=moment(new Date(t.DepartureLocal)).format("HH:mm"),t.ArrivalLocal2=moment(new Date(t.ArrivalLocal)).format("HH:mm"),t.STD2=moment(new Date(t.STD)).format("HH:mm"),t.STA2=moment(new Date(t.STA)).format("HH:mm")});var i=Enumerable.From(e.rows).Where("$.Remark").FirstOrDefault();e.IsRemarkVisible=i,e.IsISCCMVisible=Enumerable.From(e.rows).Where("$.ISCCM").FirstOrDefault(),e.IsSCCM2Visible=Enumerable.From(e.rows).Where("$.Purser2").FirstOrDefault(),e.IsIPVisible=Enumerable.From(e.rows).Where("$.IP").FirstOrDefault()}e.popup_sec_visible=!0}},e.selected_employee_id=null,e.btn_flight={text:"Flights",type:"default",icon:"airplane",width:120,bindingOptions:{},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");e.selected_employee_id=e.dg_selected.Id,e.fillPerson(e.dg_selected),e.doSearch=!1,e.popup_flight_visible=!0}},e.btn_person={text:"Details",type:"default",icon:"card",width:120,bindingOptions:{},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),!e.dg_selected)return void General.ShowNotify(Config.Text_NoRowSelected,"error");var i=e.dg_selected;n.$broadcast("InitViewPerson",i)}},e.btn_flight_total={text:"Flights(Total)",type:"default",icon:"datafield",width:180,bindingOptions:{},onClick:function(t){e.popup_flight_total_visible=!0}},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dt_from=new Date,e.dt_to=(new Date).addDays(0),e.date_from={type:"date",placeholder:"From",width:"100%",bindingOptions:{value:"dt_from"}},e.date_to={type:"date",placeholder:"To",width:"100%",bindingOptions:{value:"dt_to"}},e.filters=[],e.dg_columns=[{dataField:"Airline",caption:"Airline",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"STDDay",caption:"Date",allowResizing:!0,dataType:"string",allowEditing:!1,alignment:"center",sortIndex:0,sortOrder:"asc",width:100},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:70},{caption:"Route",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1}]},{caption:"Local",columns:[{dataField:"DepartureLocal",caption:"Dep.",allowResizing:!0,dataType:"datetime",allowEditing:!1,alignment:"center",format:"HH:mm"},{dataField:"ArrivalLocal",caption:"Arr.",allowResizing:!0,dataType:"datetime",allowEditing:!1,alignment:"center",format:"HH:mm"}]},{caption:"UTC",columns:[{dataField:"STD",caption:"Dep.",allowResizing:!0,dataType:"datetime",allowEditing:!1,alignment:"center",format:"HH:mm",sortIndex:2,sortOrder:"asc"},{dataField:"STA",caption:"Arr.",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,format:"HH:mm"}]},{caption:"Aircraft",columns:[{dataField:"AircraftType",caption:"Type",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"Register",caption:"Reg",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,sortIndex:1,sortOrder:"asc"}]},{caption:"Cockpit",columns:[{dataField:"IP",caption:"IP",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"CPT",caption:"CPT",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1}]},{caption:"Cabin",columns:[{dataField:"ISCCM",caption:"ISCCM",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"Purser",caption:"SCCM1",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1},{dataField:"Purser2",caption:"SCCM2",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1}]},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!0,width:200}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",wordWrapEnabled:!0,allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!0,height:$(window).height()-135,editing:{allowUpdating:!0,mode:"cell"},columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},export:{enabled:!0,fileName:"FlightReport-Security",allowExportSelectedData:!1,excelWrapTextEnabled:!0},bindingOptions:{dataSource:"dg_ds"}},e.scroll_sec_height=200,e.scroll_sec={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_sec_height"}},e.popup_sec_visible=!1,e.popup_sec_title="Security Report",e.popup_sec={shading:!0,width:1150,height:function(){return 1*$(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Print",icon:"print",bindingOptions:{disabled:"IsApproved"},onClick:function(t){e.IsRemarkVisible?$(".col-remark").removeClass("noprint"):$(".col-remark").addClass("noprint"),e.IsISCCMVisible?$(".col-isccm").removeClass("noprint"):$(".col-isccm").addClass("noprint"),e.IsSCCM2Visible?$(".col-sccm2").removeClass("noprint"):$(".col-sccm2").addClass("noprint"),c($("#sec"))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_sec_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(t){e.scroll_sec_height=$(window).height()-10-110},onShown:function(t){e.buildTable()},onHiding:function(){e.popup_sec_visible=!1},bindingOptions:{visible:"popup_sec_visible",title:"popup_sec_title"}},e.dg_flight_columns=[{dataField:"Date",caption:"Date",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"yyyy-MMM-dd"},{dataField:"FlightNumber",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!1,fixedPosition:"left"},{dataField:"Position",caption:"Position",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{caption:"Route",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70}]},{caption:"Departure",columns:[{dataField:"STD",caption:"STD",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"}]},{caption:"Arrival",columns:[{dataField:"STA",caption:"STA",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:90,format:"HH:mm"}]},{caption:"Times",fixed:!0,fixedPosition:"right",columns:[{dataField:"FlightTime2",caption:"Flight Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"BlockTime",caption:"Block Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100}]}],e.dg_flight_selected=null,e.dg_flight_instance=null,e.dg_flight_ds=null,e.dg_flight={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-235,columns:e.dg_flight_columns,onContentReady:function(t){e.dg_flight_instance||(e.dg_flight_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_flight_selected=i||null},summary:{totalItems:[{name:"FlightTimeTotal",showInColumn:"FlightTime2",displayFormat:"{0}",summaryType:"custom"},{name:"BlockTimeTotal",showInColumn:"BlockTime",displayFormat:"{0}",summaryType:"custom"},{name:"DutyTotal",showInColumn:"Duty",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"FlightTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.FlightH+e.value.FlightM,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"BlockTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.ActualFlightHOffBlock+e.value.ActualFlightMOffBlock,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"DutyTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.Duty,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_flight_ds"}},e.dg_flight_total_columns=[{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",width:150,allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"PID",caption:"PID",allowResizing:!0,alignment:"center",dataType:"string",width:150,allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"FirstName",caption:"First Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!1,fixedPosition:"left"},{dataField:"LastName",caption:"Last Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"FlightsCount",caption:"Legs",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FlightTime2",caption:"Flight Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"BlockTime",caption:"Block Time",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"Duty2",caption:"Duty",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100}],e.dg_flight_total_selected=null,e.dg_flight_total_instance=null,e.dg_flight_total_ds=null,e.dg_flight_total={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_flight_total_columns,onContentReady:function(t){e.dg_flight_total_instance||(e.dg_flight_total_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_flight_total_selected=i||null},summary:{totalItems:[{name:"FlightTimeTotal",showInColumn:"FlightTime2",displayFormat:"{0}",summaryType:"custom"},{name:"BlockTimeTotal",showInColumn:"BlockTime",displayFormat:"{0}",summaryType:"custom"},{name:"DutyTotal",showInColumn:"Duty",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"FlightTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.FlightH+e.value.FlightM,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"BlockTimeTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+60*e.value.BlockH+e.value.BlockM,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString())),"DutyTotal"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.Duty,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_flight_total_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.jgroup="Cockpit",e.sb_group={showClearButton:!1,searchEnabled:!0,dataSource:["Cockpit","Cabin"],bindingOptions:{value:"jgroup"}},e.bind=function(){var t=moment(e.dt_to).format("YYYY-MM-DDTHH:mm:ss"),i=moment(e.dt_from).format("YYYY-MM-DDTHH:mm:ss");e.loadingVisible=!0,a.getSecurityRoster(i,t).then(function(t){e.loadingVisible=!1,$.each(t,function(e,t){t.Remark="",t.Airline="FlyPersia";var i=new Date(t.STDDay);persianDate.toLocale("en"),t.STDDay=new persianDate(i).format("DD-MM-YYYY")}),e.dg_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e._bind=function(){var t=moment(e.dt_to).format("YYYY-MM-DDTHH:mm:ss"),i=moment(e.dt_from).format("YYYY-MM-DDTHH:mm:ss"),a="odata/flight/report/security?dt="+t+"&df="+i;e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+a,key:"ID",version:4,onLoaded:function(e){$.each(e,function(e,t){t.Airline="FlyPersia";var i=new Date(t.STDDay);persianDate.toLocale("en"),t.STDDay=new persianDate(i).format("DD-MM-YYYY")}),n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}}}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.getCrewFlights=function(t,i,n){var o=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0,a.getCrewFlights(t,i,n).then(function(t){console.log(t),e.loadingVisible=!1,$.each(t,function(e,t){t.STA=new Date(t.STA).addMinutes(o),t.STD=new Date(t.STD).addMinutes(o),t.ChocksIn&&(t.ChocksIn=new Date(t.ChocksIn).addMinutes(o)),t.ChocksOut&&(t.ChocksOut=new Date(t.ChocksOut).addMinutes(o)),t.Takeoff&&(t.Takeoff=new Date(t.Takeoff).addMinutes(o)),t.Landing&&(t.Landing=new Date(t.Landing).addMinutes(o)),t.DurationH=Math.floor(t.FlightTime/60),t.DurationM=t.FlightTime%60;var i=60*t.FlightH+t.FlightM;t.FlightTime2=pad(Math.floor(i/60)).toString()+":"+pad(i%60).toString();var n=60*t.ActualFlightHOffBlock+t.ActualFlightMOffBlock;t.BlockTime=pad(Math.floor(n/60)).toString()+":"+pad(n%60).toString(),t.Duty2=pad(Math.floor(t.Duty/60)).toString()+":"+pad(t.Duty%60).toString()}),e.dg_flight_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrewFlightsTotal=function(t,i){e.loadingVisible=!0,a.getCrewFlightsTotal(t,i).then(function(t){e.loadingVisible=!1,$.each(t,function(e,t){t.DurationH=Math.floor(t.FlightTime/60),t.DurationM=t.FlightTime%60;var i=60*t.FlightH+t.FlightM;t.FlightTime2=pad(Math.floor(i/60)).toString()+":"+pad(i%60).toString(),t.Duty2=pad(Math.floor(t.Duty/60)).toString()+":"+pad(t.Duty%60).toString();var n=60*t.BlockH+t.BlockM;t.BlockTime=pad(Math.floor(n/60)).toString()+":"+pad(n%60).toString()}),e.dg_flight_total_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.popup_flight_df=null,e.popup_flight_df_instance=null,e.popup_flight_dt=null,e.popup_flight_dt_instance=null,e.popup_flight_visible=!1,e.popup_flight_title="Flights",e.popup_flight_total_df=null,e.popup_flight_total_dt=null,e.popup_flight_total_visible=!1,e.popup_flight_total_title="Flights (Total)",e.doSearch=!1,r.isAuthorized()?(n.page_title="> Flights",$(".flightreportsecurity").fadeIn()):r.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onPersonSaved",function(t,i){e.doRefresh=!0}),e.$on("onPersonHide",function(t,i){e.bind()}),n.$broadcast("PersonLoaded",null)}]),app.controller("appsController",["$scope","$location","authService","ngAuthSettings","$rootScope",function(e,t,i,n,a){if(a.IsOnlyFlightView())return i.setModule(3),void a.navigate("/flight/board","flight_board");$(".apps").fadeIn(),e.logOut=function(){i.logOut()},e.userName=i.authentication.userName,e.link4="",e.link3="",e.go=function(e){var t=!1;switch(e){case 1:t=a.HasAccessToBasePocket();break;case 2:t=a.HasAccessToLearningPocket();break;case 3:t=a.HasAccessToFlightPocket()}
t&&(i.setModule(Number(e)),a.navigatehome())}}]);