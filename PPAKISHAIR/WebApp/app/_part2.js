"use strict";app.controller("optionController",["$scope","$location","$routeParams","$rootScope","generalService","authService","$route",function(e,t,i,n,a,o,l){e.prms=i.prms,e._parent=i.parent,e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.deleteOption(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(t){var i={Id:null,ParentId:e._parent};n.$broadcast("InitAddOption",i)}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;n.$broadcast("InitAddOption",i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.dg_columns=[{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,sortIndex:1,sortOrder:"asc"},{dataField:"People",caption:"People",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:200}],e.dg_height=100,e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},height:"100%",bindingOptions:{dataSource:"dg_ds"}};var d="odata/options/"+e._parent;if(n.page_title="Enums",o.isAuthorized()){switch(e._parent){case"36":n.page_title="> Posts",d="odata/base/posts/"+Config.CustomerId;break;case"59":n.page_title="> Fileds of Study",d="odata/base/studyfields/"+Config.CustomerId}$(".option").fadeIn()}else o.redirectToLogin();e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){var t=d;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Title",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_instance.refresh(),e.doRefresh=!1)},e.applicableEmployees=[],e.bindEmployees=function(){e.loadingVisible=!0,libraryService.getBookApplicableEmployees(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,console.log(t),e.applicableEmployees=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onOptionSaved",function(t,i){e.doRefresh=!0}),e.$on("onOptionHide",function(t,i){e.bind()}),n.$broadcast("OptionLoaded",null)}]),app.controller("jobgroupSelectController",["$scope","$location","authService","$routeParams","$rootScope",function(e,t,i,n,a){e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_columns=[{dataField:"TitleFormated",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,encodeHtml:!1},{dataField:"FullCode",caption:"Code",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,encodeHtml:!1,width:200,sortIndex:0,sortOrder:"asc"}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"multiple"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData;e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.dg_height=100,e.pop_width=800,e.pop_height=500,e.popup_add_visible=!1,e.popup_add_title="Groups",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Ok",icon:"check",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=a.getWindowSize();i.width<=800&&(e.pop_width=i.width,e.pop_height=i.height),e.dg_height=e.pop_height-100},onShown:function(t){e.bind()},onHiding:function(){e.popup_add_visible=!1},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){e.dg_selected?(a.$broadcast("onJobGroupSelectHide",e.dg_selected),e.popup_add_visible=!1):General.ShowNotify(Config.Text_NoRowSelected,"error")},e.bind=function(){e.dg_ds?e.dg_instance.clearSelection():e.dg_ds={store:{type:"odata",url:a.serviceUrl+"odata/base/jobgroups/"+Config.CustomerId,key:"Id",version:4}}},e.$on("InitJobGroupSelect",function(t,i){e.popup_add_visible=!0})}]),app.controller("personViewController",["$scope","$location","personService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.entity={Id:null,PersonId:null,DateJoinCompany:null,DateJoinCompanyP:null,IsActive:1,DateRegisterP:-1,DateConfirmedP:null,DateRegister:null,DateConfirmed:null,IsDeleted:0,DateActiveStart:null,DateActiveEnd:null,DateLastLoginP:null,DateLastLogin:null,Username:null,Password:null,PID:null,Phone:null,GroupId:null,CustomerId:Config.CustomerId,Person:{PersonId:null,DateCreate:null,MarriageId:null,NID:null,SexId:null,FirstName:null,LastName:null,DateBirth:null,Email:null,EmailPassword:null,Phone1:null,Phone2:null,Mobile:null,FaxTelNumber:null,PassportNumber:null,DatePassportIssue:null,DatePassportExpire:null,Address:null,IsActive:1,DateJoinAvation:null,DateLastCheckUP:null,DateNextCheckUP:null,DateYearOfExperience:null,CaoCardNumber:null,DateCaoCardIssue:null,DateCaoCardExpire:null,CompetencyNo:null,CaoInterval:null,CaoIntervalCalanderTypeId:null,IsDeleted:0,Remark:null,StampNumber:null,StampUrl:null,TechLogNo:null,DateIssueNDT:null,IntervalNDT:null,NDTNumber:null,NDTIntervalCalanderTypeId:null,IsAuditor:null,IsAuditee:null,Nickname:null,CityId:null,FatherName:null,IDNo:null,RowId:null,UserId:null,ImageUrl:null,CustomerCreatorId:null,DateExpireNDT:null,ProficiencyExpireDate:null,CrewMemberCertificateExpireDate:null,LicenceExpireDate:null,SimulatorLastCheck:null,SimulatorNextCheck:null,RampPassNo:null,RampPassExpireDate:null,LanguageCourseExpireDate:null,LicenceTitle:null,LicenceInitialIssue:null,RaitingCertificates:null,LicenceIssueDate:null,LicenceDescription:null,ProficiencyCheckType:null,ProficiencyCheckDate:null,ProficiencyValidUntil:null,ICAOLPRLevel:null,ICAOLPRValidUntil:null,MedicalClass:null,CMCEmployedBy:null,CMCOccupation:null,PostalCode:null,ProficiencyIPC:null,ProficiencyOPC:null,Educations:[],Expreienses:[],AircraftTypes:[],Documents:[],Ratings:[]},Locations:[{Id:-1,EmployeeId:-1,LocationId:null,IsMainLocation:1,OrgRoleId:null,DateActiveStartP:null,DateActiveEndP:null,DateActiveStart:null,DateActiveEnd:null,Remark:null,Phone:null,OrgRole:null,Title:null,FullCode:null}]},e.entityFile={Id:null,DocumentTypeId:null,FileTypeId:null,FileUrl:null,Title:null,ParentId:null},e.entityDocument={PersonId:-1,Title:null,Remark:null,DocumentTypeId:null,Id:null,DocumentType:null,Documents:[]},e.entityEducation={Id:null,PersonId:-1,EducationDegreeId:null,DateCatch:null,College:null,Remark:null,Title:null,StudyFieldId:null,StudyField:null,EducationDegree:null},e.entityExp={PersonId:-1,OrganizationId:null,Employer:null,AircraftTypeId:null,Remark:null,DateStart:null,DateEnd:null,Organization:null,JobTitle:null,AircraftType:null,Id:null},e.entityRating={Id:null,PersonId:-1,AircraftTypeId:null,RatingId:null,DateIssue:null,DateExpire:null,CategoryId:null,AircraftType:null,RatingOrganization:null,OrganizationId:null,Category:null},e.entityAircrafttype={Id:null,AircraftTypeId:null,PersonId:-1,IsActive:1,DateLimitBegin:null,DateLimitEnd:null,Remark:null,Manufacturer:null,AircraftType:null},e.bindEntityAircrafttype=function(t){e.entityAircrafttype.Id=t.Id,e.entityAircrafttype.AircraftTypeId=t.AircraftTypeId,e.entityAircrafttype.PersonId=t.PersonId,e.entityAircrafttype.IsActive=t.IsActive,e.entityAircrafttype.DateLimitBegin=t.DateLimitBegin,e.entityAircrafttype.DateLimitEnd=t.DateLimitEnd,e.entityAircrafttype.Remark=t.Remark},e.bindEducation=function(t){e.entityEducation.Id=t.Id,e.entityEducation.PersonId=t.PersonId,e.entityEducation.EducationDegreeId=t.EducationDegreeId,e.entityEducation.DateCatch=t.DateCatch,e.entityEducation.College=t.College,e.entityEducation.Remark=t.Remark,e.entityEducation.Title=t.Title,e.entityEducation.StudyFieldId=t.StudyFieldId,e.entityEducation.StudyField=t.StudyField,e.entityEducation.EducationDegree=t.EducationDegree},e.bindDocumnet=function(t){e.entityDocument.PersonId=t.PersonId,e.entityDocument.Title=t.Title,e.entityDocument.Remark=t.Remark,e.entityDocument.DocumentTypeId=t.DocumentTypeId,e.entityDocument.Id=t.Id,e.entityDocument.DocumentType=t.DocumentType,e.entityDocument.Documents=t.Documents},e.bindExp=function(t){e.entityExp.PersonId=t.PersonId,e.entityExp.OrganizationId=t.OrganizationId,e.entityExp.Employer=t.Employer,e.entityExp.AircraftTypeId=t.AircraftTypeId,e.entityExp.Remark=t.Remark,e.entityExp.DateStart=t.DateStart,e.entityExp.DateEnd=t.DateEnd,e.entityExp.Organization=t.Organization,e.entityExp.JobTitle=t.JobTitle,e.entityExp.AircraftType=t.AircraftType,e.entityExp.Id=t.Id},e.bindRating=function(t){e.entityRating.Id=t.Id,e.entityRating.PersonId=t.PersonId,e.entityRating.AircraftTypeId=t.AircraftTypeId,e.entityRating.RatingId=t.RatingId,e.entityRating.DateIssue=t.DateIssue,e.entityRating.DateExpire=t.DateExpire,e.entityRating.CategoryId=t.CategoryId,e.entityRating.AircraftType=t.AircraftType,e.entityRating.RatingOrganization=t.RatingOrganization,e.entityRating.OrganizationId=t.OrganizationId,e.entityRating.Category=t.Category},e.clearEntityDocumnet=function(){e.entityDocument.PersonId=-1,e.entityDocument.Title=null,e.entityDocument.Remark=null,e.entityDocument.DocumentTypeId=null,e.entityDocument.Id=null,e.entityDocument.DocumentType=null,e.entityDocument.Documents=[],e.uploader_document_instance.reset()},e.clearEntity=function(){e.entity.Id=null,e.entity.PersonId=-1,e.entity.DateJoinCompany=null,e.entity.DateJoinCompanyP=null,e.entity.IsActive=1,e.entity.DateRegisterP=-1,e.entity.DateConfirmedP=null,e.entity.DateRegister=null,e.entity.DateConfirmed=null,e.entity.IsDeleted=0,e.entity.DateActiveStart=null,e.entity.DateActiveEnd=null,e.entity.DateLastLoginP=null,e.entity.DateLastLogin=null,e.entity.Username=null,e.entity.Password=null,e.entity.CustomerId=Config.CustomerId,e.entity.PID=null,e.entity.Phone=null,e.nid=null,e.entity.Person.DateCreate=null,e.entity.Person.MarriageId=null,e.entity.Person.NID=null,e.entity.Person.SexId=null,e.entity.Person.FirstName=null,e.entity.Person.LastName=null,e.entity.Person.DateBirth=null,e.entity.Person.Email=null,e.entity.Person.EmailPassword=null,e.entity.Person.Phone1=null,e.entity.Person.Phone2=null,e.entity.Person.Mobile=null,e.entity.Person.FaxTelNumber=null,e.entity.Person.PassportNumber=null,e.entity.Person.DatePassportIssue=null,e.entity.Person.DatePassportExpire=null,e.entity.Person.Address=null,e.entity.Person.IsActive=1,e.entity.Person.DateJoinAvation=null,e.entity.Person.DateLastCheckUP=null,e.entity.Person.DateNextCheckUP=null,e.entity.Person.DateYearOfExperience=null,e.entity.Person.CaoCardNumber=null,e.entity.Person.DateCaoCardIssue=null,e.entity.Person.DateCaoCardExpire=null,e.entity.Person.CompetencyNo=null,e.entity.Person.CaoInterval=null,e.entity.Person.CaoIntervalCalanderTypeId=null,e.entity.Person.IsDeleted=0,e.entity.Person.Remark=null,e.entity.Person.StampNumber=null,e.entity.Person.StampUrl=null,e.entity.Person.TechLogNo=null,e.entity.Person.DateIssueNDT=null,e.entity.Person.IntervalNDT=null,e.entity.Person.NDTNumber=null,e.entity.Person.NDTIntervalCalanderTypeId=null,e.entity.Person.IsAuditor=null,e.entity.Person.IsAuditee=null,e.entity.Person.Nickname=null,e.entity.Person.CityId=null,e.entity.Person.FatherName=null,e.entity.Person.IDNo=null,e.entity.Person.CustomerCreatorId=null,e.entity.Person.ImageUrl=null,e.entity.Person.UserId=null,e.entity.Person.DateExpireNDT=null,e.entity.Person.ProficiencyExpireDate=null,e.entity.Person.CrewMemberCertificateExpireDate=null,e.entity.Person.LicenceExpireDate=null,e.entity.Person.SimulatorLastCheck=null,e.entity.Person.SimulatorNextCheck=null,e.entity.Person.RampPassNo=null,e.entity.Person.RampPassExpireDate=null,e.entity.Person.LanguageCourseExpireDate=null,e.entity.Person.LicenceTitle=null,e.entity.Person.LicenceInitialIssue=null,e.entity.Person.RaitingCertificates=null,e.entity.Person.LicenceIssueDate=null,e.entity.Person.LicenceDescription=null,e.entity.Person.ProficiencyCheckType=null,e.entity.Person.ProficiencyCheckDate=null,e.entity.Person.ProficiencyValidUntil=null,e.entity.Person.ICAOLPRLevel=null,e.entity.Person.ICAOLPRValidUntil=null,e.entity.Person.MedicalClass=null,e.entity.Person.CMCEmployedBy=null,e.entity.Person.CMCOccupation=null,e.entity.Person.PostalCode=null,e.entity.Person.ProficiencyIPC=null,e.entity.Person.ProficiencyOPC=null,e.entity.Person.Educations=[],e.entity.Person.Expreienses=[],e.entity.Person.Certificates=[],e.entity.Person.Courses=[],e.entity.Person.AircraftTypes=[],e.entity.Person.Documents=[],e.entity.Person.Ratings=[],e.entity.Locations[0].Id=-1,e.entity.Locations[0].EmployeeId=-1,e.entity.Locations[0].LocationId=null,e.entity.Locations[0].IsMainLocation=1,e.entity.Locations[0].OrgRoleId=null,e.entity.Locations[0].DateActiveStartP=null,e.entity.Locations[0].DateActiveEndP=null,e.entity.Locations[0].DateActiveStart=null,e.entity.Locations[0].DateActiveEnd=null,e.entity.Locations[0].Remark=null,e.entity.Locations[0].Phone=null,e.entity.Locations[0].OrgRole=null,e.entity.Locations[0].Title=null,e.entity.Locations[0].FullCode=null,e.img_url="content/images/imguser.png"},e.clearEntityRating=function(){e.entityRating.Id=null,e.entityRating.PersonId=-1,e.entityRating.AircraftTypeId=null,e.entityRating.RatingId=null,e.entityRating.DateIssue=null,e.entityRating.DateExpire=null,e.entityRating.CategoryId=null,e.entityRating.AircraftType=null,e.entityRating.RatingOrganization=null,e.entityRating.OrganizationId=null,e.entityRating.Category=null},e.clearEntityEducation=function(){e.entityEducation.Id=null,e.entityEducation.PersonId=-1,e.entityEducation.EducationDegreeId=null,e.entityEducation.DateCatch=null,e.entityEducation.College=null,e.entityEducation.Remark=null,e.entityEducation.Title=null,e.entityEducation.StudyFieldId=null},e.clearEntityFile=function(){e.entityFile.Id=null,e.entityFile.DocumentTypeId=null,e.entityFile.FileTypeId=null,e.entityFile.FileUrl=null,e.entityFile.Title=null,e.entityFile.ParentId=null},e.clearEntityExp=function(){e.entityExp.PersonId=-1,e.entityExp.OrganizationId=null,e.entityExp.Employer=null,e.entityExp.AircraftTypeId=null,e.entityExp.Remark=null,e.entityExp.DateStart=null,e.entityExp.DateEnd=null,e.entityExp.Organization=null,e.entityExp.JobTitle=null,e.entityExp.AircraftType=null,e.entityExp.Id=null},e.clearEntityAircrafttype=function(){e.entityAircrafttype.Id=null,e.entityAircrafttype.AircraftTypeId=null,e.entityAircrafttype.PersonId=-1,e.entityAircrafttype.IsActive=1,e.entityAircrafttype.DateLimitBegin=null,e.entityAircrafttype.DateLimitEnd=null,e.entityAircrafttype.Remark=null,e.entityAircrafttype.AircraftType=null,e.entityAircrafttype.Manufacturer=null},e.clearEntityEducation=function(){e.entityEducation.Id=null,e.entityEducation.PersonId=-1,e.entityEducation.EducationDegreeId=null,e.entityEducation.DateCatch=null,e.entityEducation.College=null,e.entityEducation.Remark=null,e.entityEducation.Title=null,e.entityEducation.StudyFieldId=null,e.entityEducation.StudyField=null,e.entityEducation.EducationDegree=null},e.bindPerson=function(t){e.entity.Person.PersonId=t.PersonId,e.entity.Person.DateCreate=t.DateCreate,e.entity.Person.MarriageId=t.MarriageId,e.entity.Person.NID=t.NID,e.entity.Person.SexId=t.SexId,e.entity.Person.FirstName=t.FirstName,e.entity.Person.LastName=t.LastName,e.entity.Person.DateBirth=t.DateBirth,e.entity.Person.Email=t.Email,e.entity.Person.EmailPassword=t.EmailPassword,e.entity.Person.Phone1=t.Phone1,e.entity.Person.Phone2=t.Phone2,e.entity.Person.Mobile=t.Mobile,e.entity.Person.FaxTelNumber=t.FaxTelNumber,e.entity.Person.PassportNumber=t.PassportNumber,e.entity.Person.DatePassportIssue=t.DatePassportIssue,e.entity.Person.DatePassportExpire=t.DatePassportExpire,e.entity.Person.Address=t.Address,e.entity.Person.IsActive=t.IsActive,e.entity.Person.DateJoinAvation=t.DateJoinAvation,e.entity.Person.DateLastCheckUP=t.DateLastCheckUP,e.entity.Person.DateNextCheckUP=t.DateNextCheckUP,e.entity.Person.DateYearOfExperience=t.DateYearOfExperience,e.entity.Person.CaoCardNumber=t.CaoCardNumber,e.entity.Person.DateCaoCardIssue=t.DateCaoCardIssue,e.entity.Person.DateCaoCardExpire=t.DateCaoCardExpire,e.entity.Person.CompetencyNo=t.CompetencyNo,e.entity.Person.CaoInterval=t.CaoInterval,e.entity.Person.CaoIntervalCalanderTypeId=t.CaoIntervalCalanderTypeId,e.entity.Person.IsDeleted=t.IsDeleted,e.entity.Person.Remark=t.Remark,e.entity.Person.StampNumber=t.StampNumber,e.entity.Person.StampUrl=t.StampUrl,e.entity.Person.TechLogNo=t.TechLogNo,e.entity.Person.DateIssueNDT=t.DateIssueNDT,e.entity.Person.IntervalNDT=t.IntervalNDT,e.entity.Person.NDTNumber=t.NDTNumber,e.entity.Person.NDTIntervalCalanderTypeId=t.NDTIntervalCalanderTypeId,e.entity.Person.IsAuditor=t.IsAuditor,e.entity.Person.IsAuditee=t.IsAuditee,e.entity.Person.Nickname=t.Nickname,e.entity.Person.CityId=t.CityId,e.entity.Person.FatherName=t.FatherName,e.entity.Person.IDNo=t.IDNo,e.entity.Person.RowId=t.RowId,e.entity.Person.UserId=t.UserId,e.entity.Person.ImageUrl=t.ImageUrl,t.ImageUrl?e.img_url=o.clientsFilesUrl+t.ImageUrl:e.img_url="content/images/imguser.png",e.entity.Person.CustomerCreatorId=t.CustomerCreatorId,e.entity.Person.DateExpireNDT=t.DateExpireNDT,e.entity.Person.ProficiencyExpireDate=t.ProficiencyExpireDate,e.entity.Person.CrewMemberCertificateExpireDate=t.CrewMemberCertificateExpireDate,e.entity.Person.LicenceExpireDate=t.LicenceExpireDate,e.entity.Person.SimulatorLastCheck=t.SimulatorLastCheck,e.entity.Person.SimulatorNextCheck=t.SimulatorNextCheck,e.entity.Person.RampPassNo=t.RampPassNo,e.entity.Person.RampPassExpireDate=t.RampPassExpireDate,e.entity.Person.LanguageCourseExpireDate=t.LanguageCourseExpireDate,e.entity.Person.LicenceTitle=t.LicenceTitle,e.entity.Person.LicenceInitialIssue=t.LicenceInitialIssue,e.entity.Person.RaitingCertificates=t.RaitingCertificates,e.entity.Person.LicenceIssueDate=t.LicenceIssueDate,e.entity.Person.LicenceDescription=t.LicenceDescription,e.entity.Person.ProficiencyCheckType=t.ProficiencyCheckType,e.entity.Person.ProficiencyCheckDate=t.ProficiencyCheckDate,e.entity.Person.ProficiencyValidUntil=t.ProficiencyValidUntil,e.entity.Person.ICAOLPRLevel=t.ICAOLPRLevel,e.entity.Person.ICAOLPRValidUntil=t.ICAOLPRValidUntil,e.entity.Person.MedicalClass=t.MedicalClass,e.entity.Person.CMCEmployedBy=t.CMCEmployedBy,e.entity.Person.CMCOccupation=t.CMCOccupation,e.entity.Person.PostalCode=t.PostalCode,e.entity.Person.ProficiencyIPC=t.ProficiencyIPC,e.entity.Person.ProficiencyOPC=t.ProficiencyOPC,e.entity.Person.Educations=t.Educations,e.entity.Person.Expreienses=t.Expreienses,e.entity.Person.Certificates=t.Certificates,e.entity.Person.Courses=t.Courses,e.entity.Person.AircraftTypes=t.AircraftTypes,e.entity.Person.Documents=t.Documents,e.entity.Person.Ratings=t.Ratings},e.bindLocation=function(t){e.entity.Locations[0].Id=t.Id,e.entity.Locations[0].EmployeeId=t.EmployeeId,e.entity.Locations[0].LocationId=t.LocationId,e.entity.Locations[0].IsMainLocation=t.IsMainLocation,e.entity.Locations[0].OrgRoleId=t.OrgRoleId,e.entity.Locations[0].DateActiveStartP=t.DateActiveStartP,e.entity.Locations[0].DateActiveEndP=t.DateActiveEndP,e.entity.Locations[0].DateActiveStart=t.DateActiveStart,e.entity.Locations[0].DateActiveEnd=t.DateActiveEnd,e.entity.Locations[0].Remark=t.Remark,e.entity.Locations[0].Phone=t.Phone,e.entity.Locations[0].OrgRole=t.OrgRole,e.entity.Locations[0].Title=t.Title,e.entity.Locations[0].FullCode=t.FullCode},e.bind=function(t){e.bindPerson(t.Person),e.entity.Id=t.Id,e.entity.PersonId=t.PersonId,e.entity.PID=t.PID,e.entity.Phone=t.Phone,e.entity.DateJoinCompany=t.DateJoinCompany,e.entity.GroupId=t.GroupId,e.entity.Username=t.Username,e.entity.Password=t.Password,e.entity.DateLastLogin=t.DateLastLogin,e.entity.DateJoinCompanyP=t.DateJoinCompanyP,e.entity.IsActive=t.IsActive,e.entity.DateRegisterP=t.DateRegisterP,e.entity.DateConfirmedP=t.DateConfirmedP,e.entity.DateRegister=t.DateRegister,e.entity.DateConfirmed=t.DateConfirmed,e.entity.IsDeleted=t.IsDeleted,e.entity.DateActiveStart=t.DateActiveStart,e.entity.DateActiveEnd=t.DateActiveEnd,e.entity.DateLastLoginP=t.DateLastLoginP,t.Locations&&t.Locations.length>0&&e.bindLocation(t.Locations[0])},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}};var l=[{text:"Main",id:"main",visible_btn:!1},{text:"Certificates",id:"certificate",visible_btn:!1,visible:e.isView},{text:"Courses",id:"course",visible_btn:!1,visible:e.isView},{text:"Education",id:"education",visible_btn:!1},{text:"Document",id:"file",visible_btn:!1,visible_btn2:!0},{text:"Experience",id:"experience",visible_btn:!1,visible:e.isView},{text:"Rating",id:"rating",visible_btn:!1,visible:e.isView},{text:"Aircraft Type",id:"aircrafttype",visible_btn:!1,visible:e.isView}];e.btn_visible_education=!1,e.btn_visible_certificate=!1,e.btn_visible_file=!1,e.btn_visible_experience=!1,e.btn_visible_rating=!1,e.btn_visible_aircrafttype=!1,e.btn_location_education="after",e.btn_location_certificate="after",e.btn_location_file="after",e.btn_location_experience="after",e.btn_location_rating="after",e.tabs=l,e.selectedTabIndex=0,e.$watch("selectedTabIndex",function(t){try{e.selectedTab=l[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_education_instance.repaint(),e.dg_file_instance.repaint(),e.dg_exp_instance.repaint(),e.dg_rating_instance.repaint(),e.dg_aircrafttype_instance.repaint(),e.dg_certificate_instance.repaint(),e.dg_course_instance.repaint();var i=setInterval(function(){$("#dg_education").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_file").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_exp").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_rating").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_aircrafttype").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_certificate").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_course").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),clearInterval(i)},100);e.btn_visible_education=1==t,e.btn_visible_file=2==t,e.btn_visible_experience=3==t,e.btn_visible_rating=4==t,e.btn_visible_aircrafttype=5==t}catch(e){}}),e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex"}},e.IsMainDisabled=!0,e.IsNIDDisabled=!1,e.nid=null,e.getByNID=function(t){e.IsMainDisabled=!0,e.loadingVisible=!0,i.getEmployeeForView(t,Config.CustomerId).then(function(i){if(e.loadingVisible=!1,console.log(i),!i)return e.entity.Person.PersonId=-1,e.entity.PersonId=-1,e.entity.Id=-1,e.entity.CustomerCreatorId=Config.CustomerId,void(e.entity.Person.NID=t);e.bind(i)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.$watch("nid",function(t){t!=e.entity.Person.NID&&(t&&10==t.length?e.getByNID(t):e.IsMainDisabled=!0)}),e.txt_nid={valueChangeEvent:"keyup",readOnly:!1,hoverStateEnabled:!1,mask:"999-999999-9",maskInvalidMessage:"Wrong value",bindingOptions:{value:"nid",readOnly:"IsNIDDisabled"}},e.chk_ProficiencyIPC={hoverStateEnabled:!1,text:"IPC",bindingOptions:{value:"entity.Person.ProficiencyIPC",readOnly:"IsMainDisabled"}},e.chk_ProficiencyOPC={hoverStateEnabled:!1,text:"OPC",bindingOptions:{value:"entity.Person.ProficiencyOPC",readOnly:"IsMainDisabled"}},e.txt_LicenceTitle={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.LicenceTitle",readOnly:"IsMainDisabled"}},e.txt_RaitingCertificates={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.RaitingCertificates",readOnly:"IsMainDisabled"}},e.txt_LicenceDescription={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.LicenceDescription",readOnly:"IsMainDisabled"}},e.txt_CMCEmployedBy={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.CMCEmployedBy",readOnly:"IsMainDisabled"}},e.txt_CMCOccupation={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.CMCOccupation",readOnly:"IsMainDisabled"}},e.txt_PostalCode={hoverStateEnabled:!1,mask:"9999999999",bindingOptions:{value:"entity.Person.PostalCode",readOnly:"IsMainDisabled"}},e.txt_CaoCardNumber={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.CaoCardNumber",readOnly:"IsMainDisabled"}},e.txt_NDTNumber={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.NDTNumber",readOnly:"IsMainDisabled"}},e.txt_FirstName={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.FirstName",readOnly:"IsMainDisabled"}},e.txt_LastName={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.LastName",readOnly:"IsMainDisabled"}},e.txt_FatherName={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.FatherName",readOnly:"IsMainDisabled"}},e.txt_Address={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.Address",readOnly:"IsMainDisabled"}},e.txt_PassportNumber={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.PassportNumber",readOnly:"IsMainDisabled"}},e.txt_DocumentTitle={hoverStateEnabled:!1,bindingOptions:{value:"entityDocument.Remark"}},e.txt_EducationField={hoverStateEnabled:!1,bindingOptions:{value:"entityEducation.Title"}},e.txt_EducationCollege={hoverStateEnabled:!1,bindingOptions:{value:"entityEducation.College"}},e.txt_EducationRemark={hoverStateEnabled:!1,bindingOptions:{value:"entityEducation.Remark"}},e.txt_AircraftTypeRemark={hoverStateEnabled:!1,bindingOptions:{value:"entityAircrafttype.Remark"}},e.txt_ExpRemark={hoverStateEnabled:!1,height:60,bindingOptions:{value:"entityExp.Remark"}},e.txt_ExpJobTitle={hoverStateEnabled:!1,bindingOptions:{value:"entityExp.JobTitle"}},e.txt_ExpOrganization={hoverStateEnabled:!1,bindingOptions:{value:"entityExp.Organization"}},e.txt_Mobile={hoverStateEnabled:!1,mask:"AB00-0000000",maskRules:{A:/[0]/,B:/[9]/},maskChar:"_",maskInvalidMessage:"Wrong value",bindingOptions:{value:"entity.Person.Mobile",readOnly:"IsMainDisabled"}},e.emailValidationRules={validationRules:[{type:"email",message:"Email is invalid"}]},e.txt_Email={mode:"email",hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.Email",readOnly:"IsMainDisabled"}},e.txt_phone={readOnly:!1,hoverStateEnabled:!1,mask:"A00000009999",maskRules:{A:/[0]/},maskChar:" ",maskInvalidMessage:"Wrong value",rtlEnabled:!1,bindingOptions:{value:"entity.Person.Phone1",readOnly:"IsMainDisabled"}},e.txt_ephone={readOnly:!1,hoverStateEnabled:!1,mask:"A00000009999",maskRules:{A:/[0]/},maskChar:" ",maskInvalidMessage:"Wrong value",rtlEnabled:!1,bindingOptions:{value:"entity.Phone",readOnly:"IsMainDisabled"}},e.txt_IDNo={readOnly:!1,hoverStateEnabled:!1,mask:"9999999999",maskChar:" ",maskInvalidMessage:"Wrong value",rtlEnabled:!1,bindingOptions:{value:"entity.Person.IDNo",readOnly:"IsMainDisabled"}},e.txt_PID={readOnly:!1,hoverStateEnabled:!1,rtlEnabled:!1,bindingOptions:{value:"entity.PID",readOnly:"IsMainDisabled"}},e.LPRDisabled=!1,e.txt_ICAOLPRLevel={min:1,max:6,onValueChanged:function(t){e.LPRDisabled=6==t.value},bindingOptions:{value:"entity.Person.ICAOLPRLevel",readOnly:"IsMainDisabled"}},e.txt_MedicalClass={min:1,max:3,bindingOptions:{value:"entity.Person.MedicalClass",readOnly:"IsMainDisabled"}},e.txt_CaoInterval={min:1,bindingOptions:{value:"entity.Person.CaoInterval",readOnly:"IsMainDisabled"}},e.txt_IntervalNDT={min:1,bindingOptions:{value:"entity.Person.IntervalNDT",readOnly:"IsMainDisabled"}},e.date_DateBirth={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateBirth",readOnly:"IsMainDisabled"}},e.date_DateCompany={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateJoinCompany",readOnly:"IsMainDisabled"}},e.date_DateCaoCardIssue={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateCaoCardIssue",readOnly:"IsMainDisabled"}},e.date_DateCaoCardExpire={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateCaoCardExpire",readOnly:"IsMainDisabled"}},e.date_DateIssueNDT={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateIssueNDT",readOnly:"IsMainDisabled"}},e.date_DateExpireNDT={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateExpireNDT",readOnly:"IsMainDisabled"}},e.date_LanguageCourseExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.LanguageCourseExpireDate",readOnly:"IsMainDisabled"}},e.date_LicenceInitialIssue={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.LicenceInitialIssue",readOnly:"IsMainDisabled"}},e.date_LicenceIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.LicenceIssueDate",readOnly:"IsMainDisabled"}},e.date_LicenceExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.LicenceExpireDate",readOnly:"IsMainDisabled"}},e.date_ProficiencyCheckDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.ProficiencyCheckDate",readOnly:"IsMainDisabled"}},e.date_ProficiencyValidUntil={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.ProficiencyValidUntil",readOnly:"IsMainDisabled"}},e.date_ICAOLPRValidUntil={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.ICAOLPRValidUntil",readOnly:"IsMainDisabled",disabled:"LPRDisabled"}},e.date_CrewMemberCertificateExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.CrewMemberCertificateExpireDate",readOnly:"IsMainDisabled"}},e.date_DatePassportIssue={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DatePassportIssue",readOnly:"IsMainDisabled"}},e.date_DatePassportExpire={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DatePassportExpire",readOnly:"IsMainDisabled"}},e.date_DateNextCheckUP={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateNextCheckUP",readOnly:"IsMainDisabled"}},e.date_DateLastCheckUP={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateLastCheckUP",readOnly:"IsMainDisabled"}},e.date_DateJoinAvation={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateJoinAvation",readOnly:"IsMainDisabled"}},e.date_EducationDateCatch={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entityEducation.DateCatch"}},e.date_ExpDateStart={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entityExp.DateStart"}},e.date_ExpDateEnd={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entityExp.DateEnd"}},e.date_RatingDateIssue={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entityRating.DateIssue"}},e.date_RatingDateExpire={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entityRating.DateExpire"}},e.btn_delete_file={text:"Delete",type:"danger",icon:"clear",onClick:function(t){var i=o.getSelectedRow(e.dg_upload_instance);i?General.Confirm(Config.Text_DeleteConfirm,function(t){t&&(e.entityDocument.Documents=Enumerable.From(e.entityDocument.Documents).Where("$.Id!="+i.Id).ToArray(),e.dg_upload_instance.refresh())}):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.sb_OrganizationId={dataSource:o.getDatasourceRatingOrgs(),showClearButton:!0,searchEnabled:!0,searchExpr:["Title"],valueExpr:"Id",displayExpr:"Title",bindingOptions:{value:"entityRating.OrganizationId"},onSelectionChanged:function(t){e.entityRating.Organization=t.selectedItem?t.selectedItem.Title:null}},e.sb_group={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceGroups(),itemTemplate:function(e){return o.getSbTemplateGroup(e)},displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.GroupId",readOnly:"IsMainDisabled"}},e.sb_city={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceCityByCountry(103),displayExpr:"FullName",valueExpr:"Id",bindingOptions:{value:"entity.Person.CityId",readOnly:"IsMainDisabled"}},e.sb_Sex={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(29),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.Person.SexId",readOnly:"IsMainDisabled"}},e.sb_calandertype={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(11),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.Person.CaoIntervalCalanderTypeId",readOnly:"IsMainDisabled"}},e.sb_calandertypendt={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(11),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.Person.NDTIntervalCalanderTypeId",readOnly:"IsMainDisabled"}},e.sb_MarriageId={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(15),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.Person.MarriageId",readOnly:"IsMainDisabled"}},e.sb_post={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(36),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.Locations[0].OrgRoleId",readOnly:"IsMainDisabled"}},e.sb_location={dataSource:o.getDatasourceLoctionCustomer(),itemTemplate:function(e){return o.getSbTemplateLocation(e)},showClearButton:!0,searchEnabled:!0,searchExpr:["Title","FullCode"],valueExpr:"Id",displayExpr:"Title",bindingOptions:{value:"entity.Locations[0].LocationId",readOnly:"IsMainDisabled"}},e.sb_CityId={showClearButton:!0,width:"100%",searchEnabled:!0,dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.ODataStore({url:o.serviceUrl+"odata/cities/all",version:4}),sort:["City"]}),searchExpr:["City","Country"],valueExpr:"Id",searchMode:"startsWith",displayExpr:"FullName",bindingOptions:{value:"entity.CityId"}},e.sb_DocumentTypeId={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(44),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entityDocument.DocumentTypeId"},onSelectionChanged:function(t){e.entityDocument.DocumentType=t.selectedItem?t.selectedItem.Title:null}},e.sb_EducationDegreeId={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(18),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entityEducation.EducationDegreeId"},onSelectionChanged:function(t){e.entityEducation.EducationDegree=t.selectedItem?t.selectedItem.Title:null}},e.sb_EducationField={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(59),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entityEducation.StudyFieldId"},onSelectionChanged:function(t){e.entityEducation.StudyField=t.selectedItem?t.selectedItem.Title:null}},e.sb_ExpAircraftTypeId={itemTemplate:function(e){return o.getSbTemplateAircraft(e)},showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",searchExpr:["Type","Manufacturer"],bindingOptions:{value:"entityExp.AircraftTypeId"},onSelectionChanged:function(t){e.entityExp.AircraftType=t.selectedItem?t.selectedItem.Type:null}},e.sb_RatingAircraftTypeId={itemTemplate:function(e){return o.getSbTemplateAircraft(e)},showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",searchExpr:["Type","Manufacturer"],bindingOptions:{value:"entityRating.AircraftTypeId"},onSelectionChanged:function(t){e.entityRating.AircraftType=t.selectedItem?t.selectedItem.Type:null}},e.sb_AircraftTypeId={itemTemplate:function(e){return o.getSbTemplateAircraft(e)},showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",searchExpr:["Type","Manufacturer"],onSelectionChanged:function(t){e.entityAircrafttype.AircraftType=t.selectedItem?t.selectedItem.Type:null,e.entityAircrafttype.Manufacturer=t.selectedItem?t.selectedItem.Manufacturer:null},bindingOptions:{value:"entityAircrafttype.AircraftTypeId"}},e.sb_RatingCategoryId={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(51),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entityRating.CategoryId"},onSelectionChanged:function(t){e.entityRating.Category=t.selectedItem?t.selectedItem.Title:null}},e.img_url="content/images/imguser.png",e.uploaderValueImage=[],e.uploadedFileImage=null,e.uploader_image={multiple:!1,labelText:"",accept:"image/*",uploadMethod:"POST",uploadMode:"instantly",rtlEnabled:!0,uploadUrl:o.fileHandlerUrl+"?t=clientfiles",onValueChanged:function(e){},onUploaded:function(t){e.uploadedFileImage=t.request.responseText,e.entity.Person.ImageUrl=t.request.responseText,e.img_url=o.clientsFilesUrl+e.uploadedFileImage},bindingOptions:{value:"uploaderValueImage"}},e.uploaderValueDocument=[],e.uploadedFileDocument=null,e.uploader_document_instance=null,e.uploader_document={multiple:!1,labelText:"",uploadMethod:"POST",uploadMode:"instantly",uploadUrl:o.fileHandlerUrl+"?t=clientfiles",onValueChanged:function(e){},onUploaded:function(t){var i={Id:-1*(e.entityDocument.Documents.length+1),Title:t.request.responseText,FileUrl:t.request.responseText};i.SysUrl=e.uploaderValueDocument[0].name,i.FileType=e.uploaderValueDocument[0].type,e.entityDocument.Documents.push(i),console.log(e.uploaderValueDocument)},onContentReady:function(t){e.uploader_document_instance||(e.uploader_document_instance=t.component)},bindingOptions:{value:"uploaderValueDocument"}},e.scroll_height=200,e.scroll_main={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.scroll_education={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.scroll_certificate={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.scroll_file={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.scroll_experience={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.scroll_rating={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}};e.dg_height=200,e.pop_width=600,e.pop_height=350,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_add_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();e.pop_width=i.width,e.pop_width>1200&&(e.pop_width=1200),e.pop_height=$(window).height()-30,e.dg_height=e.pop_height-133,e.scroll_height=e.pop_height-140},onShown:function(t){e.selectedTabIndex=0,e.isNew,null!=e.tempData&&(e.nid=e.tempData.NID)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,o.$broadcast("onPersonHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.pop_width_file=750,e.pop_height_file=600,e.popup_file_visible=!1,e.popup_file_title="New Document",e.popup_file={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fileadd",bindingOptions:{},onClick:function(t){if(t.validationGroup.validate().isValid)if(e.entityDocument.Id)JSON.copy(e.entityDocument,null),e.clearEntityDocumnet(),e.popup_file_visible=!1;else{var i=-1*(e.entity.Person.Documents.length+1);e.entityDocument.Id=i,e.entity.Person.Documents.push(JSON.clone(e.entityDocument)),e.clearEntityDocumnet()}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_file_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_file>e.pop_width&&(e.pop_width_file=e.pop_width),e.pop_height_file>e.pop_height&&(e.pop_height_file=e.pop_height)},onShown:function(t){e.dg_upload_instance.repaint()},onHiding:function(){e.clearEntityFile(),e.popup_file_visible=!1},bindingOptions:{visible:"popup_file_visible",width:"pop_width_file",height:"pop_height_file",title:"popup_file_title"}},e.pop_width_education=600,e.pop_height_education=450,e.popup_education_visible=!1,e.popup_education_title="New Education",e.popup_education={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"educationadd",bindingOptions:{},onClick:function(t){if(t.validationGroup.validate().isValid)if(Enumerable.From(e.entity.Person.Educations).Where("$.EducationDegreeId=="+e.entityEducation.EducationDegreeId+" && $.StudyFieldId=="+e.entityEducation.StudyFieldId+" && $.Id!="+e.entityEducation.Id).FirstOrDefault())General.ShowNotify(Config.Text_SameItemExist,"error");else if(e.entityEducation.Id)JSON.copy(e.entityEducation,null),e.clearEntityEducation(),e.popup_education_visible=!1;else{var i=-1*(e.entity.Person.Educations.length+1);e.entityEducation.Id=i,e.entity.Person.Educations.push(JSON.clone(e.entityEducation)),e.clearEntityEducation()}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_education_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_education>e.pop_width&&(e.pop_width_education=e.pop_width),e.pop_height_education>e.pop_height&&(e.pop_height_education=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityEducation(),e.popup_education_visible=!1},bindingOptions:{visible:"popup_education_visible",width:"pop_width_education",height:"pop_height_education",title:"popup_education_title"}},e.pop_width_exp=600,e.pop_height_exp=450,e.popup_exp_visible=!1,e.popup_exp_title="New Experience",e.popup_exp={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"experienceadd",bindingOptions:{},onClick:function(t){if(t.validationGroup.validate().isValid)if(Enumerable.From(e.entity.Person.Expreienses).Where("$.Organization=='"+e.entityExp.Organization+"' && $.AircraftTypeId=="+e.entityExp.AircraftTypeId+" && $.JobTitle=='"+e.entityExp.JobTitle+"' && $.Id!="+e.entityExp.Id).FirstOrDefault())General.ShowNotify(Config.Text_SameItemExist,"error");else if(e.entityExp.Id)JSON.copy(e.entityExp,null),e.clearEntityExp(),e.popup_exp_visible=!1;else{var i=-1*(e.entity.Person.Expreienses.length+1);e.entityExp.Id=i,e.entity.Person.Expreienses.push(JSON.clone(e.entityExp)),e.clearEntityExp()}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_exp_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_exp>e.pop_width&&(e.pop_width_exp=e.pop_width),e.pop_height_exp>e.pop_height&&(e.pop_height_exp=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityExp(),e.popup_exp_visible=!1},bindingOptions:{visible:"popup_exp_visible",width:"pop_width_exp",height:"pop_height_exp",title:"popup_exp_title"}},e.pop_width_rating=600,e.pop_height_rating=360,e.popup_rating_visible=!1,e.popup_rating_title="New Rating",e.popup_rating={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"ratingadd",bindingOptions:{},onClick:function(t){if(t.validationGroup.validate().isValid)if(Enumerable.From(e.entity.Person.Ratings).Where("$.OrganizationId=="+e.entityRating.OrganizationId+" && $.AircraftTypeId=="+e.entityRating.AircraftTypeId+" && $.CategoryId=="+e.entityExp.JobTitle+" && $.Id!="+e.entityRating.Id).FirstOrDefault())General.ShowNotify(Config.Text_SameItemExist,"error");else if(e.entityRating.Id)JSON.copy(e.entityRating,null),e.clearEntityRating(),e.popup_rating_visible=!1;else{var i=-1*(e.entity.Person.Ratings.length+1);e.entityRating.Id=i,e.entity.Person.Ratings.push(JSON.clone(e.entityRating)),e.clearEntityRating()}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_rating_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_rating>e.pop_width&&(e.pop_width_rating=e.pop_width),e.pop_height_rating>e.pop_height&&(e.pop_height_rating=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityRating(),e.popup_rating_visible=!1},bindingOptions:{visible:"popup_rating_visible",width:"pop_width_rating",height:"pop_height_rating",title:"popup_rating_title"}},e.pop_width_aircrafttype=600,e.pop_height_aircrafttype=300,e.popup_aircrafttype_visible=!1,e.popup_aircrafttype_title="New Aircraft Type",e.popup_aircrafttype={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"aircrafttypeadd",onClick:function(t){if(t.validationGroup.validate().isValid)if(Enumerable.From(e.entity.Person.AircraftTypes).Where("$.AircraftTypeId=="+e.entityAircrafttype.AircraftTypeId+" && $.Id!="+e.entityAircrafttype.Id).FirstOrDefault())General.ShowNotify(Config.Text_SameItemExist,"error");else if(e.entityAircrafttype.Id)JSON.copy(e.entityAircrafttype,null),e.clearEntityAircrafttype(),e.popup_aircrafttype_visible=!1;else{var i=-1*(e.entity.Person.AircraftTypes.length+1);e.entityAircrafttype.Id=i,e.entity.Person.AircraftTypes.push(JSON.clone(e.entityAircrafttype)),e.clearEntityAircrafttype()}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_aircrafttype_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_aircrafttype>e.pop_width&&(e.pop_width_aircrafttype=e.pop_width),e.pop_height_aircrafttype>e.pop_height&&(e.pop_height_aircrafttype=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityAircrafttype(),e.popup_aircrafttype_visible=!1},bindingOptions:{visible:"popup_aircrafttype_visible",width:"pop_width_aircrafttype",height:"pop_height_aircrafttype",title:"popup_aircrafttype_title"}},e.dg_education_columns=[{dataField:"EducationDegree",caption:"Degree",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"StudyField",caption:"Field",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"College",caption:"College",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"DateCatch",caption:"Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:150},{dataField:"FileUrl",width:120,alignment:"center",caption:"Attachment",allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="<div></div>";t.value&&(i="<a  href='"+o.clientsFilesUrl+"/"+t.value+"' class='w3-button w3-block w3-blue' style=' margin:0 auto 0px auto;text-decoration:none' target='_blank'>Download</a>"),$("<div>").append(i).appendTo(e)}}],e.dg_education_selected=null,e.dg_education_instance=null,e.dg_education={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_education_columns,onContentReady:function(t){e.dg_education_instance||(e.dg_education_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_education_selected=i||null},bindingOptions:{dataSource:"entity.Person.Educations",height:"dg_height"}},e.dg_file_columns=[{dataField:"DocumentType",caption:"DocumentType",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_file_selected=null,e.dg_file_instance=null,e.dg_file={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_file_columns,onContentReady:function(t){e.dg_file_instance||(e.dg_file_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_file_selected=i||null},bindingOptions:{dataSource:"entity.Person.Documents",height:"dg_height"}},e.dg_upload_columns=[{dataField:"FileUrl",caption:"Uploaded",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"SysUrl",caption:"File",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"FileType",caption:"File Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"FileUrl",width:120,alignment:"center",caption:"Attachment",allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="<div></div>";t.value&&(i="<a  href='"+o.clientsFilesUrl+"/"+t.value+"' class='w3-button w3-block w3-blue' style=' margin:0 auto 0px auto;text-decoration:none' target='_blank'>Download</a>"),$("<div>").append(i).appendTo(e)}}],e.dg_upload_selected=null,e.dg_upload_instance=null,e.dg_upload={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},height:230,noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!1,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_upload_columns,onContentReady:function(t){e.dg_upload_instance||(e.dg_upload_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_upload_selected=i||null},bindingOptions:{dataSource:"entityDocument.Documents"}},e.dg_exp_columns=[{dataField:"JobTitle",caption:"Job Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"Organization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:400},{dataField:"AircraftType",caption:"AC Type",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"DateStart",caption:"From",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:140},{dataField:"DateEnd",caption:"To",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:140}],e.dg_exp_selected=null,e.dg_exp_instance=null,e.dg_exp={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_exp_columns,onContentReady:function(t){e.dg_exp_instance||(e.dg_exp_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_exp_selected=i||null},bindingOptions:{dataSource:"entity.Person.Expreienses",height:"dg_height"}},e.dg_certificate_columns=[{dataField:"ExpireStatus",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="green";switch(t.value){case 1:i="red";break;case 2:i="orange"}$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"CerNumber",caption:"Certificate No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130,fixed:!0,fixedPosition:"left"},{dataField:"ExpireDate",caption:"Expire Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!0,fixedPosition:"left"},{dataField:"DateIssue",caption:"Issue Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!1,fixedPosition:"left"},{dataField:"Remain",caption:"Remain",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:70,fixed:!1,fixedPosition:"left"},{dataField:"CourseNo",caption:"Course No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:100},{dataField:"CourseTitle",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200,fixed:!0,fixedPosition:"left"},{dataField:"CourseOrganization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"CourseDateStart",caption:"DateStart",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,sortIndex:0,sortOrder:"desc"},{dataField:"CourseRecurrent",caption:"Recurrent",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100}],e.dg_certificate_selected=null,e.dg_certificate_instance=null,e.dg_certificate={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_certificate_columns,onContentReady:function(t){e.dg_certificate_instance||(e.dg_certificate_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_certificate_selected=i||null},bindingOptions:{dataSource:"entity.Person.Certificates",height:"dg_height"}},e.dg_course_columns=[{dataField:"StatusId",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="pending-24";switch(t.value){case 67:i="registered-24";break;case 69:i="canceled-24";break;case 68:i="Attended-24";break;case 70:i="failed-24";break;case 71:i="passed-24"}$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"Status",caption:"Status",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left",sortIndex:0,sortOrder:"desc"},{dataField:"No",caption:"No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:100},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300,fixed:!0,fixedPosition:"left"},{dataField:"DateStart",caption:"DateStart",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,sortIndex:0,sortOrder:"desc"},{dataField:"DateEnd",caption:"DateEnd",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"Recurrent",caption:"Recurrent",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100},{dataField:"Organization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Instructor",caption:"Instructor",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"TrainingDirector",caption:"Training Director",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"DateIssue",caption:"Issue Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!0,fixedPosition:"right"},{dataField:"CerNumber",caption:"Certificate No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"right"}],e.dg_course_selected=null,e.dg_course_instance=null,e.dg_course_ds=null,e.dg_course={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_course_columns,onContentReady:function(t){e.dg_course_instance||(e.dg_course_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_course_selected=i||null},bindingOptions:{dataSource:"entity.Person.Courses",height:"dg_height"}},e.dg_aircrafttype_columns=[{dataField:"AircraftType",caption:"Aircraft Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_aircrafttype_selected=null,e.dg_aircrafttype_instance=null,e.dg_aircrafttype={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_aircrafttype_columns,onContentReady:function(t){e.dg_aircrafttype_instance||(e.dg_aircrafttype_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_aircrafttype_selected=i||null},bindingOptions:{dataSource:"entity.Person.AircraftTypes",height:"dg_height"}},e.dg_rating_columns=[{dataField:"AircraftType",caption:"Aircraft Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Organization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"DateIssue",caption:"Issue Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200},{dataField:"DateExpire",caption:"Expire Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200}],e.dg_rating_selected=null,e.dg_rating_instance=null,e.dg_rating={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_rating_columns,onContentReady:function(t){e.dg_rating_instance||(e.dg_rating_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_rating_selected=i||null},bindingOptions:{dataSource:"entity.Person.Ratings",height:"dg_height"}},e.tempData=null,e.$on("InitViewPerson",function(t,i){e.tempData=null,i.Id?(e.popup_add_title="View",e.tempData=i,e.isNew=!1):(e.isNew=!0,e.popup_add_title="View"),e.popup_add_visible=!0})}]),app.controller("personbookController",["$scope","$location","$routeParams","$rootScope","libraryService","notificationService","authService",function(e,t,i,n,a,o,l){e.prms=i.prms,e.dsUrl=null,e.filterVisible=!1,e.selectedCourse=null,e.courseStatus={SMS:!0,Email:!0,AppNotification:!0,StatusId:null,Status:null,CourseId:null,OldStatus:null,Remark:null,IssueDate:null,No:null,Name:null,People:[]},e.sb_StatusId={showClearButton:!0,searchEnabled:!1,dataSource:n.getDatasourcePersonCourseStatus(),displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){if(t.selectedItem){var i=71==t.selectedItem.Id;e.isCertidicateDisabled=!i}},bindingOptions:{value:"courseStatus.StatusId",text:"courseStatus.Status"}},e.txt_OldStatus={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseStatus.OldStatus"}},e.chb_SMS={text:"Send SMS",bindingOptions:{value:"courseStatus.SMS"}},e.chb_Email={text:"Send Email",bindingOptions:{value:"courseStatus.Email"}},e.chb_AppNotification={text:"Send Notification",bindingOptions:{value:"courseStatus.AppNotification"}},e.txt_StatusRemark={hoverStateEnabled:!1,bindingOptions:{value:"courseStatus.Remark"}},e.txt_CertificateNo={hoverStateEnabled:!1,bindingOptions:{value:"courseStatus.No"}},e.txt_Name={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseStatus.Name"}},e.date_DateIssue={width:"100%",type:"date",displayFormat:n.DateBoxFormat,bindingOptions:{value:"courseStatus.IssueDate"}},e.IsNotificationDisabled=!0,e.btn_notification={type:"default",width:200,text:"Notify",icon:"ion ion-ios-notifications",onClick:function(t){if(e.selectedEmployees=n.getSelectedRow(e.dg_employees_instance),e.selectedEmployees){var i=Enumerable.From(e.dg_course_ds).Where("$.IsDownloaded==0").Select("$.Title").ToArray().join("\r\n");e.Notify.Message="Dear "+e.selectedEmployees.Name+",\r\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.\r\n\r\n"+i+"\r\n\r\nYour sincerely\r\n"+n.userTitle+"\r\n"+moment().format("MMMM Do YYYY, h:mm:ss a"),e.popup_notify_visible=!0}else General.ShowNotify(Config.Text_NoRowSelected,"error")},bindingOptions:{disabled:"IsNotificationDisabled"}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".filter").show())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.Notify={ModuleId:n.moduleId,TypeId:97,SMS:!0,Email:!0,AppNotification:!0,Message:null,CustomerId:Config.CustomerId,SenderId:null,Employees:[]},e.chb_SMSNotify={text:"Send SMS",bindingOptions:{value:"Notify.SMS"}},e.chb_EmailNotify={text:"Send Email",bindingOptions:{value:"Notify.Email"}},e.chb_AppNotificationNotify={text:"Send Notification",bindingOptions:{value:"Notify.AppNotification"}},e.txt_MessageNotify={hoverStateEnabled:!1,height:300,bindingOptions:{value:"Notify.Message"}},e.htmlEditorOptions={toolbar:{items:["undo","redo","separator",{formatName:"header",formatValues:[!1,1,2,3,4,5]},"separator","bold","italic","strike","underline","separator","alignLeft","alignCenter","alignRight","alignJustify","separator",{widget:"dxButton",options:{text:"Show markup",stylingMode:"text",onClick:function(){alert(e.Notify.Message)}}}]},bindingOptions:{value:"Notify.Message"}},e.popup_notify_visible=!1,e.popup_notify_title="Notify",e.popup_notify={fullScreen:!1,showTitle:!0,height:500,width:600,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",onClick:function(t){e.Notify.Employees.push(e.selectedEmployees.Id),e.loadingVisible=!0,e.Notify.Message=e.Notify.Message.replace(/\r?\n/g,"<br />"),o.notify(e.Notify).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.Notify={ModuleId:n.moduleId,TypeId:97,SMS:!0,Email:!0,AppNotification:!0,Message:null,CustomerId:Config.CustomerId,SenderId:null,Employees:[]},e.popup_notify_visible=!1},function(t){e.loadingVisible=!1,e.popup_notify_visible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_notify_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.Notify={ModuleId:n.moduleId,TypeId:97,SMS:!0,Email:!0,AppNotification:!0,Message:null,CustomerId:Config.CustomerId,SenderId:null,Employees:[]},e.popup_notify_visible=!1},bindingOptions:{visible:"popup_notify_visible",title:"popup_notify_title"}},e.courseCaption="Library Items",e.dg_employees_columns=[{dataField:"BookAlert",caption:"Issue",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90,fixed:!0,fixedPosition:"left",sortIndex:1,sortOrder:"desc"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:220,fixed:!0,fixedPosition:"left",sortIndex:2,sortOrder:"asc"},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Mobile",caption:"Mobile",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"Email",caption:"Email",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"DateJoinCompany",caption:"Join Company",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"CaoCardNumber",caption:"CAO No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"NDTNumber",caption:"NDT No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130}],e.dg_employees_height=100,e.dg_employees_selected=null,e.dg_employees_instance=null,e.dg_employees_ds=null,e.dg_employees={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_employees_columns,onContentReady:function(t){e.dg_employees_instance||(e.dg_employees_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.IsNotificationDisabled=!0,e.dg_employees_selected=i,e.courseCaption="Library > "+i.Name,a.getPersonLibrary(i.Id).then(function(t){e.dg_course_ds=t,e.IsNotificationDisabled=!1},function(e){General.ShowNotify(e.message,"error")})):(e.dg_employees_selected=null,e.dg_course_ds=null,e.courseCaption="Library",e.IsNotificationDisabled=!0)},height:$(window).height()-175,bindingOptions:{dataSource:"dg_employees_ds"}},e.dg_course_columns=[{dataField:"TypeId",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){83==t.value&&$("<div>").append("<img src='content/images/book2.png' />").appendTo(e),84==t.value&&$("<div>").append("<img src='content/images/paper.png' />").appendTo(e),85==t.value&&$("<div>").append("<img src='content/images/movie.png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"IsDownloaded",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i=0==t.value?"notdownloaded":"downloaded";$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left",sortIndex:1,sortOrder:"asc"},{dataField:"IsVisited",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i=0==t.value?"notvisited":"visited";$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left",sortIndex:2,sortOrder:"asc"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300,fixed:!0,fixedPosition:"left",sortIndex:1,sortOrder:"asc"},{dataField:"DateEffective",caption:"Effective",allowResizing:!0,dataType:"string",allowEditing:!1,width:150,alignment:"center"},{dataField:"DateExposure",caption:"Exposure Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:150},{dataField:"DateVisit",caption:"Visit Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"DateDownload",caption:"Download Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130}],e.dg_course_selected=null,e.dg_course_instance=null,e.dg_course_ds=null,e.dg_course={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-175,columns:e.dg_course_columns,onContentReady:function(t){e.dg_course_instance||(e.dg_course_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_course_selected=i||null},bindingOptions:{dataSource:"dg_course_ds"}},e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){!e.dg_employees_ds&&e.doRefresh&&(e.dg_employees_ds={store:{type:"odata",url:n.serviceUrl+"odata/employees/"+Config.CustomerId,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}}}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_employees_ds.filter=e.filters,e.dg_employees_instance.refresh(),e.doRefresh=!1)},l.isAuthorized()?(n.page_title="> Employees",$(".personbook").fadeIn()):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),n.$broadcast("PersonCourseLoaded",null)}]),app.controller("personmiscController",["$scope","$location","$routeParams","$rootScope","personService","authService","$route",function(e,t,i,n,a,o,l){switch(e.prms=i.prms,e.TypeId=l.current.TypeId,e.caption="Organization",e.url="",Number(e.TypeId)){case 8:e.caption="Aircraft Manufacturer";break;case 58:e.caption="Airlines";break;case 75:e.caption="Authors",e.url="odata/authors"}switch(e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.deleteMisc(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(t){var i={Id:null};i._tid=e.TypeId,n.$broadcast("InitAddPersonMisc",i)}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;i._tid=e.TypeId,n.$broadcast("InitAddPersonMisc",i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;e.InitAddAirport(i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.filters=[],e.dg_columns_authors=[{cellTemplate:function(e,t){$("<div style='text-align:center'/>").html(t.rowIndex+1).appendTo(e)},caption:"#",width:60,fixed:!0,fixedPosition:"left",allowResizing:!1,cssClass:"rowHeader"},{dataField:"ImageUrl",caption:"",width:105,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.value&&$("<div>").append("<img src='"+n.clientsFilesUrl+t.value+"' style=' width:70px;height:70px;border:1px soild #ccc;border-radius:50%; '/>").appendTo(e)}},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"Website",caption:"Website",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:250},{dataField:"Email",caption:"Email",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:250},{dataField:"LinkedIn",caption:"LinkedIn",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:200},{dataField:"Telegram",caption:"Telegram",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:200},{dataField:"Instagram",caption:"Instagram",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:200},{dataField:"Tel",caption:"Tel",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"Books",caption:"Items",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!0,fixedPosition:"right"}],e.dg_columns=[],Number(e.TypeId)){case 8:case 58:break;case 75:e.dg_columns=e.dg_columns_authors}e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+e.url,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:["Name"]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},o.isAuthorized()?(n.page_title="> "+e.caption,$(".personmisc").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onPersonMiscSaved",function(t,i){e.doRefresh=!0}),e.$on("onPersonMiscHide",function(t,i){e.bind()}),n.$broadcast("PersonMiscLoaded",null)}]),app.controller("loginController",["$scope","$location","authService","ngAuthSettings","$rootScope",function(e,t,i,n,a){var o=new MobileDetect(window.navigator.userAgent);console.log("Mobile: "+o.mobile()),console.log("Phone: "+o.phone()),console.log("Tablet: "+o.tablet()),console.log("OS: "+o.os()),console.log("userAgent: "+o.userAgent()),e.loginData={userName:"",password:"",useRefreshTokens:!1,scope:[Config.CustomerId+"*ap"]};var l=i.getCEO();l&&(e.loginData.userName=l.userName,e.loginData.password=l.password),e.message="",e.login=function(){$("form").fadeOut(700),$(".wait").addClass("yaxis").fadeIn(1500),$(".wrapper").addClass("form-success"),i.login(e.loginData).then(function(e){a.userName=i.authentication.userName,"True"!=a.EmailConfirmed?a.navigatefirstlogin():l||"ceo"==a.userName?(i.setModule(3),t.path("/flight/board/ceo")):t.path("/apps")},function(t){e.message=t.error_description,$(".wait").hide(),$(".wrapper").removeClass("form-success"),$("form").fadeIn(700)})},e.authExternalProvider=function(t){var i=location.protocol+"//"+location.host+"/authcomplete.html",a=n.apiServiceBaseUri+"api/Account/ExternalLogin?provider="+t+"&response_type=token&client_id="+n.clientId+"&redirect_uri="+i;window.$windowScope=e;window.open(a,"Authenticate Account","location=0,status=0,width=600,height=750")},e.authCompletedCB=function(n){e.$apply(function(){if("False"==n.haslocalaccount)i.logOut(),i.externalAuthData={provider:n.provider,userName:n.external_user_name,externalAccessToken:n.external_access_token},t.path("/associate");else{var a={provider:n.provider,externalAccessToken:n.external_access_token};i.obtainAccessToken(a).then(function(e){t.path("/orders")},function(t){e.message=t.error_description})}})}}]),app.controller("firstLoginController",["$scope","$location","authService","ngAuthSettings","$rootScope",function(e,t,i,n,a){e.cp={OldPassword:"",NewPassword:"",ConfirmPassword:""},e.message="",e.change=function(){e.cp.OldPassword&&e.cp.NewPassword&&e.cp.ConfirmPassword&&($("form").fadeOut(700),$(".wait").addClass("yaxis").fadeIn(1500),$(".wrapper").addClass("form-success"),i.changePassword(e.cp).then(function(e){a.logOut()},function(t){e.message=t.message,General.ShowNotify(t.message,"error"),$(".wait").hide(),$(".wrapper").removeClass("form-success"),$("form").fadeIn(700)}))},e.authExternalProvider=function(t){var i=location.protocol+"//"+location.host+"/authcomplete.html",a=n.apiServiceBaseUri+"api/Account/ExternalLogin?provider="+t+"&response_type=token&client_id="+n.clientId+"&redirect_uri="+i;window.$windowScope=e;window.open(a,"Authenticate Account","location=0,status=0,width=600,height=750")},e.authCompletedCB=function(n){e.$apply(function(){if("False"==n.haslocalaccount)i.logOut(),i.externalAuthData={provider:n.provider,userName:n.external_user_name,externalAccessToken:n.external_access_token},t.path("/associate");else{var a={provider:n.provider,externalAccessToken:n.external_access_token};i.obtainAccessToken(a).then(function(e){t.path("/orders")},function(t){e.message=t.error_description})}})}}]),app.controller("journalController",["$scope","$location","$routeParams","$rootScope","generalService","authService","$route",function(e,t,i,n,a,o,l){switch(e.prms=i.prms,e.TypeId=l.current.TypeId,e.caption="Journals",e.url="",Number(e.TypeId)){case 2:e.caption="Conferences",e.url="odata/base/conferences";break;case 1:e.caption="Journals",e.url="odata/base/journals"}switch(e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.deleteJournal(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(t){var i={Id:null};i._tid=e.TypeId,n.$broadcast("InitAddJournal",i)}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;i._tid=e.TypeId,n.$broadcast("InitAddJournal",i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;e.InitAddAirport(i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.filters=[],e.dg_columns_conferences=[{cellTemplate:function(e,t){$("<div style='text-align:center'/>").html(t.rowIndex+1).appendTo(e)},caption:"#",width:60,fixed:!0,fixedPosition:"left",allowResizing:!1,cssClass:"rowHeader"},{dataField:"Title",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Website",caption:"Website",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:250},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"Books",caption:"Items",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:110}],e.dg_columns_journals=[{cellTemplate:function(e,t){$("<div style='text-align:center'/>").html(t.rowIndex+1).appendTo(e)},caption:"#",width:60,fixed:!0,fixedPosition:"left",allowResizing:!1,cssClass:"rowHeader"},{dataField:"Title",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Website",caption:"Website",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:250},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"Books",caption:"Items",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:110}],e.dg_columns=[],Number(e.TypeId)){case 8:break;case 2:e.dg_columns=e.dg_columns_conferences;break;case 1:e.dg_columns=e.dg_columns_journals}e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+e.url,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Books",desc:!0},"Title"]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},o.isAuthorized()?(n.page_title="> "+e.caption,$(".journal").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onJournalSaved",function(t,i){e.doRefresh=!0}),e.$on("onJournalHide",function(t,i){e.bind()}),n.$broadcast("JournalLoaded",null)}]),app.controller("planBoardController",["$scope","$location","$routeParams","$rootScope","flightService","weatherService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,d,r,s){function c(e){var t=$("<iframe />");t[0].name="frame1",t.css({position:"absolute",top:"-1000000px"}),$("body").append(t);var i=t[0].contentWindow?t[0].contentWindow:t[0].contentDocument.document?t[0].contentDocument.document:t[0].contentDocument;i.document.open(),i.document.write("<html><head><title></title>"),i.document.write("<style>"),i.document.write("*{display: hidden;}"),i.document.write("img{display: block; width: 100%; }"),i.document.write("</style>"),i.document.write('</head><body class="gantt" style="padding:0 !important;">'),i.document.write("<div style='height:100%'><div style='text-align:center;margin-top:30px'></div><div style='text-align:center;margin-top:10px'></div><img style='margin-top:10px;height:70%'  src = '"+e.toDataURL()+"'/></div>"),i.document.write("</body></html>"),i.document.close(),setTimeout(function(){window.frames.frame1.focus(),window.frames.frame1.print(),t.remove()},500)}function u(e){var t=e.html(),i=$("<iframe />");i[0].name="frame1",i.css({position:"absolute",top:"-1000000px"}),$("body").append(i);var n=i[0].contentWindow?i[0].contentWindow:i[0].contentDocument.document?i[0].contentDocument.document:i[0].contentDocument;n.document.open(),n.document.write("<html><head><title></title>"),n.document.write("</head><body>"),n.document.write('<link href="content/css/bootstrap.css" rel="stylesheet" />'),n.document.write('<link href="content/css/main.css" rel="stylesheet" />'),n.document.write(t),n.document.write("</body></html>"),n.document.close(),setTimeout(function(){window.frames.frame1.focus(),window.frames.frame1.print(),i.remove()},500)}e.prms=i.prms,d.setModule(3),n.setTheme(),e.IsPlanning=!0,e.IsJLAccess=n.HasMenuAccess("flight_board_jl",3),e.airport=i.airport,e.airportEntity=null,e.filterVisible=!1,e.IsDispatch=s.current.isDispatch,e.IsDepartureVisible=!0,e.IsArrivalVisible=!0,e.IsDepartureDisabled=!0,e.IsArrivalDisabled=!0,e.IsAdmin=!0,e.IsEditable=n.IsFlightBoardEditable(),e.IsJLAccess=n.HasMenuAccess("flight_board_jl",3)||e.IsEditable,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").hide()):(e.filterVisible=!0,$(".filter").show())}},e.flight=null,e.takeOffVisible=!1,e.offBlockVisible=!1,e.onBlockVisible=!1,e.landingVisible=!1,e.btn_takeoff={text:"Take Off",type:"default",icon:"fas fa-plane-departure",width:"150",bindingOptions:{},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.takeOffReadOnly=!1,e.flight=e.selectedFlights[0],e.flightTakeOff=e.flight.ChocksOut,(new Date).getDatePart()==new Date(e.flight.STD).getDatePart()&&(e.flightTakeOff=new Date),e.popup_takeoff_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.btn_information={text:"Information",type:"default",icon:"fas fa-info-circle",width:"100%",bindingOptions:{},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.popup_inf_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.record=null,e.btn_dep={text:"Dep",type:"default",icon:"fas fa-plane-departure",width:"100%",bindingOptions:{},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.calculateTotalPax(),e.popup_flight_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.btn_log={text:"Log",type:"default",icon:"fas fa-plane-departure",width:"100%",bindingOptions:{},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.flight.FuelUnitID||(e.flight.FuelUnitID=115),e.flight.CargoUnitID||(e.flight.CargoUnitID=111),e.flight.STA2=new Date(e.flight.STA),e.flight.STD2=new Date(e.flight.STD),e.calculateTotalPax(),e.popup_log_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.btn_arr={text:"Arrival",type:"default",icon:"fas fa-plane-arrival",width:"100%",bindingOptions:{disabled:"IsArrivalDisabled"},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.popup_arr_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.btn_offblock={text:"Off Block",type:"default",icon:"far fa-square",width:"150",bindingOptions:{},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.flightOffBlock=new Date(e.flight.baseStartDate),(new Date).getDatePart()==new Date(e.flight.STD).getDatePart()&&(e.flightOffBlock=new Date),e.popup_offblock_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.btn_onblock={text:"On Block",type:"default",icon:"fas fa-square",width:"150",bindingOptions:{},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.flightOnBlock=new Date(e.flight.Landing),(new Date).getDatePart()==new Date(e.flight.STD).getDatePart()&&(e.flightOnBlock=new Date),e.popup_onblock_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.btn_landing={text:"Landing",type:"default",icon:"fas fa-plane-arrival",width:"150",bindingOptions:{},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.takeOffReadOnly=!0,e.flightTakeOff=e.flight.Takeoff,e.flightLanding=e.flight.baseEndDate,(new Date).getDatePart()==new Date(e.flight.STA).getDatePart()&&(e.flightLanding=new Date),e.popup_landing_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.btn_crew={text:"Crew",type:"default",icon:"fas fa-user-circle",width:"100%",bindingOptions:{},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.popup_crew_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.linked_flight={},e.linkEntity={},e.time_ir_std_date=null,e.time_ir_std_time=null,e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.moment2=function(e){return e?moment(e).format("MM-DD-YYYY HH:mm"):""},e.setArrival=function(){if(e.linkEntity&&null!=e.time_ir_std_date&&null!=e.time_ir_std_time&&null!=e.linkEntity.FlightH&&null!=e.linkEntity.FlightM){var t=new Date(e.time_ir_std_date).getDatePartArray(),i=new Date(e.time_ir_std_time).getTimePartArray(),n=new Date(t[0],t[1],t[2],i[0],i[1],0,0),a=new Date(n.addHours(e.linkEntity.FlightH).addMinutes(e.linkEntity.FlightM));e.time_ir_sta_date=General.getDayFirstHour(new Date(a)),e.time_ir_sta_time=new Date(a)}else e.time_ir_sta_date=null,e.time_ir_sta_time=null},e.text_ir_flightnumber={bindingOptions:{value:"linkEntity.FlightNumber"}},e.text_ir_flighth={min:0,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"linkEntity.FlightH"}},e.text_ir_flightm={min:0,max:59,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"linkEntity.FlightM"}},e.txt_ir_LinkedRemark={bindingOptions:{value:"linkEntity.LinkedRemark"}},e.useCrew=!0,e.chk_ir_crew={text:"Use Crew",bindingOptions:{value:"useCrew"}},e.time_ir_start={type:"date",width:"100%",interval:15,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"time_ir_std_date"}},e.time_ir_start_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"time_ir_std_time"}},e.time_ir_end={type:"date",width:"100%",interval:15,readOnly:!0,onValueChanged:function(e){},bindingOptions:{value:"time_ir_sta_date"}},e.time_ir_end_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,readOnly:!0,onValueChanged:function(e){},bindingOptions:{value:"time_ir_sta_time"}},e.sb_ir_fromairport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceAirport(),onSelectionChanged:function(t){e.getIrRoute()},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"linkEntity.FromAirportId"}},e.sb_ir_toairport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceAirport(),onSelectionChanged:function(t){e.getIrRoute()},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"linkEntity.ToAirportId"}},e.sb_ir_flighttype={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"linkEntity.FlightTypeID"}},e.getRealMSNs=function(e){return new DevExpress.data.DataSource({store:new DevExpress.data.ODataStore({url:n.serviceUrl+"odata/aircrafts/customer/"+e,version:4}),sort:["AircraftType","Register"]})},e.getSbTemplateAircraft=function(e){return"<div><div class='tmpl-col-left'>"+e.Register+"</div><div class='tmpl-col-right'>"+e.AircraftType+"</div></div>"},e.sb_ir_msn={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(t){return e.getSbTemplateAircraft(t)},searchExpr:["Register","MSN"],dataSource:e.getRealMSNs(Config.CustomerId),displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(e){},bindingOptions:{value:"linkEntity.RegisterID"}},e.getIrRoute=function(){e.linkEntity&&e.linkEntity.FromAirportId&&e.linkEntity.ToAirportId&&(e.loadingVisible=!0,a.getRoute(e.linkEntity.FromAirportId,e.linkEntity.ToAirportId).then(function(t){t&&(e.linkEntity.FlightH=t.FlightH,e.linkEntity.FlightM=t.FlightM),e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},e.btn_link={text:"Link",type:"default",icon:"fas fa-link",width:120,onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.linkEntity={ID:-1,CustomerId:Config.CustomerId},e.linkEntity.LinkedFlight=e.flight.ID,e.flight.RedirectReasonId&&(e.linkEntity.ToAirportId=e.flight.OToAirportId,e.linkEntity.ToAirportIATA=e.flight.OToAirportIATA,e.linkEntity.FlightNumber=null,e.linkEntity.FlightPlanId=null,e.linkEntity.FromAirportId=e.flight.ToAirport,e.linkEntity.FromAirportIATA=e.flight.ToAirportIATA,e.time_ir_std_date=General.getDayFirstHour(new Date(e.flight.STD)),e.time_ir_std_time=null,e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.linkEntity.FlightTypeID=null,e.linkEntity.RegisterID=e.flight.RegisterID),e.popup_link_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.btn_free={text:"Nonscheduled Flight",type:"default",icon:"airplane",width:250,onClick:function(t){e.linkEntity={ID:-1,CustomerId:Config.CustomerId};var i=General.getDayFirstHour(new Date(e.selectedDate));e.time_ir_std_date=new Date(i),e.popup_free_visible=!0}},e.before_refreshed_flight=null,e.undoRefresh=function(){e.flight.FlightStatusID=e.before_refreshed_flight.FlightStatusID,e.flight.DepartureRemark=e.before_refreshed_flight.DepartureRemark,e.flight.CancelReasonId=e.before_refreshed_flight.CancelReasonId,e.flight.CancelRemark=e.before_refreshed_flight.CancelRemark,e.flight.CancelDate=e.before_refreshed_flight.CancelDate,e.flight.RedirectReasonId=e.before_refreshed_flight.RedirectReasonId,e.flight.RedirectRemark=e.before_refreshed_flight.RedirectRemark,e.flight.RedirectDate=e.before_refreshed_flight.RedirectDate,e.flight.RampReasonId=e.before_refreshed_flight.RampReasonId,e.flight.RampRemark=e.before_refreshed_flight.RampRemark,e.flight.RampDate=e.before_refreshed_flight.RampDate,e.flight.ToAirport=e.before_refreshed_flight.ToAirport,e.flight.ToAirportIATA=e.before_refreshed_flight.ToAirportIATA,e.flight.OToAirportId=e.before_refreshed_flight.OToAirportId,e.flight.OToAirportIATA=e.before_refreshed_flight.OToAirportIATA,e.flight.FPFlightHH=e.before_refreshed_flight.FPFlightHH,e.flight.FPFlightMM=e.before_refreshed_flight.FPFlightMM,e.flight.FPFuel=e.before_refreshed_flight.FPFuel,e.flight.Defuel=e.before_refreshed_flight.Defuel,e.flight.TotalDelayHH=e.before_refreshed_flight.TotalDelayHH,e.flight.TotalDelayMM=e.before_refreshed_flight.TotalDelayMM,e.flight.TotalDelayTotalMM=e.before_refreshed_flight.TotalDelayTotalMM,e.flight.PaxAdult=e.before_refreshed_flight.PaxAdult,e.flight.PaxChild=e.before_refreshed_flight.PaxChild,e.flight.PaxInfant=e.before_refreshed_flight.PaxInfant,e.flight.BaggageCount=e.before_refreshed_flight.BaggageCount,e.flight.BaggageWeight=e.before_refreshed_flight.BaggageWeight,e.flight.CargoWeight=e.before_refreshed_flight.CargoWeight,e.flight.CargoCount=e.before_refreshed_flight.CargoCount,e.flight.FuelDeparture=e.before_refreshed_flight.FuelDeparture,e.flight.FuelArrival=e.before_refreshed_flight.FuelArrival,e.flight.ChocksOut=e.before_refreshed_flight.ChocksOut,e.flight.Takeoff=e.before_refreshed_flight.Takeoff,e.flight.Landing=e.before_refreshed_flight.Landing,e.flight.ChocksIn=e.before_refreshed_flight.ChocksIn,e.flightOffBlock2=e.flight.ChocksOut,e.flightOffBlock2||(e.flightOffBlock2=e.flight.STD),e.flightTakeOff2=e.flight.Takeoff,e.flightTakeOff2||(e.flightTakeOff2=e.flight.STD),e.flightOnBlock2=e.flight.ChocksIn,e.flightOnBlock2||(e.flightOnBlock2=e.flight.STA),e.flightLanding2=e.flight.Landing,e.flightLanding2||(e.flightLanding2=e.flight.STA)},e.btn_refresh={text:"Refresh",type:"danger",width:120,onClick:function(t){e.before_refreshed_flight=JSON.parse(JSON.stringify(e.flight)),e.flight.FlightStatusID=1,e.flight.DepartureRemark=null,e.time_status_value=null,e.flight.CancelReasonId=null,e.flight.CancelRemark=null,e.flight.CancelDate=null,e.flight.RedirectReasonId=null,e.flight.RedirectRemark=null,e.flight.RedirectDate=null,e.flight.RampReasonId=null,e.flight.RampRemark=null,e.flight.RampDate=null,e.flight.OToAirportId&&(e.flight.ToAirport=e.flight.OToAirportId,e.flight.ToAirportIATA=e.flight.OToAirportIATA),e.flight.FPFlightHH=null,e.flight.FPFlightMM=null,e.flight.FPFuel=null,e.flight.Defuel=null,e.flight.TotalDelayHH=null,e.flight.TotalDelayMM=null,e.flight.TotalDelayTotalMM=0,e.flight.PaxAdult=null,e.flight.PaxChild=null,e.flight.PaxInfant=null,e.flight.BaggageCount=null,e.flight.BaggageWeight=null,e.flight.CargoWeight=null,e.flight.CargoCount=null,e.flight.FuelDeparture=null,e.flight.FuelArrival=null,e.dg_delay_ds=[],e.flight.ChocksOut=null,e.flight.Takeoff=null,e.flight.Landing=null,e.flight.ChocksIn=null,e.flightOffBlock2=e.flight.ChocksOut,e.flightOffBlock2||(e.flightOffBlock2=e.flight.STD),e.flightTakeOff2=e.flight.Takeoff,e.flightTakeOff2||(e.flightTakeOff2=e.flight.STD),e.flightOnBlock2=e.flight.ChocksIn,e.flightOnBlock2||(e.flightOnBlock2=e.flight.STA),e.flightLanding2=e.flight.Landing,e.flightLanding2||(e.flightLanding2=e.flight.STA)}},e.jl={},e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.flight.FlightPlanId?General.ShowNotify("The selected item cannot be deleted.","error"):General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.flight.ID};e.loadingVisible=!0,a.deleteFlight(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.BeginSearch()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.btn_print={text:"Print",type:"default",icon:"print",width:110,onClick:function(e){html2canvas(document.querySelector("#gantt_container_ba")).then(function(e){c(e)})}},e.btn_pax={text:"Pax",type:"default",icon:"fas fa-user-tag",width:"100%",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.depReadOnly=!1,e.paxSaved=!1,e.flight=e.selectedFlights[0],e.calculateTotalPax(),e.popup_pax_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.btn_cargo={text:"Cargo",type:"default",icon:"fas fa-boxes",width:"100%",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.depReadOnly=!1,e.flight=e.selectedFlights[0],e.cargoSaved=!1,e.popup_cargo_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.fuelDepSaved=!1,e.fuelArrSaved=!1,e.$dgrow=null,e.btn_fueldep={text:"Fuel(D)",type:"default",icon:"fas fa-burn",width:"100%",bindingOptions:{disabled:"IsDepartureDisabled"},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.depReadOnly=!1,e.flight=e.selectedFlights[0],e.fuelDepSaved=!1,e.$dgrow=$("#dg_flights").find(".dx-row.dx-selection"),e.popup_fueldep_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.fuelArrSaved=!1,e.btn_fuelarr={text:"Fuel(A)",type:"default",icon:"fas fa-burn",width:"100%",bindingOptions:{disabled:"IsArrivalDisabled"},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.fuelArrSaved=!1,e.popup_fuelarr_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.IsCancelVisible=!1,e.btn_cancel={text:"Cancel",type:"danger",icon:"fas fa-ban",width:"150",bindingOptions:{},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.entity_cancel.CancelDate=new Date(Date.now()),e.popup_cancel_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.IsRedirectVisible=!1,e.btn_redirect={text:"Redirect",type:"danger",icon:"fas fa-random",width:"150",bindingOptions:{},onClick:function(t){e.selectedFlights&&0!=e.selectedFlights.length?(e.flight=e.selectedFlights[0],e.entity_redirect.RedirectDate=new Date(Date.now()),e.popup_redirect_visible=!0):General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.getGantt=function(){return $("#resourceGanttba").data("ejGantt")},e.ganttData=null,e.resourceGroups=[],e.resources=[],e.dataSource=[],e.totalFlights="-",e.totalDelays="-",e.departedFlights="-",e.arrivedFlights="-",e.canceledFlights="-",e.departedPax="-",e.arrivedPax="-",e.calculateSummary=function(){e.totalFlights=e.dataSource.length,e.departedFlights=Enumerable.From(e.dataSource).Where("$.Takeoff").ToArray().length,e.arrivedFlights=Enumerable.From(e.dataSource).Where("$.Landing").ToArray().length,e.canceledFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==4").ToArray().length,e.redirectedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==17").ToArray().length,e.divertedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID== 7").ToArray().length,e.totalDelays=Enumerable.From(e.dataSource).Where("$.ChocksOut").Select("$.delay").Sum(),e.departedPax=Enumerable.From(e.dataSource).Where("$.Takeoff").Select("$.TotalPax").Sum(),e.arrivedPax=Enumerable.From(e.dataSource).Where("$.Landing").Select("$.TotalPax").Sum(),e.airportEntity&&(e.totalFlights=e.dataSource.length,e.departedFlights=Enumerable.From(e.dataSource).Where("$.Takeoff && $.FromAirport=="+e.airportEntity.Id).ToArray().length,e.arrivedFlights=Enumerable.From(e.dataSource).Where("$.Landing && $.ToAirport=="+e.airportEntity.Id).ToArray().length,e.canceledFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==4").ToArray().length,e.redirectedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID==17").ToArray().length,e.divertedFlights=Enumerable.From(e.dataSource).Where("$.FlightStatusID== 7").ToArray().length,e.totalDelays=Enumerable.From(e.dataSource).Where("$.FromAirport=="+e.airportEntity.Id+" && $.ChocksOut").Select("$.delay").Sum(),e.departedPax=Enumerable.From(e.dataSource).Where("$.Takeoff && $.FromAirport=="+e.airportEntity.Id).Select("$.TotalPax").Sum(),e.arrivedPax=Enumerable.From(e.dataSource).Where("$.Landing && $.ToAirport=="+e.airportEntity.Id).Select("$.TotalPax").Sum())},e.gaugeOptions={valueIndicator:{indentFromCenter:50,spindleSize:0,type:"rangeBar"},subvalueIndicator:{type:"textcloud",text:{customizeText:function(e){return e.valueText}}},scale:{startValue:0,endValue:150,tickInterval:10,label:{useRangeColors:!0}},rangeContainer:{palette:"pastel",ranges:[{startValue:0,endValue:150}]},title:{text:"Departed",font:{size:14},verticalAlignment:"bottom"},size:{width:200,height:200},value:90,subvalues:[90]};var g=-1*(new Date).getTimezoneOffset();e.footerfilter=!1,e.searched=!1,e.baseSum=null,e.bindFlights=function(t){if(t)try{$(".e-ganttviewerbodyContianer").data("ejScroller").scrollLeft()}catch(e){}var i={Status:e.filterStatus,Types:e.filterType,Registers:e.filterAircraft,From:e.filterFrom,To:e.filterTo};e.hideButtons2(),e.selectedFlights=[],e.dg_flights_instance.deselectAll(),e.tabs_date=[];var n=e.selectedTabDateIndex;e.selectedTabDateIndex=-1,e.loadingVisible=!0;var o=new Date(e.dateEnd).toUTCDateTimeDigits();a.getPlanGantt(Config.CustomerId,new Date(e.datefrom).toUTCDateTimeDigits(),o,g,e.IsAdmin?null:e.airportEntity.Id,i).then(function(t){$.each(t.tabs,function(t,i){e.tabs_date.push({text:i.DateRangeTitle,id:t,date:moment(i.DateFrom).format("YYYY/MM/DD"),dateFrom:new Date(i.DateFrom),dateTo:new Date(i.DateTo)})}),e.tabsdatevisible=!0,e.loadingVisible=!1,e.baseDate=new Date(Date.now()).toUTCString(),e.ganttData=t,e.baseSum=e.ganttData.baseSummary,e.resourceGroups=t.resourceGroups,e.resources=t.resources,e.dataSource=Flight.proccessDataSource(t.flights),Flight.activeDatasource=e.dataSource,console.log(t),console.log("-------------------"),console.log(e.dataSource),-1!=n&&t.tabs.length>n?e.selectedTabDateIndex=n:e.selectedTabDateIndex=0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.baseDate=null,e.search=function(){e.updatedFlightsCount=0,e.updatedFlights=[],e.bindFlights(!1)},e.fillFlight=function(e,t){e.FlightPlanId=t.FlightPlanId,e.BaggageCount=t.BaggageCount,e.CargoUnitID=t.CargoUnitID,e.CargoUnit=t.CargoUnit,e.CargoWeight=t.CargoWeight,e.PaxChild=t.PaxChild,e.PaxInfant=t.PaxInfant,e.PaxAdult=t.PaxAdult,e.FuelArrival=t.FuelArrival,e.FuelDeparture=t.FuelDeparture,e.FuelActual=t.FuelActual,e.FuelPlanned=t.FuelPlanned,e.GWLand=t.GWLand,e.GWTO=t.GWTO,e.BlockM=t.BlockM,e.BlockH=t.BlockH,e.FlightH=t.FlightH,e.FlightM=t.FlightM,e.ChocksIn=t.ChocksIn,e.Landing=t.Landing,e.Takeoff=t.Takeoff,e.ChocksOut=t.ChocksOut,e.STD=t.STD,e.STA=t.STA,e.FlightStatusID=t.FlightStatusID,e.RegisterID=t.RegisterID,e.FlightTypeID=t.FlightTypeID,e.TypeId=t.TypeId,e.AirlineOperatorsID=t.AirlineOperatorsID,e.FlightNumber=t.FlightNumber,e.FromAirport=t.FromAirport,e.ToAirport=t.ToAirport,e.STAPlanned=t.STAPlanned,e.STDPlanned=t.STDPlanned,e.FlightHPlanned=t.FlightHPlanned,e.FlightMPlanned=t.FlightMPlanned,e.FlightPlan=t.FlightPlan,e.CustomerId=t.CustomerId,e.IsActive=t.IsActive,e.DateActive=t.DateActive,e.FromAirportName=t.FromAirportName,e.FromAirportIATA=t.FromAirportIATA,e.FromAirportCityId=t.FromAirportCityId,e.ToAirportName=t.ToAirportName,e.ToAirportIATA=t.ToAirportIATA,e.ToAirportCityId=t.ToAirportCityId,e.FromAirportCity=t.FromAirportCity,e.ToAirportCity=t.ToAirportCity,e.AircraftType=t.AircraftType,e.Register=t.Register,e.MSN=t.MSN,e.FlightStatus=t.FlightStatus,e.FlightStatusBgColor=t.FlightStatusBgColor,e.FlightStatusColor=t.FlightStatusColor,e.FlightStatusClass=t.FlightStatusClass,e.from=t.from,e.to=t.to,e.notes=t.notes,e.status=t.status,e.progress=t.progress,e.taskName=t.taskName,e.startDate=t.startDate,e.duration=t.duration,e.taskId=t.taskId,e.FlightGroupID=t.FlightGroupID,e.PlanId=t.PlanId,e.ManufacturerId=t.ManufacturerId,e.Manufacturer=t.Manufacturer,e.ToCountry=t.ToCountry,e.ToSortName=t.ToSortName,e.ToCity=t.ToCity,e.FromSortName=t.FromSortName,e.FromContry=t.FromContry,e.FromCity=t.FromCity,e.FromLatitude=t.FromLatitude,e.FromLongitude=t.FromLongitude,e.ToLatitude=t.ToLatitude,e.ToLongitude=t.ToLongitude,e.CargoCount=t.CargoCount,e.BaggageWeight=t.BaggageWeight,e.FuelUnitID=t.FuelUnitID,e.ArrivalRemark=t.ArrivalRemark,e.DepartureRemark=t.DepartureRemark,e.TotalSeat=t.TotalSeat,e.EstimatedDelay=t.EstimatedDelay,e.PaxOver=t.PaxOver,e.TotalPax=t.TotalPax,e.FuelUnit=t.FuelUnit,e.DateStatus=t.DateStatus},e.doActionCompleteSave=!0,e.updatedFlightsCount=0,e.updatedFlights=[],e.addUpdatedFlights=function(t){e.updatedFlights=Enumerable.From(e.updatedFlights).Where("$.ID!="+t.ID).ToArray();var i={ID:t.ID,FlightNumber:t.FlightNumber,ToAirportIATA:t.ToAirportIATA,FromAirportIATA:t.FromAirportIATA,FlightStatus:t.FlightStatus,DateStatus:t.DateStatus};e.updatedFlights.push(i),e.updatedFlightsCount=e.updatedFlights.length},e.removeUpdatedFlights=function(t){e.updatedFlights=Enumerable.From(e.updatedFlights).Where("$.ID!="+t.ID).ToArray(),e.updatedFlightsCount=e.updatedFlights.length},e.showUpdatedFlights=function(){e.popup_upd_visible=!0},e.utimer=null,e.StartUTimer=function(){},e.StopUTimer=function(){e.utimer&&clearTimeout(e.utimer)},e.nowlinetimer=null,e.nowlinelastdate=new Date,e.IsUTC=!1,e.StartNowLineTimerFirst=!0,e.StartNowLineTimerFirstTime=null,e.nowlineInitLeft=null,e.StartNowLineTimer=function(e){},e.StopNowLineTimer=function(){e.nowlinetimer&&clearTimeout(e.nowlinetimer)},e.selectedTabDateIndex=-1,e.tabsdatefirst=!0,e.$watch("selectedTabDateIndex",function(t){try{if(-1==e.selectedTabDateIndex)return;e.selectedTab=e.tabs_date[t],e.selectedDate=new Date(e.selectedTab.date),e.StopNowLineTimer(),e.createGantt(),e.footerfilter=!0,e.searched=!0,e.autoUpdate&&e.StartUTimer()}catch(e){alert(e)}}),e.tabs_date=[],e.tabs_date_options={scrollByContent:!0,showNavButtons:!0,elementAttr:{class:"tabsdate"},onItemClick:function(e){},onItemRendered:function(e){},bindingOptions:{visible:"tabsdatevisible",dataSource:{dataPath:"tabs_date",deep:!0},selectedIndex:"selectedTabDateIndex"}},e.autoUpdate=!0,e.check_autoupdate={width:"100%",text:"Auto Update",onValueChanged:function(t){t.value?e.StartUTimer():e.StopUTimer()},bindingOptions:{value:"autoUpdate"}},e.btn_update={text:"",type:"success",icon:"pulldown",width:"40",bindingOptions:{disabled:"autoUpdate"},onClick:function(t){console.log("update");var i={from:new Date(e.datefrom).toUTCString(),to:new Date(e.dateto).toUTCString(),baseDate:e.baseDate,airport:e.airportEntity?e.airportEntity.Id:-1,customer:Config.CustomerId,tzoffset:-1*(new Date).getTimezoneOffset(),userid:n.userId?n.userId:-1};e.loadingVisible=!0,a.getUpdatedFlights(i).then(function(t){e.loadingVisible=!1,console.log("updated 1"),console.log(t),e.baseDate=new Date(Date.now()).toUTCString();var i=$("#resourceGanttba").data("ejGantt");console.log("updated 1"),console.log(t),$.each(t.flights,function(t,n){var a=Enumerable.From(e.dataSource).Where("$.ID=="+n.ID).FirstOrDefault();a&&(e.doActionCompleteSave=!1,e.fillFlight(a,n),Flight.processDataOffBlock(a),e.addUpdatedFlights(a),i.updateRecordByTaskId(a),e.calculateSummary(),console.log("updated 2"),console.log(a))})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e._flightno="",e.text_flightno={bindingOptions:{value:"_flightno"}},e.btn_goflight={text:"",type:"success",icon:"arrowright",width:"35",bindingOptions:{},onClick:function(t){if(e._flightno){var i=Enumerable.From(e.dataSource).Where("$.FlightNumber.toLowerCase()=='"+e._flightno.toLowerCase()+"'").FirstOrDefault();i?e.scrollGantt(i):General.ShowNotify("Flight not found","error")}}},e.ganttview=!0,e.gridview=!0,e.btn_swap={text:"",type:"default",icon:"fas fa-exchange-alt",width:"40",bindingOptions:{},onClick:function(t){e.createGantt()}},e.btn_plan_new={type:"default",icon:"plus",width:"40",onClick:function(t){e.doRefresh=!1,e.planEntity.Id=-1,e.tempData=null,e.IsNew=!0,e.addMode=!0,e.popup_plan_add_visible=!0},bindingOptions:{visible:"IsPlanning"}},e.btn_plan_delete={type:"danger",icon:"clear",width:"40",onClick:function(t){if(e.selectedFlights&&0!=e.selectedFlights.length){var i=e.selectedFlights[0];General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var n={Id:i.Id};e.loadingVisible=!0,a.deletePlanItemBoard(n).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.BeginSearch()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}})}else General.ShowNotify(Config.Text_NoFlightSelected,"error")},bindingOptions:{visible:"IsPlanning"}},e.btn_plan_edit={type:"default",icon:"edit",width:40,onClick:function(t){if(e.selectedFlights&&0!=e.selectedFlights.length){var i=-1*(new Date).getTimezoneOffset(),n=e.selectedFlights[0];e.loadingVisible=!0,a.getPlanItemBoard(n.Id,i).then(function(t){e.loadingVisible=!1,e.IsNew=!1,e.tempData=t,e.doRefresh=!1,e.popup_plan_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.btn_interval={type:"default",icon:"event",width:40,onClick:function(t){if(e.selectedFlights&&0!=e.selectedFlights.length){(new Date).getTimezoneOffset();var i=e.selectedFlights[0];a.getFlightPlanView(i.PlanId).then(function(t){e.entityInterval.FlightPlanId=t.plan.Id,e.entityInterval.DateFrom=t.plan.DateFrom,e.entityInterval.DateTo=t.plan.DateTo,e.entityInterval.Interval=t.plan.Interval,e.entityInterval.BaseIATA=t.plan.BaseIATA,e.entityInterval.Register=t.plan.VirtualRegister,e.entityInterval.Months=[],e.entityInterval.Days=[],100==e.entityInterval.Interval||(e.popup_interval_visible=!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_NoFlightSelected,"error")}},e.popup_plan_add_visible=!1,e.popup_plan_add_title="New",e.popup_plan_add={width:600,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"bplan",onClick:function(t){t.validationGroup.validate().isValid?(e.planEntity.DateFrom=new Date(e.planEntity.iDateFrom).ToUTC(),e.planEntity.DateTo=new Date(e.planEntity.iDateTo).ToUTC(),e.planEntity.Dep=new Date(e.planEntity.Dep).toUTCString(),e.planEntity.Arr=new Date(e.planEntity.Arr).toUTCString(),e.planEntity.TypeId=12,e.loadingVisible=!0,a.savePlanItemBoard(e.planEntity).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.refreshPlanEntity(),e.popup_plan_add_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.tempData?e.bindPlanEntity(e.tempData):(e.planEntity.iDateFrom=new Date(e.selectedTab.dateFrom),e.planEntity.iDateTo=new Date(e.selectedTab.dateTo))},onHiding:function(){e.clearPlanEntity(),e.popup_plan_add_visible=!1,e.doRefresh&&e.BeginSearch()},bindingOptions:{visible:"popup_plan_add_visible",title:"popup_plan_add_title"}},e.popup_plan_add.toolbarItems[1].options.onClick=function(t){e.popup_plan_add_visible=!1},e.popup_interval_visible=!1,e.popup_interval_title="Interval",e.popup_interval={width:600,height:460,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplaninterval2",onClick:function(t){if(t.validationGroup.validate().isValid){var i={Id:e.entityInterval.FlightPlanId,DateFrom:new Date(e.entityInterval.DateFrom).ToUTC(),DateTo:new Date(e.entityInterval.DateTo).ToUTC(),Interval:e.entityInterval.Interval,Months:e.entityInterval.Months,Days:e.entityInterval.Days,DateFirst:new Date(e.entityInterval.DateFrom).ToUTC()};e.loadingVisible=!0,a.savePlanInterval(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.clearEntityInterval(),e.popup_interval_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_interval_visible=!1,e.doRefresh&&e.BeginSearch()},bindingOptions:{visible:"popup_interval_visible",title:"popup_interval_title"}},e.popup_interval.toolbarItems[1].options.onClick=function(t){e.popup_interval_visible=!1},e.text_base={readOnly:!0,bindingOptions:{value:"entityInterval.BaseIATA"}},e.text_msn={readOnly:!0,bindingOptions:{value:"entityInterval.Register"}},e.date_from2={type:"date",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entityInterval.DateFrom"}},e.date_to2={type:"date",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entityInterval.DateTo"}},e.intervalTypes=[{Id:1,Title:"Daily"}],e.sb_interval2={showClearButton:!0,width:"100%",searchEnabled:!1,displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){e.customDisabled=t.selectedItem&&100!=t.selectedItem.Id},bindingOptions:{value:"entityInterval.Interval",dataSource:"intervalTypes"}},e.customDisabled=!0,e.tag_months_instance=null,e.tag_months={dataSource:General.MonthDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_months_instance||(e.tag_months_instance=t.component)},onSelectionChanged:function(e){},bindingOptions:{disabled:"customDisabled",value:"entityInterval.Months"}},e.tag_days_instance=null,e.tag_days={dataSource:General.WeekDayDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_days_instance||(e.tag_days_instance=t.component)},onSelectionChanged:function(e){},bindingOptions:{disabled:"customDisabled",value:"entityInterval.Days"}},e.entityInterval={FlightPlanId:null,DateFrom:null,DateTo:null,Interval:null,BaseIATA:null,Register:null,Months:[],Days:[]},e.clearEntityInterval=function(){e.entityInterval.FlightPlanId=null,e.entityInterval.DateFrom=null,e.entityInterval.DateTo=null,e.entityInterval.Interval=null,e.entityInterval.BaseIATA=null,e.entityInterval.Register=null,e.entityInterval.Months=[],e.entityInterval.Days=[]},e.planEntity={Id:null,DateFrom:null,DateTo:null,iDateFrom:new Date(2019,11,22),iDateTo:new Date(2020,0,20),TypeId:null,FromId:null,ToId:null,Dep:null,Arr:null,FlightH:null,FlightM:null,FlightNumber:null,Day:null},e.refreshPlanEntity=function(){e.planEntity.Id=-1,e.planEntity.FlightH=null,e.planEntity.FlightM=null,e.planEntity.FlightNumber=null},e.clearPlanEntity=function(){e.planEntity.Id=null,e.planEntity.DateFrom=new Date(2019,11,22),e.planEntity.DateTo=new Date(2020,0,20),e.planEntity.iDateFrom=new Date(2019,11,22),e.planEntity.iDateTo=new Date(2020,0,20),e.planEntity.TypeId=null,e.planEntity.FromId=null,e.planEntity.ToId=null,e.planEntity.Arr=null,e.planEntity.Dep=null,e.planEntity.FlightH=null,e.planEntity.FlightM=null,e.planEntity.FlightNumber=null,e.start=null},e.DotBlockToBlock=!0,e.bindPlanEntity=function(t){e.DotBlockToBlock=!1,e.planEntity.Id=t.Id,e.planEntity.DateFrom=t.DateFrom,e.planEntity.DateTo=t.DateTo,e.planEntity.iDateFrom=t.DateFrom,e.planEntity.iDateTo=t.DateTo,e.planEntity.Day=t.Day,e.planEntity.TypeId=t.TypeId,e.planEntity.FlightNumber=t.FlightNumber,e.planEntity.FromId=t.FromId,e.planEntity.ToId=t.ToId,e.planEntity.Arr=t.STA,e.planEntity.Dep=t.STD,e.planEntity.FlightH=t.FlightH,e.planEntity.FlightM=t.FlightM,e.start=new Date(e.planEntity.Dep),e.tempToAirport=e.planEntity.ToId},e.plan_dg2_selected=null,e.plan_dg2_columns=[{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300}],e.plan_dg2_height=400,e.plan_dg2_instance=null,e.plan_dg2_ds=[],e.plan_dg2={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.plan_dg2_columns,onContentReady:function(t){e.plan_dg2_instance||(e.plan_dg2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.plan_dg2_selected=i||null},onCellPrepared:function(e){},bindingOptions:{dataSource:"plan_dg2_ds",height:"plan_dg2_height"}},e.plan_date_from={type:"date",width:"100%",onValueChanged:function(t){e.planEntity.iDateFrom=t.value},bindingOptions:{value:"planEntity.iDateFrom"}},e.plan_date_to={type:"date",width:"100%",onValueChanged:function(t){e.planEntity.iDateTo=t.value},bindingOptions:{value:"planEntity.iDateTo"}},e.selectedType=null,e.ds_msn=[],e.msn_readOnly=!0,e.sb_type={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(e){return n.getSbTemplateAircraft(e)},searchExpr:["Type","Manufacturer"],dataSource:n.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",onSelectionChanged:function(t){e.ds_msn=[],e.msn_readOnly=!0,t&&t.selectedItem?(e.planEntity.AircraftType=t.selectedItem.Type,l.getVirtualMSNsByType(Config.CustomerId,t.selectedItem.Id).then(function(t){e.msn_readOnly=!1,e.ds_msn=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):(e.msn_readOnly=!0,e.ds_msn=[],e.planEntity.AircraftType=null)},bindingOptions:{value:"planEntity.TypeId",selectedItem:"selectedType"}},e.unknown_readOnly=!1,e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(t){if(t.selectedItem){e.planEntity.Register=t.selectedItem.Register;var i=-1*(new Date).getTimezoneOffset(),n={CustomerId:Config.CustomerId,Date:new Date(e.planEntity.iDateFrom).ToUTC(),RegisterId:t.selectedItem.ID,Offset:i};e.loadingVisible=!0,a.getPlanLastItem(n).then(function(t){e.loadingVisible=!1,t&&-1!=t.Id?(e.isBaseDisabled=!0,e.planEntity.BaseId=t.BaseId,e.IsNew&&(e.planEntity.FromAirport=t.ToAirport,e.planEntity.ToAirport=null,e.planEntity.STD=new Date(t.STA),e.start=new Date(e.planEntity.STD)),a.getPlanItems(n).then(function(t){e.plan_dg2_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):e.isBaseDisabled=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else e.planEntity.Register=null,e.planEntity.BaseId=null,e.isBaseDisabled=!0},bindingOptions:{value:"planEntity.RegisterID",disabled:"msn_readOnly",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.isBaseDisabled=!0,e.sb_Base={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){e.isBaseDisabled||(e.planEntity.FromAirport=t.selectedItem.Id)},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"planEntity.BaseId",disabled:"isBaseDisabled"}},e.tempToAirport=null,e.selectedFromAirport=null,e.selectedToAirport=null,e.sb_FromAirport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){if(e.planEntity.ToId=null,!t.selectedItem)return e.ds_toairport=[],void(e.planEntity.FromId=null);e.planEntity.FromAirportIATA=t.selectedItem.IATA,e.loadingVisible=!0,a.getRouteDestination(Config.AirlineId,t.selectedItem.Id).then(function(t){e.loadingVisible=!1,e.ds_toairport=t,e.tempToAirport&&(e.planEntity.ToId=e.tempToAirport,e.tempToAirport=null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"planEntity.FromId",selectedItem:"selectedFromAirport"}},e.ds_toairport=[],e.sb_ToAirport={showClearButton:!0,searchEnabled:!0,itemTemplate:function(e){return n.getSbTemplateRouteTo(e)},onSelectionChanged:function(t){t.selectedItem?(e.planEntity.RouteId=t.selectedItem.Id,e.DotBlockToBlock?(e.planEntity.FlightH=t.selectedItem.FlightH,e.planEntity.FlightM=t.selectedItem.FlightM):e.DotBlockToBlock=!0,e.planEntity.ToAirportIATA=t.selectedItem.ToAirportIATA):(e.planEntity.RouteId=null,e.planEntity.FlightH=null,e.planEntity.FlightM=null,e.planEntity.ToAirportIATA=null),e.setArrivalPlan()},searchExpr:["ToAirportIATA","ToCity"],displayExpr:"ToAirportIATA",valueExpr:"ToAirportId",bindingOptions:{value:"planEntity.ToId",selectedItem:"selectedRoute",dataSource:"ds_toairport"}},e.selectedRoute=null,e.setArrivalPlan=function(){if(null!=e.planEntity.Dep&&null!=e.planEntity.FlightH&&null!=e.planEntity.FlightM){var t=new Date(e.planEntity.Dep);e.planEntity.Arr=new Date(t.addHours(e.planEntity.FlightH).addMinutes(e.planEntity.FlightM))}else e.planEntity.Arr=null},e.start=null,e.time_start={type:"time",width:"100%",interval:15,onValueChanged:function(t){if(t.value){var i=new Date(t.value),n=i.getHours()+":"+i.getMinutes()+":00",a=new Date(e.planEntity.iDateFrom).getDatePartSlash()+" "+n,o=new Date(a);e.planEntity.Dep=o}else e.planEntity.Dep=null;e.setArrivalPlan()},bindingOptions:{value:"start"}},e.time_end={readOnly:!0,type:"time",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"planEntity.Arr"}},e.text_flighth={min:0,onValueChanged:function(t){e.setArrivalPlan()},bindingOptions:{value:"planEntity.FlightH"}},e.text_flightm={min:0,max:59,onValueChanged:function(t){e.setArrivalPlan()},bindingOptions:{value:"planEntity.FlightM"}},e.text_flightnumber={bindingOptions:{value:"planEntity.FlightNumber"}},e.plan_sb_flighttype={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"planEntity.FlightTypeID"}},e.plan_sb_days={showClearButton:!0,searchEnabled:!0,dataSource:["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],bindingOptions:{value:"planEntity.Day"}},e.dateEnd=null,e.tabsdatevisible=!1,e.BeginSearch=function(){e.datefrom=General.getDayFirstHour(new Date(e._datefrom)),e.dateEnd=General.getDayLastHour(new Date(new Date(e._datefrom).addDays(e.days_count-1))),e.dateto=General.getDayLastHour(new Date(e._datefrom)),e.StopNowLineTimer(),e.search()},e.btn_search={text:"Search",type:"success",icon:"search",width:120,validationGroup:"flightboarddate",bindingOptions:{},onClick:function(t){e.StopUTimer(),e.BeginSearch()}},e.jlShow=!1,e.btn_fill={text:"Fill",type:"success",width:100,bindingOptions:{},onClick:function(t){var i=[];if(e.leg1Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg1Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg2Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg2Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg3Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg3Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg4Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg4Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg5Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg5Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg6Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg6Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg7Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg7Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg8Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg8Text+'"').FirstOrDefault();i.push(n.ID)}var o=i.join("_");e.loadingVisible=!0,a.getJLDataLegs(o).then(function(t){if(console.log("jl"),console.log(t),e.loadingVisible=!1,t){e.jl.MaxFDP=t.max,e.jl.AcType=e.flight.AircraftType,e.jl.Reg=e.flight.Register,e.jl.Date=moment(new Date(e.flight.Date)).format("MM-DD-YYYY"),e.jl.STD=moment(new Date(e.flight.STD)).format("HH:mm"),e.jl.formNo="FPI-OPS-01",e.jl.tel="+982177665544",e.jl.email="OpsEng@Airline.aero",e.jl.sectors=[];for(r=0;r<6;r++){var i=r+1,n={sector:i};if(t.flights.length>=i){var a=t.flights[r];n.from=a.FromAirportIATA,n.to=a.ToAirportIATA,n.no=a.FlightNumber,n.mm=moment(new Date(a.STD)).format("MM"),n.dd=moment(new Date(a.STD)).format("DD")}e.jl.sectors.push(n)}var o=Enumerable.From(t.crew).Where('$.JobGroupCode.startsWith("00101")').OrderBy("$.IsPositioning").ThenBy("$.GroupOrder").ThenBy("$.Name").ToArray(),l=Enumerable.From(t.crew).Where('$.JobGroupCode.startsWith("00102")').OrderBy("$.IsPositioning").ThenBy("$.GroupOrder").ThenBy("$.Name").ToArray();e.jl.cockpit=[],e.jl.cabin=[];var d=l.length;o.length>d&&(d=o.length),5>d&&(d=5),e.jl.crews=[];for(var r=0;r<d;r++){var s={};l.length>r&&(s=l[r]);var c={};o.length>r&&(c=o[r]),"Captain"==c.Position&&(c.Position="CPT"),"TRE"!=c.JobGroup&&"TRI"!=c.JobGroup&&"LTC"!=c.JobGroup||(c.Position="IP"),c.IsPositioning&&(c.Position="DH"),s.Position&&"Purser"==s.Position&&(s.Position="SCCM"),s.Position&&"FA"==s.Position&&(s.Position="CCM"),"ISCCM"==s.JobGroup&&(s.Position="ISCCM"),s.IsPositioning&&(s.Position="DH"),e.jl.crews.push({cabin:s,cockpit:c})}e.jl.rvsm1=[],e.jl.rvsm1.push({leg:1}),e.jl.rvsm1.push({leg:2}),e.jl.rvsm1.push({leg:3}),e.jl.rvsm2=[],e.jl.rvsm2.push({leg:4}),e.jl.rvsm2.push({leg:5}),e.jl.rvsm2.push({leg:6}),e.jlShow=!0}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.clShow=!1,e.btn_fill2={text:"Fill",type:"success",width:100,bindingOptions:{},onClick:function(t){var i=[];if(e.leg1Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg1Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg2Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg2Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg3Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg3Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg4Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg4Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg5Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg5Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg6Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg6Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg7Value){n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg7Text+'"').FirstOrDefault();i.push(n.ID)}if(e.leg8Value){var n=Enumerable.From(e.line).Where('$.FlightNumber=="'+e.leg8Text+'"').FirstOrDefault();i.push(n.ID)}var o=i.join("_");e.loadingVisible=!0,a.getCLDataLegs(o).then(function(t){if(e.loadingVisible=!1,t){var i=-1*(new Date).getTimezoneOffset();e.cl.actype=t.actype,e.cl.regs=t.regs;var n=new Date(t.std).addMinutes(i),a=new Date(t.sta).addMinutes(i);if(persianDate.toLocale("en"),e.cl.std_date=moment(new Date(n)).format("DD-MMM-YYYY"),e.cl.std_persian=new persianDate(n).format("DD-MM-YYYY"),e.cl.std_time=moment(new Date(n)).format("HH:mm"),e.cl.sta_date=moment(new Date(a)).format("DD-MMM-YYYY"),e.cl.sta_persian=new persianDate(a).format("DD-MM-YYYY"),e.cl.sta_time=moment(new Date(a)).format("HH:mm"),e.cl.route=t.route,e.cl.no=t.no,e.cl.formNo="",e.cl.tel="+982177665544",e.cl.email="OpsEng@Airline.aero",e.cl.crews=Enumerable.From(t.crew).OrderBy("$.IsPositioning").ThenBy("$.GroupOrder").ThenBy("$.Name").ToArray(),$.each(e.cl.crews,function(e,t){"Captain"==t.Position&&(t.Position="CPT"),"Purser"==t.Position&&(t.Position="SCCM"),"FA"==t.Position&&(t.Position="CCM"),"ISCCM"==t.JobGroup&&(t.Position="ISCCM"),"TRE"!=t.JobGroup&&"TRI"!=t.JobGroup&&"LTC"!=t.JobGroup||(t.Position="IP"),t.IsPositioning&&(t.Position="DH")}),e.cl.crews.length<18)for(var o=e.cl.crews.length;o<18;o++)e.cl.crews.push({Position:" ",Name:" "});e.clShow=!0}},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},e.datefrom=General.getDayFirstHour(new Date(2019,5,6,0,0,0)),e.dateto=General.getDayLastHour(new Date(2019,5,6,0,0,0)),e._datefrom=new Date,e.date_from={type:"date",placeholder:"From",width:"100%",displayFormat:"yyyy-MM-dd",bindingOptions:{value:"_datefrom"}},e.days_count=2,e.num_days={min:1,showSpinButtons:!1,bindingOptions:{value:"days_count"}},e.btn_test={text:"test",type:"success",icon:"search",width:"100%",bindingOptions:{},onClick:function(e){var t=$("#task-4908");console.log(t.length)}},e.date_to={type:"datetime",displayFormat:"yyyy-MM-dd HH:mm",width:"100%",interval:15,onValueChanged:function(e){if(e.value)new Date(e.value)},bindingOptions:{value:"dateto"}},e.filterStatus=null,e.tag_status={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["title"],dataSource:Flight.filteredStatusDataSource,displayExpr:"title",valueExpr:"id",bindingOptions:{value:"filterStatus"}},e.filterType=null,e.tag_types={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsAcTypes(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterType"}},e.filterAircraft=null,e.tag_aircrafts={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsRegisters(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterAircraft"}},e.filterFrom=null,e.tag_from={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsFrom(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterFrom"}},e.filterTo=null,e.tag_to={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Title"],dataSource:n.getDatasourceFlightsTo(Config.CustomerId),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"filterTo"}},e.checkOnBlock=!0,e.check_onblock={width:"100%",text:"On Block",bindingOptions:{value:"checkOnBlock"}},e.checkOffBlock=!0,e.check_offblock={width:"100%",text:"Off Block",bindingOptions:{value:"checkOffBlock"}},e.checkTakeOff=!0,e.check_takeoff={width:"100%",text:"Departued",bindingOptions:{value:"checkTakeOff"}},e.checkLanding=!0,e.check_landing={width:"100%",text:"Arrived",bindingOptions:{value:"checkLanding"}},e.checkScheduled=!0,e.check_scheduled={width:"100%",text:"Scheduled",bindingOptions:{value:"checkScheduled"}},e.applyNextFlight=!1,e.check_applynext={width:"100%",text:"Apply delay to next flights",bindingOptions:{value:"applyNextFlight"}},e.flightTakeOff=null,e.takeOffReadOnly=!1,e.time_takeoff={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightTakeOff",min:"flight.ChocksOut",readOnly:"takeOffReadOnly"}},e.calculateTotalDelay=function(){if(!e.flightOffBlock2)return e.flight.TotalDelayHH=null,e.flight.TotalDelayMM=null,void(e.flight.TotalDelayTotalMM=0);var t=new Date(e.flight.STD),i=new Date(e.flightOffBlock2);if(t>i)return e.flight.TotalDelayHH=0,e.flight.TotalDelayMM=0,void(e.flight.TotalDelayTotalMM=0);var n=subtractDates(t,i),a=Math.floor(n/60),o=n%60;e.flight.TotalDelayHH=a,e.flight.TotalDelayMM=o,e.flight.TotalDelayTotalMM=n,n&&n>0?$(".tdelay").addClass("pink"):$(".tdelay").removeClass("pink")},e.flightTakeOff2=null,e.time_takeoff2={type:"date",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightTakeOff2",readOnly:"IsTakeOffReadOnly",disabled:"IsTakeOffReadOnly"}},e.time_takeoff2_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(e){},bindingOptions:{value:"flightTakeOff2",readOnly:"IsTakeOffReadOnly",disabled:"IsTakeOffReadOnly"}},e.flightOffBlock=null,e.time_offblock={type:"datetime",width:"100%",interval:5,bindingOptions:{value:"flightOffBlock",min:"flight.baseStartDate"}},e.depReadOnly=!0,e.flightOffBlock2=null,e.time_offblock2={type:"date",width:"100%",onValueChanged:function(t){e.calculateTotalDelay()},interval:5,bindingOptions:{value:"flightOffBlock2",readOnly:"IsOffBlockReadOnly",disabled:"IsOffBlockReadOnly"}},e.time_offblock2_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(t){e.calculateTotalDelay()},bindingOptions:{value:"flightOffBlock2",readOnly:"IsOffBlockReadOnly",disabled:"IsOffBlockReadOnly"}},e.flightOnBlock=null,e.time_onblock={type:"datetime",width:"100%",interval:5,bindingOptions:{value:"flightOnBlock"}},e.flightOnBlock2=null,e.time_onblock2={type:"date",width:"100%",interval:5,bindingOptions:{value:"flightOnBlock2",readOnly:"IsOnBlockReadOnly",disabled:"IsOnBlockReadOnly"}},e.time_onblock2_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(e){},bindingOptions:{value:"flightOnBlock2",readOnly:"IsOnBlockReadOnly",disabled:"IsOnBlockReadOnly"}},e.flightLanding=null,e.landingReadOnly=!1,e.time_landing={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightLanding",min:"flight.STA",readOnly:"landingReadOnly"}},e.flightLanding2=null,e.time_landing2={type:"date",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"flightLanding2",readOnly:"IsLandingReadOnly",disabled:"IsLandingReadOnly"}},e.time_landing2_hh={type:"time",width:"100%",displayFormat:"HH:mm",interval:15,onValueChanged:function(e){},bindingOptions:{value:"flightLanding2",readOnly:"IsLandingReadOnly",disabled:"IsLandingReadOnly"}},e.time_std={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.STD"}},e.time_sta={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.STA"}},e.time_baseStart={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.baseStartDate"}},e.time_baseEnd={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.baseEndDate"}},e.time_chocksout={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.ChocksOut"}},e.time_chocksin={type:"time",width:"100%",readOnly:!0,bindingOptions:{value:"flight.ChocksIn"}},e.time_landed={type:"datetime",width:"100%",readOnly:!0,bindingOptions:{value:"flight.Landing"}},e.remark_dep={bindingOptions:{value:"flight.DepartureRemark",readOnly:"depReadOnly"}},e.remark_arr={bindingOptions:{value:"flight.ArrivalRemark"}},e.fuel_dep={min:0,bindingOptions:{value:"flight.FuelDeparture",readOnly:"depReadOnly"}},e.fuel_fp={min:0,bindingOptions:{value:"flight.FPFuel",readOnly:"depReadOnly"}},e.fuel_defuel={min:0,bindingOptions:{value:"flight.Defuel",readOnly:"depReadOnly"}},e.fuel_arr={min:0,bindingOptions:{value:"flight.FuelArrival"}},e.paxTotal=0,e.paxOver=0,e.calculateTotalPax=function(){e.paxTotal=0;var t=0;if(e.flight.PaxAdult&&(t+=e.flight.PaxAdult),e.flight.PaxChild&&(t+=e.flight.PaxChild),e.flight.TotalSeat&&t>e.flight.TotalSeat?e.flight.PaxOver=t-e.flight.TotalSeat:e.flight.PaxOver=0,e.flight.TotalPax=t,e.flight.TotalSeat){var i=round2(100*t/(1*e.flight.TotalSeat),2);e.loadPax=i+" %"}},e.total_seats={readOnly:!0,bindingOptions:{value:"flight.TotalSeat"}},e.total_pax={readOnly:!0,bindingOptions:{value:"flight.TotalPax"}},e.loadPax=null,e.load_pax={readOnly:!0,bindingOptions:{value:"loadPax"}},e.pax_adult={readOnly:!1,min:0,showSpinButtons:!0,onValueChanged:function(t){e.calculateTotalPax()},bindingOptions:{value:"flight.PaxAdult",readOnly:"depReadOnly"}},e.pax_child={readOnly:!1,showSpinButtons:!0,min:0,onValueChanged:function(t){e.calculateTotalPax()},bindingOptions:{value:"flight.PaxChild",readOnly:"depReadOnly"}},e.pax_infant={readOnly:!1,showSpinButtons:!0,min:0,onValueChanged:function(t){e.calculateTotalPax()},bindingOptions:{value:"flight.PaxInfant",readOnly:"depReadOnly"}},e.pax_over={readOnly:!1,min:0,bindingOptions:{readOnly:"depReadOnly",value:"flight.PaxOver"}},e.cargo_piece={readOnly:!1,min:0,bindingOptions:{value:"flight.CargoCount",readOnly:"depReadOnly"}},e.cargo_weight={readOnly:!1,min:0,bindingOptions:{value:"flight.CargoWeight",readOnly:"depReadOnly"}},e.cargo_excess={readOnly:!1,min:0,bindingOptions:{readOnly:"depReadOnly"}},e.bag_piece={readOnly:!1,min:0,bindingOptions:{value:"flight.BaggageCount",readOnly:"depReadOnly"}},e.bag_weight={readOnly:!1,min:0,bindingOptions:{value:"flight.BaggageWeight",readOnly:"depReadOnly"}},e.bag_excess={readOnly:!1,min:0,bindingOptions:{readOnly:"depReadOnly"}},e.convertToUTC=function(){var t=-1*(new Date).getTimezoneOffset();t*=-1,e.flight.STA2=new Date(e.flight.STA).addMinutes(t),e.flight.STD2=new Date(e.flight.STD).addMinutes(t),e.flightOffBlock2=new Date(e.flightOffBlock2).addMinutes(t),e.flightTakeOff2=new Date(e.flightTakeOff2).addMinutes(t),e.flightLanding2=new Date(e.flightLanding2).addMinutes(t),e.flightOnBlock2=new Date(e.flightOnBlock2).addMinutes(t),e.time_status_value=new Date(e.time_status_value).addMinutes(t)},e.convertToLCL=function(){var t=-1*(new Date).getTimezoneOffset();e.flight.STA2=new Date(e.flight.STA).addMinutes(t),e.flight.STD2=new Date(e.flight.STD).addMinutes(t),e.flightOffBlock2=new Date(e.flightOffBlock2).addMinutes(t),e.flightTakeOff2=new Date(e.flightTakeOff2).addMinutes(t),e.flightLanding2=new Date(e.flightLanding2).addMinutes(t),e.flightOnBlock2=new Date(e.flightOnBlock2).addMinutes(t),e.time_status_value=new Date(e.time_status_value).addMinutes(t)},e.otimes=null,e.timeBase="LCB",e.sb_timebase={showClearButton:!0,searchEnabled:!0,dataSource:["UTC","LCL","LCB"],onValueChanged:function(t){"UTC"!=t.value||"LCL"!=t.previousValue&&"LCB"!=t.previousValue?"LCL"!=t.value&&"LCB"!=t.value||"UTC"!=t.previousValue||e.convertToLCL():e.convertToUTC()},bindingOptions:{value:"timeBase"}},e.remark_status_height=128,e.remark_status={bindingOptions:{value:"flight.DepartureRemark",height:"remark_status_height"}},e.isTimeStatusVisible=!1,e.time_status_value=null,e.time_status={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"time_status_value"}},e.time_redirect_value=null,e.time_redirect={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"time_redirect_value"}},e.remark_redirect={bindingOptions:{value:"flight.RedirectRemark",height:"82"}},e.time_ramp_value=null,e.time_ramp={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"time_ramp_value"}},e.remark_ramp={bindingOptions:{value:"flight.RampRemark",height:"82"}},e.delayCodeId=21,e.delayCode={Id:21,HH:null,MM:null,Code:null,Title:null,Remark:null,Total:null},e.clearDelayCode=function(){e.delayCode.HH=null,e.delayCode.MM=null,e.delayCode.Remark=null,e.delayCode.Total=null,e.delayCodeId=null},e.fillDelayCode=function(t){e.delayCode.Id=t.Id,e.delayCode.Code=t.Code,e.delayCode.Title=t.Title},e.txt_delay_remark={width:"100%",bindingOptions:{value:"delayCode.Remark"}},e.num_delayhh={max:99,min:0,width:40,showSpinButtons:!0,bindingOptions:{value:"delayCode.HH"}},e.num_delaymm={max:59,min:0,width:45,showSpinButtons:!0,bindingOptions:{value:"delayCode.MM"}},e._delayItem=null,e.$watch("_delayItem",function(t){try{e._delayItem?e.delayCode.Remark=e._delayItem.Remark:e.delayCode.Remark=""}catch(e){}}),e.sb_delay={showClearButton:!1,searchEnabled:!0,onSelectionChanged:function(t){t&&t.selectedItem?e.fillDelayCode(t.selectedItem):e.clearDelayCode()},displayExpr:"Title2",valueExpr:"Id",bindingOptions:{value:"delayCodeId",dataSource:"delayCodes",selectedItem:"_delayItem"}},e.btn_add_delay={text:"",type:"default",icon:"plus",width:"20",validationGroup:"movdelay",bindingOptions:{},onClick:function(t){if(e.delayCode.HH||(e.delayCode.HH=0),e.delayCode.MM||(e.delayCode.MM=0),0!=e.delayCode.HH||0!=e.delayCode.MM){var i=JSON.parse(JSON.stringify(e.delayCode));i.Amount=pad(e.delayCode.HH)+":"+pad(e.delayCode.MM),i.Total=60*e.delayCode.HH+e.delayCode.MM,e.dg_delay_ds.push(i),e.clearDelayCode()}else General.ShowNotify("Amount is not valid","error")}},e.btn_remove_delay={text:"",type:"danger",icon:"close",width:"20",bindingOptions:{},onClick:function(t){if(e.dg_delay_selected=n.getSelectedRow(e.dg_delay_instance),e.dg_delay_selected){var i=Enumerable.From(e.dg_delay_ds).Where("$.Id!="+e.dg_delay_selected.Id).ToArray();e.dg_delay_ds=i}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.IsOffBlockReadOnly=!1,e.IsTakeOffReadOnly=!1,e.IsLandingReadOnly=!1,e.IsOnBlockReadOnly=!1,e.isRedirectReasonVisible=!0,e.isRampReasonVisible=!0,e.sb_status={showClearButton:!1,searchEnabled:!0,dataSource:Enumerable.From(Flight.statusDataSource).Where("$.selectable").ToArray(),onSelectionChanged:function(t){t&&t.selectedItem&&(t.selectedItem.bgcolor,t.selectedItem.color),e.remark_status_height=128,e.isTimeStatusVisible=!1,e.isCancelReasonVisible=!1,4==t.selectedItem.id&&(e.isCancelReasonVisible=!0,e.remark_status_height=74,e.isTimeStatusVisible=!0,e.time_status_value=e.flight.CancelDate?new Date(e.flight.CancelDate):null),9==t.selectedItem.id&&(e.remark_status_height=74,e.isTimeStatusVisible=!0,e.time_status_value=e.flight.RampDate?new Date(e.flight.RampDate):null),17==t.selectedItem.id&&(e.remark_status_height=40)},displayExpr:"title",valueExpr:"id",bindingOptions:{value:"flight.FlightStatusID"}},e.sb_flighttype={readOnly:!0,showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.FlightTypeID"}},e.sb_massunit={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(110),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.CargoUnitID",readOnly:"depReadOnly"}},e.sb_volumeunit={showClearButton:!0,searchEnabled:!1,dataSource:n.getDatasourceOption(113),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.FuelUnitID",text:"flight.FuelUnit",readOnly:"depReadOnly"}},e.sb_volumeunit2={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(113),displayExpr:"Title",valueExpr:"Id",readOnly:!0,bindingOptions:{value:"flight.FuelUnitID"}},e.entity_cancel={UserId:null,FlightId:null,CancelReasonId:null,CancelRemark:null,CancelDate:null},e.cleat_entity_cancel=function(){e.entity_cancel.UserId=null,e.entity_cancel.FlightId=null,e.entity_cancel.CancelReasonId=null,e.entity_cancel.CancelRemark=null,e.entity_cancel.CancelDate=null},e.entity_redirect={UserId:null,FlightId:null,RedirectReasonId:null,RedirectRemark:null,RedirectDate:null,AirportId:null,STA:null,OAirportIATA:null,AirportIATA:null,Airport:null},e.clear_entity_redirect=function(){e.entity_redirect.UserId=null,e.entity_redirect.FlightId=null,e.entity_redirect.RedirectReasonId=null,e.entity_redirect.RedirectRemark=null,e.entity_redirect.RedirectDate=null,e.entity_redirect.AirportId=null,e.entity_redirect.Airport=null,e.entity_redirect.STA=null},e.isCancelReasonVisible=!1,e.sb_cancel_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1136),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.CancelReasonId"}},e.sb_redirect_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1147),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.RedirectReasonId"}},e.sb_ramp_reason={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(1136),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"flight.RampReasonId"}},e.num_fphh={max:99,min:0,width:50,showSpinButtons:!0,bindingOptions:{value:"flight.FPFlightHH"}},e.num_fpmm={max:59,min:0,width:50,showSpinButtons:!0,bindingOptions:{value:"flight.FPFlightMM"}},e.num_totaldelayhh={max:99,min:0,width:45,showSpinButtons:!1,readOnly:!0,bindingOptions:{value:"flight.TotalDelayHH"}},e.num_totaldelayhhmm={max:59,min:0,width:45,showSpinButtons:!1,readOnly:!0,bindingOptions:{value:"flight.TotalDelayMM"}},e._time_redirect={type:"datetime",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entity_redirect.RedirectDate"}},e.txt_cancel_remark={bindingOptions:{value:"entity_cancel.CancelRemark"}},e.txt_redirect_remark={bindingOptions:{value:"entity_redirect.RedirectRemark"}},e.txt_charterer={readOnly:!0,bindingOptions:{}},e.time_redirect_sta={type:"datetime",width:"100%",interval:5,onValueChanged:function(e){},bindingOptions:{value:"entity_redirect.STA",min:"flight.Takeoff"}},e.sb_redirect_airport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceAirport(),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(e){},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity_redirect.AirportId",selectedItem:"entity_redirect.Airport"}},e.moment=function(e){return moment(e).format("MMMM Do YYYY")},e.momenttime=function(e){return e?moment(e).format("HH:mm"):"--"},e.setStatus=function(t,i){var n=Enumerable.From(Flight.statusDataSource).Where("$.id=="+i).FirstOrDefault();t.status=i,e.flight.FlightStatusID=i,t.FlightStatus=n.title},e.getStatusClass=function(e){return"col-lg-2 col-md-3 col-sm-3 col-xs-3 font-inherit "+Enumerable.From(Flight.statusDataSource).Where("$.id=="+e.status).FirstOrDefault().class},e.popup_inf_visible=!1,e.popup_inf_title="Flight Information",e.popup_inf={elementAttr:{class:"popup_inf"},shading:!1,position:{my:"left",at:"left",of:window,offset:"5 0"},width:450,height:function(){return.95*$(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){$(e.titleElement).css("background-color","#f2552c")},onShowing:function(t){e.setWeather()},onShown:function(e){},onHiding:function(){e.popup_inf_visible=!1},bindingOptions:{visible:"popup_inf_visible",title:"popup_inf_title"}},e.popup_inf.toolbarItems[0].options.onClick=function(t){e.popup_inf_visible=!1},e.scroll_1={scrollByContent:!0,scrollByThumb:!0,height:571},e.scroll2_height=300,e.scroll_2={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll2_height"}},e.scroll_dep={scrollByContent:!0,scrollByThumb:!0,height:497},e.scroll_arr={scrollByContent:!0,scrollByThumb:!0,height:497};var p=[{text:"Main",id:"departure",visible:!0},{text:"Delays",id:"delays",visible:!0}],h=[{text:"Main",id:"arrival",visible:!0},{text:"Departure",id:"depparr",visible:!0}];e.tabs=p,e.selectedTabIndex=-1,e.$watch("selectedTabIndex",function(t){try{e.selectedTab=p[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_instance.repaint()}catch(e){}}),e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex"}},e.tabs2=h,e.selectedTabIndex2=-1,e.$watch("selectedTabIndex2",function(t){try{e.selectedTab2=h[t],$(".tab").hide(),$("."+e.selectedTab2.id).fadeIn(100,function(){}),e.dg2_instance.repaint()}catch(e){}}),e.tabs2_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs2",deep:!0},selectedIndex:"selectedTabIndex2"}},e.popup_arr_visible=!1,e.popup_arr_title="Arrival",e.popup_arr={elementAttr:{class:"popup_arr"},shading:!0,width:1200,height:647,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacarr",bindingOptions:{disabled:"IsApproved"},visible:!1,onClick:function(t){if(t.validationGroup.validate().isValid)if(new Date(e.flightLanding2)<new Date(e.flight.STA))General.ShowNotify(Config.Text_Landing,"error");else if(e.flightOnBlock2&&new Date(e.flightOnBlock2)<new Date(e.flightLanding2))General.ShowNotify(Config.Text_OnBlock,"error");else{var i={StatusLog:[]},o=$("#resourceGanttba").data("ejGantt");e.flight.Landing=e.flightLanding2,i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:3,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.flightOnBlock2?(e.flight.ChocksIn=e.flightOnBlock2,Flight.calculateDelayLandingOnBlock(e.flight),e.setStatus(e.flight,15)):e.setStatus(e.flight,3),e.fillDto(i),e.fillArrival(i),e.loadingVisible=!0,a.saveFlightArr(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),o.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_arr_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.flightOnBlock2=e.flight.ChocksIn,e.flightLanding2=e.flight.Landing,e.flightOffBlock2=e.flight.ChocksOut,e.flightTakeOff2=e.flight.Takeoff,e.depReadOnly=!0,e.selectedTabIndex2=0,e.setWeather()},onShown:function(t){e.flight.delays?e.dg2_ds=e.flight.delays:(e.loadingVisible=!0,a.getFlightDelayCodes(e.flight.ID).then(function(t){e.loadingVisible=!1,e.flight.delays=t,e.dg2_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},onHiding:function(){e.selectedTabIndex2=-1,e.popup_arr_visible=!1},bindingOptions:{visible:"popup_arr_visible",title:"popup_arr_title"}},e.popup_arr.toolbarItems[1].options.onClick=function(t){e.popup_arr_visible=!1},e.popup_fueldep_visible=!1,e.popup_fueldep_title="Departure Fuel",e.fuelDepInit={},e.popup_fueldep={elementAttr:{class:"popup_fueldep"},shading:!0,width:400,height:200,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacfueldep",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(t.validationGroup.validate().isValid){var i={ID:e.flight.ID,FuelDeparture:e.flight.FuelDeparture,FuelUnitID:e.flight.FuelUnitID};e.loadingVisible=!0,a.saveFlightFuelDeparture(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.fuelDepSaved=!0,e.loadingVisible=!1,e.popup_fueldep_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.fuelDepInit.FuelUnitID=e.flight.FuelUnitID,e.fuelDepInit.FuelDeparture=e.flight.FuelDeparture},onShown:function(e){},onHiding:function(){e.fuelDepSaved||(e.flight.FuelDeparture=e.fuelDepInit.FuelDeparture,e.flight.FuelUnitID=e.fuelDepInit.FuelUnitID),e.popup_fueldep_visible=!1},bindingOptions:{visible:"popup_fueldep_visible",title:"popup_fueldep_title"}},e.popup_fueldep.toolbarItems[1].options.onClick=function(t){e.popup_fueldep_visible=!1},e.popup_fuelarr_visible=!1,e.popup_fuelarr_title="Arrival Fuel",e.fuelArrInit={},e.popup_fuelarr={elementAttr:{class:"popup_fuelarr"},shading:!0,width:400,height:200,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacfuelarr",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(t.validationGroup.validate().isValid){var i={ID:e.flight.ID,FuelArrival:e.flight.FuelArrival};e.loadingVisible=!0,a.saveFlightFuelArrival(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.fuelArrSaved=!0,e.loadingVisible=!1,e.popup_fuelarr_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.fuelArrInit.FuelArrival=e.flight.FuelArrival},onShown:function(e){},onHiding:function(){e.fuelArrSaved||(e.flight.FuelArrival=e.fuelArrInit.FuelArrival),e.popup_fuelarr_visible=!1},bindingOptions:{visible:"popup_fuelarr_visible",title:"popup_fuelarr_title"}},e.popup_fuelarr.toolbarItems[1].options.onClick=function(t){e.popup_fuelarr_visible=!1},e.popup_pax_visible=!1,e.popup_pax_title="Pax",e.paxSaved=!1,e.paxInit={},e.popup_pax={elementAttr:{class:"popup_pax"},shading:!0,width:400,height:290,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacpax",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(t.validationGroup.validate().isValid){var i={ID:e.flight.ID,PaxAdult:e.flight.PaxAdult,PaxChild:e.flight.PaxChild,PaxInfant:e.flight.PaxInfant};e.loadingVisible=!0,a.saveFlightPax(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.paxSaved=!0,e.loadingVisible=!1,e.popup_pax_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.paxInit.PaxAdult=e.flight.PaxAdult,e.paxInit.PaxChild=e.flight.PaxChild,e.paxInit.PaxInfant=e.flight.PaxInfant},onShown:function(e){},onHiding:function(){e.paxSaved||(e.flight.PaxAdult=e.paxInit.PaxAdult,e.flight.PaxChild=e.paxInit.PaxChild,e.flight.PaxInfant=e.paxInit.PaxInfant,e.calculateTotalPax()),e.popup_pax_visible=!1},bindingOptions:{visible:"popup_pax_visible",title:"popup_pax_title"}},e.popup_pax.toolbarItems[1].options.onClick=function(t){e.popup_pax_visible=!1},e.popup_link_visible=!1,e.popup_link_title="Linked Flight",e.popup_link={elementAttr:{class:"popup_link"},shading:!0,height:490,width:700,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fblink",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(t.validationGroup.validate().isValid){var i=new Date(e.time_ir_std_date).getDatePartArray(),n=new Date(e.time_ir_std_time).getTimePartArray(),o=new Date(i[0],i[1],i[2],n[0],n[1],0,0),l=new Date(e.time_ir_sta_date).getDatePartArray(),d=new Date(e.time_ir_sta_time).getTimePartArray(),r=new Date(l[0],l[1],l[2],d[0],d[1],0,0),s=JSON.parse(JSON.stringify(e.linkEntity));s.FlightStatusID=1,s.STD=new Date(o).toUTCString(),s.STA=new Date(r).toUTCString(),s.LinkedReason=1133,e.loadingVisible=!0,a.saveFlight(s).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.popup_link_visible=!1,e.BeginSearch()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(e){},onShown:function(e){},onHiding:function(){e.linkEntity.ToAirportId=null,e.linkEntity.FromAirportId=null,e.time_ir_std_date=null,e.time_ir_std_time=null,e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.linkEntity=null,e.popup_link_visible=!1},bindingOptions:{visible:"popup_link_visible",title:"popup_link_title"}},e.popup_link.toolbarItems[1].options.onClick=function(t){e.popup_link_visible=!1},e.popup_free_visible=!1,e.popup_free_title="Nonscheduled Flight",e.freeSaved=!1,e.popup_free={elementAttr:{class:"popup_free"},shading:!0,height:350,width:750,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fblink",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(t.validationGroup.validate().isValid){var i=new Date(e.time_ir_std_date).getDatePartArray(),n=new Date(e.time_ir_std_time).getTimePartArray(),o=new Date(i[0],i[1],i[2],n[0],n[1],0,0),l=new Date(e.time_ir_sta_date).getDatePartArray(),d=new Date(e.time_ir_sta_time).getTimePartArray(),r=new Date(l[0],l[1],l[2],d[0],d[1],0,0),s=JSON.parse(JSON.stringify(e.linkEntity));s.FlightStatusID=1,s.STD=new Date(o).toUTCString(),s.STA=new Date(r).toUTCString(),e.loadingVisible=!0,a.saveFlight(s).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.linkEntity.FlightNumber=null,e.linkEntity.FromAirportId=e.linkEntity.ToAirportId,e.linkEntity.ToAirportId=null,e.linkEntity.FlightH=null,e.linkEntity.FlightM=null,e.time_ir_std_date=General.getDayFirstHour(new Date(e.time_ir_sta_date)),e.time_ir_std_time=new Date(e.time_ir_sta_time).addMinutes(60),e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.loadingVisible=!1,e.freeSaved=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(e){},onShown:function(e){},onHiding:function(){e.freeSaved&&e.BeginSearch(),e.freeSaved=!1,e.linkEntity.ToAirportId=null,e.linkEntity.FromAirportId=null,e.time_ir_std_date=null,e.time_ir_std_time=null,e.time_ir_sta_date=null,e.time_ir_sta_time=null,e.linkEntity=null,e.popup_free_visible=!1},bindingOptions:{visible:"popup_free_visible",title:"popup_free_title"}},e.popup_free.toolbarItems[1].options.onClick=function(t){e.popup_free_visible=!1},e.popup_cargo_visible=!1,e.popup_cargo_title="Cargo/Baggage",e.cargoSaved=!1,e.cargoInit={},e.popup_cargo={elementAttr:{class:"popup_cargo"},shading:!0,width:400,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaccargo",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(t.validationGroup.validate().isValid){var i={ID:e.flight.ID,CargoUnitID:e.flight.CargoUnitID,CargoWeight:e.flight.CargoWeight,CargoCount:e.flight.CargoCount,BaggageWeight:e.flight.BaggageWeight,BaggageCount:e.flight.BaggageCount};e.loadingVisible=!0,a.saveFlightCargo(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.cargoSaved=!0,e.loadingVisible=!1,e.popup_cargo_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.cargoInit.CargoUnitID=e.flight.CargoUnitID,e.cargoInit.CargoWeight=e.flight.CargoWeight,e.cargoInit.CargoCount=e.flight.CargoCount,e.cargoInit.BaggageWeight=e.flight.BaggageWeight,e.cargoInit.BaggageCount=e.flight.BaggageCount},onShown:function(e){},onHiding:function(){e.cargoSaved||(e.flight.CargoUnitID=e.cargoInit.CargoUnitID,e.flight.CargoWeight=e.cargoInit.CargoWeight,e.flight.CargoCount=e.cargoInit.CargoCount,e.flight.BaggageWeight=e.cargoInit.BaggageWeight,e.flight.BaggageCount=e.cargoInit.BaggageCount),e.popup_cargo_visible=!1},bindingOptions:{visible:"popup_cargo_visible",title:"popup_cargo_title"}},e.popup_cargo.toolbarItems[1].options.onClick=function(t){e.popup_cargo_visible=!1},e.fillDto=function(t){t.ID=e.flight.ID,t.UserId=n.userId,t.FlightStatusID=e.flight.FlightStatusID,t.Delays=[];var i=Enumerable.From(e.dg_delay_ds).ToArray();$.each(i,function(i,a){console.log(a),97==a.Id&&(e.flight.notes=97),t.Delays.push({FlightId:e.flight.ID,DelayCodeId:a.Id,HH:a.HH,MM:a.MM,Remark:a.Remark,UserId:n.userId})})},e.fillLog=function(t){e.flight.ChocksOut&&(t.ChocksOut=new Date(e.flight.ChocksOut).toUTCString()),e.flight.Takeoff&&(t.Takeoff=new Date(e.flight.Takeoff).toUTCString()),t.DepartureRemark=e.flight.DepartureRemark,t.GWTO=e.flight.GWTO,t.FuelDeparture=e.flight.FuelDeparture,t.PaxAdult=e.flight.PaxAdult,t.PaxInfant=e.flight.PaxInfant,t.PaxChild=e.flight.PaxChild,t.CargoWeight=e.flight.CargoWeight,t.CargoUnitID=e.flight.CargoUnitID,t.BaggageCount=e.flight.BaggageCount,t.CargoCount=e.flight.CargoCount,t.BaggageWeight=e.flight.BaggageWeight,t.FuelUnitID=e.flight.FuelUnitID,t.FPFlightHH=e.flight.FPFlightHH,t.FPFlightMM=e.flight.FPFlightMM,t.FPFuel=e.flight.FPFuel,t.Defuel=e.flight.Defuel,e.flight.Landing&&(t.Landing=new Date(e.flight.Landing).toUTCString()),e.flight.ChocksIn&&(t.ChocksIn=new Date(e.flight.ChocksIn).toUTCString()),t.BlockH=e.flight.BlockH,t.BlockM=e.flight.BlockM,t.GWLand=e.flight.GWLand,t.FuelArrival=e.flight.FuelArrival,t.ArrivalRemark=e.flight.ArrivalRemark,9==e.flight.FlightStatusID&&(e.flight.RampDate=new Date(e.time_status_value).toUTCString(),t.RampDate=new Date(e.time_status_value).toUTCString(),t.RampReasonId=e.flight.RampReasonId),e.flight.RedirectReasonId&&(e.flight.RedirectDate=new Date(e.time_redirect_value).toUTCString(),t.RedirectDate=new Date(e.time_redirect_value).toUTCString(),e.flight.ToAirportId=e.entity_redirect.Airport.Id,e.flight.ToAirport=e.entity_redirect.Airport.Id,t.ToAirportId=e.entity_redirect.Airport.Id,e.flight.OToAirportIATA||(e.flight.OToAirportIATA=e.flight.ToAirportIATA),e.flight.ToAirportIATA=e.entity_redirect.Airport.IATA,t.RedirectReasonId=e.flight.RedirectReasonId,t.RedirectRemark=e.flight.RedirectRemark),4==e.flight.FlightStatusID&&(e.flight.CancelDate=new Date(e.time_status_value).toUTCString(),t.CancelDate=new Date(e.time_status_value).toUTCString(),t.CancelReasonId=e.flight.CancelReasonId),t.EstimatedDelays=[]},e.fillDeparture=function(t){t.ChocksOut=new Date(e.flight.ChocksOut).toUTCString(),e.flight.Takeoff&&(t.Takeoff=new Date(e.flight.Takeoff).toUTCString()),t.DepartureRemark=e.flight.DepartureRemark,t.GWTO=e.flight.GWTO,t.FuelDeparture=e.flight.FuelDeparture,t.PaxAdult=e.flight.PaxAdult,t.PaxInfant=e.flight.PaxInfant,t.PaxChild=e.flight.PaxChild,t.CargoWeight=e.flight.CargoWeight,t.CargoUnitID=e.flight.CargoUnitID,t.BaggageCount=e.flight.BaggageCount,t.CargoCount=e.flight.CargoCount,t.BaggageWeight=e.flight.BaggageWeight,t.FuelUnitID=e.flight.FuelUnitID,t.EstimatedDelays=[];var i=Enumerable.From(e.dataSource).Where("$.EstimatedDelayChanged && $.EstimatedDelayChanged==true && $.EstimatedDelay>0 && $.status==1 && $.startDate.getDatePart()=="+e.flight.startDate.getDatePart()+" && $.startDate.getTime() > "+e.flight.startDate.getTime()+"  && $.RegisterID=="+e.flight.RegisterID).OrderBy("$.startDate").ToArray();$.each(i,function(e,i){t.EstimatedDelays.push({FlightId:i.ID,Delay:Math.floor(i.EstimatedDelay)})})},e.fillArrival=function(t){t.Landing=new Date(e.flight.Landing).toUTCString(),e.flight.ChocksIn&&(t.ChocksIn=new Date(e.flight.ChocksIn).toUTCString()),t.BlockH=e.flight.BlockH,t.BlockM=e.flight.BlockM,t.GWLand=e.flight.GWLand,t.FuelArrival=e.flight.FuelArrival,t.ArrivalRemark=e.flight.ArrivalRemark},e.popup_flight_visible=!1,e.popup_flight_title="Departure",e.popup_flight={elementAttr:{class:"popup_flight"},shading:!0,width:1200,height:647,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacflight",bindingOptions:{disabled:"IsApproved"},visible:!0,onClick:function(t){if(t.validationGroup.validate().isValid)if(new Date(e.flightOffBlock2)<new Date(e.flight.STD))General.ShowNotify(Config.Text_OffBlock,"error");else if(e.flightTakeOff2&&new Date(e.flightTakeOff2)<new Date(e.flightOffBlock2))General.ShowNotify(Config.Text_TakeOff,"error");else{var i={StatusLog:[]},o=$("#resourceGanttba").data("ejGantt"),l=!e.flight.ChocksOut&&e.flightOffBlock2||new Date(e.flight.ChocksOut).getTime()!=new Date(e.flightOffBlock2).getTime();e.flight.ChocksOut=e.flightOffBlock2,Flight.calculateDelayOffBlock(e.flight),l&&e.applyNextFlight&&Flight.calculateNextTaskDelayOffBlock(e.flight,e.dataSource,o),i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:14,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.flightTakeOff2?(e.flight.Takeoff=e.flightTakeOff2,4!=e.flight.FlightStatusID&&e.setStatus(e.flight,2),i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:2,Date:new Date(Date.now()).toUTCString(),UserId:n.userId})):4!=e.flight.FlightStatusID&&e.setStatus(e.flight,14),e.fillDto(i),e.fillDeparture(i),e.loadingVisible=!0,a.saveFlightDep(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),o.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_flight_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.flight.ChocksOut?e.flightOffBlock2=e.flight.ChocksOut:e.flightOffBlock2=Flight.getEstimatedOffBlock(e.flight),e.flightTakeOff2=e.flight.Takeoff,e.depReadOnly=!1,e.selectedTabIndex=0,e.setWeather()},onShown:function(t){e.flight.delays?e.dg_ds=e.flight.delays:(e.loadingVisible=!0,a.getFlightDelayCodes(e.flight.ID).then(function(t){e.loadingVisible=!1,e.flight.delays=t,e.dg_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))},onHiding:function(){e.selectedTabIndex=-1,e.popup_flight_visible=!1},bindingOptions:{visible:"popup_flight_visible",title:"popup_flight_title"}},e.popup_flight.toolbarItems[1].options.onClick=function(t){e.popup_flight_visible=!1},e.popup_log_visible=!1,e.popup_log_title="Log",e.popup_log={elementAttr:{class:"popup_log"},shading:!0,width:1520,height:687,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",text:"Journey Log",icon:"",onClick:function(t){e.line=[],e.jlShow=!1,e.leg1Text="",e.leg1Visible=!1,e.leg1Value=!1,e.leg2Text="",e.leg2Visible=!1,e.leg2Value=!1,e.leg3Text="",e.leg3Visible=!1,e.leg3Value=!1,e.leg4Text="",e.leg4Visible=!1,e.leg4Value=!1,e.leg5Text="",e.leg5Visible=!1,e.leg5Value=!1,e.leg6Text="",e.leg6Visible=!1,e.leg6Value=!1,e.leg7Text="",e.leg7Visible=!1,e.leg7Value=!1,e.leg8Text="",e.leg8Visible=!1,e.leg8Value=!1,e.loadingVisible=!0,a.getFlightsLine(e.flight.ID).then(function(t){e.loadingVisible=!1,$.each(t,function(t,i){switch(e.line.push(i),t){case 0:e.leg1Text=i.FlightNumber,e.leg1Visible=!0,e.leg1Value=!0;break;case 1:e.leg2Text=i.FlightNumber,e.leg2Visible=!0,e.leg2Value=!0;break;case 2:e.leg3Text=i.FlightNumber,e.leg3Visible=!0,e.leg3Value=!0;break;case 3:e.leg4Text=i.FlightNumber,e.leg4Visible=!0,e.leg4Value=!0;break;case 4:e.leg5Text=i.FlightNumber,e.leg5Visible=!0,e.leg5Value=!0;break;case 5:e.leg6Text=i.FlightNumber,e.leg6Visible=!0,e.leg6Value=!0;break;case 6:e.leg7Text=i.FlightNumber,e.leg7Visible=!0,e.leg7Value=!0;break;case 7:e.leg8Text=i.FlightNumber,e.leg8Visible=!0,e.leg8Value=!0}e.popup_jl_visible=!0})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Crew List",icon:"",onClick:function(t){e.line=[],e.clShow=!1,e.leg1Text="",e.leg1Visible=!1,e.leg1Value=!1,e.leg2Text="",e.leg2Visible=!1,e.leg2Value=!1,e.leg3Text="",e.leg3Visible=!1,e.leg3Value=!1,e.leg4Text="",e.leg4Visible=!1,e.leg4Value=!1,e.leg5Text="",e.leg5Visible=!1,e.leg5Value=!1,e.leg6Text="",e.leg6Visible=!1,e.leg6Value=!1,e.leg7Text="",e.leg7Visible=!1,e.leg7Value=!1,e.leg8Text="",e.leg8Visible=!1,e.leg8Value=!1,e.loadingVisible=!0,a.getFlightsLine(e.flight.ID).then(function(t){e.loadingVisible=!1,$.each(t,function(t,i){switch(e.line.push(i),t){case 0:e.leg1Text=i.FlightNumber,e.leg1Visible=!0,e.leg1Value=!0;break;case 1:e.leg2Text=i.FlightNumber,e.leg2Visible=!0,e.leg2Value=!0;break;case 2:e.leg3Text=i.FlightNumber,e.leg3Visible=!0,e.leg3Value=!0;break;case 3:e.leg4Text=i.FlightNumber,e.leg4Visible=!0,e.leg4Value=!0;break;case 4:e.leg5Text=i.FlightNumber,e.leg5Visible=!0,e.leg5Value=!0;break;case 5:e.leg6Text=i.FlightNumber,e.leg6Visible=!0,e.leg6Value=!0;break;case 6:e.leg7Text=i.FlightNumber,e.leg7Visible=!0,e.leg7Value=!0;break;case 7:e.leg8Text=i.FlightNumber,e.leg8Visible=!0,e.leg8Value=!0}e.popup_cl_visible=!0})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Reporting Time",icon:"clock",bindingOptions:{disabled:"IsApproved"},visible:!0,onClick:function(t){e.popup_crew_visible=!0}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaclog",bindingOptions:{disabled:"IsApproved"},visible:!0,onClick:function(t){if(e.flightOffBlock2||2!=e.flight.FlightStatusID&&3!=e.flight.FlightStatusID&&7!=e.flight.FlightStatusID&&9!=e.flight.FlightStatusID&&14!=e.flight.FlightStatusID&&15!=e.flight.FlightStatusID&&17!=e.flight.FlightStatusID)if(e.flightTakeOff2||2!=e.flight.FlightStatusID&&3!=e.flight.FlightStatusID&&7!=e.flight.FlightStatusID&&15!=e.flight.FlightStatusID&&17!=e.flight.FlightStatusID)if(e.flightLanding2||3!=e.flight.FlightStatusID&&15!=e.flight.FlightStatusID)if(e.flightOnBlock2||15!=e.flight.FlightStatusID)if(e.flightOffBlock2||!(e.flightTakeOff2||e.flightLanding2||e.flightOnBlock2))if(e.flightTakeOff2||!e.flightLanding2&&!e.flightOnBlock2)if(e.flightLanding2||!e.flightOnBlock2)if(e.flightTakeOff2&&new Date(e.flightTakeOff2)<new Date(e.flightOffBlock2))General.ShowNotify(Config.Text_TakeOff,"error");else if(e.flightLanding2&&new Date(e.flightLanding2)<new Date(e.flightTakeOff2))General.ShowNotify(Config.Text_Landing,"error");else if(e.flightOnBlock2&&new Date(e.flightOnBlock2)<new Date(e.flightLanding2))General.ShowNotify(Config.Text_OnBlock,"error");else if(4!=e.flight.FlightStatusID||e.flight.CancelReasonId){var i=0;if(e.dg_delay_ds||(e.dg_delay_ds=[]),i=Enumerable.From(e.dg_delay_ds).Select("$.Total").Sum(),e.flight.TotalDelayTotalMM||(e.flight.TotalDelayTotalMM=0),e.flight.TotalDelayTotalMM>5&&0==e.dg_delay_ds.length)General.ShowNotify(Config.Text_DelayCodesNETotalDelay,"error");else if(e.dg_delay_ds&&(e.flight.TotalDelayTotalMM||(e.flight.TotalDelayTotalMM=0),i=Enumerable.From(e.dg_delay_ds).Select("$.Total").Sum(),5!=e.flight.FlightStatusID&&i>5&&i!=e.flight.TotalDelayTotalMM&&e.flightOffBlock2))General.ShowNotify(Config.Text_DelayCodesNETotalDelay,"error");else{var n={StatusLog:[]},o=$("#resourceGanttba").data("ejGantt");if(e.flight.ChocksOut=e.flightOffBlock2?e.flightOffBlock2:null,e.flight.Takeoff=e.flightTakeOff2?e.flightTakeOff2:null,e.flight.Landing=e.flightLanding2?e.flightLanding2:null,e.flight.ChocksIn=e.flightOnBlock2?e.flightOnBlock2:null,"UTC"==e.timeBase){var l=-1*(new Date).getTimezoneOffset();e.flight.ChocksOut=new Date(e.flight.ChocksOut).addMinutes(l),e.flight.Takeoff=new Date(e.flight.Takeoff).addMinutes(l),e.flight.Landing=new Date(e.flight.Landing).addMinutes(l),e.flight.ChocksIn=new Date(e.flight.ChocksIn).addMinutes(l),e.time_redirect_value&&(e.time_redirect_value=new Date(e.time_redirect_value).addMinutes(l)),e.time_ramp_value&&(e.time_ramp_value=new Date(e.time_ramp_value).addMinutes(l))}e.flight.ChocksIn&&Flight.calculateDelayLandingOnBlock(e.flight),e.flight.ChocksOut&&Flight.XcalculateDelayOffBlock(e.flight),e.flight.ChocksIn&&Flight.XcalculateDelayLandingOnBlock(e.flight),e.flight.EstimatedDelay=i,e.setStatus(e.flight,e.flight.FlightStatusID),e.fillDto(n),e.fillLog(n),e.loadingVisible=!0,a.saveFlightLog(n).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.ChocksOut||Flight.calculateEstimatedDelay(e.flight),o.reRenderChart(),$(".task-"+e.flight.ID).parent().addClass("e-gantt-taskbarSelection"),e.before_refreshed_flight=null,e.loadingVisible=!1,e.popup_log_visible=!1,e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}else General.ShowNotify(Config.Text_CancelReason,"error");else General.ShowNotify(Config.Text_Landing,"error");else General.ShowNotify(Config.Text_TakeOff,"error");else General.ShowNotify(Config.Text_OffBlock,"error");else General.ShowNotify(Config.Text_OnBlock,"error");else General.ShowNotify(Config.Text_Landing,"error");else General.ShowNotify(Config.Text_TakeOff,"error");else General.ShowNotify(Config.Text_OffBlock,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_log_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){},onShowing:function(t){e.flight.ChocksOut&&(e.flightOffBlock2=e.flight.ChocksOut),e.flightOffBlock2||(e.flightOffBlock2=e.flight.STD),e.flightTakeOff2=e.flight.Takeoff,e.flightTakeOff2||(e.flightTakeOff2=e.flight.STD),e.flightOnBlock2=e.flight.ChocksIn,e.flightOnBlock2||(e.flightOnBlock2=e.flight.STA),e.flightLanding2=e.flight.Landing,e.flightLanding2||(e.flightLanding2=e.flight.STA),4==e.flight.FlightStatusID?e.time_status_value=new Date(e.flight.CancelDate):9==e.flight.FlightStatusID&&(e.time_status_value=new Date(e.flight.RampDate)),e.flight.RedirectReasonId&&(e.time_redirect_value=new Date(e.flight.RedirectDate),e.entity_redirect.AirportId=e.flight.ToAirport),e.depReadOnly=!1},onShown:function(t){e.loadingVisible=!0,a.getFlightDelays(e.flight.ID).then(function(t){e.loadingVisible=!1,$.each(t,function(t,i){var n={Id:i.DelayCodeId,HH:i.DelayHH?i.DelayHH:0,MM:i.DelayMM?i.DelayMM:0,Code:i.Code,Title:i.Title,Remark:i.Remark,Total:null};n.Total=60*n.HH+n.MM,n.Amount=pad(n.HH.toString())+":"+pad(n.MM.toString()),e.dg_delay_ds.push(n)}),e.getCrewAbs(e.flight.ID)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},onHiding:function(){e.before_refreshed_flight&&(e.undoRefresh(),e.before_refreshed_flight=null),e.timeBase="LCL",e.dg_delay_ds=[],e.flightTakeOff2=null,e.flightOnBlock2=null,e.flightOffBlock2=null,e.flightLanding2=null,e.time_status_value=null,e.entity_redirect.ToAirportId=null,e.popup_log_visible=!1},bindingOptions:{visible:"popup_log_visible",title:"popup_log_title","toolbarItems[0].visible":"IsJLAccess","toolbarItems[1].visible":"IsJLAccess","toolbarItems[2].visible":"IsEditable","toolbarItems[3].visible":"IsEditable"}},e.popup_takeoff_visible=!1,e.popup_takeoff_title="Take Off",e.popup_takeoff={width:400,height:400,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbactakeoff",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(t.validationGroup.validate().isValid)if(new Date(e.flightTakeOff)<new Date(e.flight.ChocksOut))General.ShowNotify(Config.Text_TakeOff,"error");else{var i=$("#resourceGanttba").data("ejGantt");e.flight.Takeoff=e.flightTakeOff,e.setStatus(e.flight,2);var o={Takeoff:new Date(e.flight.Takeoff).toUTCString(),StatusLog:[],EstimatedDelays:[]};o.ID=e.flight.ID,o.UserId=n.userId,o.FlightStatusID=e.flight.FlightStatusID,o.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:2,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.loadingVisible=!0,a.saveFlightTakeOff(o).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_takeoff_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_takeoff_visible=!1},bindingOptions:{visible:"popup_takeoff_visible",title:"popup_takeoff_title"}},e.popup_takeoff.toolbarItems[1].options.onClick=function(t){e.popup_takeoff_visible=!1},e.dg_selected=null,e.dg_columns=[{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Selected",caption:"",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!0,width:90,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!0,fixedPosition:"left"},{dataField:"MM",caption:"Minute(s)",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!0,width:90},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_height=100,e.dg_instance=null,e.dg_ds=null,e.dg={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},onEditingStart:function(e){"MM"!=e.column.dataField||e.key.Selected||(e.cancel=!0)},onRowUpdating:function(e){e.newData.hasOwnProperty("Selected")&&(e.newData.Selected||(e.newData.HH=null,e.newData.MM=null))},onRowUpdated:function(e){},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},height:497,summary:{totalItems:[{column:"MM",summaryType:"sum"}]},bindingOptions:{dataSource:"dg_ds"}},e.dg2_selected=null,e.dg2_columns=[{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Selected",caption:"",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!0,width:90,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!0,fixedPosition:"left"},{dataField:"MM",caption:"Minute(s)",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!0,width:90},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg2_height=100,e.dg2_instance=null,e.dg2_ds=null,e.dg2={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},onEditingStart:function(e){"MM"!=e.column.dataField||e.key.Selected||(e.cancel=!0)},onRowUpdating:function(e){e.newData.hasOwnProperty("Selected")&&(e.newData.Selected||(e.newData.HH=null,e.newData.MM=null))},onRowUpdated:function(e){},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg2_columns,onContentReady:function(t){e.dg2_instance||(e.dg2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg2_selected=i||null},height:330,summary:{totalItems:[{column:"MM",summaryType:"sum"}]},bindingOptions:{dataSource:"dg2_ds"}},e.dg_crew_abs_columns=[{caption:"Crew",columns:[{dataField:"IsPositioning",caption:"DH",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:60},{dataField:"Position",caption:"Pos.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90,fixed:!0,fixedPosition:"left"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}]}],e.dg_crew_abs_selected=null,e.dg_crew_abs_instance=null,e.dg_crew_abs_ds=null,e.dg_crew_abs={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:274,columns:e.dg_crew_abs_columns,onContentReady:function(t){e.dg_crew_abs_instance||(e.dg_crew_abs_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew_abs_selected=i||null},onRowPrepared:function(e){e.data&&e.data.IsPositioning&&e.rowElement.css("background","#ffccff")},bindingOptions:{dataSource:"dg_crew_abs_ds"}},e.dg_crew_abs2_columns=[{caption:"Crew",columns:[{dataField:"Position",caption:"Pos.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"left"},{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90,fixed:!0,fixedPosition:"left"},{dataField:"ScName",caption:"Schedule Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"left"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}]}],e.dg_crew_abs2_selected=null,e.dg_crew_abs2_instance=null,e.dg_crew_abs2_ds=null,e.dg_crew_abs2={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:200,columns:e.dg_crew_abs2_columns,onContentReady:function(t){e.dg_crew_abs2_instance||(e.dg_crew_abs2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?e.dg_crew_abs_selected=i:e.dg_crew_abs2_selected=null},onRowPrepared:function(e){},bindingOptions:{dataSource:"dg_crew_abs2_ds"}},e.dg_delay_selected=null,e.dg_delay_columns=[{caption:"Delay",columns:[{dataField:"Code",caption:"Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"center",width:70,dataType:"string",allowEditing:!1},{dataField:"Remark",caption:"Remark",allowResizing:!0,dataType:"string",allowEditing:!1},{dataField:"Amount",caption:"Amount",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!0,width:80}]}],e.dg_delay_height=100,e.dg_delay_instance=null,e.dg_delay_ds=[],e.dg_delay={editing:{allowUpdating:!0,mode:"cell"},grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_delay_columns,onContentReady:function(t){e.dg_delay_instance||(e.dg_delay_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_delay_selected=i||null},height:210,summary:{totalItems:[{name:"TotalDelay",showInColumn:"Amount",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"TotalDelay"===e.name&&("start"===e.summaryProcess&&(e.totalValueMinutes=0,e.totalValue=""),"calculate"===e.summaryProcess&&(e.totalValueMinutes=e.totalValueMinutes+e.value.Total,e.totalValue=pad(Math.floor(e.totalValueMinutes/60)).toString()+":"+pad(e.totalValueMinutes%60).toString()))}},bindingOptions:{dataSource:"dg_delay_ds"}},e.dg_upd_selected=null,e.dg_upd_columns=[{dataField:"FlightNumber",caption:"No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"DateStatus",caption:"Date",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,format:"yyyy-MMM-dd, HH:mm",sortIndex:0,sortOrder:"asc"}],e.dg_upd_height=100,e.dg_upd_instance=null,e.dg_upd={editing:{allowUpdating:!1,mode:"cell"},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_upd_columns,onContentReady:function(t){e.dg_upd_instance||(e.dg_upd_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_upd_selected=i||null},height:"100%",bindingOptions:{dataSource:"updatedFlights"}},e.popup_upd_visible=!1,e.popup_upd_title="Updated Flights",e.popup_upd={elementAttr:{class:"popup_upd"},shading:!1,position:{my:"left",at:"left",of:window,offset:"5 5"},width:500,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Flight",icon:"arrowright",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(e.dg_upd_selected){var i=Enumerable.From(e.dataSource).Where("$.ID=="+e.dg_upd_selected.ID).FirstOrDefault();i&&(e.scrollGantt(i),e.scrollGrid(i))}}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onTitleRendered:function(e){$(e.titleElement).css("background-color","#8BC34A")},onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_upd_visible=!1},bindingOptions:{visible:"popup_upd_visible",title:"popup_upd_title"}},e.popup_upd.toolbarItems[1].options.onClick=function(t){e.popup_upd_visible=!1},e.popup_offblock_visible=!1,e.popup_offblock_title="Off Block",e.popup_offblock={shading:!0,width:380,height:"380",fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacoffblock",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(t.validationGroup.validate().isValid)if(new Date(e.flightOffBlock)<new Date(e.flight.STD))General.ShowNotify(Config.Text_OffBlock,"error");else{var i=$("#resourceGanttba").data("ejGantt"),o=!e.flight.ChocksOut&&e.flightOffBlock||new Date(e.flight.ChocksOut).getTime()!=new Date(e.flightOffBlock).getTime();e.flight.ChocksOut=e.flightOffBlock,Flight.calculateDelayOffBlock(e.flight),o&&e.applyNextFlight&&Flight.calculateNextTaskDelayOffBlock(e.flight,e.dataSource,i),e.setStatus(e.flight,14);var l={ChocksOut:new Date(e.flight.ChocksOut).toUTCString(),StatusLog:[],EstimatedDelays:[]};l.ID=e.flight.ID,l.UserId=n.userId,l.FlightStatusID=e.flight.FlightStatusID,l.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:14,Date:new Date(Date.now()).toUTCString(),UserId:n.userId});var d=Enumerable.From(e.dataSource).Where("$.EstimatedDelayChanged && $.EstimatedDelayChanged==true && $.EstimatedDelay>0 && $.status==1 && $.startDate.getDatePart()=="+e.flight.startDate.getDatePart()+" && $.startDate.getTime() > "+e.flight.startDate.getTime()+"  && $.RegisterID=="+e.flight.RegisterID).OrderBy("$.startDate").ToArray();$.each(d,function(e,t){l.EstimatedDelays.push({FlightId:t.ID,Delay:Math.floor(t.EstimatedDelay)})}),e.loadingVisible=!0,a.saveFlightOffBlock(l).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_offblock_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_offblock_visible=!1},bindingOptions:{visible:"popup_offblock_visible",title:"popup_offblock_title"}},e.popup_offblock.toolbarItems[1].options.onClick=function(t){e.popup_offblock_visible=!1},e.popup_landing_visible=!1,e.popup_landing_title="Take Off",e.popup_landing={width:400,height:450,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaclanding",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(t.validationGroup.validate().isValid)if(new Date(e.flightLanding)<new Date(e.flight.STA))General.ShowNotify(Config.Text_Landing,"error");else{var i=$("#resourceGanttba").data("ejGantt");17!=e.flight.status?e.setStatus(e.flight,3):e.setStatus(e.flight,7),e.flight.Landing=e.flightLanding;var o={StatusLog:[]};o.ID=e.flight.ID,o.UserId=n.userId,o.Landing=new Date(e.flight.Landing).toUTCString(),o.FlightStatusID=e.flight.FlightStatusID,o.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:3,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),e.loadingVisible=!0,a.saveFlightLanding(o).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_landing_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_landing_visible=!1},bindingOptions:{visible:"popup_landing_visible",title:"popup_landing_title"}},e.popup_landing.toolbarItems[1].options.onClick=function(t){e.popup_landing_visible=!1},e.popup_onblock_visible=!1,e.popup_onblock_title="Off Block",e.popup_onblock={width:400,height:270,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaconblock",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(t.validationGroup.validate().isValid)if(e.flightOnBlock&&new Date(e.flightOnBlock)<new Date(e.flight.Landing))General.ShowNotify(Config.Text_OnBlock,"error");else{var i={StatusLog:[]};$("#resourceGanttba").data("ejGantt");17!=e.flight.status&&7!=e.flight.status?e.setStatus(e.flight,15):e.setStatus(e.flight,7),e.flight.ChocksIn=e.flightOnBlock,i.StatusLog.push({FlightID:e.flight.ID,FlightStatusID:15,Date:new Date(Date.now()).toUTCString(),UserId:n.userId}),i.ID=e.flight.ID,i.UserId=n.userId,i.ChocksIn=new Date(e.flight.ChocksIn).toUTCString(),i.FlightStatusID=e.flight.FlightStatusID,e.loadingVisible=!0,a.saveFlightOnBlock(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.popup_onblock_visible=!1,e.bindFlights(!0)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_onblock_visible=!1},bindingOptions:{visible:"popup_onblock_visible",title:"popup_onblock_title"}},e.popup_onblock.toolbarItems[1].options.onClick=function(t){e.popup_onblock_visible=!1},e.popup_cancel_visible=!1,e.popup_cancel_title="Cancel",e.popup_cancel={shading:!0,width:360,height:"380",fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbaccancel",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(t.validationGroup.validate().isValid){e.entity_cancel.Date=new Date(Date.now()).toUTCString(),e.entity_cancel.CancelDate=new Date(e.entity_cancel.CancelDate).toUTCString(),e.entity_cancel.UserId=n.userId,e.entity_cancel.FlightId=e.flight.ID;i=$("#resourceGanttba").data("ejGantt");return e.setStatus(e.flight,4),e.loadingVisible=!0,void a.saveFlightCancel(e.entity_cancel).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),i.updateRecordByTaskId(e.flight),e.showButtons2(e.flight),e.loadingVisible=!1,e.popup_cancel_visible=!1,e.doGridSelectedChanged=!1,e.dg_flights_instance.refresh(),e.dg_flights_instance.selectRows([e.flight],!0),e.calculateSummary()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")});var i}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.cleat_entity_cancel(),e.popup_cancel_visible=!1},bindingOptions:{visible:"popup_cancel_visible",title:"popup_cancel_title"}},e.popup_cancel.toolbarItems[1].options.onClick=function(t){e.popup_cancel_visible=!1},e.popup_redirect_visible=!1,e.popup_redirect_title="Redirect",e.popup_redirect={shading:!0,width:360,height:"490",fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fbacredirect",bindingOptions:{disabled:"IsApproved"},onClick:function(t){if(t.validationGroup.validate().isValid){e.entity_redirect.Date=new Date(Date.now()).toUTCString(),e.entity_redirect.RedirectDate=new Date(e.entity_redirect.RedirectDate).toUTCString(),e.entity_redirect.UserId=n.userId,e.entity_redirect.FlightId=e.flight.ID,e.entity_redirect.STA=new Date(e.entity_redirect.STA).toUTCString(),e.entity_redirect.OAirportIATA=e.flight.ToAirportIATA,e.entity_redirect.Airport=null;$("#resourceGanttba").data("ejGantt");e.setStatus(e.flight,17),e.loadingVisible=!0,a.saveFlightRedirect(e.entity_redirect).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.showButtons2(e.flight),e.updatedFlightsCount=0,e.updatedFlights=[],e.bindFlights(!1),e.popup_redirect_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.clear_entity_redirect(),e.popup_redirect_visible=!1},bindingOptions:{visible:"popup_redirect_visible",title:"popup_redirect_title"}},e.popup_redirect.toolbarItems[1].options.onClick=function(t){e.popup_redirect_visible=!1},e.getReporting=function(t){e.loadingVisible=!0,a.getReporting(t).then(function(t){e.loadingVisible=!1;var i=Enumerable.From(t).OrderBy("$.GroupOrder").ThenBy("$.Name").ToArray();e.dg_crew_ds=i},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrew=function(t){e.loadingVisible=!0,a.getFlightCrew2(t).then(function(t){if(e.loadingVisible=!1,$.each(t,function(e,t){t.ReportingTime=new Date(t.ReportingTime).addMinutes(g)}),e.dg_boxflight_ds&&e.dg_boxflight_ds.length>0)new Date(e.dg_boxflight_ds[0].STD).addHours(-1);e.dg_crew_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrewAbs=function(t){e.loadingVisible=!0,e.loadingVisible=!0,a.getFlightCrews(t).then(function(t){e.loadingVisible=!1,e.dg_crew_abs_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getCrewAbs2=function(t){e.loadingVisible=!0,a.getFlightCrew2(t).then(function(t){e.loadingVisible=!1,e.dg_crew_abs2_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.getBoxFlights=function(t,i){var n=-1*(new Date).getTimezoneOffset();a.getBoxFlights(t).then(function(t){$.each(t,function(e,t){t.STA=new Date(t.STA).addMinutes(n),t.STD=new Date(t.STD).addMinutes(n),t.ChocksIn&&(t.ChocksIn=new Date(t.ChocksIn).addMinutes(n)),t.ChocksOut&&(t.ChocksOut=new Date(t.ChocksOut).addMinutes(n)),t.Takeoff&&(t.Takeoff=new Date(t.Takeoff).addMinutes(n)),t.Landing&&(t.Landing=new Date(t.Landing).addMinutes(n))}),e.dg_boxflight_ds=t,i&&i()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.dg_crew_columns=[{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"RP",caption:"Reporting Time",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!0,width:200}],e.dg_crew_selected=null,e.dg_crew_instance=null,e.dg_crew_ds=null,e.dg_crew={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",editing:{mode:"cell",allowUpdating:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-250,columns:e.dg_crew_columns,onContentReady:function(t){e.dg_crew_instance||(e.dg_crew_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_crew_selected=i||null},onRowPrepared:function(e){},onRowUpdated:function(t){var i=new Date(t.data.RP).toUTCString(),n=-1*(new Date).getTimezoneOffset();e.loadingVisible=!0;var o={CrewId:t.key.CrewId,FDPId:t.key.FDPId,Date:i,Offset:n};a.saveReportingTime(o).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success")},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},bindingOptions:{dataSource:"dg_crew_ds"}},e.dg_boxflight_columns=[{caption:"Flights",columns:[{dataField:"FlightNumber",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80},{dataField:"FlightH",caption:"HH",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60},{dataField:"FlightM",caption:"MM",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:60},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:150,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:150,format:"HH:mm"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]}],e.dg_boxflight_selected=null,e.dg_boxflight_instance=null,e.dg_boxflight_ds=null,e.dg_boxflight={headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:200,columns:e.dg_boxflight_columns,onContentReady:function(t){e.dg_boxflight_instance||(e.dg_boxflight_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_boxflight_selected=i||null},onRowPrepared:function(e){},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg_boxflight_ds"}},e.popup_crew_visible=!1,e.popup_crew_title="Crew",e.popup_crew={shading:!0,width:1100,height:600,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_crew_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.getReporting(e.flight.ID)},onHiding:function(){e.dg_crew_ds=[],e.popup_crew_visible=!1},bindingOptions:{visible:"popup_crew_visible",title:"popup_crew_title"}},e.sms=null,e.txt_sms={height:530,bindingOptions:{value:"sms"}},e.popup_sms_visible=!1,e.popup_sms_title="Notification",e.popup_sms={shading:!0,width:600,height:650,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Send",icon:"fas fa-bell",validationGroup:"fbacredirect",bindingOptions:{disabled:"IsApproved"},onClick:function(t){var i=[];$.each(e.dg_crew_ds,function(e,t){t.Mobile&&i.push(t.Mobile)});var n=i.join(","),a=e.sms;r.sms(a,n).then(function(e){General.ShowNotify("The message sent successfully.","success")},function(t){e.loadingVisible=!1,General.ShowNotify2(t.message,"error",5e3)})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_sms_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.sms=null,e.popup_sms_visible=!1},bindingOptions:{visible:"popup_sms_visible",title:"popup_sms_title"}},e.leg1Text="",e.leg1Value=!1,e.leg1Visible=!1,e.leg2Text="",e.leg2Value=!1,e.leg2Visible=!1,e.leg3Text="",e.leg3Value=!1,e.leg3Visible=!1,e.leg4Text="",e.leg4Value=!1,e.leg4Visible=!1,e.leg5Text="",e.leg5Value=!1,e.leg5Visible=!1,e.leg6Text="",e.leg6Value=!1,e.leg6Visible=!1,e.leg7Text="",e.leg7Value=!1,e.leg7Visible=!1,e.leg8Text="",e.leg8Value=!1,e.leg8Visible=!1,e.ch_leg1={bindingOptions:{text:"leg1Text",value:"leg1Value",visible:"leg1Visible"}},e.ch_leg2={bindingOptions:{text:"leg2Text",value:"leg2Value",visible:"leg2Visible"}},e.ch_leg3={bindingOptions:{text:"leg3Text",value:"leg3Value",visible:"leg3Visible"}},e.ch_leg4={bindingOptions:{text:"leg4Text",value:"leg4Value",visible:"leg4Visible"}},e.ch_leg5={bindingOptions:{text:"leg5Text",value:"leg5Value",visible:"leg5Visible"}},e.ch_leg6={bindingOptions:{text:"leg6Text",value:"leg6Value",visible:"leg6Visible"}},e.ch_leg7={bindingOptions:{text:"leg7Text",value:"leg7Value",visible:"leg7Visible"}},e.ch_leg8={bindingOptions:{text:"leg8Text",value:"leg8Value",visible:"leg8Visible"}},e.scroll_jl_height=200,e.scroll_jl={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_jl_height"}},e.popup_jl_visible=!1,e.popup_jl_title="Journey Log",e.popup_jl={shading:!0,width:1150,height:function(){return 1*$(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Update",icon:"save",bindingOptions:{disabled:"IsApproved"},onClick:function(e){u($("#jl"))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Print",icon:"print",bindingOptions:{disabled:"IsApproved"},onClick:function(e){u($("#jl"))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_jl_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(t){e.scroll_jl_height=$(window).height()-10-110},onShown:function(e){},onHiding:function(){e.popup_jl_visible=!1},bindingOptions:{visible:"popup_jl_visible",title:"popup_jl_title","toolbarItems[0].visible":"IsEditable"}},e.cl={},e.scroll_cl_height=200,e.scroll_cl={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_cl_height"}},e.popup_cl_visible=!1,e.popup_cl_title="Crew List",e.popup_cl={shading:!0,width:820,height:function(){return 1*$(window).height()},fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Print",icon:"print",bindingOptions:{disabled:"IsApproved"},onClick:function(e){u($("#cl"))}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_cl_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(t){e.scroll_cl_height=$(window).height()-10-110},onShown:function(e){},onHiding:function(){e.popup_cl_visible=!1},bindingOptions:{visible:"popup_cl_visible",title:"popup_cl_title","toolbarItems[0].visible":"IsEditable"}},e.popup_gd_visible=!1,e.popup_gd_title="GD",e.popup_gd={shading:!0,width:1100,height:650,fullScreen:!1,showTitle:!0,dragEnabled:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_gd_visible=!1}},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){$("#Spreadsheet").ejSpreadsheet({importSettings:{importMapper:window.baseurl+"api/Spreadsheet/Import"}})},onHiding:function(){e.popup_gd_visible=!1},bindingOptions:{visible:"popup_gd_visible",title:"popup_gd_title"}},e.scrollGrid=function(t){var i=e.dg_flights_instance.getView("rowsView")._scrollable,n=e.dg_flights_instance.getRowIndexByKey(t),a=e.dg_flights_instance.getRowElement(n);i.scrollToElement(a)},e.scrollGantt=function(t){var i=new Date(t.STD),n=new Date(e.datefrom),a=Flight.subtractDatesHours(i,n)*$(".e-schedule-day-headercell").width()-50;$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(a)},e.scrollGanttX=function(e){$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(e)},e.scrollGanttNow=function(){var t=new Date(Date.now()),i=new Date(t),n=new Date(e.datefrom),a=Flight.subtractDatesHours(i,n)*$(".e-schedule-day-headercell").width()-50;$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(a)},e.dg_flights_selected=null,e.dg_flights_columns=[{dataField:"delay1",caption:"",width:50,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i="lightgray";t.data.FlightStatusID>1&&(i=t.data.delay>0||t.data.delayLanding>0?"#e51400":"#60a917"),$("<div>").append('<i class="fas fa-clock" style="color:'+i+';font-size:16px"></i>').appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"FlightStatusID",caption:"",width:50,allowFiltering:!1,allowSorting:!1,alignment:"center",cellTemplate:function(e,t){var i=Flight.getStatus(t.value).bgcolor;t.data.FlightStatus;switch("",t.value){case 1:$("<div>").append('<i class="fas fa-calendar-day" style="color:lightgray;font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px"></span>').appendTo(e);break;case 14:$("<div>").append('<i class="far fa-square" style="color:'+i+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px"></span>').appendTo(e);break;case 2:$("<div>").append('<i class="fas fa-plane-departure" style="color:'+i+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px"></span>').appendTo(e);break;case 3:$("<div>").append('<i class="fas fa-plane-arrival" style="color:'+i+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px"></span>').appendTo(e);break;case 4:$("<div>").append('<i class="fas fa-ban" style="color:'+i+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px"></span>').appendTo(e);break;case 15:$("<div>").append('<i class="fas fa-square" style="color:'+i+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px"></span>').appendTo(e);break;case 17:$("<div>").append('<i class="fas fa-random" style="color:'+i+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px"></span>').appendTo(e);break;case 7:$("<div>").append('<i class="fas fa-level-down-alt" style="color:'+i+';font-size:16px"></i><span style="display:inlline-block;padding-left:5px;font-size:13px"></span>').appendTo(e)}},fixed:!0,fixedPosition:"left"},{dataField:"ID",caption:"ID",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90,fixed:!0,fixedPosition:"left"},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:110,fixed:!0,fixedPosition:"left"},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{caption:"Airports",columns:[{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:90}]},{caption:"Departure",columns:[{dataField:"STD",caption:"Scheduled Dep.",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:170,alignment:"center",format:"yyyy-MMM-dd, HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"ChocksOut",caption:"Off Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Takeoff",caption:"Departed",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Arrival",columns:[{dataField:"STA",caption:"Scheduled Arr.",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"Landing",caption:"Arrived",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"},{dataField:"ChocksIn",caption:"On Block",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:170,format:"yyyy-MMM-dd, HH:mm"}]},{caption:"Pax",columns:[{dataField:"PaxAdult",caption:"Adult",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxChild",caption:"Child",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxInfant",caption:"Infant",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"TotalPax",caption:"Total",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center",name:"totalpax"},{dataField:"TotalSeat",caption:"Seats",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"PaxOver",caption:"Over",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Cargo",columns:[{dataField:"CargoUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"CargoWeight",caption:"Weight",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"cargoweight"},{dataField:"CargoCount",caption:"Count",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Baggage",columns:[{dataField:"CargoUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"BaggageWeight",caption:"Weight",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"baggageweight"},{dataField:"BaggageCount",caption:"Count",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"}]},{caption:"Fuel",columns:[{dataField:"FuelUnit",caption:"Unit",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:70},{dataField:"FuelDeparture",caption:"Dep.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"},{dataField:"FuelArrival",caption:"Arr.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center"}]},{caption:"Delays",fixed:!0,fixedPosition:"right",columns:[{dataField:"delay",caption:"Dep.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"delay"},{dataField:"delayLanding",caption:"Arr.",allowResizing:!0,dataType:"number",allowEditing:!1,width:100,alignment:"center",name:"delayLanding"}]}],e.dg_flights_height=$(window).height()-139-50,e.dg_flights_instance=null,e.dg_flights_ds=null,e.dg_flights={searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,scrolling:{mode:"infinite",showScrollbar:"always"},paging:{pageSize:100},columns:e.dg_flights_columns,onContentReady:function(t){e.dg_flights_instance||(e.dg_flights_instance=t.component)},onSelectionChanged:function(t){if(e.doGridSelectedChanged){var i=t.selectedRowsData[0];if(i){e.dg_flights_selected=i,e.addSelectedFlight2(i);var n=$("#resourceGanttba").data("ejGantt"),a=n._getRecordByTaskId(i.ID.toString());n._$ganttchartHelper.ejGanttChart("selectTaskbar",a),e.scrollGantt(i)}else e.dg_flights_selected=null}else{e.doGridSelectedChanged=!0;var o=t.component.getView("rowsView")._scrollable,l=t.component.element().find("tr.dx-selection");o.scrollToElement(l)}},summary:{totalItems:[{name:"delay",showInColumn:"delay",displayFormat:"{0}",summaryType:"custom"},{name:"delayLanding",showInColumn:"delayLanding",displayFormat:"{0}",summaryType:"custom"},{name:"totalpax",showInColumn:"totalpax",displayFormat:"{0}",summaryType:"custom"},{name:"cargoweight",showInColumn:"cargoweight",displayFormat:"{0}",summaryType:"custom"},{name:"baggageweight",showInColumn:"baggageweight",displayFormat:"{0}",summaryType:"custom"}],calculateCustomSummary:function(e){"delay"===e.name&&("start"===e.summaryProcess&&(e.delay=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.delay+=e.value.delay)),"finalize"===e.summaryProcess&&(e.totalValue=e.delay)),"delayLanding"===e.name&&("start"===e.summaryProcess&&(e.delayLanding=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.delayLanding+=e.value.delayLanding)),"finalize"===e.summaryProcess&&(e.totalValue=e.delayLanding)),"totalpax"===e.name&&("start"===e.summaryProcess&&(e.totalpax=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.totalpax+=e.value.TotalPax)),"finalize"===e.summaryProcess&&(e.totalValue=e.totalpax)),"cargoweight"===e.name&&("start"===e.summaryProcess&&(e.cargoweight=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.cargoweight+=e.value.CargoWeight)),"finalize"===e.summaryProcess&&(e.totalValue=e.cargoweight)),"baggageweight"===e.name&&("start"===e.summaryProcess&&(e.baggageweight=0),"calculate"===e.summaryProcess&&(2!=e.value.FlightStatusID&&3!=e.value.FlightStatusID&&14!=e.value.FlightStatusID&&15!=e.value.FlightStatusID||(e.baggageweight+=e.value.BaggageWeight)),"finalize"===e.summaryProcess&&(e.totalValue=e.baggageweight))}},bindingOptions:{dataSource:"dg_flights_ds",visible:"gridview",height:"dg_flights_height"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},Flight.cindex=0,e.taskIndex=1e6,Flight.activeDatasource=[],e.scroll=0,e.bind=function(){var t="odata/flightplans/customer/"+Config.CustomerId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Id",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},d.isAuthorized()?n.page_title="> Planning Board":d.redirectToLogin(),e.hideButtons=function(){e.IsDepartureDisabled=!0,e.IsArrivalDisabled=!0},e.hideButtons2=function(){e.IsDepartureDisabled=!0,e.IsArrivalDisabled=!0},e.showButtons=function(t){e.IsDepartureDisabled=!1,e.IsArrivalDisabled=!1},e.showButtons2=function(t){e.IsDepartureDisabled=!1,e.IsArrivalDisabled=!1},e.weatherUpdateTime=null,e.weatherUpdateTimePassed=0,e.AirportWeatherVisible=!1,e.AirportWeather={currently:{},hourly:{}},e.FromWeather={currently:{}},e.FromWeatherVisible=!0,e.ToWeather={currently:{}},e.ToWeatherVisible=!0,e.getIcon=function(e){return e?e.currently.icon+" wicon":""},e.getIcon2=function(e){return e+" wicon"},e.prepareWeather=function(e){var t=90+Number(e.currently.windBearing);if(e.latitude=Number(e.latitude).toFixed(4),e.longitude=Number(e.longitude).toFixed(4),e.currently.windDeg="rotate("+t+"deg)",e.currently.windPoint="Winds from the "+Weather.getCompassPoint(Number(e.currently.windBearing)),e.currently.humidity=(100*Number(e.currently.humidity)).toFixed(1),e.currently.cloudCover=(100*Number(e.currently.cloudCover)).toFixed(1),e.currently.visibility=(1e3*Number(e.currently.visibility)).toFixed(0),e.hourly){e.hourly.h1={},e.hourly.h2={},e.hourly.h3={},e.hourly.h4={};for(var i=1;i<=4;i++){var n=e.hourly.data[i],a=null;switch(i){case 1:a=e.hourly.h1;break;case 2:a=e.hourly.h2;break;case 3:a=e.hourly.h3;break;case 4:a=e.hourly.h4}a.time=formatHourAMPM(new Date(1e3*n.time)),a.icon=n.icon,a.summary=n.summary,a.temperature=n.temperature,a.windtotal=n.windSpeed+" "+Weather.getCompassPoint(Number(n.windBearing)),a.visibility=1e3*Number(n.visibility),a.cloudCover=(100*Number(n.cloudCover)).toFixed(1)}}},e.setWeather=function(){if(e.flight){e.ToWeatherVisible=!1,e.FromWeatherVisible=!1;new Date(e.flight.STD).toUTCDateTimeDigits(),new Date(e.flight.STA).toUTCDateTimeDigits();o.getFlight(e.flight.ID,-1).then(function(t){e.FromWeather=t,e.prepareWeather(e.FromWeather),e.FromWeatherVisible=!0,o.getFlight(e.flight.ID,-2).then(function(t){e.ToWeather=t,e.prepareWeather(e.ToWeather),e.ToWeatherVisible=!0},function(e){General.ShowNotify(e.message,"error")})},function(e){General.ShowNotify(e.message,"error")})}},e.selectedFlights=[],e.clearSelectedFlights=function(){e.selectedFlights=[],e.hideButtons()},e.doGridSelectedChanged=!0,e.addSelectedFlight=function(t){e.removeUpdatedFlights(t),e.hideButtons(),Enumerable.From(e.selectedFlights).Where("$.taskId=="+t.taskId).FirstOrDefault()?(e.selectedFlights=[],e.$apply(function(){e.popup_inf_visible=!1})):(e.selectedFlights=[],e.selectedFlights.push(t),e.flight=t,e.showButtons(t),e.popup_inf_visible&&e.setWeather(),e.doGridSelectedChanged=!1,e.dg_flights_instance.selectRows([t],!1))},e.addSelectedFlight2=function(t){e.removeUpdatedFlights(t),e.hideButtons2(),Enumerable.From(e.selectedFlights).Where("$.taskId=="+t.taskId).FirstOrDefault()?(e.selectedFlights=[],e.popup_inf_visible=!1):(e.selectedFlights=[],e.selectedFlights.push(t),e.flight=t,e.showButtons2(t),e.popup_inf_visible&&e.setWeather())},e.selectedResource=null,e.setSelectedResource=function(t){var i=t.index;e.selectedResource&&e.setSelectedResource.index==i?(e.selectedResource=null,$("#resourceGanttba").data("ejGantt").clearSelection(i),alert("x")):e.selectedResource={index:t.index,item:t.item}},e.ganttCreated=!1,e.renderTopTimeHeader=function(){$.each($(".e-treegridrows.gridrowIndexlevel0").find(".e-cell"),function(e,t){var i=$(t).html(),n="";-1!=i.indexOf("Sat")&&(n="#ffd480"),-1!=i.indexOf("Sun")&&(n="#80ffff"),-1!=i.indexOf("Mon")&&(n="#00ff00"),-1!=i.indexOf("Tue")&&(n="#66b3ff"),-1!=i.indexOf("Wed")&&(n="#e6e600"),-1!=i.indexOf("Thu")&&(n="#99ccff"),-1!=i.indexOf("Fri")&&(n="#ff66ff"),$(t).parents(".e-treegridrows.gridrowIndexlevel0").css("background",n)});var t=$(".e-schedule-week-headercell-content");$.each(t,function(t,i){var n=$(i),a=n.html().split("(")[0],o=Number(a.split("-")[2]),l=a.split("-"),d=l[1],r=l[0],s=new Date(o+"/"+d+"/"+r);persianDate.toLocale("en");new persianDate(s).format("DD/MM/YYYY");var c=new persianDate(e.selectedTab.dateFrom).format("DD/MM/YYYY ")+" TO  "+new persianDate(e.selectedTab.dateTo).format(" DD/MM/YYYY");n.html(c)})},e.renderTimeHeader=function(){var t=$(".e-schedule-day-headercell-content");$.each(t,function(t,i){var n=$(i),a=n.html(),o=Number(n.html());n.find("span").length>0&&(a=$(n.find("span")[1]).html(),o=Number(a));var l=0,d="<span style='font-size:10px;display:block;color:gray;text-align:left;padding-left:2px'>"+(l=(e.IsUTC,getUTCHour(o)))+"</span><span style='font-size:13px;display:block;position:relative;top:-5px'>"+a+"</span>";n.html(d)})},e.timeCellWidth=0,e.selectedDate=null,e.createGantt=function(t){new Date(e.datefrom).yyyymmddtimenow(!1);t||(t=.24*$(window).width());var i=$(window).width()/1536,n=$("#resourceGanttba").data("ejGantt");n&&n.destroy(),e.StartNowLineTimerFirst=!0;var a=$(window).height()-139-50+140-130;a+="px";var o=General.getDayFirstHour(new Date(e.selectedDate)),l=new Date(o).addDays(1),d=(new Date(o).addDays(-1),General.getDayLastHour(new Date(e.selectedDate)));o=new Date(e.selectedTab.dateFrom),d=new Date(e.selectedTab.dateTo),console.log("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"),console.log(e.resources);var r=o.getFullYear().toString()+(o.getMonth()+1).toString()+o.getDate().toString()+(d.getMonth()+1).toString()+d.getDate().toString();console.log(r);var s=[],s=Enumerable.From(e.resources).Where(function(e){return e.resourceId.toString().startsWith(r)}).ToArray();console.log(s),console.log("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX");var c=Enumerable.From(e.dataSource).Where(function(e){var t=new Date(e.DateFrom),i=new Date(e.DateTo);return t.getTime()===o.getTime()&&i.getTime()===d.getTime()}).ToArray(),u=Enumerable.From(c).Where(function(e){var t=new Date(e.STA),i=new Date(e.STA),n=new Date(e.STA);return e.Landing&&(n=new Date(e.Landing)),e.ChocksIn&&(i=new Date(e.ChocksIn)),t>d||i>d||n>d}).ToArray(),g=!1,p=1e6;u&&u.length>0&&(d=General.getDayLastHour(new Date(l)),g=!0,p=400*i,console.log(u));var h=Enumerable.From(c).Where("$.LinkedFlight").FirstOrDefault();$("#resourceGanttba").ejGantt({scheduleStartDate:new Date(1900,0,1,0,0,0,0),scheduleEndDate:new Date(1900,0,1,23,59,59,999),taskbarBackground:"red",selectionMode:ej.Gantt.SelectionMode.Cell,selectionType:ej.Gantt.SelectionType.Single,taskbarClick:function(t){e.addSelectedFlight(t.data.item),$("#resourceGanttba").data("ejGantt").clearSelection()},dataSource:c,allowColumnResize:!0,isResponsive:!0,taskIdMapping:"taskId",taskNameMapping:"taskName",fromLocationMapping:"from",startDateMapping:"startDate",endDateMapping:"endDate",progressMapping:"progress",durationMapping:"duration",groupNameMapping:"Title",groupIdMapping:"groupId",resources:s,resourceIdMapping:"resourceId",resourceNameMapping:"resourceName",resourceInfoMapping:"resourceId",notesMapping:"notes",rightTaskLabelMapping:"taskName",baselineStartDateMapping:"BaselineStartDate",baselineEndDateMapping:"BaselineEndDate",highlightWeekEnds:!0,includeWeekend:!1,rowHeight:42,taskbarHeight:42,predecessorMapping:"predecessor",allowGanttChartEditing:!1,allowDragAndDrop:!0,editSettings:{allowEditing:!0,allowAdding:!0,allowDeleting:!0,editMode:"normal"},splitterSettings:{position:110},toolbarSettings:{showToolbar:!1,toolbarItems:[ej.Gantt.ToolbarItems.Add,ej.Gantt.ToolbarItems.Delete,ej.Gantt.ToolbarItems.Update,ej.Gantt.ToolbarItems.Cancel,ej.Gantt.ToolbarItems.ExpandAll,ej.Gantt.ToolbarItems.CollapseAll,ej.Gantt.ToolbarItems.NextTimeSpan,ej.Gantt.ToolbarItems.PrevTimeSpan]},enableContextMenu:!1,load:function(){e.ganttCreated=!0,this.getColumns()[0].width=110;h&&(e.linkedTimerDone=!1,e.StartLinkedTimer())},create:function(t){try{$(".e-ganttviewerbodyContianer").data("ejScroller").scrollX(p),g||$(".e-scrollbar.e-js.e-widget.e-hscrollbar").remove(),e.renderTopTimeHeader(),e.renderTimeHeader(),$(".e-ganttviewerbodyContianer-stripLines").css("z-index",0),e.timeCellWidth=$(".e-schedule-day-headercell-content").width();var i=new Date,n=new Date(o),a=new Date(d);i.getTime()>=n.getTime()&&i.getTime()<=a.getTime()?(e.autoUpdate=!0,e.StartNowLineTimer(1)):e.autoUpdate=!1}catch(e){alert(e)}},cellSelecting:function(e){e&&"resourceTask"!=e.data.eResourceTaskType&&(e.cancel=!0)},cellSelected:function(t){$(".e-gantt-taskbarSelection").removeClass("e-gantt-taskbarSelection"),e.setSelectedResource(t.data)},actionBegin:function(e){e.requestType&&"beginedit"==e.requestType&&(e.cancel=!0)},actionComplete:function(t){"save"==t.requestType&&(e.doActionCompleteSave?setTimeout(function(){$("#resourceGanttba").data("ejGantt")._$ganttchartHelper.ejGanttChart("selectTaskbar",t.modifiedRecord)},100):e.doActionCompleteSave=!0)},workingTimeScale:"TimeScale24Hours",durationUnit:ej.Gantt.DurationUnit.Hour,scheduleHeaderSettings:{scheduleHeaderType:ej.Gantt.ScheduleHeaderType.Day,dayHeaderFormat:"dd-MMM-yyyy",minutesPerInterval:ej.Gantt.minutesPerInterval.Auto,timescaleStartDateMode:ej.Gantt.TimescaleRoundMode.Auto,timescaleUnitSize:t+"%"},taskbarTemplate:"#taskbarTemplateLightNew",leftTaskLabelTemplate:"#leftlableTemplate",viewType:ej.Gantt.ViewType.ResourceView,sizeSettings:{height:a},groupSettings:{},showStackedHeader:!1,taskSchedulingMode:ej.Gantt.TaskSchedulingMode.Manual,enableTaskbarTooltip:!1})},e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.linkedTimer=null,e.linkedTimerDone=!1,e.StartLinkedTimer=function(){e.linkedTimer=setTimeout(function(){if(e.linkedTimerDone)e.StopLinkedTimer();else{var t=$(".linked-flight");t.length>0&&(t.each(function(){var e=$(this).data("linked");if(e){var t=$(this).closest(".e-childContainer"),i=$(".task-"+e).closest(".e-childContainer");if(i.length>0){var n=i.position().left;t.css({left:n+10})}}$(this).show()}),e.linkedTimerDone=!0),e.StartLinkedTimer()}},50)},e.StopLinkedTimer=function(){e.linkedTimer&&clearTimeout(e.linkedTimer)},e.wtimer=null,e.StartWTimer=function(){e.wtimer=setTimeout(function(){var t=Number(subtractDates(new Date(Date.now()),e.weatherUpdateTime)).toFixed(0);e.$apply(function(){e.weatherUpdateTimePassed=t}),e.StartWTimer()},1e4)},e.StopWTimer=function(){e.wtimer&&clearTimeout(e.wtimer)},e.getAirportWeather=function(){e.weatherUpdateTimePassed=0,e.StopWTimer(),e.AirportWeatherVisible=!1,o.getCurrentHourly(e.airportEntity.Latitude,e.airportEntity.Longitude).then(function(t){e.weatherUpdateTime=new Date(Date.now()),e.AirportWeather=t,e.prepareWeather(e.AirportWeather),e.StartWTimer(),e.AirportWeatherVisible=!0},function(e){General.ShowNotify(e.message,"error")})},e.updateWeather=function(){e.getAirportWeather()},e.delayCodes=null,e.$on("$viewContentLoaded",function(){e.scroll2_height=$(window).height()-266.5+87,$(".flightboard").fadeIn(400,function(){e.airport?(e.loadingVisible=!0,a.getAirportByIATA(e.airport).then(function(t){e.airportEntity=t,e.airportEntity.Latitude2=Number(e.airportEntity.Latitude).toFixed(3),e.airportEntity.Longitude2=Number(e.airportEntity.Longitude).toFixed(3),e.airportEntity.LtLg="("+e.airportEntity.Latitude2+", "+e.airportEntity.Longitude2+")",e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):e.airportEntity=null,e.loadingVisible=!0,a.getDelayCodes().then(function(t){e.loadingVisible=!1,$.each(t,function(e,t){t.Title2=t.Code+" "+t.Title}),e.delayCodes=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})})}),e.$on("$destroy",function(t){e.StopUTimer(),e.StopNowLineTimer()}),n.$broadcast("FlightBoardLoaded",null)}]),app.controller("personmiscAddController",["$scope","$location","personService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.TypeId=null,e.entity={Id:null,FirstName:null,LastName:null,Remark:null,TypeId:null,ImageUrl:null,Email:null,Instagram:null,Telegram:null,LinkedIn:null,Website:null,Tel:null},e.clearEntity=function(){e.entity.Id=null,e.entity.FirstName=null,e.entity.LastName=null,e.entity.Remark=null,e.entity.TypeId=null,e.entity.ImageUrl=null,e.entity.Email=null,e.entity.Instagram=null,e.entity.Telegram=null,e.entity.LinkedIn=null,e.entity.Website=null,e.entity.Tel=null,e.img_url="content/images/image.png"},e.bind=function(t){e.entity.Id=t.Id,e.entity.FirstName=t.FirstName,e.entity.LastName=t.LastName,e.entity.Remark=t.Remark,e.entity.TypeId=t.TypeId,e.entity.ImageUrl=t.ImageUrl,e.entity.Email=t.Email,e.entity.Instagram=t.Instagram,e.entity.Telegram=t.Telegram,e.entity.LinkedIn=t.LinkedIn,e.entity.Website=t.Website,e.entity.Tel=t.Tel,t.ImageUrl?e.img_url=o.clientsFilesUrl+t.ImageUrl:e.img_url="content/images/image.png"},e.img_url="content/images/image.png",e.uploaderValueImage=[],e.uploadedFileImage=null,e.uploader_image={multiple:!1,labelText:"",accept:"image/*",uploadMethod:"POST",uploadMode:"instantly",rtlEnabled:!0,uploadUrl:o.fileHandlerUrl+"?t=clientfiles",onValueChanged:function(e){},onUploaded:function(t){e.uploadedFileImage=t.request.responseText,e.entity.ImageUrl=t.request.responseText,e.img_url=o.clientsFilesUrl+e.uploadedFileImage},bindingOptions:{value:"uploaderValueImage"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.txt_FirstName={hoverStateEnabled:!1,bindingOptions:{value:"entity.FirstName"}},e.txt_LastName={hoverStateEnabled:!1,bindingOptions:{value:"entity.LastName"}},e.txt_Remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.Remark"}},e.txt_Tel={hoverStateEnabled:!1,bindingOptions:{value:"entity.Tel"}},e.txt_Instagram={hoverStateEnabled:!1,bindingOptions:{value:"entity.Instagram"}},e.txt_Telegram={hoverStateEnabled:!1,bindingOptions:{value:"entity.Telegram"}},e.txt_LinkedIn={hoverStateEnabled:!1,bindingOptions:{value:"entity.LinkedIn"}},e.emailValidationRules={validationRules:[{type:"email",message:"Email is invalid"}]},e.txt_Email={mode:"email",hoverStateEnabled:!1,bindingOptions:{value:"entity.Email"}},e.websiteValidationRules={validationRules:[{type:"pattern",pattern:/^(http:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,message:"Url is invalid"}]},e.txt_Website={mode:"url",hoverStateEnabled:!1,bindingOptions:{value:"entity.Website"}},e.pop_width=700,e.pop_height=585,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Save",icon:"check",validationGroup:"personmiscadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();i.width<=600&&(e.pop_width=i.width,e.pop_height=i.height)},onShown:function(t){e.isNew,null!=e.tempData&&e.bind(e.tempData)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,o.$broadcast("onPersonMiscHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){t.validationGroup.validate().isValid?(e.isNew&&(e.entity.Id=-1,e.entity.TypeId=e.TypeId),e.loadingVisible=!0,i.saveMisc(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onPersonMiscSaved",t),e.loadingVisible=!1,e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_FillRequired,"error")},e.tempData=null,e.$on("InitAddPersonMisc",function(t,i){e.tempData=null,e.TypeId=i._tid,i.Id?(e.popup_add_title="Edit",e.tempData=i,e.isNew=!1):(e.isNew=!0,e.popup_add_title="New"),e.popup_add_visible=!0})}]),app.controller("organizationController",["$scope","$location","$routeParams","$rootScope","organizationService","authService","$route",function(e,t,i,n,a,o,l){switch(e.prms=i.prms,e.TypeId=l.current.TypeId,e.caption="Organization",e.url="",Number(e.TypeId)){case 8:e.caption="Aircraft Manufacturer";break;case 58:e.caption="Airlines";break;case 77:e.caption="Publishers",e.url="odata/base/publishers"}switch(e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(t){var i={Id:null};i._tid=e.TypeId,n.$broadcast("InitAddOrganization",i)}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;i._tid=e.TypeId,n.$broadcast("InitAddOrganization",i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;e.InitAddAirport(i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.filters=[],e.dg_columns_publisher=[{cellTemplate:function(e,t){$("<div style='text-align:center'/>").html(t.rowIndex+1).appendTo(e)},caption:"#",width:60,fixed:!0,fixedPosition:"left",allowResizing:!1,cssClass:"rowHeader"},{dataField:"LogoUrl",caption:"",width:105,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.value&&$("<div>").append("<img src='"+n.clientsFilesUrl+t.value+"' style=' width:70px;height:70px '/>").appendTo(e)}},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Website",caption:"Website",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:250},{dataField:"SortName",caption:"Sort Name",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"Country",caption:"Country",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:170},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"Books",caption:"Items",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:80,fixed:!0,fixedPosition:"right"}],e.dg_columns=[],Number(e.TypeId)){case 8:case 58:break;case 77:e.dg_columns=e.dg_columns_publisher}e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+e.url,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:["Title"]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},o.isAuthorized()?(n.page_title="> "+e.caption,$(".organization").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onOrganizationSaved",function(t,i){e.doRefresh=!0}),e.$on("onOrganizationHide",function(t,i){e.bind()}),n.$broadcast("OrganizationLoaded",null)}]),app.controller("ordersController",["$scope","$location","ordersService","authService",function(e,t,i,n){n.isAuthorized()?($(".orders").fadeIn(),e.orders=[],i.getOrders().then(function(t){e.orders=t.data},function(e){})):(console.log("redirect"),n.redirectToLogin())}]),app.controller("jobgroupController",["$scope","$location","$routeParams","$rootScope","jobgroupService","personService","authService",function(e,t,i,n,a,o,l){e.prms=i.prms,e.height_tree=$(window).height()-177,e.dsUrl=null,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(t){var i={parent:e.dg_selected?e.dg_selected:null,Id:null,groups:e.dg_ds};n.$broadcast("InitAddJobGroup",i)}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;n.$broadcast("InitAddJobGroup",{Id:e.dg_selected.Id,data:i,groups:e.dg_ds})}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;e.InitAddAirport(i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_employees_ds=[],e.dg_employees_columns=[{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"left",sortIndex:1,sortOrder:"asc"},{dataField:"JobGroupCode",caption:"Group Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130,fixed:!0,fixedPosition:"left",sortIndex:2,sortOrder:"asc"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200,fixed:!0,fixedPosition:"left",sortIndex:3,sortOrder:"asc"},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Mobile",caption:"Mobile",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"Email",caption:"Email",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200}],e.dg_employees_height=100,e.dg_employees_selected=null,e.dg_employees_instance=null,e.dg_employees_ds=null,e.dg_employees={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_employees_columns,onContentReady:function(t){e.dg_employees_instance||(e.dg_employees_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_employees_selected=i||null},height:$(window).height()-180,bindingOptions:{dataSource:"dg_employees_ds"}},e.filters=[],e.dg_columns=[{dataField:"TitleFormated",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,encodeHtml:!1},{dataField:"FullCode",caption:"Code",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,encodeHtml:!1,width:200,sortIndex:0,sortOrder:"asc"},{dataField:"Employees",caption:"Employees",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.expandedRow=null,e.tree={selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,dataSource:e.dg_ds,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,o.getEmployeesByGroupCode(i.FullCode).then(function(t){e.dg_employees_ds=t},function(e){General.ShowNotify(e.message,"error")})):(e.dg_selected=null,e.dg_employees_ds=[])},keyExpr:"Id",parentIdExpr:"ParentId",showBorders:!0,columns:e.dg_columns,headerFilter:{visible:!0},height:$(window).height()-180,bindingOptions:{dataSource:"dg_ds",expandedRowKeys:"expandedRow"}},e.doRefresh=!0,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){var t=e.expandedRow;e.doRefresh=!1,e.loadingVisible=!0,a.getGroups(Config.CustomerId).then(function(i){e.dg_ds=i.data,!t&&i.data&&i.data.length>0?(e.expandedRow=[],e.expandedRow.push(i.data[0].Id)):e.expandedRow=t,e.loadingVisible=!1,$("#treecontainer").fadeIn()},function(t){e.loadingVisible=!1})},l.isAuthorized()?(n.page_title="> Groups",$(".jobgroup").fadeIn()):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onJobGroupSaved",function(t,i){e.doRefresh=!0}),e.$on("onJobGroupHide",function(t,i){e.bind()}),e.bind(),n.$broadcast("JobGroupLoaded",null)}]),app.controller("planRegistersController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,d,r){e.prms=i.prms;var s=-1*(new Date).getTimezoneOffset();e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.dg_selected=null,e.dg_columns=[{dataField:"status",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){12==t.value&&$("<div>").append("<i style='font-size:22px;color:#2196F3' class='icon ion-md-add-circle'></i>").appendTo(e),13==t.value&&$("<div>").append("<i style='font-size:22px;color:#4CAF50' class='icon ion-md-create'></i>").appendTo(e),10==t.value&&$("<div>").append("<i style='font-size:22px;color:#f44336' class='icon ion-md-shuffle'></i>").appendTo(e),11==t.value&&$("<div>").append("<i style='font-size:22px;color:#ff5722' class='icon ion-md-code-working'></i>").appendTo(e),16==t.value&&$("<div>").append("<i style='font-size:22px;color:#f44336' class='icon ion-md-shuffle'></i><i style='font-size:22px;color:#ff5722' class='icon ion-md-code-working'></i>").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"DateFrom",caption:"Date",allowResizing:!0,dataType:"date",allowEditing:!1,width:200,alignment:"center",groupIndex:0},{dataField:"BaseIATA",caption:"Base",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"AircraftType",caption:"AC Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Register",caption:"Register",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"FlightStatus",caption:"Status",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"right"}],e.dg_height=$(window).height()-135,e.dg_instance=null,e.dg_ds=null,e.dg={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},onCellPrepared:function(e){if("data"==e.rowType&&"BaseIATA"===e.column.dataField){var t=Flight.getBaseMetaData(e.data.BaseIATA);t&&e.cellElement.css("background",t.bgcolor)}},bindingOptions:{dataSource:"dg_ds",height:"dg_height"}},e.bind=function(){var t="odata/flightplans/items/opened/"+Config.CustomerId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){$.each(e,function(e,t){t.STD=new Date(t.STD).addMinutes(s),t.STA=new Date(t.STA).addMinutes(s)}),n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"DateFrom",desc:!0},"BaseIATA","STD"]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},l.isAuthorized()?(n.page_title="> Registers ",$(".planregister").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("$viewContentLoaded",function(){})}]),app.controller("personcertificateController",["$scope","$location","$routeParams","$rootScope","courseService","authService",function(e,t,i,n,a,o){e.prms=i.prms;var l=[{text:"Last Certificates",id:"last"},{text:"All Certificates",id:"all"}];e.tabs=l,e.selectedTabIndex=0,e.$watch("selectedTabIndex",function(t){e.dg_course_visible=0==t,e.dg_course_all_visible=1==t}),e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex"}},e.bindCourses=function(t){if(!t){var i=n.getSelectedRow(e.dg_employees_instance);if(!i)return;t=i.PersonId}a.getPersonLastCertificates(t).then(function(t){e.dg_course_ds=t},function(e){General.ShowNotify(e.message,"error")}),a.getPersonAllCertificates(t).then(function(t){e.dg_course_all_ds=t},function(e){General.ShowNotify(e.message,"error")})},e.dsUrl=null,e.filterVisible=!1,e.selectedCourse=null,e.courseStatus={SMS:!0,Email:!0,AppNotification:!0,StatusId:null,Status:null,CourseId:null,OldStatus:null,Remark:null,IssueDate:null,No:null,Name:null,People:[]},e.sb_StatusId={showClearButton:!0,searchEnabled:!1,dataSource:n.getDatasourcePersonCourseStatus(),displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){if(t.selectedItem){var i=71==t.selectedItem.Id;e.isCertidicateDisabled=!i}},bindingOptions:{value:"courseStatus.StatusId",text:"courseStatus.Status"}},e.txt_OldStatus={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseStatus.OldStatus"}},e.chb_SMS={text:"Send SMS",bindingOptions:{value:"courseStatus.SMS"}},e.chb_Email={text:"Send Email",bindingOptions:{value:"courseStatus.Email"}},e.chb_AppNotification={text:"Send Notification",bindingOptions:{value:"courseStatus.AppNotification"}},e.txt_StatusRemark={hoverStateEnabled:!1,bindingOptions:{value:"courseStatus.Remark"}},e.txt_CertificateNo={hoverStateEnabled:!1,bindingOptions:{value:"courseStatus.No"}},e.txt_Name={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseStatus.Name"}},e.date_DateIssue={width:"100%",type:"date",displayFormat:n.DateBoxFormat,bindingOptions:{value:"courseStatus.IssueDate"}},e.btn_status={text:"Change Status",type:"default",icon:"event",width:200,onClick:function(t){if(e.selectedCourse=n.getSelectedRow(e.dg_course_instance),e.selectedCourse){var i=n.getSelectedRow(e.dg_employees_instance);e.courseStatus.People=[],e.courseStatus.People.push(i.PersonId),e.courseStatus.CourseId=e.selectedCourse.CourseId,e.courseStatus.OldStatus=e.selectedCourse.Status,e.courseStatus.OldStatus||(e.courseStatus.OldStatus="Pending"),e.popup_status_visible=!0}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_passed={text:"Certification",type:"default",icon:"event",width:200,onClick:function(t){if(e.selectedCourse=n.getSelectedRow(e.dg_course_instance),e.selectedCourse){var i=n.getSelectedRow(e.dg_employees_instance);e.courseStatus.People=[],e.courseStatus.People.push(i.PersonId),e.courseStatus.CourseId=e.selectedCourse.CourseId,e.courseStatus.Name=i.Name,e.courseStatus.OldStatus=e.selectedCourse.Status,e.courseStatus.StatusId=71,e.courseStatus.OldStatus||(e.courseStatus.OldStatus="Pending"),e.popup_passed_visible=!0}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".filter").show())}},e.btn_new={text:"New Certificate",type:"default",icon:"plus",width:200,onClick:function(t){var i=n.getSelectedRow(e.dg_employees_instance);if(i){var a={Id:null,PersonId:i.PersonId,Name:i.Name,PID:i.PID,NID:i.NID,Mobile:i.Mobile,Type:null,Title:null,Organization:null,Interval:null,CalanderTypeId:null,CourseId:null,No:null,DateIssue:null,CourseTypeId:null,Title:null};n.$broadcast("InitAddCertificate",a)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_delete={text:"Delete Certificate",type:"danger",icon:"clear",width:230,onClick:function(t){var i=null;(i=0==e.selectedTabIndex?n.getSelectedRow(e.dg_course_instance):n.getSelectedRow(e.dg_course_all_instance))?1!=i.IsNotificationEnabled?General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var n={Id:i.Id};e.loadingVisible=!0,a.deleteCertificate(n).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.bindCourses()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}):General.ShowNotify(Config.Text_CanNotDelete,"error"):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.certificateCaption="Last Certificates",e.dg_employees_columns=[{dataField:"CriticalCertificatesCount",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){t.value>0&&$("<div>").append("<img src='content/images/alert.png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250,fixed:!0,fixedPosition:"left"},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Mobile",caption:"Mobile",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"Email",caption:"Email",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"DateJoinCompany",caption:"Join Company",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"CaoCardNumber",caption:"CAO No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"NDTNumber",caption:"NDT No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130}],e.dg_employees_height=100,e.dg_employees_selected=null,e.dg_employees_instance=null,e.dg_employees_ds=null,e.dg_employees={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_employees_columns,onContentReady:function(t){e.dg_employees_instance||(e.dg_employees_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_employees_selected=i,e.courseCaption="Courses > "+i.Name,e.dg_course_ds=null,e.dg_course_all_ds=null,e.bindCourses(i.PersonId)):(e.dg_employees_selected=null,e.dg_course_ds=null,e.dg_course_all_ds=null,e.courseCaption="Courses")},height:$(window).height()-175,bindingOptions:{dataSource:"dg_employees_ds"}},e.dg_course_visible=!0,e.dg_course_all_visible=!1,e.dg_course_columns=[{dataField:"ExpireStatus",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="green";switch(t.value){case 1:i="red";break;case 2:i="orange"}$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"CerNumber",caption:"Certificate No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130,fixed:!0,fixedPosition:"left"},{dataField:"ExpireDate",caption:"Expire Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!0,fixedPosition:"left"},{dataField:"DateIssue",caption:"Issue Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!1,fixedPosition:"left"},{dataField:"Remain",caption:"Remain",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:70,fixed:!1,fixedPosition:"left"},{dataField:"CourseNo",caption:"Course No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:100},{dataField:"CourseTitle",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300,fixed:!0,fixedPosition:"left"},{dataField:"CourseOrganization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"CourseDateStart",caption:"DateStart",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,sortIndex:0,sortOrder:"desc"},{dataField:"CourseRecurrent",caption:"Recurrent",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100}],e.dg_course_selected=null,e.dg_course_instance=null,e.dg_course_ds=null,e.dg_course={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-175,columns:e.dg_course_columns,onContentReady:function(t){e.dg_course_instance||(e.dg_course_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_course_selected=i||null},bindingOptions:{dataSource:"dg_course_ds",visible:"dg_course_visible"}},e.dg_course_all_columns=[{dataField:"IsLast",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="";1==t.data.IsFirst&&(i="letter-f"),1==t.data.IsLast&&(i="letter-l"),i&&$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"CerNumber",caption:"Certificate No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130,fixed:!0,fixedPosition:"left"},{dataField:"ExpireDate",caption:"Expire Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!0,fixedPosition:"left"},{dataField:"DateIssue",caption:"Issue Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!1,fixedPosition:"left"},{dataField:"CourseNo",caption:"Course No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:100},{dataField:"CourseTitle",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300,fixed:!0,fixedPosition:"left"},{dataField:"CourseOrganization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"CourseDateStart",caption:"DateStart",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,sortIndex:0,sortOrder:"desc"},{dataField:"CourseRecurrent",caption:"Recurrent",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100}],e.dg_course_all_selected=null,e.dg_course_all_instance=null,e.dg_course_all_ds=null,e.dg_course_all={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-175,columns:e.dg_course_all_columns,onContentReady:function(t){e.dg_course_all_instance||(e.dg_course_all_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_course_all_selected=i||null},bindingOptions:{dataSource:"dg_course_all_ds",visible:"dg_course_all_visible"}},e.popup_status_visible=!1,e.popup_status={height:340,width:550,fullScreen:!1,showTitle:!0,title:"Change Status",toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"statusChange",onClick:function(t){t.validationGroup.validate().isValid?(e.loadingVisible=!0,a.changeStatus(e.courseStatus).then(function(t){e.selectedCourse.StatusId=72!=e.courseStatus.StatusId?e.courseStatus.StatusId:null,e.selectedCourse.Status=72!=e.courseStatus.Status?e.courseStatus.Status:null,e.selectedCourse.CerNumber=null,e.selectedCourse.DateIssue=null,General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.dg_course_instance.clearSelection(),e.popup_status_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_status_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHidden:function(){e.dg_employees_instance.refresh()},onHiding:function(){e.courseStatus={CourseId:null,SMS:!0,Email:!0,AppNotification:!0,StatusId:null,Status:null,OldStatus:null,Remark:null,IssueDate:null,No:null,People:[]},e.popup_status_visible=!1},bindingOptions:{visible:"popup_status_visible"}},e.popup_passed_visible=!1,e.popup_passed={height:440,width:550,fullScreen:!1,showTitle:!0,title:"Certification",toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"passed",onClick:function(t){t.validationGroup.validate().isValid?(e.loadingVisible=!0,a.changeStatus(e.courseStatus).then(function(t){e.selectedCourse.StatusId=71,e.selectedCourse.Status="Passed",e.selectedCourse.CerNumber=e.courseStatus.No,e.selectedCourse.DateIssue=e.courseStatus.IssueDate,e.dg_course_instance.clearSelection(),General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.popup_passed_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_passed_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.courseStatus={CourseId:null,SMS:!0,Email:!0,AppNotification:!0,StatusId:null,Status:null,OldStatus:null,Remark:null,IssueDate:null,No:null,People:[]},e.popup_passed_visible=!1},bindingOptions:{visible:"popup_passed_visible"}},e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){!e.dg_employees_ds&&e.doRefresh&&(e.dg_employees_ds={store:{type:"odata",url:n.serviceUrl+"odata/employees/"+Config.CustomerId,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"CriticalCertificatesCount",desc:!0},"Name"]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_employees_ds.filter=e.filters,e.dg_employees_instance.refresh(),e.doRefresh=!1)},o.isAuthorized()?(n.page_title="> Certificates",$(".personcertificate").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.doRefreshCertificates=!1,e.$on("onCertificateSaved",function(t,i){e.doRefreshCertificates=!0}),e.$on("onCertificateHide",function(t,i){e.doRefreshCertificates&&(e.doRefreshCertificates=!1,e.bindCourses())}),n.$broadcast("PersonCourseLoaded",null)}]),app.controller("locationController",["$scope","$location","$routeParams","$rootScope","locationService","authService",function(e,t,i,n,a,o){e.prms=i.prms,e.dsUrl=null,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i={parent:e.dg_selected,Id:null};n.$broadcast("InitAddLocation",i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;n.$broadcast("InitAddLocation",i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_view={text:"View",type:"default",icon:"doc",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;e.InitAddAirport(i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.filters=[],e.dg_columns=[{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FullCode",caption:"Full Code",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Type",caption:"Type",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"Root",caption:"Root",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.expandedRow=null,e.dg={filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:"100%",columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds"}},e.tree={selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,height:"100%",dataSource:e.dg_ds,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},keyExpr:"Id",parentIdExpr:"ParentId",showBorders:!0,columns:e.dg_columns,headerFilter:{visible:!0},bindingOptions:{dataSource:"dg_ds",expandedRowKeys:"expandedRow"}},e.doRefresh=!0,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){var t=e.expandedRow;e.doRefresh=!1,e.loadingVisible=!0,a.getLocations(Config.CustomerId).then(function(i){e.dg_ds=i.data,!t&&i.data&&i.data.length>0?(e.expandedRow=[],e.expandedRow.push(i.data[0].Id)):e.expandedRow=t,e.loadingVisible=!1,$("#treecontainer").fadeIn()},function(t){e.loadingVisible=!1})},o.isAuthorized()?(n.page_title="> Locations",$(".location").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onLocationSaved",function(t,i){e.doRefresh=!0}),e.$on("onLocationHide",function(t,i){e.bind()}),e.bind(),n.$broadcast("LocationLoaded",null)}]),app.controller("optionAddController",["$scope","$location","generalService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.ParentId=null,e.entity={Id:null,Title:null,ParentId:e.ParentId,IsSystem:0,OrderIndex:1,CreatorId:Config.CustomerId},e.clearEntity=function(){e.entity.Id=null,e.entity.Title=null,e.entity.ParentId=e.ParentId,e.entity.IsSystem=0,e.entity.OrderIndex=1,e.entity.CreatorId=Config.CustomerId},e.bind=function(t){e.entity.Id=t.Id,e.entity.Title=t.Title,e.entity.ParentId=t.ParentId,e.entity.IsSystem=t.IsSystem,e.entity.OrderIndex=t.OrderIndex,e.entity.CreatorId=t.CreatorId},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.txt_Title={hoverStateEnabled:!1,bindingOptions:{value:"entity.Title"}},e.pop_width=400,e.pop_height=200,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Save",icon:"check",validationGroup:"optionadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();i.width<=600&&(e.pop_width=i.width,e.pop_height=i.height)},onShown:function(t){null!=e.tempData&&e.bind(e.tempData)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,o.$broadcast("onOptionHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){t.validationGroup.validate().isValid?(e.isNew&&(e.entity.Id=-1),e.entity.ParentId=e.ParentId,e.entity.CreatorId=Config.CustomerId,e.loadingVisible=!0,i.saveOption(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onOptionSaved",t),e.loadingVisible=!1,e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_FillRequired,"error")},e.tempData=null,e.parentData=null,e.parent=null,e.parentCode=null,e.ParentCustomerId=null,e.$on("InitAddOption",function(t,i){e.tempData=null,i.Id?(e.popup_add_title="Edit",e.tempData=i,e.isNew=!1,e.ParentId=i.ParentId):(e.isNew=!0,e.popup_add_title="New",e.ParentId=i.ParentId),e.popup_add_visible=!0})}]),app.controller("personController",["$scope","$location","$routeParams","$rootScope","personService","authService","notificationService",function(e,t,i,n,a,o,l){e.prms=i.prms,e.IsEditable=n.IsProfileEditable(),e.editButtonIcon="edit",e.editButtonText="Edit",e.IsEditable||(e.editButtonText="View",e.editButtonIcon="card"),e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,bindingOptions:{visible:"IsEditable"},onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={PersonId:e.dg_selected.PersonId};e.loadingVisible=!0,a.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify2(t.message,"error",5e3)})}}):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_view={text:"View",type:"default",icon:"card",width:120,visible:!1,bindingOptions:{},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;n.$broadcast("InitViewPerson",i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(e){var t={Id:null};n.$broadcast("InitAddPerson",t)},bindingOptions:{visible:"IsEditable"}},e.btn_edit={type:"default",width:120,bindingOptions:{icon:"editButtonIcon",text:"editButtonText"},onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;n.$broadcast("InitAddPerson",i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_print={text:"Print",type:"default",icon:"print",width:120},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".filter").fadeOut()):(e.filterVisible=!0,$(".filter").fadeIn())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.filters=[],e.dg_columns=[{dataField:"ImageUrl",width:80,alignment:"center",caption:"",allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){$("<div>").append($("<img>",{src:n.clientsFilesUrl+(t.value?t.value:"imguser.png"),css:{height:"50px",width:"50px",borderRadius:"100%"}})).appendTo(e)}},{caption:"Base",columns:[{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"ScheduleName",caption:"Schedule",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Mobile",caption:"Mobile",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Email",caption:"Email",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"DateJoinAvation",caption:"Join Aviation",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"Age",caption:"Age",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:50}]},{caption:"Organizational",columns:[{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Location",caption:"Department",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:130},{dataField:"DateJoinCompany",caption:"Join Company",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130}]},{caption:"Passport",columns:[{dataField:"RemainPassport",caption:"Remain",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90}]},{caption:"Medical Checkup",columns:[{dataField:"RemainMedical",caption:"Remain",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90}]},{caption:"CAO",columns:[{dataField:"RemainCAO",caption:"Remain",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90}]},{caption:"NDT",columns:[{dataField:"RemainNDT",caption:"Remain",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:90}]}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+"odata/employees/light/"+Config.CustomerId,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}}}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},o.isAuthorized()?(n.page_title="> People",$(".person").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onPersonSaved",function(t,i){e.doRefresh=!0}),e.$on("onPersonHide",function(t,i){e.bind()}),n.$broadcast("PersonLoaded",null)}]),app.controller("personAddController",["$scope","$location","personService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.IsEditable=-1!=o.roles.indexOf("Admin")||"beyram"==o.userName||"abbaspour"==o.userName,e.entity={Id:null,PersonId:null,DateJoinCompany:null,DateJoinCompanyP:null,IsActive:1,DateRegisterP:-1,DateConfirmedP:null,DateRegister:null,DateConfirmed:null,IsDeleted:0,DateActiveStart:null,DateActiveEnd:null,DateLastLoginP:null,DateLastLogin:null,Username:null,Password:null,PID:null,Phone:null,GroupId:null,CustomerId:Config.CustomerId,BaseAirportId:null,DateInactiveBegin:null,DateInactiveEnd:null,Person:{PersonId:null,DateCreate:null,MarriageId:null,NID:null,SexId:null,FirstName:null,LastName:null,DateBirth:null,Email:null,EmailPassword:null,Phone1:null,Phone2:null,Mobile:null,FaxTelNumber:null,PassportNumber:null,DatePassportIssue:null,DatePassportExpire:null,Address:null,IsActive:1,DateJoinAvation:null,DateLastCheckUP:null,DateNextCheckUP:null,DateYearOfExperience:null,CaoCardNumber:null,DateCaoCardIssue:null,DateCaoCardExpire:null,CompetencyNo:null,CaoInterval:null,CaoIntervalCalanderTypeId:null,IsDeleted:0,Remark:null,StampNumber:null,StampUrl:null,TechLogNo:null,DateIssueNDT:null,IntervalNDT:null,NDTNumber:null,NDTIntervalCalanderTypeId:null,IsAuditor:null,IsAuditee:null,Nickname:null,CityId:null,FatherName:null,IDNo:null,RowId:null,UserId:null,ImageUrl:null,CustomerCreatorId:null,DateExpireNDT:null,ProficiencyExpireDate:null,CrewMemberCertificateExpireDate:null,LicenceExpireDate:null,LicenceIRExpireDate:null,SimulatorLastCheck:null,SimulatorNextCheck:null,RampPassNo:null,RampPassExpireDate:null,LanguageCourseExpireDate:null,LicenceTitle:null,LicenceInitialIssue:null,RaitingCertificates:null,LicenceIssueDate:null,LicenceDescription:null,ProficiencyCheckType:null,ProficiencyCheckDate:null,ProficiencyValidUntil:null,ICAOLPRLevel:null,ICAOLPRValidUntil:null,MedicalClass:null,CMCEmployedBy:null,CMCOccupation:null,PostalCode:null,ProficiencyIPC:null,ProficiencyOPC:null,ProficiencyDescription:null,MedicalLimitation:null,VisaExpireDate:null,SEPTIssueDate:null,SEPTExpireDate:null,SEPTPIssueDate:null,SEPTPExpireDate:null,DangerousGoodsIssueDate:null,DangerousGoodsExpireDate:null,CCRMIssueDate:null,CCRMExpireDate:null,CRMIssueDate:null,CRMExpireDate:null,SMSIssueDate:null,SMSExpireDate:null,FirstAidIssueDate:null,FirstAidExpireDate:null,AviationSecurityIssueDate:null,AviationSecurityExpireDate:null,EGPWSIssueDate:null,EGPWSExpireDate:null,UpsetRecoveryTrainingIssueDate:null,UpsetRecoveryTrainingExpireDate:null,ColdWeatherOperationIssueDate:null,HotWeatherOperationIssueDate:null,ColdWeatherOperationExpireDate:null,HotWeatherOperationExpireDate:null,PBNRNAVIssueDate:null,PBNRNAVExpireDate:null,ScheduleName:null,Code:null,Educations:[],Expreienses:[],AircraftTypes:[],Documents:[],Ratings:[]},Locations:[{Id:-1,EmployeeId:-1,LocationId:null,IsMainLocation:1,OrgRoleId:null,DateActiveStartP:null,DateActiveEndP:null,DateActiveStart:null,DateActiveEnd:null,Remark:null,Phone:null,OrgRole:null,Title:null,FullCode:null}]},e.entityFile={Id:null,DocumentTypeId:null,FileTypeId:null,FileUrl:null,Title:null,ParentId:null},e.entityDocument={PersonId:-1,Title:null,Remark:null,DocumentTypeId:null,Id:null,DocumentType:null,Documents:[]},e.entityEducation={Id:null,PersonId:-1,EducationDegreeId:null,DateCatch:null,College:null,Remark:null,Title:null,StudyFieldId:null,StudyField:null,EducationDegree:null,FileUrl:null,FileTitle:null,SysUrl:null,FileType:null},e.txt_EducationFileUrl={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"entityEducation.FileUrl"}},e.txt_EducationSysUrl={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"entityEducation.SysUrl"}},e.txt_EducationFileType={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"entityEducation.FileType"}},e.entityExp={PersonId:-1,OrganizationId:null,Employer:null,AircraftTypeId:null,Remark:null,DateStart:null,DateEnd:null,Organization:null,JobTitle:null,AircraftType:null,Id:null},e.entityRating={Id:null,PersonId:-1,AircraftTypeId:null,RatingId:null,DateIssue:null,DateExpire:null,CategoryId:null,AircraftType:null,RatingOrganization:null,OrganizationId:null,Category:null},e.entityAircrafttype={Id:null,AircraftTypeId:null,PersonId:-1,IsActive:1,DateLimitBegin:null,DateLimitEnd:null,Remark:null,Manufacturer:null,AircraftType:null},e.bindEntityAircrafttype=function(t){e.entityAircrafttype.Id=t.Id,e.entityAircrafttype.AircraftTypeId=t.AircraftTypeId,e.entityAircrafttype.PersonId=t.PersonId,e.entityAircrafttype.IsActive=t.IsActive,e.entityAircrafttype.DateLimitBegin=t.DateLimitBegin,e.entityAircrafttype.DateLimitEnd=t.DateLimitEnd,e.entityAircrafttype.Remark=t.Remark},e.bindEducation=function(t){e.entityEducation.Id=t.Id,e.entityEducation.PersonId=t.PersonId,e.entityEducation.EducationDegreeId=t.EducationDegreeId,e.entityEducation.DateCatch=t.DateCatch,e.entityEducation.College=t.College,e.entityEducation.Remark=t.Remark,e.entityEducation.Title=t.Title,e.entityEducation.StudyFieldId=t.StudyFieldId,e.entityEducation.StudyField=t.StudyField,e.entityEducation.EducationDegree=t.EducationDegree,e.entityEducation.FileUrl=t.FileUrl,e.download="",e.entityEducation.FileUrl&&(e.download=o.clientsFilesUrl+"/"+e.entityEducation.FileUrl),e.entityEducation.FileTitle=t.FileTitle,e.entityEducation.SysUrl=t.SysUrl,e.entityEducation.FileType=t.FileType},e.bindDocumnet=function(t){e.entityDocument.PersonId=t.PersonId,e.entityDocument.Title=t.Title,e.entityDocument.Remark=t.Remark,e.entityDocument.DocumentTypeId=t.DocumentTypeId,e.entityDocument.Id=t.Id,e.entityDocument.DocumentType=t.DocumentType,e.entityDocument.Documents=t.Documents},e.entityDocument2={},e.bindDocumnetView=function(t){e.entityDocument2={},e.entityDocument2.PersonId=t.PersonId,e.entityDocument2.Title=t.Title,e.entityDocument2.Remark=t.Remark,e.entityDocument2.DocumentTypeId=t.DocumentTypeId,e.entityDocument2.Id=t.Id,e.entityDocument2.DocumentType=t.DocumentType,e.entityDocument2.Documents=t.Documents},e.bindExp=function(t){e.entityExp.PersonId=t.PersonId,e.entityExp.OrganizationId=t.OrganizationId,e.entityExp.Employer=t.Employer,e.entityExp.AircraftTypeId=t.AircraftTypeId,e.entityExp.Remark=t.Remark,e.entityExp.DateStart=t.DateStart,e.entityExp.DateEnd=t.DateEnd,e.entityExp.Organization=t.Organization,e.entityExp.JobTitle=t.JobTitle,e.entityExp.AircraftType=t.AircraftType,e.entityExp.Id=t.Id},e.bindRating=function(t){e.entityRating.Id=t.Id,e.entityRating.PersonId=t.PersonId,e.entityRating.AircraftTypeId=t.AircraftTypeId,e.entityRating.RatingId=t.RatingId,e.entityRating.DateIssue=t.DateIssue,e.entityRating.DateExpire=t.DateExpire,e.entityRating.CategoryId=t.CategoryId,e.entityRating.AircraftType=t.AircraftType,e.entityRating.RatingOrganization=t.RatingOrganization,e.entityRating.OrganizationId=t.OrganizationId,e.entityRating.Category=t.Category},e.clearEntityDocumnet=function(){e.entityDocument.PersonId=-1,e.entityDocument.Title=null,e.entityDocument.Remark=null,e.entityDocument.DocumentTypeId=null,e.entityDocument.Id=null,e.entityDocument.DocumentType=null,e.entityDocument.Documents=[],e.uploader_document_instance.reset()},e.clearEntity=function(){e.entity.Id=null,e.entity.PersonId=-1,e.entity.DateJoinCompany=null,e.entity.DateJoinCompanyP=null,e.entity.IsActive=1,e.entity.DateRegisterP=-1,e.entity.DateConfirmedP=null,e.entity.DateRegister=null,e.entity.DateConfirmed=null,e.entity.IsDeleted=0,e.entity.DateActiveStart=null,e.entity.DateActiveEnd=null,e.entity.DateLastLoginP=null,e.entity.DateLastLogin=null,e.entity.Username=null,e.entity.Password=null,e.entity.CustomerId=Config.CustomerId,e.entity.PID=null,e.entity.Phone=null,e.entity.BaseAirportId=null,e.entity.DateInactiveBegin=null,e.entity.DateInactiveEnd=null,e.nid=null,e.entity.Person.DateCreate=null,e.entity.Person.MarriageId=null,e.entity.Person.NID=null,e.entity.Person.SexId=null,e.entity.Person.FirstName=null,e.entity.Person.LastName=null,e.entity.Person.DateBirth=null,e.entity.Person.Email=null,e.entity.Person.EmailPassword=null,e.entity.Person.Phone1=null,e.entity.Person.Phone2=null,e.entity.Person.Mobile=null,e.entity.Person.FaxTelNumber=null,e.entity.Person.PassportNumber=null,e.entity.Person.DatePassportIssue=null,e.entity.Person.DatePassportExpire=null,e.entity.Person.Address=null,e.entity.Person.IsActive=1,e.entity.Person.DateJoinAvation=null,e.entity.Person.DateLastCheckUP=null,e.entity.Person.DateNextCheckUP=null,e.entity.Person.DateYearOfExperience=null,e.entity.Person.CaoCardNumber=null,e.entity.Person.DateCaoCardIssue=null,e.entity.Person.DateCaoCardExpire=null,e.entity.Person.CompetencyNo=null,e.entity.Person.CaoInterval=null,e.entity.Person.CaoIntervalCalanderTypeId=null,e.entity.Person.IsDeleted=0,e.entity.Person.Remark=null,e.entity.Person.StampNumber=null,e.entity.Person.StampUrl=null,e.entity.Person.TechLogNo=null,e.entity.Person.DateIssueNDT=null,e.entity.Person.IntervalNDT=null,e.entity.Person.NDTNumber=null,e.entity.Person.NDTIntervalCalanderTypeId=null,e.entity.Person.IsAuditor=null,e.entity.Person.IsAuditee=null,e.entity.Person.Nickname=null,e.entity.Person.CityId=null,e.entity.Person.FatherName=null,e.entity.Person.IDNo=null,e.entity.Person.CustomerCreatorId=null,e.entity.Person.ImageUrl=null,e.entity.Person.UserId=null,e.entity.Person.DateExpireNDT=null,e.entity.Person.ProficiencyExpireDate=null,e.entity.Person.CrewMemberCertificateExpireDate=null,e.entity.Person.LicenceExpireDate=null,e.entity.Person.LicenceIRExpireDate=null,e.entity.Person.SimulatorLastCheck=null,e.entity.Person.SimulatorNextCheck=null,e.entity.Person.RampPassNo=null,e.entity.Person.RampPassExpireDate=null,e.entity.Person.LanguageCourseExpireDate=null,e.entity.Person.LicenceTitle=null,e.entity.Person.LicenceInitialIssue=null,e.entity.Person.RaitingCertificates=null,e.entity.Person.LicenceIssueDate=null,e.entity.Person.LicenceDescription=null,e.entity.Person.ProficiencyCheckType=null,e.entity.Person.ProficiencyCheckDate=null,e.entity.Person.ProficiencyValidUntil=null,e.entity.Person.ICAOLPRLevel=null,e.entity.Person.ICAOLPRValidUntil=null,e.entity.Person.MedicalClass=null,e.entity.Person.CMCEmployedBy=null,e.entity.Person.CMCOccupation=null,e.entity.Person.PostalCode=null,e.entity.Person.ProficiencyIPC=null,e.entity.Person.ProficiencyOPC=null,e.entity.Person.ProficiencyDescription=null,e.entity.Person.MedicalLimitation=null,e.entity.Person.VisaExpireDate=null,e.entity.Person.SEPTIssueDate=null,e.entity.Person.SEPTExpireDate=null,e.entity.Person.SEPTPIssueDate=null,e.entity.Person.SEPTPExpireDate=null,e.entity.Person.DangerousGoodsIssueDate=null,e.entity.Person.DangerousGoodsExpireDate=null,e.entity.Person.CCRMIssueDate=null,e.entity.Person.CCRMExpireDate=null,e.entity.Person.CRMIssueDate=null,e.entity.Person.CRMExpireDate=null,e.entity.Person.SMSIssueDate=null,e.entity.Person.SMSExpireDate=null,e.entity.Person.FirstAidIssueDate=null,e.entity.Person.FirstAidExpireDate=null,e.entity.Person.AviationSecurityIssueDate=null,e.entity.Person.AviationSecurityExpireDate=null,e.entity.Person.EGPWSIssueDate=null,e.entity.Person.EGPWSExpireDate=null,e.entity.Person.UpsetRecoveryTrainingIssueDate=null,e.entity.Person.UpsetRecoveryTrainingExpireDate=null,e.entity.Person.ColdWeatherOperationIssueDate=null,e.entity.Person.HotWeatherOperationIssueDate=null,e.entity.Person.ColdWeatherOperationExpireDate=null,e.entity.Person.HotWeatherOperationExpireDate=null,e.entity.Person.PBNRNAVIssueDate=null,e.entity.Person.PBNRNAVExpireDate=null,e.entity.Person.Code=null,e.entity.Person.ScheduleName=null,e.entity.Person.Educations=[],e.entity.Person.Expreienses=[],e.entity.Person.AircraftTypes=[],e.entity.Person.Documents=[],e.entity.Person.Ratings=[],e.entity.Person.Certificates=[],e.entity.Locations[0].Id=-1,e.entity.Locations[0].EmployeeId=-1,e.entity.Locations[0].LocationId=null,e.entity.Locations[0].IsMainLocation=1,e.entity.Locations[0].OrgRoleId=null,e.entity.Locations[0].DateActiveStartP=null,e.entity.Locations[0].DateActiveEndP=null,e.entity.Locations[0].DateActiveStart=null,e.entity.Locations[0].DateActiveEnd=null,e.entity.Locations[0].Remark=null,e.entity.Locations[0].Phone=null,e.entity.Locations[0].OrgRole=null,e.entity.Locations[0].Title=null,e.entity.Locations[0].FullCode=null,e.img_url="content/images/imguser.png"},e.clearEntityRating=function(){e.entityRating.Id=null,e.entityRating.PersonId=-1,e.entityRating.AircraftTypeId=null,e.entityRating.RatingId=null,e.entityRating.DateIssue=null,e.entityRating.DateExpire=null,e.entityRating.CategoryId=null,e.entityRating.AircraftType=null,e.entityRating.RatingOrganization=null,e.entityRating.OrganizationId=null,e.entityRating.Category=null},e.clearEntityEducation=function(){e.entityEducation.Id=null,e.entityEducation.PersonId=-1,e.entityEducation.EducationDegreeId=null,e.entityEducation.DateCatch=null,e.entityEducation.College=null,e.entityEducation.Remark=null,e.entityEducation.Title=null,e.entityEducation.StudyFieldId=null,e.entityEducation.FileUrl=null,e.download="",e.entityEducation.FileTitle=null,e.entityEducation.SysUrl=null,e.entityEducation.FileType=null},e.clearEntityFile=function(){e.entityFile.Id=null,e.entityFile.DocumentTypeId=null,e.entityFile.FileTypeId=null,e.entityFile.FileUrl=null,e.entityFile.Title=null,e.entityFile.ParentId=null},e.clearEntityExp=function(){e.entityExp.PersonId=-1,e.entityExp.OrganizationId=null,e.entityExp.Employer=null,e.entityExp.AircraftTypeId=null,e.entityExp.Remark=null,e.entityExp.DateStart=null,e.entityExp.DateEnd=null,e.entityExp.Organization=null,e.entityExp.JobTitle=null,e.entityExp.AircraftType=null,e.entityExp.Id=null},e.clearEntityAircrafttype=function(){e.entityAircrafttype.Id=null,e.entityAircrafttype.AircraftTypeId=null,e.entityAircrafttype.PersonId=-1,e.entityAircrafttype.IsActive=1,e.entityAircrafttype.DateLimitBegin=null,e.entityAircrafttype.DateLimitEnd=null,e.entityAircrafttype.Remark=null,e.entityAircrafttype.AircraftType=null,e.entityAircrafttype.Manufacturer=null},e.clearEntityEducation=function(){e.entityEducation.Id=null,e.entityEducation.PersonId=-1,e.entityEducation.EducationDegreeId=null,e.entityEducation.DateCatch=null,e.entityEducation.College=null,e.entityEducation.Remark=null,e.entityEducation.Title=null,e.entityEducation.StudyFieldId=null,e.entityEducation.StudyField=null,e.entityEducation.EducationDegree=null,e.entityEducation.FileUrl=null,e.download="",e.entityEducation.FileTitle=null,e.entityEducation.SysUrl=null,e.entityEducation.FileType=null},e.bindPerson=function(t){e.entity.Person.PersonId=t.PersonId,e.entity.Person.DateCreate=t.DateCreate,e.entity.Person.MarriageId=t.MarriageId,e.entity.Person.NID=t.NID,e.entity.Person.SexId=t.SexId,e.entity.Person.FirstName=t.FirstName,e.entity.Person.LastName=t.LastName,e.entity.Person.DateBirth=t.DateBirth,e.entity.Person.Email=t.Email,e.entity.Person.EmailPassword=t.EmailPassword,e.entity.Person.Phone1=t.Phone1,e.entity.Person.Phone2=t.Phone2,e.entity.Person.Mobile=t.Mobile,e.entity.Person.FaxTelNumber=t.FaxTelNumber,e.entity.Person.PassportNumber=t.PassportNumber,e.entity.Person.DatePassportIssue=t.DatePassportIssue,e.entity.Person.DatePassportExpire=t.DatePassportExpire,e.entity.Person.Address=t.Address,e.entity.Person.IsActive=t.IsActive,e.entity.Person.DateJoinAvation=t.DateJoinAvation,e.entity.Person.DateLastCheckUP=t.DateLastCheckUP,e.entity.Person.DateNextCheckUP=t.DateNextCheckUP,e.entity.Person.DateYearOfExperience=t.DateYearOfExperience,e.entity.Person.CaoCardNumber=t.CaoCardNumber,e.entity.Person.DateCaoCardIssue=t.DateCaoCardIssue,e.entity.Person.DateCaoCardExpire=t.DateCaoCardExpire,e.entity.Person.CompetencyNo=t.CompetencyNo,e.entity.Person.CaoInterval=t.CaoInterval,e.entity.Person.CaoIntervalCalanderTypeId=t.CaoIntervalCalanderTypeId,e.entity.Person.IsDeleted=t.IsDeleted,e.entity.Person.Remark=t.Remark,e.entity.Person.StampNumber=t.StampNumber,e.entity.Person.StampUrl=t.StampUrl,e.entity.Person.TechLogNo=t.TechLogNo,e.entity.Person.DateIssueNDT=t.DateIssueNDT,e.entity.Person.IntervalNDT=t.IntervalNDT,e.entity.Person.NDTNumber=t.NDTNumber,e.entity.Person.NDTIntervalCalanderTypeId=t.NDTIntervalCalanderTypeId,e.entity.Person.IsAuditor=t.IsAuditor,e.entity.Person.IsAuditee=t.IsAuditee,e.entity.Person.Nickname=t.Nickname,e.entity.Person.CityId=t.CityId,e.entity.Person.FatherName=t.FatherName,e.entity.Person.IDNo=t.IDNo,e.entity.Person.RowId=t.RowId,e.entity.Person.UserId=t.UserId,e.entity.Person.ImageUrl=t.ImageUrl,t.ImageUrl?e.img_url=o.clientsFilesUrl+t.ImageUrl:e.img_url="content/images/imguser.png",e.entity.Person.CustomerCreatorId=t.CustomerCreatorId,e.entity.Person.DateExpireNDT=t.DateExpireNDT,e.entity.Person.ProficiencyExpireDate=t.ProficiencyExpireDate,e.entity.Person.CrewMemberCertificateExpireDate=t.CrewMemberCertificateExpireDate,e.entity.Person.LicenceExpireDate=t.LicenceExpireDate,e.entity.Person.LicenceIRExpireDate=t.LicenceIRExpireDate,e.entity.Person.SimulatorLastCheck=t.SimulatorLastCheck,e.entity.Person.SimulatorNextCheck=t.SimulatorNextCheck,e.entity.Person.RampPassNo=t.RampPassNo,e.entity.Person.RampPassExpireDate=t.RampPassExpireDate,e.entity.Person.LanguageCourseExpireDate=t.LanguageCourseExpireDate,e.entity.Person.LicenceTitle=t.LicenceTitle,e.entity.Person.LicenceInitialIssue=t.LicenceInitialIssue,e.entity.Person.RaitingCertificates=t.RaitingCertificates,e.entity.Person.LicenceIssueDate=t.LicenceIssueDate,e.entity.Person.LicenceDescription=t.LicenceDescription,e.entity.Person.ProficiencyCheckType=t.ProficiencyCheckType,e.entity.Person.ProficiencyCheckDate=t.ProficiencyCheckDate,e.entity.Person.ProficiencyValidUntil=t.ProficiencyValidUntil,e.entity.Person.ICAOLPRLevel=t.ICAOLPRLevel,e.entity.Person.ICAOLPRValidUntil=t.ICAOLPRValidUntil,e.entity.Person.MedicalClass=t.MedicalClass,e.entity.Person.CMCEmployedBy=t.CMCEmployedBy,e.entity.Person.CMCOccupation=t.CMCOccupation,e.entity.Person.PostalCode=t.PostalCode,e.entity.Person.ProficiencyIPC=t.ProficiencyIPC,e.entity.Person.ProficiencyOPC=t.ProficiencyOPC,e.entity.Person.ProficiencyDescription=t.ProficiencyDescription,e.entity.Person.MedicalLimitation=t.MedicalLimitation,e.entity.Person.VisaExpireDate=t.VisaExpireDate,e.entity.Person.SEPTIssueDate=t.SEPTIssueDate,e.entity.Person.SEPTExpireDate=t.SEPTExpireDate,e.entity.Person.SEPTPIssueDate=t.SEPTPIssueDate,e.entity.Person.SEPTPExpireDate=t.SEPTPExpireDate,e.entity.Person.DangerousGoodsIssueDate=t.DangerousGoodsIssueDate,e.entity.Person.DangerousGoodsExpireDate=t.DangerousGoodsExpireDate,e.entity.Person.CCRMIssueDate=t.CCRMIssueDate,e.entity.Person.CCRMExpireDate=t.CCRMExpireDate,e.entity.Person.CRMIssueDate=t.CRMIssueDate,e.entity.Person.CRMExpireDate=t.CRMExpireDate,e.entity.Person.SMSIssueDate=t.SMSIssueDate,e.entity.Person.SMSExpireDate=t.SMSExpireDate,e.entity.Person.FirstAidIssueDate=t.FirstAidIssueDate,e.entity.Person.FirstAidExpireDate=t.FirstAidExpireDate,e.entity.Person.AviationSecurityIssueDate=t.AviationSecurityIssueDate,e.entity.Person.AviationSecurityExpireDate=t.AviationSecurityExpireDate,e.entity.Person.EGPWSIssueDate=t.EGPWSIssueDate,e.entity.Person.EGPWSExpireDate=t.EGPWSExpireDate,e.entity.Person.UpsetRecoveryTrainingIssueDate=t.UpsetRecoveryTrainingIssueDate,e.entity.Person.UpsetRecoveryTrainingExpireDate=t.UpsetRecoveryTrainingExpireDate,e.entity.Person.ColdWeatherOperationIssueDate=t.ColdWeatherOperationIssueDate,e.entity.Person.HotWeatherOperationIssueDate=t.HotWeatherOperationIssueDate,e.entity.Person.ColdWeatherOperationExpireDate=t.ColdWeatherOperationExpireDate,e.entity.Person.HotWeatherOperationExpireDate=t.HotWeatherOperationExpireDate,e.entity.Person.PBNRNAVIssueDate=t.PBNRNAVIssueDate,e.entity.Person.PBNRNAVExpireDate=t.PBNRNAVExpireDate,e.entity.Person.Code=t.Code,e.entity.Person.ScheduleName=t.ScheduleName,e.entity.Person.Educations=t.Educations,e.entity.Person.Expreienses=t.Expreienses,e.entity.Person.AircraftTypes=t.AircraftTypes,e.entity.Person.Documents=t.Documents,e.entity.Person.Ratings=t.Ratings,e.entity.Person.Certificates=t.Certificates},e.bindLocation=function(t){e.entity.Locations[0].Id=t.Id,e.entity.Locations[0].EmployeeId=t.EmployeeId,e.entity.Locations[0].LocationId=t.LocationId,e.entity.Locations[0].IsMainLocation=t.IsMainLocation,e.entity.Locations[0].OrgRoleId=t.OrgRoleId,e.entity.Locations[0].DateActiveStartP=t.DateActiveStartP,e.entity.Locations[0].DateActiveEndP=t.DateActiveEndP,e.entity.Locations[0].DateActiveStart=t.DateActiveStart,e.entity.Locations[0].DateActiveEnd=t.DateActiveEnd,e.entity.Locations[0].Remark=t.Remark,e.entity.Locations[0].Phone=t.Phone,e.entity.Locations[0].OrgRole=t.OrgRole,e.entity.Locations[0].Title=t.Title,e.entity.Locations[0].FullCode=t.FullCode},e.bind=function(t){e.bindPerson(t.Person),e.entity.Id=t.Id,e.entity.PersonId=t.PersonId,e.entity.PID=t.PID,e.entity.Phone=t.Phone,e.entity.DateJoinCompany=t.DateJoinCompany,e.entity.GroupId=t.GroupId,e.entity.Username=t.Username,e.entity.Password=t.Password,e.entity.DateLastLogin=t.DateLastLogin,e.entity.DateJoinCompanyP=t.DateJoinCompanyP,e.entity.IsActive=t.IsActive,e.entity.DateRegisterP=t.DateRegisterP,e.entity.DateConfirmedP=t.DateConfirmedP,e.entity.DateRegister=t.DateRegister,e.entity.DateConfirmed=t.DateConfirmed,e.entity.IsDeleted=t.IsDeleted,e.entity.DateActiveStart=t.DateActiveStart,e.entity.DateActiveEnd=t.DateActiveEnd,e.entity.DateLastLoginP=t.DateLastLoginP,e.entity.BaseAirportId=t.BaseAirportId,e.entity.DateInactiveBegin=t.DateInactiveBegin,e.entity.DateInactiveEnd=t.DateInactiveEnd,t.Locations&&t.Locations.length>0&&e.bindLocation(t.Locations[0])},e.doc_click=function(t){var i=Enumerable.From(e.entity.Person.Documents).Where('$.DocumentType=="'+t+'"').FirstOrDefault();if(i){var n=JSON.parse(JSON.stringify(i));e.bindDocumnetView(n),e.popup_file_view_visible=!0}else General.ShowNotify("No Documents Found","error")},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}};var l=[{text:"Main",id:"main",visible_btn:!1},{text:"Education",id:"education",visible_btn:!1},{text:"Document",id:"file",visible_btn:!1,visible_btn2:!0},{text:"Experience",id:"experience",visible_btn:!1,visible:e.isView},{text:"Rating",id:"rating",visible_btn:!1,visible:e.isView},{text:"Aircraft Type",id:"aircrafttype",visible_btn:!1,visible:e.isView}];e.btn_visible_education=!1,e.btn_visible_certificate=!1,e.btn_visible_file=!1,e.btn_visible_experience=!1,e.btn_visible_rating=!1,e.btn_visible_aircrafttype=!1,e.btn_visible_certificate=!1,e.btn_visible_course=!1,e.btn_location_education="after",e.btn_location_certificate="after",e.btn_location_file="after",e.btn_location_experience="after",e.btn_location_rating="after",e.tabs=l,e.selectedTabIndex=0,e.$watch("selectedTabIndex",function(t){try{e.selectedTab=l[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_education_instance.repaint(),e.dg_file_instance.repaint(),e.dg_exp_instance.repaint(),e.dg_rating_instance.repaint(),e.dg_aircrafttype_instance.repaint(),e.btn_visible_education=1==t,e.btn_visible_file=2==t,e.btn_visible_experience=3==t,e.btn_visible_rating=4==t,e.btn_visible_aircrafttype=5==t,e.btn_visible_course=7==t}catch(e){}}),e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex"}},e.IsMainDisabled=!1,e.IsNIDDisabled=!1,e.nid=null,e.doNID=!0,e.getByNID=function(t){e.IsMainDisabled=!0,e.loadingVisible=!0,i.getEmployee(t,Config.CustomerId).then(function(i){if(e.loadingVisible=!1,e.IsMainDisabled=!1,!i)return e.entity.Person.PersonId=-1,e.entity.PersonId=-1,e.entity.Id=-1,e.entity.CustomerCreatorId=Config.CustomerId,void(e.entity.Person.NID=t);e.bind(i),e.isNew||(e.doNID=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.$watch("nid",function(t){t!=e.entity.Person.NID&&(t&&10==t.length?e.doNID?e.getByNID(t):(e.entity.Person.NID=t,e.IsMainDisabled=!1):e.IsMainDisabled=!0)}),e.txt_nid={valueChangeEvent:"keyup",readOnly:!1,hoverStateEnabled:!1,mask:"999-999999-9",maskInvalidMessage:"Wrong value",bindingOptions:{value:"nid",readOnly:"IsNIDDisabled"}},e.chk_ProficiencyIPC={hoverStateEnabled:!1,text:"LPC",bindingOptions:{value:"entity.Person.ProficiencyIPC",readOnly:"IsMainDisabled"}},e.chk_ProficiencyOPC={hoverStateEnabled:!1,text:"OPC",bindingOptions:{value:"entity.Person.ProficiencyOPC",readOnly:"IsMainDisabled"}},e.txt_LicenceTitle={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.LicenceTitle",readOnly:"IsMainDisabled"}},e.txt_RaitingCertificates={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.RaitingCertificates",readOnly:"IsMainDisabled"}},e.txt_LicenceDescription={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.LicenceDescription",readOnly:"IsMainDisabled"}},e.txt_MedicalLimitation={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.MedicalLimitation",readOnly:"IsMainDisabled"}},e.txt_ProficiencyDescription={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.ProficiencyDescription",readOnly:"IsMainDisabled"}},e.txt_ProficiencyDescriptionOPC={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.ProficiencyDescriptionOPC",readOnly:"IsMainDisabled"}},e.txt_CMCEmployedBy={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.CMCEmployedBy",readOnly:"IsMainDisabled"}},e.txt_CMCOccupation={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.CMCOccupation",readOnly:"IsMainDisabled"}},e.txt_PostalCode={hoverStateEnabled:!1,mask:"9999999999",bindingOptions:{value:"entity.Person.PostalCode",readOnly:"IsMainDisabled"}},e.txt_CaoCardNumber={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.CaoCardNumber",readOnly:"IsMainDisabled"}},e.txt_NDTNumber={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.NDTNumber",readOnly:"IsMainDisabled"}},e.txt_Code={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.Code",readOnly:"IsMainDisabled"}},e.txt_ScheduleName={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.ScheduleName",readOnly:"IsMainDisabled"}},e.txt_FirstName={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.FirstName",readOnly:"IsMainDisabled"}},e.txt_LastName={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.LastName",readOnly:"IsMainDisabled"}},e.txt_FatherName={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.FatherName",readOnly:"IsMainDisabled"}},e.txt_Address={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.Address",readOnly:"IsMainDisabled"}},e.txt_PassportNumber={hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.PassportNumber",readOnly:"IsMainDisabled"}},e.txt_DocumentTitle={hoverStateEnabled:!1,bindingOptions:{value:"entityDocument.Remark"}},e.txt_DocumentTitle2={hoverStateEnabled:!1,bindingOptions:{value:"entityDocument2.Remark"}},e.txt_EducationField={hoverStateEnabled:!1,bindingOptions:{value:"entityEducation.Title"}},e.txt_EducationCollege={hoverStateEnabled:!1,bindingOptions:{value:"entityEducation.College"}},e.txt_EducationRemark={hoverStateEnabled:!1,bindingOptions:{value:"entityEducation.Remark"}},e.txt_AircraftTypeRemark={hoverStateEnabled:!1,bindingOptions:{value:"entityAircrafttype.Remark"}},e.txt_ExpRemark={hoverStateEnabled:!1,height:60,bindingOptions:{value:"entityExp.Remark"}},e.txt_ExpJobTitle={hoverStateEnabled:!1,bindingOptions:{value:"entityExp.JobTitle"}},e.txt_ExpOrganization={hoverStateEnabled:!1,bindingOptions:{value:"entityExp.Organization"}},e.txt_Mobile={hoverStateEnabled:!1,mask:"AB00-0000000",maskRules:{A:/[0]/,B:/[9]/},maskChar:"_",maskInvalidMessage:"Wrong value",bindingOptions:{value:"entity.Person.Mobile",readOnly:"IsMainDisabled"}},e.emailValidationRules={validationRules:[{type:"email",message:"Email is invalid"}]},e.txt_Email={mode:"email",hoverStateEnabled:!1,bindingOptions:{value:"entity.Person.Email",readOnly:"IsMainDisabled"}},e.txt_phone={readOnly:!1,hoverStateEnabled:!1,mask:"A00000009999",maskRules:{A:/[0]/},maskChar:" ",maskInvalidMessage:"Wrong value",rtlEnabled:!1,bindingOptions:{value:"entity.Person.Phone1",readOnly:"IsMainDisabled"}},e.txt_ephone={readOnly:!1,hoverStateEnabled:!1,mask:"A00000009999",maskRules:{A:/[0]/},maskChar:" ",maskInvalidMessage:"Wrong value",rtlEnabled:!1,bindingOptions:{value:"entity.Phone",readOnly:"IsMainDisabled"}},e.txt_IDNo={readOnly:!1,hoverStateEnabled:!1,mask:"9999999999",maskChar:" ",maskInvalidMessage:"Wrong value",rtlEnabled:!1,bindingOptions:{value:"entity.Person.IDNo",readOnly:"IsMainDisabled"}},e.txt_PID={readOnly:!1,hoverStateEnabled:!1,rtlEnabled:!1,bindingOptions:{value:"entity.PID",readOnly:"IsMainDisabled"}},e.LPRDisabled=!1,e.txt_ICAOLPRLevel={min:1,max:6,onValueChanged:function(t){e.LPRDisabled=6==t.value},bindingOptions:{value:"entity.Person.ICAOLPRLevel",readOnly:"IsMainDisabled"}},e.sb_ICAOLPRLevel={showClearButton:!0,searchEnabled:!0,dataSource:[1,2,3,4,5,6],onValueChanged:function(t){e.LPRDisabled=6==t.value},bindingOptions:{value:"entity.Person.ICAOLPRLevel",readOnly:"IsMainDisabled"}},e.txt_MedicalClass={min:1,max:3,bindingOptions:{value:"entity.Person.MedicalClass",readOnly:"IsMainDisabled"}},e.txt_CaoInterval={min:1,bindingOptions:{value:"entity.Person.CaoInterval",readOnly:"IsMainDisabled"}},e.txt_IntervalNDT={min:1,bindingOptions:{value:"entity.Person.IntervalNDT",readOnly:"IsMainDisabled"}},e.date_DateBirth={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateBirth",readOnly:"IsMainDisabled"}},e.date_DateCompany={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateJoinCompany",readOnly:"IsMainDisabled"}},e.date_DateCaoCardIssue={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateCaoCardIssue",readOnly:"IsMainDisabled"}},e.date_DateCaoCardExpire={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateCaoCardExpire",readOnly:"IsMainDisabled"}},e.date_DateIssueNDT={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateIssueNDT",readOnly:"IsMainDisabled"}},e.date_DateExpireNDT={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateExpireNDT",readOnly:"IsMainDisabled"}},e.date_VisaExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.VisaExpireDate",readOnly:"IsMainDisabled"}},e.date_SEPTIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){t.value?e.entity.Person.SEPTExpireDate=new Date(t.value).addYears(3):e.entity.Person.SEPTExpireDate=null},bindingOptions:{value:"entity.Person.SEPTIssueDate",readOnly:"IsMainDisabled"}},e.date_SEPTExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.SEPTExpireDate",readOnly:"IsMainDisabled"}},e.date_SEPTPIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){!e.isNew&&e.entity.Person.SEPTPExpireDate||(t.value?e.entity.Person.SEPTPExpireDate=new Date(t.value).addYears(1):e.entity.Person.SEPTPExpireDate=null)},bindingOptions:{value:"entity.Person.SEPTPIssueDate",readOnly:"IsMainDisabled"}},e.date_SEPTPExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.SEPTPExpireDate",readOnly:"IsMainDisabled"}},e.date_DangerousGoodsIssueDate={width:"100%",type:"date",onValueChanged:function(t){t.value?e.entity.Person.DangerousGoodsExpireDate=new Date(t.value).addYears(2):e.entity.Person.DangerousGoodsExpireDate=null},displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DangerousGoodsIssueDate",readOnly:"IsMainDisabled"}},e.date_DangerousGoodsExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DangerousGoodsExpireDate",readOnly:"IsMainDisabled"}},e.date_CCRMIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){t.value?e.entity.Person.CCRMExpireDate=new Date(t.value).addYears(1):e.entity.Person.CCRMExpireDate=null},bindingOptions:{value:"entity.Person.CCRMIssueDate",readOnly:"IsMainDisabled"}},e.date_CCRMExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.CCRMExpireDate",readOnly:"IsMainDisabled"}},e.date_CRMIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){!e.isNew&&e.entity.Person.CRMExpireDate||(t.value?e.entity.Person.CRMExpireDate=new Date(t.value).addYears(1):e.entity.Person.CRMExpireDate=null)},bindingOptions:{value:"entity.Person.CRMIssueDate",readOnly:"IsMainDisabled"}},e.date_CRMExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.CRMExpireDate",readOnly:"IsMainDisabled"}},e.date_SMSIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){t.value?e.entity.Person.SMSExpireDate=new Date(t.value).addYears(3):e.entity.Person.SMSExpireDate=null},bindingOptions:{value:"entity.Person.SMSIssueDate",readOnly:"IsMainDisabled"}},e.date_SMSExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.SMSExpireDate",readOnly:"IsMainDisabled"}},e.date_FirstAidIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){t.value?e.entity.Person.FirstAidExpireDate=new Date(t.value).addYears(1):e.entity.Person.FirstAidExpireDate=null},bindingOptions:{value:"entity.Person.FirstAidIssueDate",readOnly:"IsMainDisabled"}},e.date_FirstAidExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.FirstAidExpireDate",readOnly:"IsMainDisabled"}},e.date_AviationSecurityIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){t.value?e.entity.Person.AviationSecurityExpireDate=new Date(t.value).addYears(3):e.entity.Person.AviationSecurityExpireDate=null},bindingOptions:{value:"entity.Person.AviationSecurityIssueDate",readOnly:"IsMainDisabled"}},e.date_AviationSecurityExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.AviationSecurityExpireDate",readOnly:"IsMainDisabled"}},e.date_EGPWSIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.EGPWSIssueDate",readOnly:"IsMainDisabled"}},e.date_EGPWSExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.EGPWSExpireDate",readOnly:"IsMainDisabled"}},e.date_UpsetRecoveryTrainingIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){t.value?e.entity.Person.UpsetRecoveryTrainingExpireDate=new Date(t.value).addYears(1):e.entity.Person.UpsetRecoveryTrainingExpireDate=null},bindingOptions:{value:"entity.Person.UpsetRecoveryTrainingIssueDate",readOnly:"IsMainDisabled"}},e.date_UpsetRecoveryTrainingExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.UpsetRecoveryTrainingExpireDate",readOnly:"IsMainDisabled"}},e.date_ColdWeatherOperationIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){t.value?e.entity.Person.ColdWeatherOperationExpireDate=new Date(t.value).addYears(1):e.entity.Person.ColdWeatherOperationExpireDate=null},bindingOptions:{value:"entity.Person.ColdWeatherOperationIssueDate",readOnly:"IsMainDisabled"}},e.date_ColdWeatherOperationExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.ColdWeatherOperationExpireDate",readOnly:"IsMainDisabled"}},e.date_HotWeatherOperationIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){t.value?e.entity.Person.HotWeatherOperationExpireDate=new Date(t.value).addYears(1):e.entity.Person.HotWeatherOperationExpireDate=null},bindingOptions:{value:"entity.Person.HotWeatherOperationIssueDate",readOnly:"IsMainDisabled"}},e.date_HotWeatherOperationExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.HotWeatherOperationExpireDate",readOnly:"IsMainDisabled"}},e.date_PBNRNAVIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.PBNRNAVIssueDate",readOnly:"IsMainDisabled"}},e.date_PBNRNAVExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.PBNRNAVExpireDate",readOnly:"IsMainDisabled"}},e.date_DateInactiveBegin={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateInactiveBegin",readOnly:"IsMainDisabled"}},e.date_DateInactiveEnd={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateInactiveEnd",readOnly:"IsMainDisabled"}},e.sb_Base={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return o.getSbTemplateAirport(e)},onSelectionChanged:function(e){},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.BaseAirportId"}},e.date_LanguageCourseExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.LanguageCourseExpireDate",readOnly:"IsMainDisabled"}},e.date_LicenceInitialIssue={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.LicenceInitialIssue",readOnly:"IsMainDisabled"}},e.date_LicenceIssueDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.LicenceIssueDate",readOnly:"IsMainDisabled"}},e.date_LicenceExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.LicenceExpireDate",readOnly:"IsMainDisabled"}},e.date_LicenceIRExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.LicenceIRExpireDate",readOnly:"IsMainDisabled"}},e.date_ProficiencyCheckDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.ProficiencyCheckDate",readOnly:"IsMainDisabled"}},e.date_ProficiencyValidUntil={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.ProficiencyValidUntil",readOnly:"IsMainDisabled"}},e.date_ProficiencyCheckDateOPC={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.ProficiencyCheckDateOPC",readOnly:"IsMainDisabled"}},e.date_ProficiencyValidUntilOPC={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.ProficiencyValidUntilOPC",readOnly:"IsMainDisabled"}},e.date_ICAOLPRValidUntil={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.ICAOLPRValidUntil",readOnly:"IsMainDisabled",disabled:"LPRDisabled"}},e.date_CrewMemberCertificateExpireDate={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.CrewMemberCertificateExpireDate",readOnly:"IsMainDisabled"}},e.date_DatePassportIssue={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DatePassportIssue",readOnly:"IsMainDisabled"}},e.date_DatePassportExpire={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DatePassportExpire",readOnly:"IsMainDisabled"}},e.date_DateNextCheckUP={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateNextCheckUP",readOnly:"IsMainDisabled"}},e.date_DateLastCheckUP={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){!e.isNew&&e.entity.Person.DateNextCheckUP||(t.value?e.entity.Person.DateNextCheckUP=new Date(t.value).addYears(1):e.entity.Person.DateNextCheckUP=null)},bindingOptions:{value:"entity.Person.DateLastCheckUP",readOnly:"IsMainDisabled"}},e.sb_AircraftTypeId2={itemTemplate:function(e){return o.getSbTemplateAircraft(e)},showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",searchExpr:["Type","Manufacturer"],onSelectionChanged:function(e){},bindingOptions:{value:"entity.Person.AircraftTypeId"}},e.date_TypeExpire={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateTypeExpire",readOnly:"IsMainDisabled"}},e.date_TypeIssue={width:"100%",type:"date",displayFormat:o.DateBoxFormat,onValueChanged:function(t){!e.isNew&&e.entity.Person.DateTypeExpire||(t.value?e.entity.Person.DateTypeExpire=new Date(t.value).addYears(1):e.entity.Person.DateTypeExpire=null)},bindingOptions:{value:"entity.Person.DateTypeIssue",readOnly:"IsMainDisabled"}},e.date_DateJoinAvation={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.Person.DateJoinAvation",readOnly:"IsMainDisabled"}},e.date_EducationDateCatch={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entityEducation.DateCatch"}},e.date_ExpDateStart={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entityExp.DateStart"}},e.date_ExpDateEnd={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entityExp.DateEnd"}},e.date_RatingDateIssue={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entityRating.DateIssue"}},e.date_RatingDateExpire={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entityRating.DateExpire"}},e.btn_delete_file={text:"Delete",type:"danger",icon:"clear",onClick:function(t){var i=o.getSelectedRow(e.dg_upload_instance);i?General.Confirm(Config.Text_DeleteConfirm,function(t){t&&(e.entityDocument.Documents=Enumerable.From(e.entityDocument.Documents).Where("$.Id!="+i.Id).ToArray(),e.dg_upload_instance.refresh())}):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.sb_OrganizationId={dataSource:o.getDatasourceRatingOrgs(),showClearButton:!0,searchEnabled:!0,searchExpr:["Title"],valueExpr:"Id",displayExpr:"Title",bindingOptions:{value:"entityRating.OrganizationId"},onSelectionChanged:function(t){e.entityRating.Organization=t.selectedItem?t.selectedItem.Title:null}},e.sb_group={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceGroups(),itemTemplate:function(e){return o.getSbTemplateGroup(e)},displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.GroupId",readOnly:"IsMainDisabled"}},e.sb_city={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceCityByCountry(103),displayExpr:"FullName",valueExpr:"Id",bindingOptions:{value:"entity.Person.CityId",readOnly:"IsMainDisabled"}},e.sb_Sex={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(29),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.Person.SexId",readOnly:"IsMainDisabled"}},e.sb_calandertype={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(11),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.Person.CaoIntervalCalanderTypeId",readOnly:"IsMainDisabled"}},e.sb_calandertypendt={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(11),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.Person.NDTIntervalCalanderTypeId",readOnly:"IsMainDisabled"}},e.sb_MarriageId={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(15),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.Person.MarriageId",readOnly:"IsMainDisabled"}},e.sb_post={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(36),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.Locations[0].OrgRoleId",readOnly:"IsMainDisabled"}},e.sb_location={dataSource:o.getDatasourceLoctionCustomer(),itemTemplate:function(e){return o.getSbTemplateLocation(e)},showClearButton:!0,searchEnabled:!0,searchExpr:["Title","FullCode"],valueExpr:"Id",displayExpr:"Title",bindingOptions:{value:"entity.Locations[0].LocationId",readOnly:"IsMainDisabled"}},e.sb_CityId={showClearButton:!0,width:"100%",searchEnabled:!0,dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.ODataStore({url:o.serviceUrl+"odata/cities/all",version:4}),sort:["City"]}),searchExpr:["City","Country"],valueExpr:"Id",searchMode:"startsWith",displayExpr:"FullName",bindingOptions:{value:"entity.CityId"}},e.sb_DocumentTypeId={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(44),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entityDocument.DocumentTypeId"},onSelectionChanged:function(t){e.entityDocument.DocumentType=t.selectedItem?t.selectedItem.Title:null}},e.sb_DocumentTypeId2={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(44),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entityDocument2.DocumentTypeId"},onSelectionChanged:function(t){e.entityDocument2.DocumentType=t.selectedItem?t.selectedItem.Title:null}},e.sb_EducationDegreeId={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(18),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entityEducation.EducationDegreeId"},onSelectionChanged:function(t){e.entityEducation.EducationDegree=t.selectedItem?t.selectedItem.Title:null}},e.sb_EducationField={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(59),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entityEducation.StudyFieldId"},onSelectionChanged:function(t){e.entityEducation.StudyField=t.selectedItem?t.selectedItem.Title:null}},e.sb_ExpAircraftTypeId={itemTemplate:function(e){return o.getSbTemplateAircraft(e)},showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",searchExpr:["Type","Manufacturer"],bindingOptions:{value:"entityExp.AircraftTypeId"},onSelectionChanged:function(t){e.entityExp.AircraftType=t.selectedItem?t.selectedItem.Type:null}},e.sb_RatingAircraftTypeId={itemTemplate:function(e){return o.getSbTemplateAircraft(e)},showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",searchExpr:["Type","Manufacturer"],bindingOptions:{value:"entityRating.AircraftTypeId"},onSelectionChanged:function(t){e.entityRating.AircraftType=t.selectedItem?t.selectedItem.Type:null}},e.sb_AircraftTypeId={itemTemplate:function(e){return o.getSbTemplateAircraft(e)},showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",searchExpr:["Type","Manufacturer"],onSelectionChanged:function(t){e.entityAircrafttype.AircraftType=t.selectedItem?t.selectedItem.Type:null,e.entityAircrafttype.Manufacturer=t.selectedItem?t.selectedItem.Manufacturer:null},bindingOptions:{value:"entityAircrafttype.AircraftTypeId"}},e.sb_RatingCategoryId={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(51),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entityRating.CategoryId"},onSelectionChanged:function(t){e.entityRating.Category=t.selectedItem?t.selectedItem.Title:null}},e.img_url="content/images/imguser.png",e.uploaderValueImage=[],e.uploadedFileImage=null,e.uploader_image={multiple:!1,labelText:"",accept:"image/*",uploadMethod:"POST",uploadMode:"instantly",rtlEnabled:!0,uploadUrl:o.fileHandlerUrl+"?t=clientfiles",onValueChanged:function(e){},onUploaded:function(t){e.uploadedFileImage=t.request.responseText,e.entity.Person.ImageUrl=t.request.responseText,e.img_url=o.clientsFilesUrl+e.uploadedFileImage},bindingOptions:{value:"uploaderValueImage"}},e.uploaderValueDocument=[],e.uploadedFileDocument=null,e.uploader_document_instance=null,e.uploader_document={multiple:!1,labelText:"",uploadMethod:"POST",uploadMode:"instantly",uploadUrl:o.fileHandlerUrl+"?t=clientfiles",onValueChanged:function(e){},onUploaded:function(t){var i={Id:-1*(e.entityDocument.Documents.length+1),Title:t.request.responseText,FileUrl:t.request.responseText};i.SysUrl=e.uploaderValueDocument[0].name,i.FileType=e.uploaderValueDocument[0].type,e.entityDocument.Documents.push(i),console.log(e.uploaderValueDocument)},onContentReady:function(t){e.uploader_document_instance||(e.uploader_document_instance=t.component)},bindingOptions:{value:"uploaderValueDocument"}},e.uploaderValueEdu=[],e.uploadedFileEdu=null,e.uploader_edu_instance=null,e.download="",e.uploader_edu={multiple:!1,labelText:"",uploadMethod:"POST",uploadMode:"instantly",uploadUrl:o.fileHandlerUrl+"?t=clientfiles",onValueChanged:function(e){},onUploaded:function(t){e.entityEducation.FileTitle=e.uploaderValueEdu[0].name,e.entityEducation.SysUrl=e.uploaderValueEdu[0].name,e.entityEducation.FileUrl=t.request.responseText,e.download=o.clientsFilesUrl+"/"+e.entityEducation.FileUrl,e.entityEducation.FileType=e.uploaderValueEdu[0].type},onContentReady:function(t){e.uploader_edu_instance||(e.uploader_edu_instance=t.component)},bindingOptions:{value:"uploaderValueEdu"}},e.scroll_height=200,e.scroll_main={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.scroll_education={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.scroll_certificate={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.scroll_file={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.scroll_experience={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.scroll_rating={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}};var d=null;e.dg_height=200,e.pop_width=600,e.pop_height=350,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_instance=null,e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"educationadd",onClick:function(t){e.popup_education_visible=!0}},toolbar:"bottom",bindingOptions:{visible:"btn_visible_education",disabled:"IsMainDisabled"}},{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"default",text:"Edit",width:120,icon:"edit",validationGroup:"educationadd",bindingOptions:{visible:"btn_visible_education",disabled:"IsMainDisabled"},onClick:function(t){(d=o.getSelectedRow(e.dg_education_instance))?(e.bindEducation(d),e.popup_education_visible=!0):General.ShowNotify(Config.Text_NoRowSelected,"error")}}},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"educationadd",bindingOptions:{visible:"btn_visible_education",disabled:"IsMainDisabled"},onClick:function(t){(d=o.getSelectedRow(e.dg_education_instance))?e.entity.Person.Educations=Enumerable.From(e.entity.Person.Educations).Where("$.Id!="+d.Id).ToArray():General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{onClick:function(e){},type:"default",text:"Add",width:120,icon:"plus",validationGroup:"certificateadd",bindingOptions:{visible:"btn_visible_certificate",disabled:"IsMainDisabled"}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Edit",width:120,icon:"edit",validationGroup:"certificateadd",bindingOptions:{visible:"btn_visible_certificate",disabled:"IsMainDisabled"}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"certificateadd",bindingOptions:{visible:"btn_visible_certificate",disabled:"IsMainDisabled"}},toolbar:"bottom"},{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"fileadd",bindingOptions:{visible:"btn_visible_file",disabled:"IsMainDisabled"},onClick:function(t){e.popup_file_visible=!0}}},{widget:"dxButton",location:"before",options:{type:"default",text:"Edit",width:120,icon:"edit",validationGroup:"fileadd",bindingOptions:{visible:"btn_visible_file",disabled:"IsMainDisabled"},onClick:function(t){(d=o.getSelectedRow(e.dg_file_instance))?(e.bindDocumnet(d),e.popup_file_visible=!0):General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"fileadd",bindingOptions:{visible:"btn_visible_file",disabled:"IsMainDisabled"},onClick:function(t){(d=o.getSelectedRow(e.dg_file_instance))?e.entity.Person.Documents=Enumerable.From(e.entity.Person.Documents).Where("$.Id!="+d.Id).ToArray():General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"experienceadd",bindingOptions:{visible:"btn_visible_experience",disabled:"IsMainDisabled"},onClick:function(t){e.popup_exp_visible=!0}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Edit",width:120,icon:"edit",validationGroup:"experienceadd",bindingOptions:{visible:"btn_visible_experience",disabled:"IsMainDisabled"},onClick:function(t){(d=o.getSelectedRow(e.dg_exp_instance))?(e.bindExp(d),e.popup_exp_visible=!0):General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"experienceadd",bindingOptions:{visible:"btn_visible_experience",disabled:"IsMainDisabled"},onClick:function(t){(d=o.getSelectedRow(e.dg_exp_instance))?e.entity.Person.Expreienses=Enumerable.From(e.entity.Person.Expreienses).Where("$.Id!="+d.Id).ToArray():General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"ratingadd",bindingOptions:{visible:"btn_visible_rating",disabled:"IsMainDisabled"},onClick:function(t){e.popup_rating_visible=!0}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Edit",width:120,icon:"edit",validationGroup:"ratingadd",bindingOptions:{visible:"btn_visible_rating",disabled:"IsMainDisabled"},onClick:function(t){(d=o.getSelectedRow(e.dg_rating_instance))?(e.bindRating(d),e.popup_rating_visible=!0):General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"ratingadd",bindingOptions:{visible:"btn_visible_rating",disabled:"IsMainDisabled"},onClick:function(t){(d=o.getSelectedRow(e.dg_rating_instance))?e.entity.Person.Ratings=Enumerable.From(e.entity.Person.Ratings).Where("$.Id!="+d.Id).ToArray():General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"aircraftadd",bindingOptions:{visible:"btn_visible_aircrafttype",disabled:"IsMainDisabled"},onClick:function(t){e.popup_aircrafttype_visible=!0}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Edit",width:120,icon:"edit",validationGroup:"aircraftadd",bindingOptions:{visible:"btn_visible_aircrafttype",disabled:"IsMainDisabled"},onClick:function(t){(d=o.getSelectedRow(e.dg_aircrafttype_instance))?(e.bindEntityAircrafttype(d),e.popup_aircrafttype_visible=!0):General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"aircraftadd",bindingOptions:{visible:"btn_visible_aircrafttype",disabled:"IsMainDisabled"},onClick:function(t){(d=o.getSelectedRow(e.dg_aircrafttype_instance))?e.entity.Person.AircraftTypes=Enumerable.From(e.entity.Person.AircraftTypes).Where("$.Id!="+d.Id).ToArray():General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"personadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!0,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();e.pop_width=i.width,e.pop_width>1400&&(e.pop_width=1400),e.pop_height=$(window).height()-30,e.dg_height=e.pop_height-133,e.scroll_height=e.pop_height-140},onShown:function(t){e.selectedTabIndex=0,e.isNew,null!=e.tempData&&(e.nid=e.tempData.NID)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,o.$broadcast("onPersonHide",null)},onContentReady:function(t){e.popup_instance||(e.popup_instance=t.component)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title","toolbarItems[0].visible":"btn_visible_education","toolbarItems[1].visible":"btn_visible_education","toolbarItems[2].visible":"btn_visible_education","toolbarItems[3].visible":"btn_visible_certificate","toolbarItems[4].visible":"btn_visible_certificate","toolbarItems[5].visible":"btn_visible_certificate","toolbarItems[6].visible":"btn_visible_file","toolbarItems[7].visible":"btn_visible_file","toolbarItems[8].visible":"btn_visible_file","toolbarItems[9].visible":"btn_visible_experience","toolbarItems[10].visible":"btn_visible_experience","toolbarItems[11].visible":"btn_visible_experience","toolbarItems[12].visible":"btn_visible_rating","toolbarItems[13].visible":"btn_visible_rating","toolbarItems[14].visible":"btn_visible_rating","toolbarItems[15].visible":"btn_visible_aircrafttype","toolbarItems[16].visible":"btn_visible_aircrafttype","toolbarItems[17].visible":"btn_visible_aircrafttype","toolbarItems[18].visible":"IsEditable"}},e.popup_add.toolbarItems[19].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[18].options.onClick=function(t){if(t.validationGroup.validate().isValid){e.entity.Person.MarriageId=16;var n=-1*(new Date).getTimezoneOffset();e.entity.DateInactiveBegin&&(e.entity.DateInactiveBegin=new Date(e.entity.DateInactiveBegin).addMinutes(n)),e.entity.DateInactiveEnd&&(e.entity.DateInactiveEnd=new Date(e.entity.DateInactiveEnd).addMinutes(n)),e.loadingVisible=!0,i.save(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onPersonSaved",t),e.loadingVisible=!1,e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")},e.pop_width_file=750,e.pop_height_file=600,e.popup_file_visible=!1,e.popup_file_title="New Document",e.popup_file={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"fileadd",bindingOptions:{},onClick:function(t){if(t.validationGroup.validate().isValid)if(e.entityDocument.Id)JSON.copy(e.entityDocument,d),e.clearEntityDocumnet(),e.popup_file_visible=!1;else{var i=-1*(e.entity.Person.Documents.length+1);e.entityDocument.Id=i,e.entity.Person.Documents.push(JSON.clone(e.entityDocument)),e.clearEntityDocumnet()}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_file_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_file>e.pop_width&&(e.pop_width_file=e.pop_width),e.pop_height_file>e.pop_height&&(e.pop_height_file=e.pop_height)},onShown:function(t){e.dg_upload_instance.repaint()},onHiding:function(){e.clearEntityDocumnet(),e.clearEntityFile(),e.popup_file_visible=!1},bindingOptions:{visible:"popup_file_visible",width:"pop_width_file",height:"pop_height_file",title:"popup_file_title"}},e.popup_file_view_visible=!1,e.popup_file_view_title="Document",e.popup_file_view={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_file_view_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_file>e.pop_width&&(e.pop_width_file=e.pop_width),e.pop_height_file>e.pop_height&&(e.pop_height_file=e.pop_height)},onShown:function(t){e.dg_upload_instance.repaint()},onHiding:function(){e.clearEntityFile(),e.popup_file_view_visible=!1},bindingOptions:{visible:"popup_file_view_visible",width:"pop_width_file",height:"pop_height_file",title:"popup_file_view_title"}},e.pop_width_education=600,e.pop_height_education=600,e.popup_education_visible=!1,e.popup_education_title="New Education",e.popup_education={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"educationadd",bindingOptions:{},onClick:function(t){if(t.validationGroup.validate().isValid)if(Enumerable.From(e.entity.Person.Educations).Where("$.EducationDegreeId=="+e.entityEducation.EducationDegreeId+" && $.StudyFieldId=="+e.entityEducation.StudyFieldId+" && $.Id!="+e.entityEducation.Id).FirstOrDefault())General.ShowNotify(Config.Text_SameItemExist,"error");else if(e.entityEducation.Id)JSON.copy(e.entityEducation,d),e.clearEntityEducation(),e.popup_education_visible=!1;else{var i=-1*(e.entity.Person.Educations.length+1);e.entityEducation.Id=i,e.entity.Person.Educations.push(JSON.clone(e.entityEducation)),e.clearEntityEducation()}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_education_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_education>e.pop_width&&(e.pop_width_education=e.pop_width),e.pop_height_education>e.pop_height&&(e.pop_height_education=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityEducation(),e.popup_education_visible=!1},bindingOptions:{visible:"popup_education_visible",width:"pop_width_education",height:"pop_height_education",title:"popup_education_title"}},e.pop_width_exp=600,e.pop_height_exp=450,e.popup_exp_visible=!1,e.popup_exp_title="New Experience",e.popup_exp={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"experienceadd",bindingOptions:{},onClick:function(t){if(t.validationGroup.validate().isValid)if(Enumerable.From(e.entity.Person.Expreienses).Where("$.Organization=='"+e.entityExp.Organization+"' && $.AircraftTypeId=="+e.entityExp.AircraftTypeId+" && $.JobTitle=='"+e.entityExp.JobTitle+"' && $.Id!="+e.entityExp.Id).FirstOrDefault())General.ShowNotify(Config.Text_SameItemExist,"error");else if(e.entityExp.Id)JSON.copy(e.entityExp,d),e.clearEntityExp(),e.popup_exp_visible=!1;else{var i=-1*(e.entity.Person.Expreienses.length+1);e.entityExp.Id=i,e.entity.Person.Expreienses.push(JSON.clone(e.entityExp)),e.clearEntityExp()}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_exp_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_exp>e.pop_width&&(e.pop_width_exp=e.pop_width),e.pop_height_exp>e.pop_height&&(e.pop_height_exp=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityExp(),e.popup_exp_visible=!1},bindingOptions:{visible:"popup_exp_visible",width:"pop_width_exp",height:"pop_height_exp",title:"popup_exp_title"}},e.pop_width_rating=600,e.pop_height_rating=360,e.popup_rating_visible=!1,e.popup_rating_title="New Rating",e.popup_rating={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"ratingadd",bindingOptions:{},onClick:function(t){if(t.validationGroup.validate().isValid)if(Enumerable.From(e.entity.Person.Ratings).Where("$.OrganizationId=="+e.entityRating.OrganizationId+" && $.AircraftTypeId=="+e.entityRating.AircraftTypeId+" && $.CategoryId=="+e.entityExp.JobTitle+" && $.Id!="+e.entityRating.Id).FirstOrDefault())General.ShowNotify(Config.Text_SameItemExist,"error");else if(e.entityRating.Id)JSON.copy(e.entityRating,d),e.clearEntityRating(),e.popup_rating_visible=!1;else{var i=-1*(e.entity.Person.Ratings.length+1);e.entityRating.Id=i,e.entity.Person.Ratings.push(JSON.clone(e.entityRating)),e.clearEntityRating()}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_rating_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_rating>e.pop_width&&(e.pop_width_rating=e.pop_width),e.pop_height_rating>e.pop_height&&(e.pop_height_rating=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityRating(),e.popup_rating_visible=!1},bindingOptions:{visible:"popup_rating_visible",width:"pop_width_rating",height:"pop_height_rating",title:"popup_rating_title"}},e.pop_width_aircrafttype=600,e.pop_height_aircrafttype=300,e.popup_aircrafttype_visible=!1,e.popup_aircrafttype_title="New Aircraft Type",e.popup_aircrafttype={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"aircrafttypeadd",onClick:function(t){if(t.validationGroup.validate().isValid)if(Enumerable.From(e.entity.Person.AircraftTypes).Where("$.AircraftTypeId=="+e.entityAircrafttype.AircraftTypeId+" && $.Id!="+e.entityAircrafttype.Id).FirstOrDefault())General.ShowNotify(Config.Text_SameItemExist,"error");else if(e.entityAircrafttype.Id)JSON.copy(e.entityAircrafttype,d),e.clearEntityAircrafttype(),e.popup_aircrafttype_visible=!1;else{var i=-1*(e.entity.Person.AircraftTypes.length+1);e.entityAircrafttype.Id=i,e.entity.Person.AircraftTypes.push(JSON.clone(e.entityAircrafttype)),e.clearEntityAircrafttype()}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_aircrafttype_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){e.pop_width_aircrafttype>e.pop_width&&(e.pop_width_aircrafttype=e.pop_width),e.pop_height_aircrafttype>e.pop_height&&(e.pop_height_aircrafttype=e.pop_height)},onShown:function(e){},onHiding:function(){e.clearEntityAircrafttype(),e.popup_aircrafttype_visible=!1},bindingOptions:{visible:"popup_aircrafttype_visible",width:"pop_width_aircrafttype",height:"pop_height_aircrafttype",title:"popup_aircrafttype_title"}},e.dg_education_columns=[{dataField:"EducationDegree",caption:"Degree",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"StudyField",caption:"Field",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"College",caption:"College",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"DateCatch",caption:"Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:150},{dataField:"FileUrl",width:120,alignment:"center",caption:"Attachment",allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="<div></div>";t.value&&(i="<a  href='"+o.clientsFilesUrl+"/"+t.value+"' class='w3-button w3-block w3-blue' style=' margin:0 auto 0px auto;text-decoration:none' target='_blank'>Download</a>"),$("<div>").append(i).appendTo(e)}}],e.dg_education_selected=null,e.dg_education_instance=null,e.dg_education={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_education_columns,onContentReady:function(t){e.dg_education_instance||(e.dg_education_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_education_selected=i||null},bindingOptions:{dataSource:"entity.Person.Educations",height:"dg_height"}},e.dg_file_columns=[{dataField:"DocumentType",caption:"DocumentType",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_file_selected=null,e.dg_file_instance=null,e.dg_file={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_file_columns,onContentReady:function(t){e.dg_file_instance||(e.dg_file_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_file_selected=i||null},bindingOptions:{dataSource:"entity.Person.Documents",height:"dg_height"}},e.dg_upload_columns=[{dataField:"FileUrl",caption:"Uploaded",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"SysUrl",caption:"File",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"FileType",caption:"File Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"FileUrl",width:120,alignment:"center",caption:"Attachment",allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="<div></div>";t.value&&(i="<a  href='"+o.clientsFilesUrl+"/"+t.value+"' class='w3-button w3-block w3-blue' style=' margin:0 auto 0px auto;text-decoration:none' target='_blank'>Download</a>"),$("<div>").append(i).appendTo(e)}}],e.dg_upload_selected=null,e.dg_upload_instance=null,e.dg_upload={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},height:230,noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!1,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_upload_columns,onContentReady:function(t){e.dg_upload_instance||(e.dg_upload_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_upload_selected=i||null},bindingOptions:{dataSource:"entityDocument.Documents"}},e.dg_upload2_columns=[{dataField:"FileUrl",caption:"Uploaded",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"SysUrl",caption:"File",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"FileType",caption:"File Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"FileUrl",width:120,alignment:"center",caption:"Attachment",allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="<div></div>";t.value&&(i="<a  href='"+o.clientsFilesUrl+"/"+t.value+"' class='w3-button w3-block w3-blue' style=' margin:0 auto 0px auto;text-decoration:none' target='_blank'>Download</a>"),$("<div>").append(i).appendTo(e)}}],e.dg_upload2_selected=null,e.dg_upload2_instance=null,e.dg_upload2={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},height:230,noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!1,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_upload2_columns,onContentReady:function(t){e.dg_upload2_instance||(e.dg_upload2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_upload2_selected=i||null},bindingOptions:{dataSource:"entityDocument2.Documents"}},e.dg_exp_columns=[{dataField:"JobTitle",caption:"Job Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"Organization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:400},{dataField:"AircraftType",caption:"AC Type",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"DateStart",caption:"From",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:140},{dataField:"DateEnd",caption:"To",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:140}],e.dg_exp_selected=null,e.dg_exp_instance=null,e.dg_exp={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_exp_columns,onContentReady:function(t){e.dg_exp_instance||(e.dg_exp_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_exp_selected=i||null},bindingOptions:{dataSource:"entity.Person.Expreienses",height:"dg_height"}},e.dg_aircrafttype_columns=[{dataField:"AircraftType",caption:"Aircraft Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_aircrafttype_selected=null,e.dg_aircrafttype_instance=null,e.dg_aircrafttype={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_aircrafttype_columns,onContentReady:function(t){e.dg_aircrafttype_instance||(e.dg_aircrafttype_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_aircrafttype_selected=i||null},bindingOptions:{dataSource:"entity.Person.AircraftTypes",height:"dg_height"}},e.dg_certificate_columns=[{dataField:"ExpireStatus",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="green";switch(t.value){case 1:i="red";break;case 2:i="orange"}$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"CerNumber",caption:"Certificate No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130,fixed:!0,fixedPosition:"left"},{dataField:"ExpireDate",caption:"Expire Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!0,fixedPosition:"left"},{dataField:"DateIssue",caption:"Issue Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!1,fixedPosition:"left"},{dataField:"Remain",caption:"Remain",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:70,fixed:!1,fixedPosition:"left"},{dataField:"CourseNo",caption:"Course No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:100},{dataField:"CourseTitle",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200,fixed:!0,fixedPosition:"left"},{dataField:"CourseOrganization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"CourseDateStart",caption:"DateStart",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,sortIndex:0,sortOrder:"desc"},{dataField:"CourseRecurrent",caption:"Recurrent",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100}],e.dg_certificate_selected=null,e.dg_certificate_instance=null,e.dg_certificate={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_certificate_columns,onContentReady:function(t){e.dg_certificate_instance||(e.dg_certificate_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_certificate_selected=i||null},bindingOptions:{dataSource:"entity.Person.Certificates",height:"dg_height"}},e.dg_course_columns=[{dataField:"StatusId",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="pending-24";switch(t.value){case 67:i="registered-24";break;case 69:i="canceled-24";break;case 68:i="Attended-24";break;case 70:i="failed-24";break;case 71:i="passed-24"}$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"Status",caption:"Status",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left",sortIndex:0,sortOrder:"desc"},{dataField:"No",caption:"No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:100},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300,fixed:!0,fixedPosition:"left"},{dataField:"DateStart",caption:"DateStart",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,sortIndex:0,sortOrder:"desc"},{dataField:"DateEnd",caption:"DateEnd",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"Recurrent",caption:"Recurrent",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100},{dataField:"Organization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Instructor",caption:"Instructor",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"TrainingDirector",caption:"Training Director",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"DateIssue",caption:"Issue Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!0,fixedPosition:"right"},{dataField:"CerNumber",caption:"Certificate No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"right"}],e.dg_course_selected=null,e.dg_course_instance=null,e.dg_course_ds=null,e.dg_course={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-175,columns:e.dg_course_columns,onContentReady:function(t){e.dg_course_instance||(e.dg_course_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_course_selected=i||null},bindingOptions:{dataSource:"dg_course_ds"}},e.dg_rating_columns=[{dataField:"AircraftType",caption:"Aircraft Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"Category",caption:"Category",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Organization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{dataField:"DateIssue",caption:"Issue Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200},{dataField:"DateExpire",caption:"Expire Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200}],e.dg_rating_selected=null,e.dg_rating_instance=null,e.dg_rating={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_rating_columns,onContentReady:function(t){e.dg_rating_instance||(e.dg_rating_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_rating_selected=i||null},bindingOptions:{dataSource:"entity.Person.Ratings",height:"dg_height"}},e.tempData=null,e.$on("InitAddPerson",function(t,i){e.tempData=null,e.doNID=!0,i.Id?(e.popup_add_title="Edit",e.tempData=i,e.isNew=!1):(e.isNew=!0,e.popup_add_title="New"),e.popup_add_visible=!0})}]),app.controller("personcourseController",["$scope","$location","$routeParams","$rootScope","courseService","authService",function(e,t,i,n,a,o){e.prms=i.prms,e.dsUrl=null,e.filterVisible=!1,e.selectedCourse=null,e.courseStatus={SMS:!0,Email:!0,AppNotification:!0,StatusId:null,Status:null,CourseId:null,OldStatus:null,Remark:null,IssueDate:null,No:null,Name:null,People:[]},e.sb_StatusId={showClearButton:!0,searchEnabled:!1,dataSource:n.getDatasourcePersonCourseStatus(),displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){if(t.selectedItem){var i=71==t.selectedItem.Id;e.isCertidicateDisabled=!i}},bindingOptions:{value:"courseStatus.StatusId",text:"courseStatus.Status"}},e.txt_OldStatus={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseStatus.OldStatus"}},e.chb_SMS={text:"Send SMS",bindingOptions:{value:"courseStatus.SMS"}},e.chb_Email={text:"Send Email",bindingOptions:{value:"courseStatus.Email"}},e.chb_AppNotification={text:"Send Notification",bindingOptions:{value:"courseStatus.AppNotification"}},e.txt_StatusRemark={hoverStateEnabled:!1,bindingOptions:{value:"courseStatus.Remark"}},e.txt_CertificateNo={hoverStateEnabled:!1,bindingOptions:{value:"courseStatus.No"}},e.txt_Name={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"courseStatus.Name"}},e.date_DateIssue={width:"100%",type:"date",displayFormat:n.DateBoxFormat,bindingOptions:{value:"courseStatus.IssueDate"}},e.btn_status={text:"Change Status",type:"default",icon:"event",width:200,onClick:function(t){if(e.selectedCourse=n.getSelectedRow(e.dg_course_instance),e.selectedCourse){var i=n.getSelectedRow(e.dg_employees_instance);e.courseStatus.People=[],e.courseStatus.People.push(i.PersonId),e.courseStatus.CourseId=e.selectedCourse.CourseId,e.courseStatus.OldStatus=e.selectedCourse.Status,e.courseStatus.OldStatus||(e.courseStatus.OldStatus="Pending"),e.popup_status_visible=!0}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_passed={text:"Certification",type:"default",icon:"event",width:200,onClick:function(t){if(e.selectedCourse=n.getSelectedRow(e.dg_course_instance),e.selectedCourse){var i=n.getSelectedRow(e.dg_employees_instance);e.courseStatus.People=[],e.courseStatus.People.push(i.PersonId),e.courseStatus.CourseId=e.selectedCourse.CourseId,e.courseStatus.Name=i.Name,e.courseStatus.OldStatus=e.selectedCourse.Status,e.courseStatus.StatusId=71,e.courseStatus.OldStatus||(e.courseStatus.OldStatus="Pending"),e.popup_passed_visible=!0}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".filter").show())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.courseCaption="Courses",e.dg_employees_columns=[{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250,fixed:!0,fixedPosition:"left",sortIndex:1,sortOrder:"asc"},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Mobile",caption:"Mobile",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"Email",caption:"Email",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"DateJoinCompany",caption:"Join Company",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"CaoCardNumber",caption:"CAO No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"NDTNumber",caption:"NDT No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130}],e.dg_employees_height=100,e.dg_employees_selected=null,e.dg_employees_instance=null,e.dg_employees_ds=null,e.dg_employees={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_employees_columns,onContentReady:function(t){e.dg_employees_instance||(e.dg_employees_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_employees_selected=i,e.courseCaption="Courses > "+i.Name,a.getPersonActiveCourse(i.PersonId).then(function(t){e.dg_course_ds=t},function(e){General.ShowNotify(e.message,"error")})):(e.dg_employees_selected=null,e.dg_course_ds=null,e.courseCaption="Courses")},height:$(window).height()-175,bindingOptions:{dataSource:"dg_employees_ds"}},e.dg_course_columns=[{dataField:"StatusId",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i="pending-24";switch(t.value){case 67:i="registered-24";break;case 69:i="canceled-24";break;case 68:i="Attended-24";break;case 70:i="failed-24";break;case 71:i="passed-24"}$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"Status",caption:"Status",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100,fixed:!0,fixedPosition:"left",sortIndex:0,sortOrder:"desc"},{dataField:"No",caption:"No.",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:100},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300,fixed:!0,fixedPosition:"left"},{dataField:"DateStart",caption:"DateStart",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,sortIndex:0,sortOrder:"desc"},{dataField:"DateEnd",caption:"DateEnd",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130},{dataField:"Recurrent",caption:"Recurrent",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100},{dataField:"Organization",caption:"Organization",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"Instructor",caption:"Instructor",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"TrainingDirector",caption:"Training Director",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"DateIssue",caption:"Issue Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!0,fixedPosition:"right"},{dataField:"CerNumber",caption:"Certificate No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"right"}],e.dg_course_selected=null,e.dg_course_instance=null,e.dg_course_ds=null,e.dg_course={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-175,columns:e.dg_course_columns,onContentReady:function(t){e.dg_course_instance||(e.dg_course_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_course_selected=i||null},bindingOptions:{dataSource:"dg_course_ds"}},e.popup_status_visible=!1,e.popup_status={height:340,width:550,fullScreen:!1,showTitle:!0,title:"Change Status",toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"statusChange",onClick:function(t){t.validationGroup.validate().isValid?(e.loadingVisible=!0,a.changeStatus(e.courseStatus).then(function(t){e.selectedCourse.StatusId=72!=e.courseStatus.StatusId?e.courseStatus.StatusId:null,e.selectedCourse.Status=72!=e.courseStatus.Status?e.courseStatus.Status:null,e.selectedCourse.CerNumber=null,e.selectedCourse.DateIssue=null,General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.dg_course_instance.clearSelection(),e.popup_status_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_status_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHidden:function(){e.dg_employees_instance.refresh()},onHiding:function(){e.courseStatus={CourseId:null,SMS:!0,Email:!0,AppNotification:!0,StatusId:null,Status:null,OldStatus:null,Remark:null,IssueDate:null,No:null,People:[]},e.popup_status_visible=!1},bindingOptions:{visible:"popup_status_visible"}},e.popup_passed_visible=!1,e.popup_passed={height:440,width:550,fullScreen:!1,showTitle:!0,title:"Certification",toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"passed",onClick:function(t){t.validationGroup.validate().isValid?(e.loadingVisible=!0,a.changeStatus(e.courseStatus).then(function(t){e.selectedCourse.StatusId=71,e.selectedCourse.Status="Passed",e.selectedCourse.CerNumber=e.courseStatus.No,e.selectedCourse.DateIssue=e.courseStatus.IssueDate,e.dg_course_instance.clearSelection(),General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.popup_passed_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_passed_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.courseStatus={CourseId:null,SMS:!0,Email:!0,AppNotification:!0,StatusId:null,Status:null,OldStatus:null,Remark:null,IssueDate:null,No:null,People:[]},e.popup_passed_visible=!1},bindingOptions:{visible:"popup_passed_visible"}},e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){!e.dg_employees_ds&&e.doRefresh&&(e.dg_employees_ds={store:{type:"odata",url:n.serviceUrl+"odata/employees/light/"+Config.CustomerId,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}}}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_employees_ds.filter=e.filters,e.dg_employees_instance.refresh(),e.doRefresh=!1)},o.isAuthorized()?(n.page_title="> Courses",$(".personcourse").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),n.$broadcast("PersonCourseLoaded",null)}]),app.controller("planController",["$scope","$location","$routeParams","$rootScope","flightService","aircraftService","authService","notificationService","$route",function(e,t,i,n,a,o,l,d,r){e.prms=i.prms,e.IsDetailsVisible=!1,e.IsTabDisabled=!1,e.tabs=[{text:"Legs",id:"legs"},{text:"Information",id:"information"},{text:"Registers",id:"registers"}],e.$watch("selectedTabIndex",function(t){try{e.selectedTab=e.tabs[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_reg_instance.repaint()}catch(e){}}),e.selectedTabIndex=0,e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex",disabled:"IsTabDisabled"}},e.filterVisible=!1,e.IsNew=!0,e.entity={Id:null,Title:null,DateFrom:null,DateTo:null,DateFirst:null,DateLast:null,BaseId:null,iDateFrom:new Date,iDateTo:new Date,CustomerId:Config.CustomerId,IsActive:!1,DateActive:null,Interval:1,TypeId:null,RegisterID:null,FlightTypeID:null,FromAirport:null,ToAirport:null,STA:null,STD:null,FlightH:null,FlightM:null,FlightNumber:null,RouteId:null,FlightPlanId:-1,Months:[],Days:[]},e.refreshEntity=function(){e.entity.Id=-1,e.entity.DateFirst=null,e.entity.DateLast=null,e.entity.CustomerId=Config.CustomerId,e.entity.IsActive=!1,e.entity.DateActive=null,e.entity.Interval=101,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.FlightNumber=null,e.entity.RouteId=null},e.clearEntity=function(){e.entity.Id=null,e.entity.BaseId=null,e.entity.Title=null,e.entity.DateFrom=null,e.entity.DateTo=null,e.entity.DateFirst=null,e.entity.DateLast=null,e.entity.iDateFrom=new Date,e.entity.iDateTo=new Date,e.entity.CustomerId=Config.CustomerId,e.entity.IsActive=!1,e.entity.DateActive=null,e.entity.Interval=101,e.entity.TypeId=null,e.entity.RegisterID=null,e.entity.FlightTypeID=null,e.entity.FromAirport=null,e.entity.ToAirport=null,e.entity.STA=null,e.entity.STD=null,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.FlightNumber=null,e.entity.RouteId=null,e.entity.Months=[],e.entity.Days=[],e.data=[]},e.DotBlockToBlock=!0,e.bindEntity=function(t){e.DotBlockToBlock=!1,e.entity.Id=t.Id,e.entity.BaseId=t.BaseId,e.entity.Title=t.Title,e.entity.DateFrom=t.DateFrom,e.entity.DateTo=t.DateTo,e.entity.DateFirst=t.DateFirst,e.entity.DateLast=t.DateLast,e.entity.iDateFrom=t.DateFrom,e.entity.iDateTo=t.DateTo,e.entity.CustomerId=t.CustomerId,e.entity.IsActive=t.IsActive,e.entity.DateActive=t.DateActive,e.entity.Interval=t.Interval,e.entity.Months=t.Months,e.entity.Days=t.Days,e.entity.FlightPlanId=t.FlightPlanId,e.entity.TypeId=t.TypeId,e.entity.RegisterID=t.RegisterID,e.entity.FlightTypeID=t.FlightTypeID,e.entity.AirlineOperatorsID=t.AirlineOperatorsID,e.entity.FlightNumber=t.FlightNumber,e.entity.FromAirport=t.FromAirport,e.entity.ToAirport=t.ToAirport,e.entity.STA=t.STA,e.entity.STD=t.STD,e.entity.FlightH=t.FlightH,e.entity.FlightM=t.FlightM,e.entity.FlightStatus=t.FlightStatus,e.start=new Date(e.entity.STD),e.tempToAirport=e.entity.ToAirport},e.tempData=null,e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){e.dg_leg_selected=n.getSelectedRow(e.dg_leg_instance),e.dg_leg_selected?General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_leg_selected.Id};e.loadingVisible=!0,a.deletePlanItem(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bindlegs()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.addMode=!1,e.appendMode=!1,e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(t){e.doRefresh=!1,e.entity.Id=-1,e.tempData=null,e.IsNew=!0,e.addMode=!0,e.popup_add_visible=!0}};var s=-1*(new Date).getTimezoneOffset();e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){e.dg_leg_selected=n.getSelectedRow(e.dg_leg_instance),e.dg_leg_selected?(e.loadingVisible=!0,a.getFlightPlanItem(e.dg_leg_selected.Id,s).then(function(t){e.loadingVisible=!1,e.IsNew=!1,e.tempData=t,e.doRefresh=!1,e.popup_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_append={text:"Append",type:"default",icon:"edit",width:120,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?(e.loadingVisible=!0,a.getFlightPlanItem(e.dg_selected.Id,s).then(function(t){e.loadingVisible=!1,e.IsNew=!0,e.tempData=t,e.doRefresh=!1,e.popup_add_visible=!0},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_approve={text:"Approve",type:"default",icon:"check",width:150,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?(e.loadingVisible=!0,a.checkPlanErrors(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,t>0&&General.ShowNotify("The plan has error(s).","error")},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}),General.Confirm(Config.Text_SimpleConfirm,function(t){t&&(e.loadingVisible=!0,a.closePlan(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}))})):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_edit_plan={text:"Make Editable",type:"default",icon:"info",width:200,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?e.dg_selected.IsApproved50?(e.loadingVisible=!0,a.makePlanEditable(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,e.$broadcast("getFilterQuery",null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify("The selected plan is not approved","error"):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_gantt_base={text:"Gantt View (Base)",type:"default",icon:"rowfield",width:210,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){e.dg_selected;n.$broadcast("InitFlightPlanningGanttViewBase",e.dg_selected)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_gantt={text:"Gantt View (All)",type:"default",icon:"rowfield",width:200,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){e.dg_selected;n.$broadcast("InitFlightPlanningGanttView",e.dg_selected)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_grid={text:"Grid View",type:"default",icon:"menu",width:140,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){e.dg_selected;n.$broadcast("InitFlightDesignGrid",e.dg_selected)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.entityInterval={FlightPlanId:null,DateFrom:null,DateTo:null,Interval:null,BaseIATA:null,Register:null,Months:[],Days:[]},e.clearEntityInterval=function(){e.entityInterval.FlightPlanId=null,e.entityInterval.DateFrom=null,e.entityInterval.DateTo=null,e.entityInterval.Interval=null,e.entityInterval.BaseIATA=null,e.entityInterval.Register=null,e.entityInterval.Months=[],e.entityInterval.Days=[]},e.btn_interval={text:"Interval",type:"default",icon:"event",width:150,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?(e.entityInterval.FlightPlanId=e.dg_selected.Id,e.entityInterval.DateFrom=e.dg_selected.DateFrom,e.entityInterval.DateTo=e.dg_selected.DateTo,e.entityInterval.Interval=e.dg_selected.Interval,e.entityInterval.BaseIATA=e.dg_selected.BaseIATA,e.entityInterval.Register=e.dg_selected.VirtualRegister,e.entityInterval.Months=[],e.entityInterval.Days=[],100==e.entityInterval.Interval||(e.popup_interval_visible=!0)):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}};new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("02/27/2017"),new Date("03/03/2017"),new Date("03/18/2017"),new Date("03/22/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/06/2017"),new Date("03/10/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017"),new Date("03/13/2017"),new Date("03/17/2017");e.Day0="05/06/2019",e.Day1="05/07/2019",e.Day2="05/07/2019 23:59:00.000",e.setArrival=function(){if(null!=e.entity.STD&&null!=e.entity.FlightH&&null!=e.entity.FlightM){var t=new Date(e.entity.STD);console.log(e.entity.STD),console.log(e.entity.FlightH),console.log(e.entity.FlightM),e.entity.STA=new Date(t.addHours(e.entity.FlightH).addMinutes(e.entity.FlightM))}else e.entity.STA=null},e.isBaseDisabled=!0,e.sb_Base={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){e.isBaseDisabled||(e.entity.FromAirport=t.selectedItem.Id)},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.BaseId",disabled:"isBaseDisabled"}},e.tempToAirport=null,e.selectedFromAirport=null,e.selectedToAirport=null,e.sb_FromAirport={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceRoutesFromAirport(Config.AirlineId),itemTemplate:function(e){return n.getSbTemplateAirport(e)},onSelectionChanged:function(t){if(e.entity.ToAirport=null,!t.selectedItem)return e.ds_toairport=[],void(e.entity.FromAirportIATA=null);e.entity.FromAirportIATA=t.selectedItem.IATA,e.loadingVisible=!0,a.getRouteDestination(Config.AirlineId,t.selectedItem.Id).then(function(t){e.loadingVisible=!1,e.ds_toairport=t,e.tempToAirport&&(e.entity.ToAirport=e.tempToAirport,e.tempToAirport=null)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},searchExpr:["IATA","Country","SortName","City"],displayExpr:"IATA",valueExpr:"Id",bindingOptions:{value:"entity.FromAirport",selectedItem:"selectedFromAirport"}},e.ds_toairport=[],e.sb_ToAirport={showClearButton:!0,searchEnabled:!0,itemTemplate:function(e){return n.getSbTemplateRouteTo(e)},onSelectionChanged:function(t){t.selectedItem?(e.entity.RouteId=t.selectedItem.Id,e.DotBlockToBlock?(e.entity.FlightH=t.selectedItem.FlightH,e.entity.FlightM=t.selectedItem.FlightM):e.DotBlockToBlock=!0,e.entity.ToAirportIATA=t.selectedItem.ToAirportIATA):(e.entity.RouteId=null,e.entity.FlightH=null,e.entity.FlightM=null,e.entity.ToAirportIATA=null),e.setArrival()},searchExpr:["ToAirportIATA","ToCity"],displayExpr:"ToAirportIATA",valueExpr:"ToAirportId",bindingOptions:{value:"entity.ToAirport",selectedItem:"selectedRoute",dataSource:"ds_toairport"}},e.selectedRoute=null,e.start=null,e.time_start={type:"time",width:"100%",interval:15,onValueChanged:function(t){if(t.value){var i=new Date(t.value),n=i.getHours()+":"+i.getMinutes()+":00",a=new Date(e.entity.iDateFrom).getDatePartSlash()+" "+n,o=new Date(a);e.entity.STD=o}else e.entity.STD=null;e.setArrival()},bindingOptions:{value:"start"}},e.time_end={readOnly:!0,type:"time",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entity.STA"}},e.text_flighth={min:0,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.FlightH"}},e.text_flightm={min:0,max:59,onValueChanged:function(t){e.setArrival()},bindingOptions:{value:"entity.FlightM"}},e.text_flightnumber={bindingOptions:{value:"entity.FlightNumber"}},e.sb_flighttype={showClearButton:!0,searchEnabled:!0,dataSource:n.getDatasourceOption(108),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.FlightTypeID"}},e.selectedType=null,e.sb_type={showClearButton:!0,width:"100%",searchEnabled:!0,itemTemplate:function(e){return n.getSbTemplateAircraft(e)},searchExpr:["Type","Manufacturer"],dataSource:n.getDatasourceAircrafts(),displayExpr:"Type",valueExpr:"Id",onSelectionChanged:function(t){e.ds_msn=[],e.msn_readOnly=!0,t&&t.selectedItem?(e.entity.AircraftType=t.selectedItem.Type,o.getVirtualMSNsByType(Config.CustomerId,t.selectedItem.Id).then(function(t){e.msn_readOnly=!1,e.ds_msn=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):(e.msn_readOnly=!0,e.ds_msn=[],e.entity.AircraftType=null)},bindingOptions:{value:"entity.TypeId",selectedItem:"selectedType"}},e.ds_msn=[],e.msn_readOnly=!0,e.unknown_readOnly=!1,e.selectedMsn=null,e.sb_msn={showClearButton:!0,width:"100%",searchEnabled:!0,searchExpr:["Register","MSN"],displayExpr:"Register",valueExpr:"ID",onSelectionChanged:function(t){if(t.selectedItem){e.entity.Register=t.selectedItem.Register;var i=-1*(new Date).getTimezoneOffset(),n={CustomerId:Config.CustomerId,Date:new Date(e.entity.iDateFrom).ToUTC(),RegisterId:t.selectedItem.ID,Offset:i};e.loadingVisible=!0,a.getPlanLastItem(n).then(function(t){e.loadingVisible=!1,t&&-1!=t.Id?(e.isBaseDisabled=!0,e.entity.BaseId=t.BaseId,e.IsNew&&(e.entity.FromAirport=t.ToAirport,e.entity.ToAirport=null,e.entity.STD=new Date(t.STA),e.start=new Date(e.entity.STD)),a.getPlanItems(n).then(function(t){e.dg2_ds=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):e.isBaseDisabled=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else e.entity.Register=null,e.entity.BaseId=null,e.isBaseDisabled=!0},bindingOptions:{value:"entity.RegisterID",disabled:"msn_readOnly",dataSource:"ds_msn",selectedItem:"selectedMsn"}},e.pop_width_employees=600,e.pop_height_employees=450,e.dg_height_full=100,e.scroll_height_full=501,e.scroll_add={bindingOptions:{height:"scroll_height_full"}},e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={width:1200,height:530,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplan",onClick:function(t){t.validationGroup.validate().isValid?(e.entity.DateFrom=new Date(e.entity.iDateFrom).ToUTC(),e.entity.DateTo=new Date(e.entity.iDateTo).ToUTC(),e.entity.STD=new Date(e.entity.STD).toUTCString(),e.entity.STA=new Date(e.entity.STA).toUTCString(),100!=e.entity.Interval&&(e.entity.Months=[],e.entity.Days=[]),e.loadingVisible=!0,a.savePlanItem(e.entity).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.refreshEntity(),e.IsNew?(e.isBaseDisabled=!0,e.entity.STD=new Date(e.entity.STA).addMinutes(60),e.start=e.entity.STD,e.entity.STA=null,e.entity.FromAirport=e.entity.ToAirport,e.entity.ToAirport=null,t.STD=new Date(t.STD).addMinutes(s),t.STA=new Date(t.STA).addMinutes(s),e.dg2_ds.push(t),e.dg2_instance.refresh()):e.popup_add_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(t){e.tempData&&e.bindEntity(e.tempData)},onHiding:function(){e.clearEntity(),e.dg2_ds=[],e.dg2_instance.refresh(),e.popup_add_visible=!1,e.doRefresh&&e.bind()},bindingOptions:{visible:"popup_add_visible",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_interval_visible=!1,e.popup_interval_title="Interval",e.popup_interval={width:1100,height:620,fullScreen:!1,showTitle:!0,dragEnabled:!1,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",validationGroup:"flightplaninterval",onClick:function(t){if(t.validationGroup.validate().isValid){var i={Id:e.entityInterval.FlightPlanId,DateFrom:new Date(e.entityInterval.DateFrom).ToUTC(),DateTo:new Date(e.entityInterval.DateTo).ToUTC(),Interval:e.entityInterval.Interval,Months:e.entityInterval.Months,Days:e.entityInterval.Days,DateFirst:new Date(e.data[0].startDate).ToUTC()};e.loadingVisible=!0,a.savePlanInterval(i).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),e.loadingVisible=!1,e.doRefresh=!0,e.clearEntityInterval(),e.popup_interval_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_interval_visible=!1,e.doRefresh&&e.bind()},bindingOptions:{visible:"popup_interval_visible",title:"popup_interval_title"}},e.popup_interval.toolbarItems[1].options.onClick=function(t){e.popup_interval_visible=!1},e.isDouble=0;e.monthArray=[],e.dayArray=[],e.addCustom=function(t,i,n,a){if(n&&0!=n.length&&a&&0!=a.length)for(;t<=i;){var o=!1,l=!1;o=!n||0==n.length||-1!=n.indexOf(t.getMonth()),l=!a||0==a.length||-1!=a.indexOf(t.getDay()),o&&l&&e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(1)}},e.addDaily=function(t,i,n){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(n)},e.addMonthly=function(t,i){for(;t<=i;)e.data.push({text:"",startDate:new Date(t),endDate:new Date(t)}),t=t.addDays(30)},e.fillSchedule=function(){if(e.data=[],e.entity.Interval&&e.entity.iDateFrom&&e.entity.iDateTo){var t=new Date(e.entity.iDateFrom);t=new Date(t.setHours(0,0,0,0));var i=new Date(e.entity.iDateTo);switch(i=new Date(i.setHours(23,59,59,999)),console.log(t),console.log(i),e.entity.Interval){case 1:e.addDaily(t,i,1);break;case 2:e.addDaily(t,i,7);break;case 3:e.addDaily(t,i,10);break;case 4:e.addDaily(t,i,14);break;case 5:e.addDaily(t,i,15);break;case 100:e.addCustom(t,i,e.entity.Months,e.entity.Days)}}},e.fillSchedule2=function(){if(e.data=[],e.entityInterval.Interval&&e.entityInterval.DateFrom&&e.entityInterval.DateTo){var t=new Date(e.entityInterval.DateFrom);t=new Date(t.setHours(0,0,0,0));var i=new Date(e.entityInterval.DateTo);switch(i=new Date(i.setHours(23,59,59,999)),e.entityInterval.Interval){case 1:e.addDaily(t,i,1);break;case 2:e.addDaily(t,i,7);break;case 3:e.addDaily(t,i,10);break;case 4:e.addDaily(t,i,14);break;case 5:e.addDaily(t,i,15);break;case 100:e.addCustom(t,i,e.entityInterval.Months,e.entityInterval.Days);break;case 101:e.addDaily(t,i,1)}}},e.data=[],e.scheduler_instance=null,e.schedulerOptions={onContentReady:function(t){e.scheduler_instance||(e.scheduler_instance=t.component)},views:["month"],currentView:"month",startDayHour:0,endDayHour:24,showCurrentTimeIndicator:!1,height:492,appointmentTemplate:function(e){return $("<div style='text-align:center; height:38px;color:green;background:white;margin-top:-5px'><i style='font-size:32px' class='icon ion-md-checkmark'></i></div>")},editing:{allowAdding:!1,allowUpdating:!1,allowDeleting:!0,allowResizing:!1,allowDragging:!1},onAppointmentClick:function(e){e.cancel=!0},onAppointmentDblClick:function(e){e.cancel=!0},onCellClick:function(e){e.cancel=!0},bindingOptions:{dataSource:"data",min:"entityInterval.DateFrom",max:"entityInterval.DateTo",currentDate:"entityInterval.DateFrom"}},e.date_from={type:"date",width:"100%",onValueChanged:function(t){e.entity.iDateTo=t.value},bindingOptions:{value:"entity.iDateFrom"}},e.date_to={type:"date",width:"100%",onValueChanged:function(e){},bindingOptions:{value:"entity.iDateTo"}},e.date_from2={type:"date",width:"100%",onValueChanged:function(t){e.fillSchedule2()},bindingOptions:{value:"entityInterval.DateFrom"}},e.date_to2={type:"date",width:"100%",onValueChanged:function(t){e.fillSchedule2()},bindingOptions:{value:"entityInterval.DateTo"}},e.intervalTypes=[{Id:1,Title:"Daily"},{Id:100,Title:"Custom"}],e.sb_interval={showClearButton:!0,width:"100%",searchEnabled:!1,displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){e.customDisabled=t.selectedItem&&100!=t.selectedItem.Id,e.fillSchedule()},bindingOptions:{value:"entity.Interval",dataSource:"intervalTypes"}},e.sb_interval2={showClearButton:!0,width:"100%",searchEnabled:!1,displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){e.customDisabled=t.selectedItem&&100!=t.selectedItem.Id,e.fillSchedule2()},bindingOptions:{value:"entityInterval.Interval",dataSource:"intervalTypes"}},e.customDisabled=!0,e.tag_months_instance=null,e.tag_months={dataSource:General.MonthDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_months_instance||(e.tag_months_instance=t.component)},onSelectionChanged:function(t){e.fillSchedule2()},bindingOptions:{disabled:"customDisabled",value:"entityInterval.Months"}},e.tag_days_instance=null,e.tag_days={dataSource:General.WeekDayDataSource,searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Title",valueExpr:"Id",onContentReady:function(t){e.tag_days_instance||(e.tag_days_instance=t.component)},onSelectionChanged:function(t){e.fillSchedule2()},bindingOptions:{disabled:"customDisabled",value:"entityInterval.Days"}},e.text_title={bindingOptions:{value:"entity.Title"}},e.text_base={readOnly:!0,bindingOptions:{value:"entityInterval.BaseIATA"}},e.text_type={readOnly:!0,bindingOptions:{value:"dg_selected.AircraftType"}},e.text_msn={readOnly:!0,bindingOptions:{value:"entityInterval.Register"}},e.bindlegs=function(){e.selectedTabIndex=0,e.IsTabDisabled=!0,e.loadingVisible=!0;var t=-1*(new Date).getTimezoneOffset(),i={Id:e.dg_selected.Id,Offset:t};a.getPlanItemsById(i).then(function(t){e.dg_leg_ds=t,e.loadingVisible=!1,e.IsDetailsVisible=!0;var i=setInterval(function(){e.IsTabDisabled=!1,clearInterval(i)},200)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.dg_selected=null,e.dg_columns=[{dataField:"Id",caption:"No",allowResizing:!0,dataType:"number",allowEditing:!1,width:90,alignment:"center",fixed:!0,fixedPosition:"left"},{dataField:"BaseIATA",caption:"Base",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left"},{dataField:"Types",caption:"Types",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:120},{dataField:"VirtualRegister",caption:"Line",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:100},{dataField:"DateFrom",caption:"From",allowResizing:!0,dataType:"date",allowEditing:!1,width:130,alignment:"center",sortIndex:1,sortOrder:"asc",fixed:!1,fixedPosition:"right"},{dataField:"DateTo",caption:"To",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130,fixed:!1,fixedPosition:"right"},{dataField:"IntervalType",caption:"Interval",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,fixed:!1,fixedPosition:"left",width:100}],e.dg_height=100,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_selected=i,e.dg_selected.summary?e.dg_reg_ds=e.dg_selected.summary.AssignedRegisters:e.bindlegs()):(e.dg_selected=null,e.IsDetailsVisible=!1,e.dg_reg_ds=null,e.dg_leg_ds=null)},height:$(window).height()-175,bindingOptions:{dataSource:"dg_ds"}},e.dg2_selected=null,e.dg2_columns=[{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300}],e.dg2_height=400,e.dg2_instance=null,e.dg2_ds=[],e.dg2={grouping:{autoExpandAll:!0,allowCollapsing:!0},searchPanel:{visible:!1},groupPanel:{visible:!1},headerFilter:{visible:!1},filterRow:{visible:!1,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg2_columns,onContentReady:function(t){e.dg2_instance||(e.dg2_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg2_selected=i||null},onCellPrepared:function(e){},bindingOptions:{dataSource:"dg2_ds",height:"dg2_height"}},e.dg_leg_columns=[{dataField:"FlightNumber",caption:"Flight No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"FromAirportIATA",caption:"From",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"ToAirportIATA",caption:"To",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:100},{dataField:"STD",caption:"Departure",allowResizing:!0,dataType:"datetime",allowEditing:!1,width:130,alignment:"center",format:"HH:mm",sortIndex:0,sortOrder:"asc"},{dataField:"STA",caption:"Arrival",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:130,format:"HH:mm"},{dataField:"FlightH",caption:"HH",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightM",caption:"MM",allowResizing:!0,dataType:"number",allowEditing:!1,width:80,alignment:"center"},{dataField:"FlightType",caption:"Flight Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300}],e.dg_leg_selected=null,e.dg_leg_instance=null,e.dg_leg_ds=null,e.dg_leg_height=null,e.dg_leg={grouping:{autoExpandAll:!0,allowCollapsing:!0},headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_leg_columns,onContentReady:function(t){e.dg_leg_instance||(e.dg_leg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_leg_selected=i||null},height:function(){return window.innerHeight-175},bindingOptions:{dataSource:"dg_leg_ds"}},e._bind=function(){var t="odata/flightplans/items/opened/"+Config.CustomerId;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){$.each(e,function(e,t){t.STD=new Date(t.STD).addMinutes(s),t.STA=new Date(t.STA).addMinutes(s)}),n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"DateFrom",desc:!0},"BaseIATA","Register","STD"]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},e.bind=function(){var t="odata/flightplans/approved/customer/"+Config.CustomerId+"/"+-1;!e.dg_ds&&e.doRefresh&&(e.dg_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"Id",desc:!1}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1,e.dg_selected&&e.bindlegs())},e.flightData=null,e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.getFlightsGantt=function(){e.loadingVisible=!0,a.getFlightsGantt(Config.CustomerId).then(function(t){e.loadingVisible=!1,e.flightData=t,$.each(e.flightData.flights,function(e,t){t.startDate=new Date(t.startDate)})},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},l.isAuthorized()?(n.page_title="> Flights Planning",$(".plan").fadeIn(400,function(){})):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onFlightPlanItemsSaved",function(t,i){e.doRefresh=!0}),e.$on("onFlightDesignHide",function(t,i){e.bind()}),e.$on("$viewContentLoaded",function(){}),n.$broadcast("FlightLoaded",null)}]),app.controller("notificationController",["$scope","$location","$routeParams","$rootScope","libraryService","notificationService","authService",function(e,t,i,n,a,o,l){e.prms=i.prms,e.dsUrl=null,e.filterVisible=!1,e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".filter").show())}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.Message="",e.courseCaption="Library Items",e.dg_employees_columns=[{dataField:"DateSent",caption:"Date",allowResizing:!0,alignment:"center",dataType:"datetime",allowEditing:!1,width:200},{dataField:"Type",caption:"Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:250},{caption:"Receiver",columns:[{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Mobile",caption:"Mobile",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150}]},{dataField:"SMS",caption:"SMS",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100},{dataField:"Email",caption:"Email",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100},{dataField:"App",caption:"App",allowResizing:!0,alignment:"center",dataType:"boolean",allowEditing:!1,width:100}],e.dg_employees_height=100,e.dg_employees_selected=null,e.dg_employees_instance=null,e.dg_employees_ds=null,e.dg_employees={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_employees_columns,onContentReady:function(t){e.dg_employees_instance||(e.dg_employees_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?o.getNotification(i.Id).then(function(t){e.Message=t.Message},function(e){General.ShowNotify(e.message,"error")}):e.Message=null},height:$(window).height()-135,bindingOptions:{dataSource:"dg_employees_ds"}},e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){!e.dg_employees_ds&&e.doRefresh&&(e.dg_employees_ds={store:{type:"odata",url:n.serviceUrl+"odata/notifications/module/"+Config.CustomerId+"/"+n.moduleId,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"DateSent",desc:!0}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_employees_ds.filter=e.filters,e.dg_employees_instance.refresh(),e.doRefresh=!1)},l.isAuthorized()?(n.page_title="> Notifications",$(".notification").fadeIn()):l.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),n.$broadcast("NotificationLoaded",null)}]),app.controller("journalAddController",["$scope","$location","generalService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.TypeId=null,e.entity={Id:null,TypeId:null,Title:null,Remark:null,Website:null},e.clearEntity=function(){e.entity.Id=null,e.entity.TypeId=null,e.entity.Title=null,e.entity.Remark=null,e.entity.Website=null},e.bind=function(t){e.entity.Id=t.Id,e.entity.TypeId=t.TypeId,e.entity.Title=t.Title,e.entity.Remark=t.Remark,e.entity.Website=t.Website},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.txt_Title={hoverStateEnabled:!1,bindingOptions:{value:"entity.Title"}},e.txt_Remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.Remark"}},e.websiteValidationRules={validationRules:[{type:"pattern",pattern:/^(http:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,message:"Url is invalid"}]},e.txt_Website={mode:"url",hoverStateEnabled:!1,bindingOptions:{value:"entity.Website"}},e.pop_width=700,e.pop_height=370,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Save",icon:"check",validationGroup:"journaladd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();i.width<=600&&(e.pop_width=i.width,e.pop_height=i.height)},onShown:function(t){null!=e.tempData&&e.bind(e.tempData)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,o.$broadcast("onJournalHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){t.validationGroup.validate().isValid?(e.isNew&&(e.entity.Id=-1,e.entity.TypeId=e.TypeId),e.loadingVisible=!0,i.saveJournal(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onJournalSaved",t),e.loadingVisible=!1,e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_FillRequired,"error")},e.tempData=null,e.$on("InitAddJournal",function(t,i){e.tempData=null,e.TypeId=i._tid,i.Id?(e.popup_add_title="Edit",e.tempData=i,e.isNew=!1):(e.isNew=!0,e.popup_add_title="New"),e.popup_add_visible=!0})}]),app.controller("libraryAddController",["$scope","$location","libraryService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.IsEditable=o.IsLibraryEditable(),e.IsEditableDoc=o.IsDocEditable(),e._IsEditable=e.IsEditable||e.IsEditableDoc,e.IsExposedDisabled=!0,e.entity={Id:-1,Issue:null,Title:null,ISBN:null,DateRelease:null,PublisherId:null,ISSNPrint:null,ISSNElectronic:null,DOI:null,Pages:null,CategoryId:null,ImageUrl:null,Abstract:null,DateCreate:null,DatePublished:null,CustomerId:Config.CustomerId,IsExposed:!1,BookKeywords:[],BookAuthors:[],BookRelatedAircraftTypes:[],BookRelatedGroups:[],BookRelatedStudyFields:[],BookRelatedEmployees:[],BookFiles:[],DateDeadline:null,Duration:null,LanguageId:null,ExternalUrl:null,NumberOfLessens:null,TypeId:83,JournalId:null,Conference:null,ConferenceLocationId:null,DateConference:null,Sender:null,No:null,PublishedIn:null,INSPECAccessionNumber:null,Edition:null,DateEffective:null,FolderId:null,BookKey:null},e.clearEntity=function(){e.entity.Id=-1,e.entity.Title=null,e.entity.Issue=null,e.entity.ISBN=null,e.entity.DateRelease=null,e.entity.DatePublished=null,e.entity.PublisherId=null,e.entity.ISSNPrint=null,e.entity.ISSNElectronic=null,e.entity.DOI=null,e.entity.Pages=null,e.entity.CategoryId=null,e.entity.ImageUrl=null,e.entity.Abstract=null,e.entity.DateCreate=null,e.entity.IsExposed=!1,e.entity.BookKeywords=[],e.entity.BookAuthors=[],e.entity.BookRelatedAircraftTypes=[],e.entity.BookRelatedGroups=[],e.entity.BookRelatedStudyFields=[],e.entity.BookRelatedEmployees=[],e.entity.BookFiles=[],e.uploaderValueDocument=[],e.uploadedFileDocument=null,e.uploader_document_instance.reset(),e.entity.CustomerId=Config.CustomerId,e.img_url="content/images/image.png",e.entity.DateDeadline=null,e.entity.Duration=null,e.entity.LanguageId=null,e.entity.ExternalUrl=null,e.entity.NumberOfLessens=null,e.entity.JournalId=null,e.entity.Conference=null,e.entity.ConferenceLocationId=null,e.entity.DateConference=null,e.entity.Sender=null,e.entity.No=null,e.entity.PublishedIn=null,e.entity.INSPECAccessionNumber=null,e.entity.Edition=null,e.entity.DateEffective=null,e.entity.BookKey=null,e.chapter_ds=[],e.expandedRow=[]},e.bind=function(t){e.entity.Id=t.Id,e.entity.Title=t.Title,e.entity.Issue=t.Issue,e.entity.ISBN=t.ISBN,e.entity.DateRelease=t.DateRelease,e.entity.PublisherId=t.PublisherId,e.entity.ISSNPrint=t.ISSNPrint,e.entity.ISSNElectronic=t.ISSNElectronic,e.entity.DOI=t.DOI,e.entity.Pages=t.Pages,e.entity.CategoryId=t.CategoryId,e.entity.CustomerId=t.CustomerId,e.entity.Abstract=t.Abstract,e.entity.DateCreate=t.DateCreate,e.entity.DatePublished=t.DatePublished,e.entity.ImageUrl=t.ImageUrl,e.entity.BookKeywords=t.BookKeywords,e.entity.BookAuthors=t.BookAuthors,e.entity.BookRelatedAircraftTypes=t.BookRelatedAircraftTypes,e.entity.BookRelatedGroups=t.BookRelatedGroups,e.entity.BookRelatedStudyFields=t.BookRelatedStudyFields,e.entity.BookRelatedEmployees=t.BookRelatedEmployees,e.entity.BookFiles=t.BookFiles,e.entity.IsExposed=t.IsExposed,e.IsExposedDisabled=0==t.IsExposed,t.ImageUrl?e.img_url=o.clientsFilesUrl+t.ImageUrl:e.img_url="content/images/image.png",e.entity.DateDeadline=t.DateDeadline,e.entity.Duration=t.Duration,e.entity.LanguageId=t.LanguageId,e.entity.ExternalUrl=t.ExternalUrl,e.entity.NumberOfLessens=t.NumberOfLessens,e.entity.TypeId=t.TypeId,e.entity.JournalId=t.JournalId,e.entity.Conference=t.Conference,e.entity.ConferenceLocationId=t.ConferenceLocationId,e.entity.DateConference=t.DateConference,e.entity.Sender=t.Sender,e.entity.No=t.No,e.entity.PublishedIn=t.PublishedIn,e.entity.INSPECAccessionNumber=t.INSPECAccessionNumber,e.entity.Edition=t.Edition,e.entity.DateEffective=t.DateEffective,e.entity.FolderId=t.FolderId,e.entity.BookKey=t.BookKey,e.bookKey=t.BookKey,e.chapter_ds=t.Chapters,e.expandedRow=Enumerable.From(t.Chapters).Select("$.Id").ToArray(),e.fillFileDs()};var l=[{text:"Main",id:"main",visible_btn:!1},{text:"Chapters/Files",id:"files",visible_btn:!1,visible:!0},{text:"Aircraft Types",id:"actypes",visible_btn:!0,visible:!0},{text:"Groups",id:"groups",visible_btn:!1,visible_btn2:!0,visible:!0},{text:"Educations",id:"educations",visible_btn:!1,visible:!0},{text:"Employees",id:"employees",visible_btn:!1,visible:!0}];e.btn_visible_aircrafttype=!1,e.btn_visible_coursetype=!1,e.btn_visible_education=!1,e.btn_visible_course=!1,e.btn_visible_group=!1,e.btn_visible_employee=!1,e.btn_visible_file=!1,e.tabs=l,e.selectedTabIndex=0,e.$watch("selectedTabIndex",function(t){try{e.selectedTab=l[t],$(".tab").hide(),$("."+e.selectedTab.id).fadeIn(100,function(){}),e.dg_aircrafttype_instance.repaint(),e.dg_education_instance.repaint(),e.dg_group_instance.repaint(),e.dg_employee_instance.repaint(),e.chapter_instance.refresh();var i=setInterval(function(){$("#dg_education").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_aircrafttype").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_file").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_group").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),$("#dg_employee").find(".dx-datagrid-rowsview").dxScrollable("instance").scrollTo({left:0}),clearInterval(i)},10);e.btn_visible_aircrafttype=2==t,e.btn_visible_file=1==t,e.btn_visible_education=4==t,e.btn_visible_group=3==t,e.btn_visible_employee=5==t}catch(e){}}),e.tabs_options={onItemClick:function(e){},bindingOptions:{dataSource:{dataPath:"tabs",deep:!0},selectedIndex:"selectedTabIndex"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.txt_Title={hoverStateEnabled:!1,bindingOptions:{value:"entity.Title"}},e.txt_Edition={hoverStateEnabled:!1,bindingOptions:{value:"entity.Edition"}},e.txt_DateEffective={hoverStateEnabled:!1,bindingOptions:{value:"entity.DateEffective"}},e.txt_Remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.Remark"}},e.number_Lessons={hoverStateEnabled:!1,min:1,bindingOptions:{value:"entity.NumberOfLessens"}},e.txt_Issue={hoverStateEnabled:!1,min:1,bindingOptions:{value:"entity.Issue"}},e.sb_Category={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceOption(79),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.CategoryId"}},e.sb_Language={showClearButton:!1,searchEnabled:!0,dataSource:o.getDatasourceOption(87),displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.LanguageId"}},e.sb_Type={showClearButton:!1,searchEnabled:!0,dataSource:o.getDatasourceLibraryItemTypes(),displayExpr:"Title",valueExpr:"Id",onSelectionChanged:function(t){83==t.selectedItem.Id&&(e.entity.DateDeadline=null,e.entity.Duration=null,e.entity.LanguageId=null,e.entity.NumberOfLessens=null,e.entity.JournalId=null,e.entity.Conference=null,e.entity.ConferenceLocationId=null,e.entity.DateConference=null,e.entity.Sender=null,e.entity.No=null,e.DOI=null,e.entity.INSPECAccessionNumber=null),84==t.selectedItem.Id&&(e.entity.DateDeadline=null,e.entity.Duration=null,e.entity.LanguageId=null,e.entity.NumberOfLessens=null,e.entity.Sender=null,e.entity.No=null,e.PublisherId=null,e.entity.ISBN=null)},bindingOptions:{value:"entity.TypeId"}};var d=[];e.keywords=d.slice(),e.tag_KeyWords={acceptCustomValue:!0,searchEnabled:!0,hideSelectedItems:!0,bindingOptions:{items:"keywords",value:"entity.BookKeywords"},onCustomItemCreating:function(t){var i=t.text;-1==e.keywords.indexOf(i)&&e.keywords.unshift(i),console.log(e.entity.BookKeywords),t.customItem=i}},e.tag_authors_instance=null,e.tag_Authors={dataSource:o.getDatasourceAuthors(),searchEnabled:!0,hideSelectedItems:!0,displayExpr:"Name",valueExpr:"Id",onContentReady:function(t){e.tag_authors_instance||(e.tag_authors_instance=t.component)},bindingOptions:{value:"entity.BookAuthors"}},e.btn_newAuthor={icon:"plus",width:30,type:"default",onClick:function(t){e.tag_authors_instance&&e.tag_authors_instance.getDataSource().reload()}},e.sb_publisher_instance=null,e.sb_Publisher={dataSource:o.getDatasourcePublishers(),showClearButton:!0,searchEnabled:!0,searchExpr:["Title"],valueExpr:"Id",displayExpr:"Title",onContentReady:function(t){e.sb_publisher_instance||(e.sb_publisher_instance=t.component)},bindingOptions:{value:"entity.PublisherId"}},e.sb_journal_instance=null,e.sb_journal={dataSource:o.getDatasourceJournals(),showClearButton:!0,searchEnabled:!0,searchExpr:["Title"],valueExpr:"Id",displayExpr:"Title",onContentReady:function(t){e.sb_journal_instance||(e.sb_journal_instance=t.component)},bindingOptions:{value:"entity.JournalId"}},e.btn_newPublisher={icon:"plus",width:30,type:"default",onClick:function(t){e.sb_publisher_instance&&e.sb_publisher_instance.getDataSource().reload()}},e.btn_newJournal={icon:"plus",width:30,type:"default",onClick:function(t){e.sb_journal_instance&&e.sb_journal_instance.getDataSource().reload()}},e.date_DatePublication={width:"100%",type:"date",displayFormat:o.DateBoxFormat,bindingOptions:{value:"entity.DateRelease"}},e.txt_Duration={hoverStateEnabled:!1,bindingOptions:{value:"entity.Duration"}},e.txt_Abstract={hoverStateEnabled:!1,height:170,bindingOptions:{value:"entity.Abstract"}},e.txt_ISSNPrint={hoverStateEnabled:!1,bindingOptions:{value:"entity.ISSNPrint"}},e.txt_ISSNElectronic={hoverStateEnabled:!1,bindingOptions:{value:"entity.ISSNElectronic"}},e.txt_ISBN={hoverStateEnabled:!1,bindingOptions:{value:"entity.ISBN"}},e.txt_DOI={hoverStateEnabled:!1,bindingOptions:{value:"entity.DOI"}},e.txt_INSPECAccessionNumber={hoverStateEnabled:!1,bindingOptions:{value:"entity.INSPECAccessionNumber"}},e.txt_Remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.PublishedIn"}},e.txt_Pages={hoverStateEnabled:!1,bindingOptions:{value:"entity.Pages"}},e.txt_DateConference={hoverStateEnabled:!1,bindingOptions:{value:"entity.DateConference"}},e.chb_Exposed={text:"Exposed",bindingOptions:{value:"entity.IsExposed",disabled:"IsExposedDisabled"}},e.img_url="content/images/image.png",e.uploaderValueImage=[],e.uploadedFileImage=null,e.uploader_image={multiple:!1,labelText:"",accept:"image/*",uploadMethod:"POST",uploadMode:"instantly",rtlEnabled:!0,uploadUrl:o.fileHandlerUrl+"?t=clientfiles",onValueChanged:function(e){},onUploaded:function(t){e.uploadedFileImage=t.request.responseText,e.entity.ImageUrl=t.request.responseText,e.img_url=o.clientsFilesUrl+e.uploadedFileImage},bindingOptions:{value:"uploaderValueImage"}},e.scroll_height=200,e.dg_height=200,e.dg_height2=200,e.scroll_main={scrollByContent:!0,scrollByThumb:!0,bindingOptions:{height:"scroll_height"}},e.pop_width=900,e.pop_height=600,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"before",toolbar:"bottom",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"aircrafttypeadd",bindingOptions:{visible:"btn_visible_aircrafttype"},onClick:function(e){o.$broadcast("InitAircraftSelect",null)}}},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"aircrafttypeadd",bindingOptions:{visible:"btn_visible_aircrafttype"},onClick:function(t){var i=o.getSelectedRow(e.dg_aircrafttype_instance);i?e.entity.BookRelatedAircraftTypes=Enumerable.From(e.entity.BookRelatedAircraftTypes).Where("$.Id!="+i.Id).ToArray():General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"groupadd",bindingOptions:{visible:"btn_visible_group"},onClick:function(e){o.$broadcast("InitJobGroupSelect",null)}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"groupadd",bindingOptions:{visible:"btn_visible_group"},onClick:function(t){var i=o.getSelectedRow(e.dg_group_instance);i?e.entity.BookRelatedGroups=Enumerable.From(e.entity.BookRelatedGroups).Where("$.Id!="+i.Id).ToArray():General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"educationadd",onClick:function(e){o.$broadcast("InitStudyFieldSelect",null)}},toolbar:"bottom",bindingOptions:{visible:"btn_visible_education",disabled:"IsMainDisabled"}},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"educationadd",bindingOptions:{visible:"btn_visible_education"},onClick:function(t){var i=o.getSelectedRow(e.dg_education_instance);i?e.entity.BookRelatedStudyFields=Enumerable.From(e.entity.BookRelatedStudyFields).Where("$.Id!="+i.Id).ToArray():General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Add",width:120,icon:"plus",validationGroup:"employeeadd",bindingOptions:{visible:"btn_visible_employee"},onClick:function(e){o.$broadcast("InitEmployeeSelect",null)}},toolbar:"bottom"},{widget:"dxButton",location:"before",options:{type:"default",text:"Delete",width:120,icon:"clear",validationGroup:"employeeadd",bindingOptions:{visible:"btn_visible_employee"},onClick:function(t){var i=o.getSelectedRow(e.dg_employee_instance);i?e.entity.BookRelatedEmployees=Enumerable.From(e.entity.BookRelatedEmployees).Where("$.Id!="+i.Id).ToArray():General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"default",text:"Save",icon:"check",validationGroup:"libraryadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();e.pop_height=$(window).height()-30,i.width<=600&&(e.pop_width=i.width,e.pop_height=i.height),e.dg_height=e.pop_height-133,e.dg_height2=e.dg_height-173,e.scroll_height=e.pop_height-140},onShown:function(t){e.loadingVisible=!0,i.getKeywords().then(function(t){e.keywords=t.slice(),null!=e.tempData?i.getBook(e.tempData.Id).then(function(t){e.loadingVisible=!1,e.bind(t)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")}):e.loadingVisible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,o.$broadcast("onLibraryHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title","toolbarItems[0].visible":"btn_visible_aircrafttype","toolbarItems[1].visible":"btn_visible_aircrafttype","toolbarItems[2].visible":"btn_visible_group","toolbarItems[3].visible":"btn_visible_group","toolbarItems[4].visible":"btn_visible_education","toolbarItems[5].visible":"btn_visible_education","toolbarItems[6].visible":"btn_visible_employee","toolbarItems[7].visible":"btn_visible_employee","toolbarItems[8].visible":"_IsEditable"}},e.popup_add.toolbarItems[9].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[8].options.onClick=function(t){t.validationGroup.validate().isValid?83!=e.entity.TypeId||e.entity.PublisherId?84!=e.entity.TypeId||e.entity.JournalId?(e.isNew&&(e.entity.Id=-1),e.entity.DateRelease=new Date(e.entity.DateRelease).ToUTC(),e.entity.BookKey=e.bookKey,e.loadingVisible=!0,i.save(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onLibrarySaved",t),e.loadingVisible=!1,e.isNew?(e.bookKey=e.generateINT(),o.$broadcast("onFolderAdd",null)):e.popup_add_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify('Please select "Journal / Conference".',"error"):General.ShowNotify('Please select "Publisher".',"error"):General.ShowNotify(Config.Text_FillRequired,"error")},e.uploaderValueDocument=[],e.uploadedFileDocument=null,e.uploader_document_instance=null,e.uploader_document={multiple:!0,labelText:"",uploadMethod:"POST",uploadMode:"instantly",uploadUrl:o.fileHandlerUrl+"?t=clientfiles",onValueChanged:function(e){},onUploaded:function(t){var i={Id:-1*(e.entity.BookFiles.length+1),Title:t.request.responseText,FileUrl:t.request.responseText,Remark:"",DocumentId:-1,BookId:e.entity.Id,ChapterId:e.selectedChapterId};i.SysUrl=t.file.name,i.FileType=t.file.type,e.entity.BookFiles.push(i),e.entity.BookFiles=Enumerable.From(e.entity.BookFiles).OrderBy("$.SysUrl").ToArray(),e.fillFileDs(),console.log(t),console.log(e.uploaderValueDocument),console.log("*******************************")},onContentReady:function(t){e.uploader_document_instance||(e.uploader_document_instance=t.component)},bindingOptions:{value:"uploaderValueDocument"}},e.dg_aircrafttype_columns=[{dataField:"Type",caption:"Type",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200,sortIndex:0,sortOrder:"asc"},{dataField:"Manufacturer",caption:"Manufacturer",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_aircrafttype_selected=null,e.dg_aircrafttype_instance=null,e.dg_aircrafttype={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_aircrafttype_columns,onContentReady:function(t){e.dg_aircrafttype_instance||(e.dg_aircrafttype_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_aircrafttype_selected=i||null},bindingOptions:{dataSource:"entity.BookRelatedAircraftTypes",height:"dg_height"}},e.dg_group_columns=[{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FullCode",caption:"Code",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,encodeHtml:!1,width:200,sortIndex:0,sortOrder:"asc"}],e.dg_group_selected=null,e.dg_group_instance=null,e.dg_group={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_group_columns,onContentReady:function(t){e.dg_group_instance||(e.dg_group_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_group_selected=i||null},bindingOptions:{dataSource:"entity.BookRelatedGroups",height:"dg_height"}},e.dg_education_columns=[{dataField:"Title",caption:"Field",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,sortIndex:0,sortOrder:"asc"},{dataField:"Remark",caption:"Remark",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300}],e.dg_education_selected=null,e.dg_education_instance=null,e.dg_education={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_education_columns,onContentReady:function(t){e.dg_education_instance||(e.dg_education_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_education_selected=i||null},bindingOptions:{dataSource:"entity.BookRelatedStudyFields",height:"dg_height"}},e.dg_employee_columns=[{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,sortIndex:0,sortOrder:"asc",width:250},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Location",caption:"Department",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:150},{dataField:"CaoCardNumber",caption:"CAO No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"NDTNumber",caption:"NDT No.",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"DateJoinCompany",caption:"Join Company",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130}],e.dg_employee_selected=null,e.dg_employee_instance=null,e.dg_employee={showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_employee_columns,onContentReady:function(t){e.dg_employee_instance||(e.dg_employee_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_employee_selected=i||null},bindingOptions:{dataSource:"entity.BookRelatedEmployees",height:"dg_height"}},e.dg_file_columns=[{dataField:"SysUrl",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1}],e.dg_file_selected=null,e.dg_file_instance=null,e.dg_file_ds=null,e.fillFileDs=function(){e.selectedChapterId?e.dg_file_ds=Enumerable.From(e.entity.BookFiles).Where("$.ChapterId=="+e.selectedChapterId).ToArray():e.dg_file_ds=Enumerable.From(e.entity.BookFiles).Where("!$.ChapterId").ToArray()},e.dg_file={editing:{allowUpdating:!0,allowDeleting:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!1,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_file_columns,onContentReady:function(t){e.dg_file_instance||(e.dg_file_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_file_selected=i||null},bindingOptions:{dataSource:"dg_file_ds",height:"dg_height2"}},e.sb_folder={showClearButton:!0,searchEnabled:!0,dataSource:o.getDatasourceFolders(),itemTemplate:function(e){return"<div>"+e.TitleFormated+"</div>"},displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"entity.FolderId"}},e.chapterId=null,e.IsEditChapter=!1,e.btn_new_folder={text:"",type:"default",icon:"plus",onClick:function(t){e.chapterId=null,e.chapter_selected&&(e.chapterId=e.chapter_selected.Id),e.IsEditChapter=!1,e.popup_chapter_visible=!0}},e.btn_edit_folder={text:"",type:"default",icon:"edit",onClick:function(t){e.chapter_selected?(e.chapter=e.chapter_selected.Title,e.chapterId=null,e.chapter_selected.ParentId&&(e.chapterId=e.chapter_selected.ParentId),e.IsEditChapter=!0,e.popup_chapter_visible=!0):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_delete_folder={text:"",type:"danger",icon:"clear",onClick:function(t){if(e.chapter_selected){e.loadingVisible=!0;var n={Id:e.chapter_selected.Id};i.deleteChapter(n).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.chapter_ds=Enumerable.From(e.chapter_ds).Where("$.Id!="+e.chapter_selected.Id).OrderBy("$.FullCode").ToArray(),e.chapter_instance.refresh(),e.chapter_selected=null,e.chapterId=null,e.selectedChapterId=null},function(t){e.loadingVisible=!1,e.popup_folder_visible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.selectedChapterId=null,e.sb_chapters={showClearButton:!0,searchEnabled:!0,onSelectionChanged:function(t){if(t.selectedItem){var i=[];i.push(t.selectedItem.Id),e.chapter_instance.selectRows(i,!1)}else e.chapter_instance.clearSelection();e.fillFileDs()},itemTemplate:function(e){return"<div>"+e.TitleFormated+"</div>"},displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"selectedChapterId",dataSource:"chapter_ds"}},e.sb_chapter_add={showClearButton:!0,searchEnabled:!0,itemTemplate:function(e){return"<div>"+e.TitleFormated+"</div>"},displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"chapterId",dataSource:"chapter_ds"}},e.chapter=null,e.txt_chapter_title={hoverStateEnabled:!1,bindingOptions:{value:"chapter"}},e.chapter_columns=[{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,encodeHtml:!1},{dataField:"Files",caption:"Files",allowResizing:!0,alignment:"center",dataType:"string",width:100,allowEditing:!1}],e.chapter_selected=null,e.chapter_instance=null,e.chapter_ds=[],e.expandedRow=[],e.treeSelectedKeys=[19],e.chaptertree={selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,editing:{mode:"cell",allowAdding:!1,allowUpdating:!0,allowDeleting:!1},dataSource:e.chpater_ds,onContentReady:function(t){e.chapter_instance||(e.chapter_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.chapter_selected=i,e.selectedChapterId=i.Id):(e.chapter_selected=null,e.selectedChapterId=null)},keyExpr:"Id",parentIdExpr:"ParentId",showBorders:!0,columns:e.chapter_columns,headerFilter:{visible:!0},height:$(window).height()-280,wordWrapEnabled:!0,bindingOptions:{dataSource:"chapter_ds",expandedRowKeys:"expandedRow",selectedRowKeys:"treeSelectedKeys"}},e.generateINT=function(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1,n=e.getDate(),a=e.getHours(),o=e.getMinutes(),l=e.getMilliseconds(),d=e.getSeconds();return t.toString()+i.toString()+n.toString()+a.toString()+o.toString()+d.toString()+l.toString()},e.popup_chapter_visible=!1,e.popup_chapter_title="Chapter",e.popup_chapter={fullScreen:!1,showTitle:!0,height:290,width:500,toolbarItems:[{widget:"dxButton",location:"after",options:{validationGroup:"chapteradd",type:"success",text:"Save",icon:"check",onClick:function(t){if(t.validationGroup.validate().isValid){var n={Id:-1,ParentId:e.chapterId,Title:e.chapter,BookKey:e.bookKey};e.IsEditChapter&&(n.Id=e.chapter_selected.Id),console.log(n),e.loadingVisible=!0,i.saveChapter(n).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success");var i=e.chapterId;if(e.IsEditChapter){var n=Enumerable.From(e.chapter_ds).Where("$.Id=="+t.Id).FirstOrDefault();n.TitleFormated=t.TitleFormated,n.Title=t.Title,n.Fullcode=t.Fullcode,n.ParentId=t.ParentId,n.TitleFormatedSpace=t.TitleFormatedSpace,n.Items=t.Items,e.chapter_ds=Enumerable.From(e.chapter_ds).OrderBy("$.Fullcode").ToArray(),e.chapter_instance.refresh(),e.popup_chapter_visible=!1}else e.chapter_ds.push(t),e.chapterId=i,e.chapter=null,e.chapter_ds=Enumerable.From(e.chapter_ds).OrderBy("$.Fullcode").ToArray(),console.log(e.chapter_ds),e.expandedRow.push(t.Id),e.selectedChapterId=t.Id},function(t){e.loadingVisible=!1,e.popup_chapter_visible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_chapter_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_folder_visible=!1},bindingOptions:{visible:"popup_chapter_visible",title:"popup_chapter_title"}},e.tempData=null,e.bookKey=null,e.$on("InitAddLibrary",function(t,i){e.tempData=null,i.Id?(e.popup_add_title="Edit",e.tempData=i,e.isNew=!1):(e.isNew=!0,e.bookKey=e.generateINT(),e.popup_add_title="New",e.entity.FolderId=i.FolderId),e.popup_add_visible=!0}),e.$on("onAircraftSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.BookRelatedAircraftTypes).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.BookRelatedAircraftTypes.push(i)}),e.dg_aircrafttype_instance.refresh())}),e.$on("onJobGroupSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.BookRelatedGroups).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.BookRelatedGroups.push(i)}),e.dg_group_instance.refresh())}),e.$on("onStudyFieldSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.BookRelatedStudyFields).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.BookRelatedStudyFields.push(i)}),e.dg_education_instance.refresh())}),e.$on("onEmployeeSelectHide",function(t,i){i&&0!=i.length&&($.each(i,function(t,i){Enumerable.From(e.entity.BookRelatedEmployees).Where("$.Id=="+i.Id).FirstOrDefault()||e.entity.BookRelatedEmployees.push(i)}),e.dg_employee_instance.refresh())})}]),app.controller("mlistController",["$scope","$location","$routeParams","$rootScope","personService","authService","$route",function(e,t,i,n,a,o,l){e.prms=i.prms,e.caption="Matching List",e.url="odata/matchinglist",e.dsUrl=null,e.filterVisible=!1,e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected?General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.deleteMatchingList(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(e){var t={Id:null};n.$broadcast("InitAddMlist",t)}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_instance),e.dg_selected){var i=e.dg_selected;i._tid=e.TypeId,n.$broadcast("InitAddPersonMisc",i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.filters=[],e.dg_columns=[{caption:"First Crew",columns:[{dataField:"FirstCrew",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"FirstJobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:200}]},{caption:"Second Crew",columns:[{dataField:"SecondCrew",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"SecondJobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:200}]}],e.dg_selected=null,e.dg_instance=null,e.dg_ds=null,e.dg={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-135,columns:e.dg_columns,onContentReady:function(t){e.dg_instance||(e.dg_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_selected=i||null},bindingOptions:{dataSource:"dg_ds"}},e.doRefresh=!1,e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){e.dg_ds||(e.dg_ds={store:{type:"odata",url:n.serviceUrl+e.url,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:["Name"]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_ds.filter=e.filters,e.dg_instance.refresh(),e.doRefresh=!1)},o.isAuthorized()?(n.page_title="> "+e.caption,$(".mlist").fadeIn()):o.redirectToLogin(),e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onMlistSaved",function(t,i){e.doRefresh=!0}),e.$on("onMlistAddHide",function(t,i){e.bind()}),n.$broadcast("PersonMiscLoaded",null)}]),app.controller("jobgroupAddController",["$scope","$location","jobgroupService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.entity={Id:null,Title:null,Code:"",FullCode:"",CustomerId:null,Remark:null,ParentId:null},e.clearEntity=function(){e.entity.Id=null,e.entity.Title=null,e.entity.Code="",e.entity.FullCode=e.parentCode?e.ParentCode:"",e.entity.CustomerId=null,e.entity.Remark=null,e.entity.ParentId=null},e.bind=function(t){e.entity.Id=t.Id,e.entity.Title=t.Title,e.entity.Code=t.Code,e.entity.FullCode=t.FullCode,e.entity.CustomerId=t.CustomerId,e.entity.Remark=t.Remark,e.entity.ParentId=t.ParentId},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.txt_parent={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"parent"}},e.txt_parentCode={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"parentCode"}},e.txt_Title={hoverStateEnabled:!1,bindingOptions:{value:"entity.Title"}},e.txt_Remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.Remark"}},e.codeMask="00",e.txt_Code={maskChar:"-",maskInvalidMessage:"Wrong Code",valueChangeEvent:"keyup",onValueChanged:function(t){t.value?e.entity.FullCode=(e.parentCode?e.parentCode:"")+t.value:e.entity.FullCode=e.parentCode?e.parentCode:""},bindingOptions:{value:"entity.Code",mask:"codeMask"}},e.txt_FullCode={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"entity.FullCode"}},e.sb_CityId={showClearButton:!0,width:"100%",searchEnabled:!0,dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.ODataStore({url:o.serviceUrl+"odata/cities/all",version:4}),sort:["City"]}),searchExpr:["City","Country"],valueExpr:"Id",searchMode:"startsWith",displayExpr:"FullName",bindingOptions:{value:"entity.CityId"}},e.txt_IATA={hoverStateEnabled:!1,bindingOptions:{value:"entity.IATA"}},e.txt_ICAO={hoverStateEnabled:!1,bindingOptions:{value:"entity.ICAO"}},e.pop_width=600,e.pop_height=430,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Save",icon:"check",validationGroup:"jobgroupadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();i.width<=600&&(e.pop_width=i.width,e.pop_height=i.height)},onShown:function(t){e.isNew,null!=e.tempData&&e.bind(e.tempData)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,o.$broadcast("onJobGroupHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){t.validationGroup.validate().isValid?(e.isNew&&(e.entity.Id=-1),e.entity.ParentId=e.parentId,e.entity.CustomerId=Config.CustomerId,e.loadingVisible=!0,i.save(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onJobGroupSaved",t),e.loadingVisible=!1,e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_FillRequired,"error")},e.tempData=null,e.parentData=null,e.parent=null,e.parentCode=null,e.ParentCustomerId=null,e.parentId=null,e.rootId=null,e.root=null,e.rootCode=null,e.groups=null,e.sb_parent={itemTemplate:function(e){return o.getSbTemplateLocation(e)},showClearButton:!0,searchEnabled:!0,searchExpr:["Title","FullCode"],valueExpr:"Id",displayExpr:"Title",onSelectionChanged:function(t){e.parentCode=t.selectedItem?t.selectedItem.FullCode:null,e.entity.FullCode=e.parentCode+e.entity.Code,t.selectedItem?e.codeMask="00":e.codeMask="000"},bindingOptions:{value:"parentId",dataSource:"groups"}},e.$on("InitAddJobGroup",function(t,i){e.tempData=null,i.Id?(e.popup_add_title="Edit",e.tempData=i.data,e.isNew=!1,e.parent=i.data.Parent,e.parentCode=i.data.ParentCode?i.data.ParentCode:"",e.parentId=i.data.ParentId,e.groups=Enumerable.From(i.groups).OrderBy("$.FullCode").ToArray()):(e.isNew=!0,e.popup_add_title="New",e.parentData=i.parent,e.parent=i.parent?i.parent.Title:null,e.parentCode=i.parent?i.parent.FullCode:"",e.parentId=i.parent?i.parent.Id:null,e.groups=Enumerable.From(i.groups).OrderBy("$.FullCode").ToArray()),null==e.parentId?e.codeMask="000":e.codeMask="00",e.popup_add_visible=!0})}]),app.controller("organizationAddController",["$scope","$location","organizationService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.TypeId=null,e.entity={Id:null,Title:null,Website:null,Email:null,Tel:null,Fax:null,ContactPerson:null,Address:null,Remark:null,LogoUrl:null,TypeId:null,CountryId:null},e.clearEntity=function(){e.entity.Id=null,e.entity.Title=null,e.entity.Website=null,e.entity.Email=null,e.entity.Tel=null,e.entity.Fax=null,e.entity.ContactPerson=null,e.entity.Address=null,e.entity.Remark=null,e.entity.LogoUrl=null,e.entity.TypeId=null,e.entity.CountryId=null,e.img_url="content/images/image.png"},e.bind=function(t){e.entity.Id=t.Id,e.entity.Title=t.Title,e.entity.Website=t.Website,e.entity.Email=t.Email,e.entity.Tel=t.Tel,e.entity.Fax=t.Fax,e.entity.ContactPerson=t.ContactPerson,e.entity.Address=t.Address,e.entity.Remark=t.Remark,e.entity.LogoUrl=t.LogoUrl,e.entity.TypeId=t.TypeId,e.entity.CountryId=t.CountryId,t.LogoUrl?e.img_url=o.clientsFilesUrl+t.LogoUrl:e.img_url="content/images/image.png"},e.img_url="content/images/image.png",e.uploaderValueImage=[],e.uploadedFileImage=null,e.uploader_image={multiple:!1,labelText:"",accept:"image/*",uploadMethod:"POST",uploadMode:"instantly",rtlEnabled:!0,uploadUrl:o.fileHandlerUrl+"?t=clientfiles",onValueChanged:function(e){},onUploaded:function(t){e.uploadedFileImage=t.request.responseText,e.entity.LogoUrl=t.request.responseText,e.img_url=o.clientsFilesUrl+e.uploadedFileImage},bindingOptions:{value:"uploaderValueImage"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.txt_Title={hoverStateEnabled:!1,bindingOptions:{value:"entity.Title"}},e.txt_Remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.Remark"}},e.txt_Address={hoverStateEnabled:!1,bindingOptions:{value:"entity.Address"}},e.txt_Address={hoverStateEnabled:!1,bindingOptions:{value:"entity.Address"}},e.txt_ContactPerson={hoverStateEnabled:!1,bindingOptions:{value:"entity.ContactPerson"}},e.txt_Tel={hoverStateEnabled:!1,bindingOptions:{value:"entity.Tel"}},e.txt_Fax={hoverStateEnabled:!1,bindingOptions:{value:"entity.Fax"}},e.sb_Country={showClearButton:!0,width:"100%",searchEnabled:!0,dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.ODataStore({url:o.serviceUrl+"odata/countries",version:4}),sort:["Name"]}),searchExpr:["Name","SortName"],valueExpr:"Id",searchMode:"startsWith",displayExpr:"Name",bindingOptions:{value:"entity.CountryId"}},e.emailValidationRules={validationRules:[{type:"email",message:"Email is invalid"}]},e.txt_Email={mode:"email",hoverStateEnabled:!1,bindingOptions:{value:"entity.Email"}},e.websiteValidationRules={validationRules:[{type:"pattern",pattern:/^(http:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,message:"Url is invalid"}]},e.txt_Website={mode:"url",hoverStateEnabled:!1,bindingOptions:{value:"entity.Website"}},e.pop_width=700,e.pop_height=585,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Save",icon:"check",validationGroup:"organizationadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();i.width<=600&&(e.pop_width=i.width,e.pop_height=i.height)},onShown:function(t){e.isNew,null!=e.tempData&&e.bind(e.tempData)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,o.$broadcast("onOrganizationHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){t.validationGroup.validate().isValid?(e.isNew&&(e.entity.Id=-1,e.entity.TypeId=e.TypeId),e.loadingVisible=!0,i.save(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onOrganizationSaved",t),e.loadingVisible=!1,e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_FillRequired,"error")},e.tempData=null,e.$on("InitAddOrganization",function(t,i){e.tempData=null,e.TypeId=i._tid,i.Id?(e.popup_add_title="Edit",e.tempData=i,e.isNew=!1):(e.isNew=!0,e.popup_add_title="New"),e.popup_add_visible=!0})}]),app.controller("mlistAddController",["$scope","$location","personService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.dg_first_columns=[{caption:"First Crew",columns:[{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"GroupOrder",caption:"O",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120,visible:!1}]}],e.dg_first_selected=null,e.dg_first_instance=null,e.dg_first_ds=null,e.dg_first={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-180,columns:e.dg_first_columns,onContentReady:function(t){e.dg_first_instance||(e.dg_first_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_first_selected=i||null},bindingOptions:{dataSource:"dg_first_ds"}},e.dg_second_columns=[{caption:"Second Crew",columns:[{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"JobGroup",caption:"Group",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"GroupOrder",caption:"O",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:120,visible:!1}]}],e.dg_second_selected=null,e.dg_second_instance=null,e.dg_second_ds=null,e.dg_second={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,height:$(window).height()-180,columns:e.dg_second_columns,onContentReady:function(t){e.dg_second_instance||(e.dg_second_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_second_selected=i||null},bindingOptions:{dataSource:"dg_second_ds"}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.pop_width=900,e.pop_height=650,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Save",icon:"check",validationGroup:"personmiscadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();i.width<=600&&(e.pop_width=i.width,e.pop_height=i.height)},onShown:function(t){e.bind_first(),e.bind_second()},onHiding:function(){e.popup_add_visible=!1,o.$broadcast("onMlistAddHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){if(e.dg_first_selected)if(e.dg_second_selected)if(e.dg_second_selected.Id!=e.dg_first_selected.Id){var n={First:e.dg_first_selected.Id,Second:e.dg_second_selected.Id};e.loadingVisible=!0,i.saveMatchingList(n).then(function(t){General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onMlistSaved",t),e.loadingVisible=!1,e.popup_add_visible=!1},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify("First Crew and Second Crew are equal.","error");else General.ShowNotify("Please select Second Crew","error");else General.ShowNotify("Please select First Crew","error")},e.tempData=null,e.$on("InitAddMlist",function(t,i){e.popup_add_title="New",e.popup_add_visible=!0}),e.bind_first=function(){var t="odata/crew/ordered/group/"+Config.CustomerId;e.dg_first_ds||(e.dg_first_ds={store:{type:"odata",url:o.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){o.$broadcast("OnDataLoaded",null)},beforeSend:function(e){}},sort:[{getter:"GroupOrder",desc:!1},{getter:"JobGroup",desc:!1},{getter:"Name",desc:!1}]})},e.bind_second=function(){var t="odata/crew/ordered/group/"+Config.CustomerId;e.dg_second_ds||(e.dg_second_ds={store:{type:"odata",url:o.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){o.$broadcast("OnDataLoaded",null)},beforeSend:function(e){}},sort:[{getter:"GroupOrder",desc:!1},{getter:"JobGroup",desc:!1},{getter:"Name",desc:!1}]})}}]),app.controller("locationAddController",["$scope","$location","locationService","authService","$routeParams","$rootScope",function(e,t,i,n,a,o){e.isNew=!0,e.entity={Id:null,Title:null,Code:null,FullCode:null,CustomerId:null,Remark:null,TypeId:10,IsVirtual:!1,IsDeleted:!1,IsActive:!0,ParentId:null,CityId:null,Address:null,PostalCode:null,Website:null,RootLocation:null},e.clearEntity=function(){e.entity.Id=null,e.entity.Title=null,e.entity.Code=null,e.entity.FullCode=e.parentCode,e.entity.CustomerId=null,e.entity.Remark=null,e.entity.TypeId=10,e.entity.IsVirtual=!1,e.entity.IsDeleted=!1,e.entity.IsActive=!0,e.entity.ParentId=null,e.entity.CityId=null,e.entity.Address=null,e.entity.PostalCode=null,e.entity.Website=null,e.entity.RootLocation=null},e.bind=function(t){e.entity.Id=t.Id,e.entity.Title=t.Title,e.entity.Code=t.Code,e.entity.FullCode=t.FullCode,e.entity.CustomerId=t.CustomerId,e.entity.Remark=t.Remark,e.entity.TypeId=t.TypeId,e.entity.IsVirtual=t.IsVirtual,e.entity.IsDeleted=t.IsDeleted,e.entity.IsActive=t.IsActive,e.entity.ParentId=t.ParentId,e.entity.CityId=t.CityId,e.entity.Address=t.Address,e.entity.PostalCode=t.PostalCode,e.entity.Website=t.Website,e.entity.RootLocation=t.RootLocation},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.txt_parent={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"parent"}},e.txt_parentCode={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"parentCode"}},e.txt_Title={hoverStateEnabled:!1,bindingOptions:{value:"entity.Title"}},e.txt_Remark={hoverStateEnabled:!1,bindingOptions:{value:"entity.Remark"}},e.txt_Code={mask:"00",maskChar:"-",maskInvalidMessage:"Wrong Code",valueChangeEvent:"keyup",onValueChanged:function(t){t.value?e.entity.FullCode=e.parentCode+t.value:e.entity.FullCode=e.parentCode},bindingOptions:{value:"entity.Code"}},e.txt_FullCode={hoverStateEnabled:!1,readOnly:!0,bindingOptions:{value:"entity.FullCode"}},e.sb_CityId={showClearButton:!0,width:"100%",searchEnabled:!0,dataSource:new DevExpress.data.DataSource({store:new DevExpress.data.ODataStore({url:o.serviceUrl+"odata/cities/all",version:4}),sort:["City"]}),searchExpr:["City","Country"],valueExpr:"Id",searchMode:"startsWith",displayExpr:"FullName",bindingOptions:{value:"entity.CityId"}},e.txt_IATA={hoverStateEnabled:!1,bindingOptions:{value:"entity.IATA"}},e.txt_ICAO={hoverStateEnabled:!1,bindingOptions:{value:"entity.ICAO"}},e.pop_width=600,e.pop_height=430,e.popup_add_visible=!1,e.popup_add_title="New",e.popup_add={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"default",text:"Save",icon:"check",validationGroup:"locationadd",bindingOptions:{}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove"},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=o.getWindowSize();i.width<=600&&(e.pop_width=i.width,e.pop_height=i.height)},onShown:function(t){e.isNew,null!=e.tempData&&e.bind(e.tempData)},onHiding:function(){e.clearEntity(),e.popup_add_visible=!1,o.$broadcast("onLocationHide",null)},bindingOptions:{visible:"popup_add_visible",width:"pop_width",height:"pop_height",title:"popup_add_title"}},e.popup_add.toolbarItems[1].options.onClick=function(t){e.popup_add_visible=!1},e.popup_add.toolbarItems[0].options.onClick=function(t){t.validationGroup.validate().isValid?(e.isNew&&(e.entity.Id=-1),e.entity.ParentId=e.parentId,e.entity.RootLocation=e.rootId,e.entity.CustomerId=e.ParentCustomerId,e.loadingVisible=!0,i.save(e.entity).then(function(t){e.clearEntity(),General.ShowNotify(Config.Text_SavedOk,"success"),o.$broadcast("onLocationSaved",t),e.loadingVisible=!1,e.isNew||(e.popup_add_visible=!1)},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):General.ShowNotify(Config.Text_FillRequired,"error")},e.tempData=null,e.parentData=null,e.parent=null,e.parentCode=null,e.ParentCustomerId=null,e.parentId=null,e.rootId=null,e.root=null,e.rootCode=null,e.$on("InitAddLocation",function(t,i){e.tempData=null,i.Id?(e.popup_add_title="Edit",e.tempData=i,e.isNew=!1,e.parent=i.Parent,e.parentCode=i.ParentCode,e.parentId=i.ParentId,e.rootId=i.RootLocation,e.root=i.Root,e.rootCode=i.RootCode,e.ParentCustomerId=i.CustomerId):(e.isNew=!0,e.popup_add_title="New",e.parentData=i.parent,e.parent=i.parent.Title,e.parentCode=i.parent.FullCode,e.parentId=i.parent.Id,e.rootId=i.parent.RootLocation,e.root=i.parent.Root,e.rootCode=i.parent.RootCode,e.ParentCustomerId=i.parent.CustomerId,e.entity.FullCode=e.parentCode),e.popup_add_visible=!0})}]),app.controller("libraryController",["$scope","$location","$routeParams","$rootScope","libraryService","authService","notificationService","$route",function(e,t,i,n,a,o,l,d){if(e.prms=i.prms,e.IsEditable=n.IsLibraryEditable(),e.IsEditableDoc=n.IsDocEditable(),e.dsUrl=null,e.filterVisible=!1,e.dg_selected=null,e.IsDocument=d.current.isDocument,e.IsDocument&&(e._type=86),e.IsNotDocument=!d.current.isDocument,e._type=i.type,e._publisher=i.publisher,e._author=i.author,e._filterConsts={key:"library",values:[{id:"TypeId",value:e._type?Number(e._type):-1}]},e.$on("FilterLoaded",function(t,i){e.$broadcast("initFilters",e._filterConsts)}),e.btn_search={text:"Search",type:"success",icon:"search",width:120,bindingOptions:{},onClick:function(t){e.$broadcast("getFilterQuery",null)}},e.btn_filter={text:"",type:"default",icon:"filter",width:40,onClick:function(t){e.filterVisible?(e.filterVisible=!1,$(".col-grid").removeClass("col-lg-7").addClass("col-lg-10"),$(".book-side").removeClass("col-lg-12").addClass("col-lg-8"),$(".filter").hide()):(e.filterVisible=!0,$(".col-grid").removeClass("col-lg-10").addClass("col-lg-7"),$(".book-side").removeClass("col-lg-8").addClass("col-lg-12"),$(".filter").show())}},e.btn_delete={text:"Delete",type:"danger",icon:"clear",width:120,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_book_instance),e.dg_selected?General.Confirm(Config.Text_DeleteConfirm,function(t){if(t){var i={Id:e.dg_selected.Id};e.loadingVisible=!0,a.delete(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.IsDocument||(e.tree_selected.Items=e.tree_selected.Items-1,e.tree_instance.refresh()),e.doRefresh=!0,e.bind()},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})}}):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_new={text:"New",type:"default",icon:"plus",width:120,onClick:function(t){if(e.IsDocument||e.tree_selected){var i={Id:null,FolderId:e.tree_selected?e.tree_selected.Id:null};e.IsDocument?n.$broadcast("InitAddDocument",i):n.$broadcast("InitAddLibrary",i)}else General.ShowNotify("Please select a folder.","error")}},e.IsEditFolder=!1,e.btn_new_folder={text:"",type:"default",icon:"plus",onClick:function(t){e.folderId=null,e.tree_selected&&(e.folderId=e.tree_selected.Id),e.IsEditFolder=!1,e.popup_folder_visible=!0}},e.btn_edit_folder={text:"",type:"default",icon:"edit",onClick:function(t){e.tree_selected?(e.folder=e.tree_selected.Title,e.folderId=null,e.tree_selected.ParentId&&(e.folderId=e.tree_selected.ParentId),e.IsEditFolder=!0,e.popup_folder_visible=!0):General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_delete_folder={text:"",type:"danger",icon:"clear",onClick:function(t){if(e.tree_selected){e.loadingVisible=!0;var i={Id:e.tree_selected.Id};a.deleteFolder(i).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.tree_ds=Enumerable.From(e.tree_ds).Where("$.Id!="+e.tree_selected.Id).OrderBy("$.Fullcode").ToArray(),e.tree_instance.refresh(),e.tree_selected=null,e.folderId=null},function(t){e.loadingVisible=!1,e.popup_folder_visible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_edit={text:"Edit",type:"default",icon:"edit",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_book_instance),e.dg_selected){var i=e.dg_selected;e.IsDocument?n.$broadcast("InitAddDocument",i):n.$broadcast("InitAddLibrary",i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_view={text:"View",type:"default",width:120,onClick:function(t){if(e.dg_selected=n.getSelectedRow(e.dg_book_instance),e.dg_selected){var i=e.dg_selected;e.IsDocument?n.$broadcast("InitAddDocument",i):n.$broadcast("InitAddLibrary",i)}else General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_expose={text:"Expose",type:"default",icon:"ion ion-ios-cloud",width:120,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_book_instance),e.dg_selected?e.popup_expose_visible=!0:General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_move={text:"Move",type:"default",icon:"ion ion-ios-folder",width:120,onClick:function(t){e.dg_selecteds=n.getSelectedRows(e.dg_book_instance),e.dg_selecteds&&0!=e.dg_selecteds.length?e.popup_move_visible=!0:General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.btn_employees={text:"Employees",type:"default",icon:"group",width:200,onClick:function(t){e.dg_selected=n.getSelectedRow(e.dg_book_instance),e.dg_selected?e.popup_employees_visible=!0:General.ShowNotify(Config.Text_NoRowSelected,"error")}},e.loadingVisible=!1,e.loadPanel={message:"Please wait...",showIndicator:!0,showPane:!0,shading:!0,closeOnOutsideClick:!1,shadingColor:"rgba(0,0,0,0.4)",onShown:function(){},onHidden:function(){},bindingOptions:{visible:"loadingVisible"}},e.txt_Abstract={hoverStateEnabled:!1,height:120,readOnly:!0,bindingOptions:{value:"dg_book_selected.Abstract"}},e.txt_Keywords={hoverStateEnabled:!1,height:50,readOnly:!0,bindingOptions:{value:"dg_book_selected.Keywords"}},e.txt_Authors={hoverStateEnabled:!1,height:70,readOnly:!0,bindingOptions:{value:"authors"}},e.itemCaption="Details",e.IsDetailsVisible=!1,e.img_url="content/images/image.png",e.authors="",e.publisher="",e.No="",e.Sender="",e.PublisherCaption="Publisher",e.isbn="",e.bookid="",e.itemType=-1,e.dg_book_columns=[{dataField:"IsExposed",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){1==t.value&&$("<div>").append("<img src='content/images/eye.png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"FileCount",caption:"Files",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:60,fixed:!0,fixedPosition:"left"},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:500,fixed:!0,fixedPosition:"left",sortIndex:1,sortOrder:"asc"},{dataField:"Edition",caption:"Revision",allowResizing:!0,dataType:"string",allowEditing:!1,width:200},{dataField:"Issue",caption:"Issue",allowResizing:!0,alignment:"center",dataType:"number",allowEditing:!1,width:200},{dataField:"Category",caption:"Category",allowResizing:!0,dataType:"string",allowEditing:!1,width:200},{dataField:"Publisher",caption:"Publisher",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"DateEffective",caption:"Effective",allowResizing:!0,dataType:"string",allowEditing:!1,width:200,alignment:"center"},{dataField:"DateRelease",caption:"Publication Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200},{dataField:"DateExposure",caption:"Exposure Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200}],e.dg_book_height=100,e.dg_book_selected=null,e.dg_book_instance=null,e.dg_book_ds=null,e.dg_book={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"multiple"},columnAutoWidth:!1,columns:e.dg_book_columns,onContentReady:function(t){e.dg_book_instance||(e.dg_book_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_book_selected=i,e.itemCaption=i.Title,e.img_url=i.ImageUrl?n.clientsFilesUrl+i.ImageUrl:"content/images/image.png",e.authors=i.Authors?i.Authors.split(",").join("<br/>"):"",e.publisher=i.Publisher,e.isbn=i.ISBN,e.bookid=i.Id,e.IsDetailsVisible=!0,e.PublisherCaption="Publisher",e.itemType=i.TypeId,84==i.TypeId&&(e.PublisherCaption="Published In",e.publisher=i.Journal),a.getBookFiles(i.Id).then(function(t){e.bookFiles=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})):(e.dg_book_selected=null,e.itemCaption="Details",e.img_url="content/images/image.png",e.authors="",e.publisher="",e.PublisherCaption="Publisher",e.isbn="",e.IsDetailsVisible=!1,e.itemType=-1,e.bookFiles=null)},height:$(window).height()-175,bindingOptions:{dataSource:"dg_book_ds"}},e.dg_doc_columns=[{dataField:"IsExposed",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){1==t.value&&$("<div>").append("<img src='content/images/eye.png' />").appendTo(e)},fixed:!0,fixedPosition:"left"},{dataField:"No",caption:"No",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150,fixed:!0,fixedPosition:"left"},{dataField:"Category",caption:"Category",allowResizing:!0,dataType:"string",allowEditing:!1,width:200},{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:400,fixed:!0,fixedPosition:"left",sortIndex:1,sortOrder:"asc"},{dataField:"Sender",caption:"Sender",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:300},{dataField:"Edition",caption:"Edition",allowResizing:!0,dataType:"string",allowEditing:!1,width:200},{dataField:"DateEffective",caption:"Effective",allowResizing:!0,dataType:"string",allowEditing:!1,width:200,alignment:"center"},{dataField:"DateRelease",caption:"Publication Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200},{dataField:"DateExposure",caption:"Exposure Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:200},{dataField:"Id",caption:"",width:130,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){$("<div>").append("<a  href='downloadhandler.ashx?t=book&id="+t.value+"' class='w3-button w3-block w3-blue' style=' margin:0 auto 0px auto;text-decoration:none'>Download</a>").appendTo(e)},fixed:!0,fixedPosition:"right"}],e.dg_doc_height=100,e.dg_doc_selected=null,e.dg_doc_instance=null,e.dg_doc_ds=null,e.dg_doc={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},columnAutoWidth:!1,columns:e.dg_doc_columns,onContentReady:function(t){e.dg_book_instance||(e.dg_book_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.dg_book_selected=i,e.itemCaption=i.Title,e.img_url=i.ImageUrl?n.clientsFilesUrl+i.ImageUrl:"content/images/image.png",e.authors=i.Authors?i.Authors.split(",").join("<br/>"):"",e.publisher=i.Publisher,e.isbn=i.ISBN,e.bookid=i.Id,e.IsDetailsVisible=!0,e.PublisherCaption="Publisher",e.itemType=i.TypeId,e.No=i.No,e.Sender=i.Sender,84==i.TypeId&&(e.PublisherCaption="Published In",e.publisher=i.Journal)):(e.dg_book_selected=null,e.itemCaption="Details",e.img_url="content/images/image.png",e.authors="",e.publisher="",e.PublisherCaption="Publisher",e.isbn="",e.IsDetailsVisible=!1,e.No="",e.Sender="",e.itemType=-1)},height:$(window).height()-175,bindingOptions:{dataSource:"dg_book_ds"}},e.dg_file_columns=[{dataField:"SysUrl",caption:"File(s)",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1},{dataField:"Id",caption:"",width:60,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){$("<div>").append("<a  href='downloadhandler.ashx?t=bookfile&id="+t.value+"' class='w3-button w3-block w3-blue' style=' margin:0 auto 0px auto;text-decoration:none;padding:8px !important;border-radius:50%;width:40px'> <i class='icon ion-md-cloud-download ion-20'></i></a>").appendTo(e)},fixed:!0,fixedPosition:"right"}],e.dg_file_selected=null,e.dg_file_instance=null,e.dg_file={editing:{allowUpdating:!1,allowDeleting:!1},showColumnHeaders:!0,showRowLines:!0,showColumnLines:!1,sorting:{mode:"multiple"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"single"},filterRow:{visible:!1,showOperationChooser:!0},columnAutoWidth:!1,columns:e.dg_file_columns,onContentReady:function(t){e.dg_file_instance||(e.dg_file_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_file_selected=i||null},height:$(window).height()-220,bindingOptions:{dataSource:"bookFiles"}},e.dg_employees_columns=[{dataField:"IsVisited",caption:"",width:55,allowFiltering:!1,allowSorting:!1,cellTemplate:function(e,t){var i=0==t.value?"notvisited":"visited";$("<div>").append("<img src='content/images/"+i+".png' />").appendTo(e)},fixed:!0,fixedPosition:"left",sortIndex:0,sortOrder:"desc"},{dataField:"Name",caption:"Name",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,fixed:!0,fixedPosition:"left",sortIndex:1,sortOrder:"asc"},{dataField:"NID",caption:"National Code",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"Mobile",caption:"Mobile",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:150},{dataField:"Email",caption:"Email",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,width:200},{dataField:"PID",caption:"Personnel Id",allowResizing:!0,alignment:"center",dataType:"string",allowEditing:!1,width:130},{dataField:"DateVisit",caption:"Visit Date",allowResizing:!0,alignment:"center",dataType:"date",allowEditing:!1,width:130}],e.dg_employees_height=100,e.dg_employees_selected=null,e.dg_employees_instance=null,e.dg_employees_ds=null,e.dg_employees={headerFilter:{visible:!1},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",columnFixing:{enabled:!0},allowColumnReordering:!0,allowColumnResizing:!0,scrolling:{mode:"infinite"},paging:{pageSize:100},showBorders:!0,selection:{mode:"multiple"},columnAutoWidth:!1,height:"100%",columns:e.dg_employees_columns,onContentReady:function(t){e.dg_employees_instance||(e.dg_employees_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];e.dg_employees_selected=i||null},summary:{totalItems:[{column:"PID",summaryType:"count"}]},bindingOptions:{dataSource:"applicableEmployees",height:"dg_employees_height"}},e.selectedEmployees=null,e.pop_width_employees=600,e.pop_height_employees=450,e.dg_height_full=100,e.scroll_height_full=400,e.popup_employees_visible=!1,e.popup_employees_title="Employees",e.popup_employees={fullScreen:!1,showTitle:!0,toolbarItems:[{widget:"dxButton",location:"before",options:{type:"default",width:200,text:"Notify",icon:"ion ion-ios-notifications",onClick:function(t){e.selectedEmployees=n.getSelectedRows(e.dg_employees_instance),e.selectedEmployees?(e.Notify.Message="Dear [#Name],\r\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.\r\n\r\n<strong>"+e.dg_selected.Title+"</strong>\r\n\r\nYour(s) sincerely\r\n"+n.userTitle+"\r\n"+moment().format("MMMM Do YYYY, h:mm:ss a"),e.popup_notify_visible=!0):General.ShowNotify(Config.Text_NoRowSelected,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_employees_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(t){var i=n.getWindowSize();e.pop_width_employees=i.width-20,e.pop_height_employees=$(window).height()-30,e.dg_height_full=e.pop_height_employees-133,e.dg_employees_height=e.dg_height_full-81,e.scroll_height_full=e.pop_height_employees-133},onShown:function(t){e.bindEmployees()},onHiding:function(){e.applicableEmployees=[],e.popup_employees_visible=!1},bindingOptions:{visible:"popup_employees_visible",width:"pop_width_employees",height:"pop_height_employees",title:"popup_employees_title"}},e.popup_expose_visible=!1,e.popup_expose_title="Expose Book",e.popup_expose={fullScreen:!1,showTitle:!0,height:200,width:500,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",onClick:function(t){e.expose.BookId=e.dg_selected.Id,e.loadingVisible=!0,a.exposeBook(e.expose).then(function(t){e.loadingVisible=!1,e.expose={BookId:null,SMS:!0,Email:!0,AppNotification:!0,CustomerId:Config.CustomerId},e.$broadcast("getFilterQuery",null),e.popup_expose_visible=!1},function(t){e.loadingVisible=!1,e.popup_expose_visible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_expose_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.expose={BookId:null,SMS:!0,Email:!0,AppNotification:!0,CustomerId:Config.CustomerId},e.popup_expose_visible=!1},bindingOptions:{visible:"popup_expose_visible",title:"popup_expose_title"}},e.popup_folder_visible=!1,e.popup_folder_title="Folder",e.popup_folder={fullScreen:!1,showTitle:!0,height:290,width:500,toolbarItems:[{widget:"dxButton",location:"after",options:{validationGroup:"folderadd",type:"success",text:"Save",icon:"check",onClick:function(t){if(t.validationGroup.validate().isValid){var i={Id:-1,ParentId:e.folderId,Title:e.folder};e.IsEditFolder&&(i.Id=e.tree_selected.Id),e.loadingVisible=!0,a.saveFolder(i).then(function(t){switch(e.loadingVisible=!1,e._type){case"83":t.Items=t.Items83;break;case"84":t.Items=t.Items84;break;case"85":t.Items=t.Items85;break;case"86":t.Items=t.Items86}General.ShowNotify(Config.Text_SavedOk,"success");var i=e.folderId;if(e.IsEditFolder){var n=Enumerable.From(e.tree_ds).Where("$.Id=="+t.Id).FirstOrDefault();n.TitleFormated=t.TitleFormated,n.Title=t.Title,n.Fullcode=t.Fullcode,n.ParentId=t.ParentId,n.TitleFormatedSpace=t.TitleFormatedSpace,n.Items=t.Items,e.tree_ds=Enumerable.From(e.tree_ds).OrderBy("$.Fullcode").ToArray(),console.log(e.tree_ds),console.log(n),e.tree_instance.refresh(),e.popup_folder_visible=!1}else e.tree_ds.push(t),e.folderId=i,e.folder=null,e.tree_ds=Enumerable.From(e.tree_ds).OrderBy("$.Fullcode").ToArray()},function(t){e.loadingVisible=!1,e.popup_folder_visible=!1,General.ShowNotify(t.message,"error")})}else General.ShowNotify(Config.Text_FillRequired,"error")}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_folder_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_folder_visible=!1},bindingOptions:{visible:"popup_folder_visible",title:"popup_folder_title"}},e.popup_move_visible=!1,e.popup_move_title="Move",e.popup_move={fullScreen:!1,showTitle:!0,height:230,width:500,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",onClick:function(t){if(e.selectedFolderId){var i=Enumerable.From(e.dg_selecteds).Select("$.Id").ToArray().join("_"),n={folderId:e.selectedFolderId,ids:i};e.loadingVisible=!0,a.move(n).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.tree_selected.Items=e.tree_selected.Items-e.dg_selecteds.length;var i=Enumerable.From(e.tree_ds).Where("$.Id=="+e.selectedFolderId).FirstOrDefault();i.Items=i.Items+e.dg_selecteds.length,e.tree_instance.refresh(),e.$broadcast("getFilterQuery",null),e.popup_move_visible=!1},function(t){e.loadingVisible=!1,e.popup_move_visible=!1,General.ShowNotify(t.message,"error")})}}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_move_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.popup_move_visible=!1},bindingOptions:{visible:"popup_move_visible",title:"popup_move_title"}},e.popup_notify_visible=!1,e.popup_notify_title="Notify",e.popup_notify={fullScreen:!1,showTitle:!0,height:500,width:500,toolbarItems:[{widget:"dxButton",location:"after",options:{type:"success",text:"Save",icon:"check",onClick:function(t){e.Notify.ObjectId=e.dg_selected.Id,e.Notify.Message=e.Notify.Message.replace(/\r?\n/g,"<br />");var i=Enumerable.From(e.selectedEmployees).Select("{EmployeeId:$.EmployeeId,Name:$.Name}").ToArray();$.each(i,function(t,i){e.Notify.Employees.push(i.EmployeeId),e.Notify.Names.push(i.Name)}),e.loadingVisible=!0,l.notify(e.Notify).then(function(t){e.loadingVisible=!1,General.ShowNotify(Config.Text_SavedOk,"success"),e.Notify={ModuleId:n.moduleId,TypeId:97,SMS:!0,Email:!0,App:!0,Message:null,CustomerId:Config.CustomerId,SenderId:null,Employees:[],Names:[]},e.popup_notify_visible=!1},function(t){e.loadingVisible=!1,e.popup_notify_visible=!1,General.ShowNotify(t.message,"error")})}},toolbar:"bottom"},{widget:"dxButton",location:"after",options:{type:"danger",text:"Close",icon:"remove",onClick:function(t){e.popup_notify_visible=!1}},toolbar:"bottom"}],visible:!1,dragEnabled:!1,closeOnOutsideClick:!1,onShowing:function(e){},onShown:function(e){},onHiding:function(){e.Notify={ModuleId:n.moduleId,TypeId:97,SMS:!0,Email:!0,App:!0,Message:null,CustomerId:Config.CustomerId,SenderId:null,Employees:[],Names:[]},e.popup_notify_visible=!1},position:"right",bindingOptions:{visible:"popup_notify_visible",title:"popup_notify_title"}},e.expose={BookId:null,SMS:!0,Email:!0,AppNotification:!0,CustomerId:Config.CustomerId},e.chb_SMS={text:"Send SMS",bindingOptions:{value:"expose.SMS"}},e.chb_Email={text:"Send Email",bindingOptions:{value:"expose.Email"}},e.chb_AppNotification={text:"Send Notification",bindingOptions:{value:"expose.AppNotification"}},e.Notify={ModuleId:n.moduleId,TypeId:97,SMS:!0,Email:!0,App:!0,Message:null,CustomerId:Config.CustomerId,SenderId:null,Employees:[],Names:[]},e.chb_SMSNotify={text:"Send SMS",bindingOptions:{value:"Notify.SMS"}},e.chb_EmailNotify={text:"Send Email",bindingOptions:{value:"Notify.Email"}},e.chb_AppNotificationNotify={text:"Send Notification",bindingOptions:{value:"Notify.AppNotification"}},e.txt_MessageNotify={hoverStateEnabled:!1,height:300,bindingOptions:{value:"Notify.Message"}},e.doRefresh=!1,e.filters=[],e.getFilters=function(){var t=e.filters;return 0==t.length&&(t=[["Id",">",0]]),t},e.bind=function(){var t=e.IsDocument?"odata/library/documents/"+Config.CustomerId:"odata/library/books/folder/"+Config.CustomerId+"/"+e.tree_selected.Fullcode+"/0";e.dg_book_ds||(e.dg_book_ds={store:{type:"odata",url:n.serviceUrl+t,key:"Id",version:4,onLoaded:function(e){n.$broadcast("OnDataLoaded",null)},beforeSend:function(t){e.dsUrl=General.getDsUrl(t),n.$broadcast("OnDataLoading",null)}},sort:[{getter:"DateCreate",desc:!0}]}),e.doRefresh&&(e.filters=e.getFilters(),e.dg_book_ds.filter=e.filters,e.dg_book_instance.refresh(),e.doRefresh=!1)},e.applicableEmployees=[],e.bindEmployees=function(){e.loadingVisible=!0,a.getBookApplicableEmployees(e.dg_selected.Id).then(function(t){e.loadingVisible=!1,console.log(t),e.applicableEmployees=t},function(t){e.loadingVisible=!1,General.ShowNotify(t.message,"error")})},e.filterTiles=[],e.EmployeeTotal=0,e.filterStatus=function(t,i){$(t.currentTarget).hasClass("w3-2017-flame")?($(t.currentTarget).removeClass("w3-2017-flame"),e.filterTiles=Enumerable.From(e.filterTiles).Where("$!="+i).ToArray()):($(t.currentTarget).addClass("w3-2017-flame"),e.filterTiles.push(i));var n=[];$.each(e.filterTiles,function(e,t){switch(t){case-1:n.push(["IsVisited","=",!1]),n.push("and");break;case-2:n.push(["IsDownloaded","=",!1]),n.push("and");break;case 1:n.push(["IsVisited","=",!0]),n.push("and");break;case 2:n.push(["IsDownloaded","=",!0]),n.push("and")}}),n.length>0?(n.pop(),e.dg_employees_instance.filter(n)):e.dg_employees_instance.clearFilter()},e.tree_columns=[{dataField:"Title",caption:"Title",allowResizing:!0,alignment:"left",dataType:"string",allowEditing:!1,encodeHtml:!1},{dataField:"Items",caption:"Items",allowResizing:!0,alignment:"center",dataType:"string",width:100,allowEditing:!1},{dataField:"Files",caption:"Files",allowResizing:!0,alignment:"center",dataType:"string",width:100,allowEditing:!1}],e.tree_selected=null,e.tree_instance=null,e.tree_ds=null,e.expandedRow=null,e.tree={selection:{mode:"single"},filterRow:{visible:!0,showOperationChooser:!0},showRowLines:!0,showColumnLines:!0,sorting:{mode:"none"},noDataText:"",allowColumnReordering:!0,allowColumnResizing:!0,editing:{mode:"cell",allowAdding:!1,allowUpdating:!0,allowDeleting:!1},dataSource:e.tree_ds,onContentReady:function(t){e.tree_instance||(e.tree_instance=t.component)},onSelectionChanged:function(t){var i=t.selectedRowsData[0];i?(e.tree_selected=i,e.dg_book_ds=null,e.$broadcast("getFilterQuery",null)):(e.tree_selected=null,e.dg_book_ds=null)},keyExpr:"Id",parentIdExpr:"ParentId",showBorders:!0,columns:e.tree_columns,headerFilter:{visible:!0},height:$(window).height()-180,wordWrapEnabled:!0,bindingOptions:{dataSource:"tree_ds",expandedRowKeys:"expandedRow"}},e.selectedFolderId=null,e.sb_folder={showClearButton:!0,searchEnabled:!0,itemTemplate:function(e){return"<div>"+e.TitleFormated+"</div>"},displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"selectedFolderId",dataSource:"tree_ds"}},e.folderId=null,e.sb_folder_add={showClearButton:!0,searchEnabled:!0,itemTemplate:function(e){return"<div>"+e.TitleFormated+"</div>"},displayExpr:"Title",valueExpr:"Id",bindingOptions:{value:"folderId",dataSource:"tree_ds"}},e.folder=null,e.txt_folder_title={hoverStateEnabled:!1,bindingOptions:{value:"folder"}},e.bindTree=function(){a.getFolders(Config.CustomerId).then(function(t){e.loadingVisible=!1,$.each(t,function(t,i){switch(e._type){case"83":i.Items=i.Items83,i.Files=i.Files83;break;case"84":i.Items=i.Items84,i.Files=i.Files84;break;case"85":i.Items=i.Items85,i.Files=i.Files85;break;case"86":i.Items=i.Items86,i.Files=i.Files86}}),e.tree_ds=t,e.expandedRow=[],e.expandedRow.push(t[0].Id)},function(e){General.ShowNotify(e.message,"error")})},o.isAuthorized()){switch(n.page_title=e.IsDocument?"> Documents":"> Knowledge",e._type){case"83":n.page_title="> Books";break;case"84":n.page_title="> Papers";break;case"85":n.page_title="> Videos"}$(".library").fadeIn(),e.bindTree()}else o.redirectToLogin();e.$on("getFilterResponse",function(t,i){e.filters=i,e.doRefresh=!0,e.bind()}),e.$on("onTemplateSearch",function(t,i){e.$broadcast("getFilterQuery",null)}),e.$on("onLibrarySaved",function(t,i){e.doRefresh=!0}),e.$on("onFolderAdd",function(t,i){e.tree_selected.Items=e.tree_selected.Items+1,e.tree_instance.refresh()}),e.$on("onLibraryHide",function(t,i){e.bind()}),n.$broadcast("LibraryLoaded",null)}]);